<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Springä¹‹Scopeå±æ€§</title>
      <link href="/2025/04/11/Spring%E4%B9%8BScope%E5%B1%9E%E6%80%A7/"/>
      <url>/2025/04/11/Spring%E4%B9%8BScope%E5%B1%9E%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<blockquote><h4 id="Scopeå±æ€§"><a href="#Scopeå±æ€§" class="headerlink" title="Scopeå±æ€§"></a>Scopeå±æ€§</h4><ul><li><code>&lt; bean&gt;</code>çš„ä¸€ä¸ªå±æ€§,æ§åˆ¶å¦‚ä½•å®ä¾‹åŒ–å¯¹è±¡</li></ul><p><strong>Scopeå±æ€§å¯å–å€¼ï¼š</strong></p><ul><li>singleton: é»˜è®¤å€¼,å•ä¾‹çš„.ä½¿ç”¨ApplicationContextå¯åŠ¨æ—¶å®ä¾‹åŒ–å¯¹è±¡</li><li>prototype:åŸå‹.æ¯æ¬¡è°ƒç”¨æ—¶å®ä¾‹åŒ–.</li><li>request:æ¯æ¬¡è¯·æ±‚æ—¶å®ä¾‹åŒ–å¯¹è±¡.</li><li>session:æ¯æ¬¡äº§ç”Ÿsession(HttpSession)æ—¶å®ä¾‹åŒ–</li><li>application:äº§ç”Ÿapplicationå¯¹è±¡æ—¶å®ä¾‹åŒ–.ä¸€èˆ¬éƒ½å®ä¾‹åŒ–ä¸€æ¬¡.</li><li>golbal session: å…¨å±€Golbal Session,webåº”ç”¨ä¸­ä¸€ä¸ªæ–°çš„å…¨å±€HttpSessinå¯¹è±¡.åœ¨spring-webmvc-portletæä¾›</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;bean id=<span class="string">&quot;stu&quot;</span> class=<span class="string">&quot;com.spring1.Student&quot;</span> scope=<span class="string">&quot;prototype&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure></blockquote><p>è¿™äº›éƒ½æ˜¯ Spring æ¡†æ¶ä¸­ <strong>Bean çš„ä½œç”¨åŸŸï¼ˆScopeï¼‰</strong> å±æ€§çš„å¯é€‰å€¼ï¼Œå®ƒä»¬å†³å®šäº† Spring å®¹å™¨æ˜¯å¦‚ä½•åˆ›å»ºå’Œç®¡ç† Bean å®ä¾‹çš„ã€‚ä¸‹é¢æˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹æ¯ä¸ªä½œç”¨åŸŸçš„å«ä¹‰ã€é€‚ç”¨åœºæ™¯ä»¥åŠæ³¨æ„äº‹é¡¹ï¼š</p><hr><blockquote><p>åŸºç¡€ç±»ï¼š</p><pre><code>@Componentpublic class MyBean &#123;    private final String id = UUID.randomUUID().toString();        public String getId() &#123;        return id;        &#125;&#125;</code></pre></blockquote><h3 id="1-singletonï¼ˆå•ä¾‹ï¼‰-â€“-é»˜è®¤å€¼"><a href="#1-singletonï¼ˆå•ä¾‹ï¼‰-â€“-é»˜è®¤å€¼" class="headerlink" title="1. singletonï¼ˆå•ä¾‹ï¼‰ â€“ é»˜è®¤å€¼"></a>1. <strong>singletonï¼ˆå•ä¾‹ï¼‰</strong> â€“ é»˜è®¤å€¼</h3><ul><li><p><strong>è§£é‡Š</strong>ï¼šSpring å®¹å™¨ä¸­åªåˆ›å»º <strong>ä¸€ä¸ªå…±äº«çš„ Bean å®ä¾‹</strong>ï¼Œæ‰€æœ‰è¯·æ±‚ï¼ˆæ— è®ºæ˜¯å•çº¿ç¨‹è¿˜æ˜¯å¤šçº¿ç¨‹ï¼‰éƒ½è¿”å›è¿™ä¸ªå®ä¾‹ã€‚</p></li><li><p><strong>å®ä¾‹åŒ–æ—¶æœº</strong>ï¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶å°±å®ä¾‹åŒ–ï¼ˆå¦‚æœæ˜¯ <code>ApplicationContext</code> å¯åŠ¨ï¼‰</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ— çŠ¶æ€ã€çº¿ç¨‹å®‰å…¨çš„ Beanï¼ˆå¦‚ Service å±‚ï¼‰</p></li><li><p><strong>ç¤ºæ„</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;singleton&quot;)</span> <span class="comment">// å¯çœç•¥ï¼Œé»˜è®¤å°±æ˜¯ singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonBean</span> <span class="keyword">extends</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SingletonBean singletonBean;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/singleton&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;singleton bean ID: &quot;</span> + singletonBean.getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>è¯´æ˜</strong>ï¼šæ— è®ºè®¿é—®å‡ æ¬¡ <code>/singleton</code>ï¼Œå¾—åˆ°çš„ ID æ˜¯ä¸€æ ·çš„ã€‚</p><hr><h3 id="2-prototypeï¼ˆåŸå‹ï¼‰"><a href="#2-prototypeï¼ˆåŸå‹ï¼‰" class="headerlink" title="2. prototypeï¼ˆåŸå‹ï¼‰"></a>2. <strong>prototypeï¼ˆåŸå‹ï¼‰</strong></h3><ul><li><p><strong>è§£é‡Š</strong>ï¼š<strong>æ¯æ¬¡è°ƒç”¨ Bean æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹</strong>ã€‚Spring ç®¡ç†åˆ›å»ºåŠ¨ä½œï¼Œç”Ÿå‘½å‘¨æœŸç”±è°ƒç”¨è€…è´Ÿè´£ï¼ˆä¸ä¼šè‡ªåŠ¨é”€æ¯ï¼‰</p></li><li><p><strong>å®ä¾‹åŒ–æ—¶æœº</strong>ï¼šæ¯æ¬¡è°ƒç”¨æ—¶æ‰ä¼šå®ä¾‹åŒ–</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæœ‰çŠ¶æ€çš„å¯¹è±¡æˆ–éçº¿ç¨‹å®‰å…¨çš„åœºæ™¯</p></li><li><p><strong>ç¤ºæ„</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrototypeBean</span> <span class="keyword">extends</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrototypeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectFactory&lt;PrototypeBean&gt; prototypeBeanFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/prototype&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrototype</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">PrototypeBean</span> <span class="variable">prototypeBean</span> <span class="operator">=</span> prototypeBeanFactory.getObject();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;prototype bean ID: &quot;</span> + prototypeBean.getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼šæ¯æ¬¡è®¿é—® <code>/prototype</code> ä¼šè¿”å›ä¸åŒçš„ IDã€‚</p></li></ul><hr><h3 id="3-requestï¼ˆè¯·æ±‚ä½œç”¨åŸŸï¼‰"><a href="#3-requestï¼ˆè¯·æ±‚ä½œç”¨åŸŸï¼‰" class="headerlink" title="3. requestï¼ˆè¯·æ±‚ä½œç”¨åŸŸï¼‰"></a>3. <strong>requestï¼ˆè¯·æ±‚ä½œç”¨åŸŸï¼‰</strong></h3><ul><li><p><strong>è§£é‡Š</strong>ï¼š<strong>æ¯ä¸€ä¸ª HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹</strong>ï¼Œè¯·æ±‚ç»“æŸåï¼Œè¯¥ Bean è¢«é”€æ¯</p></li><li><p><strong>ä½¿ç”¨é™åˆ¶</strong>ï¼šåªèƒ½ç”¨äº Web åº”ç”¨ï¼Œå¹¶ä¸”éœ€è¦ Spring Web ç¯å¢ƒ</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¦‚ Controller å±‚ä¸­å’Œç”¨æˆ·è¯·æ±‚å¼ºç›¸å…³çš„å¯¹è±¡</p></li><li><p><strong>ç¤ºæ„</strong>ï¼ˆWeb é¡¹ç›®ä¸­æœ‰æ•ˆï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;request&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestBean</span> <span class="keyword">extends</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RequestBean requestBean;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/request&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRequest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;request bean ID: &quot;</span> + requestBean.getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼šæ¯æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°å®ä¾‹ã€‚</p></li></ul><hr><h3 id="4-sessionï¼ˆä¼šè¯ä½œç”¨åŸŸï¼‰"><a href="#4-sessionï¼ˆä¼šè¯ä½œç”¨åŸŸï¼‰" class="headerlink" title="4. sessionï¼ˆä¼šè¯ä½œç”¨åŸŸï¼‰"></a>4. <strong>sessionï¼ˆä¼šè¯ä½œç”¨åŸŸï¼‰</strong></h3><ul><li><p><strong>è§£é‡Š</strong>ï¼š<strong>æ¯ä¸€ä¸ª HTTP ä¼šè¯ï¼ˆHttpSessionï¼‰æ‹¥æœ‰ä¸€ä¸ª Bean å®ä¾‹</strong></p></li><li><p><strong>ä½¿ç”¨é™åˆ¶</strong>ï¼šåªèƒ½ç”¨äº Web ç¯å¢ƒ</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€è¦ä¿å­˜ç”¨æˆ·ä¼šè¯çŠ¶æ€çš„ç»„ä»¶ï¼ˆå¦‚è´­ç‰©è½¦ï¼‰</p></li><li><p><strong>ç¤ºæ„</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;session&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionBean</span> <span class="keyword">extends</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SessionBean sessionBean;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/session&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;session bean ID: &quot;</span> + sessionBean.getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼šæ¯ä¸ªä¼šè¯æœ‰è‡ªå·±çš„å®ä¾‹ï¼ŒåŒä¸€ä¸ªæµè§ˆå™¨åˆ·æ–°é¡µé¢ ID ä¸å˜ï¼Œæ¢æµè§ˆå™¨ ID ä¼šå˜ã€‚</p></li></ul><hr><h3 id="5-applicationï¼ˆåº”ç”¨ä½œç”¨åŸŸï¼‰"><a href="#5-applicationï¼ˆåº”ç”¨ä½œç”¨åŸŸï¼‰" class="headerlink" title="5. applicationï¼ˆåº”ç”¨ä½œç”¨åŸŸï¼‰"></a>5. <strong>applicationï¼ˆåº”ç”¨ä½œç”¨åŸŸï¼‰</strong></h3><ul><li><p><strong>è§£é‡Š</strong>ï¼šBean çš„ç”Ÿå‘½å‘¨æœŸä¸ ServletContext ç›¸åŒã€‚æ•´ä¸ª Web åº”ç”¨å…±äº«ä¸€ä¸ªå®ä¾‹ï¼ˆç±»ä¼¼ singletonï¼Œä½†å— Web å®¹å™¨ç®¡ç†ï¼‰</p></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå…¨å±€å…±äº«èµ„æºï¼Œä¸”æ˜¯ Web åº”ç”¨</p></li><li><p><strong>ç¤ºæ„</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;application&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationBean</span> <span class="keyword">extends</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationBean applicationBean;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/application&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getApplication</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;application bean ID: &quot;</span> + applicationBean.getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜</strong>ï¼šæ•´ä¸ª Web åº”ç”¨èŒƒå›´å†…åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œç±»ä¼¼ singletonï¼Œä½†ä½œç”¨åŸŸæ›´æ˜ç¡®æ˜¯ Web å…¨å±€ã€‚</p></li></ul><hr><h3 id="6-globalSessionï¼ˆå…¨å±€ä¼šè¯ä½œç”¨åŸŸï¼‰"><a href="#6-globalSessionï¼ˆå…¨å±€ä¼šè¯ä½œç”¨åŸŸï¼‰" class="headerlink" title="6. globalSessionï¼ˆå…¨å±€ä¼šè¯ä½œç”¨åŸŸï¼‰"></a>6. <strong>globalSessionï¼ˆå…¨å±€ä¼šè¯ä½œç”¨åŸŸï¼‰</strong></h3><ul><li><p><strong>è§£é‡Š</strong>ï¼š<strong>ä»…åœ¨ Portlet åº”ç”¨ä¸­ä½¿ç”¨</strong>ï¼Œä»£è¡¨ä¸€ä¸ªå…¨å±€çš„ HTTP Sessionï¼ˆå¤šä¸ª Portlet å…±äº«ï¼‰ã€‚</p></li><li><p><strong>æ³¨æ„</strong>ï¼šåœ¨æ™®é€šçš„ Web åº”ç”¨ä¸­æ— æ•ˆï¼Œåªé€‚ç”¨äºä½¿ç”¨ Spring Portlet MVC çš„åœºæ™¯ã€‚</p></li><li><p><strong>ç¤ºæ„</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;globalSession&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalSessionBean</span> <span class="keyword">extends</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>âš ï¸ æ³¨æ„ï¼š<code>globalSession</code> åªåœ¨ Portlet ç¯å¢ƒä¸­ï¼ˆå¦‚ Liferay ç­‰é—¨æˆ·ç³»ç»Ÿï¼‰ä½¿ç”¨ã€‚Spring MVC æ™®é€š Web é¡¹ç›®æ— æ³•ä½¿ç”¨è¯¥ä½œç”¨åŸŸï¼Œä¼šæŠ›å¼‚å¸¸ã€‚</p></li></ul><hr><h3 id="ğŸŒŸ-ç®€å•å¯¹æ¯”æ€»ç»“"><a href="#ğŸŒŸ-ç®€å•å¯¹æ¯”æ€»ç»“" class="headerlink" title="ğŸŒŸ ç®€å•å¯¹æ¯”æ€»ç»“"></a>ğŸŒŸ ç®€å•å¯¹æ¯”æ€»ç»“</h3><table><thead><tr><th>Scope</th><th>æ˜¯å¦ Web ç¯å¢ƒ</th><th>å®ä¾‹æ•°é‡</th><th>ç”Ÿå‘½å‘¨æœŸ</th></tr></thead><tbody><tr><td>singleton</td><td>å¦</td><td>å®¹å™¨ä¸­ä¸€ä¸ª</td><td>å®¹å™¨å¯åŠ¨åˆ°é”€æ¯</td></tr><tr><td>prototype</td><td>å¦</td><td>æ¯æ¬¡è¯·æ±‚æ–°å»º</td><td>è°ƒç”¨è€…è´Ÿè´£ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td>request</td><td>æ˜¯</td><td>æ¯ä¸ª HTTP è¯·æ±‚ä¸€ä¸ª</td><td>è¯·æ±‚å®Œæˆåé”€æ¯</td></tr><tr><td>session</td><td>æ˜¯</td><td>æ¯ä¸ªä¼šè¯ä¸€ä¸ª</td><td>ä¼šè¯ç»“æŸåé”€æ¯</td></tr><tr><td>application</td><td>æ˜¯</td><td>å…¨ Web åº”ç”¨å…±äº«</td><td>åº”ç”¨ç»“æŸæ—¶é”€æ¯</td></tr><tr><td>globalSession</td><td>æ˜¯ï¼ˆPortletï¼‰</td><td>å…¨å±€ä¼šè¯å…±äº«</td><td>Portlet å…¨å±€ä¼šè¯ç»“æŸé”€æ¯</td></tr></tbody></table><hr>]]></content>
      
      
      <categories>
          
          <category> Spring åŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaåŸºç¡€</title>
      <link href="/2025/01/12/Java%E5%9F%BA%E7%A1%80/"/>
      <url>/2025/01/12/Java%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é›†åˆ</title>
      <link href="/2025/01/01/%E9%9B%86%E5%90%88/"/>
      <url>/2025/01/01/%E9%9B%86%E5%90%88/</url>
      
        <content type="html"><![CDATA[<h3 id="æ¥å£ç»§æ‰¿å…³ç³»å’Œå®ç°"><a href="#æ¥å£ç»§æ‰¿å…³ç³»å’Œå®ç°" class="headerlink" title="æ¥å£ç»§æ‰¿å…³ç³»å’Œå®ç°"></a>æ¥å£ç»§æ‰¿å…³ç³»å’Œå®ç°</h3><p>é›†åˆç±»å­˜æ”¾äº Java.util åŒ…ä¸­ï¼Œä¸»è¦æœ‰ 3 ç§ï¼šset(é›†ï¼‰ã€list(åˆ—è¡¨åŒ…å« Queueï¼‰å’Œ map(æ˜ å°„)ã€‚ </p><ol><li>Collectionï¼šCollection æ˜¯é›†åˆ Listã€Setã€Queue çš„æœ€åŸºæœ¬çš„æ¥å£ã€‚ </li><li>Iteratorï¼šè¿­ä»£å™¨ï¼Œå¯ä»¥é€šè¿‡è¿­ä»£å™¨éå†é›†åˆä¸­çš„æ•°æ® </li><li>Mapï¼šæ˜¯æ˜ å°„è¡¨çš„åŸºç¡€æ¥å£</li></ol><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501012232913.png" alt="image-20250101223201691"></p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501012235985.png" alt="image-20250101223555405"></p><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>Java çš„ List æ˜¯éå¸¸å¸¸ç”¨çš„æ•°æ®ç±»å‹ã€‚List æ˜¯æœ‰åºçš„ Collectionã€‚Java List ä¸€å…±ä¸‰ä¸ªå®ç°ç±»ï¼š </p><p>åˆ†åˆ«æ˜¯ ArrayListã€Vector å’Œ LinkedListã€‚ </p><h4 id="ArrayList-ï¼ˆæ•°ç»„ï¼‰"><a href="#ArrayList-ï¼ˆæ•°ç»„ï¼‰" class="headerlink" title="ArrayList ï¼ˆæ•°ç»„ï¼‰"></a>ArrayList ï¼ˆæ•°ç»„ï¼‰</h4><p>â€‹ArrayListå®ç°äº†Listæ¥å£çš„å¯æ‰©å®¹æ•°ç»„ï¼Œå®ƒå†…éƒ¨æ˜¯åŸºäºæ•°ç»„å®ç°çš„ã€‚å…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt;,RandomAccess, Cloneable, java.io.Serializable &#123;...&#125;</span><br></pre></td></tr></table></figure><p>â€‹æ•°ç»„çš„ç¼ºç‚¹æ˜¯æ¯ä¸ªå…ƒç´ ä¹‹é—´ä¸èƒ½æœ‰é—´éš”ï¼Œå½“æ•°ç»„å¤§å°ä¸æ»¡è¶³æ—¶éœ€è¦å¢åŠ å­˜å‚¨èƒ½åŠ›ï¼Œå°±è¦å°†å·²ç»æœ‰æ•° ç»„çš„æ•°æ®å¤åˆ¶åˆ°æ–°çš„å­˜å‚¨ç©ºé—´ä¸­ã€‚</p><p>â€‹å½“ä»ArrayListçš„ä¸­é—´ä½ç½®æ’å…¥æˆ–è€…åˆ é™¤å…ƒç´ æ—¶ï¼Œéœ€è¦å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ã€ç§»åŠ¨ã€ä»£ä»·æ¯”è¾ƒé«˜ã€‚å› æ­¤ï¼Œå®ƒé€‚åˆéšæœºæŸ»æ‰¾å’Œéå†ï¼Œä¸é€‚åˆæ’å…¥å’Œåˆ é™¤ã€‚</p><blockquote><p>ArrayList å¯ä»¥å®ç°æ‰€æœ‰å¯é€‰æ‹©çš„åˆ—è¡¨æ“ä½œï¼Œå…è®¸æ“ä½œçš„å…ƒç´ ï¼ŒåŒ…æ‹¬æ§åˆ¶ç©ºå€¼ã€‚ArrayListè¿˜æä¾›äº†å†…éƒ¨å­˜å‚¨çš„listæ–¹æ³•ï¼Œå¯ä»¥å®Œå…¨æ›¿ä»£Vectorï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ArrayListæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼ŒVectoræ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></blockquote><h4 id="Vector-ï¼ˆæ•°ç»„å®ç°ã€çº¿ç¨‹åŒæ­¥ï¼‰"><a href="#Vector-ï¼ˆæ•°ç»„å®ç°ã€çº¿ç¨‹åŒæ­¥ï¼‰" class="headerlink" title="Vector ï¼ˆæ•°ç»„å®ç°ã€çº¿ç¨‹åŒæ­¥ï¼‰"></a>Vector ï¼ˆæ•°ç»„å®ç°ã€çº¿ç¨‹åŒæ­¥ï¼‰</h4><p>â€‹Vectorä¸ArrayList ä¸€æ ·ï¼Œä¹Ÿæ˜¯é€šè¿‡æ•°ç»„å®ç°çš„ï¼Œä¸åŒçš„æ˜¯å®ƒæ”¯æŒçº¿ç¨‹çš„åŒæ­¥ï¼Œå³æŸä¸€æ—¶åˆ»åªæœ‰ä¸€ ä¸ªçº¿ç¨‹èƒ½å¤Ÿå†™Vectorï¼Œé¿å…å¤šçº¿ç¨‹åŒæ—¶å†™è€Œå¼•èµ·çš„ä¸ä¸€è‡´æ€§ï¼Œä½†å®ç°åŒæ­¥éœ€è¦å¾ˆé«˜çš„èŠ±è´¹ï¼Œå› æ­¤, è®¿é—®å®ƒæ¯”è®¿é—®ArrayListæ…¢ã€‚</p><h4 id="LinkList-ï¼ˆé“¾è¡¨ï¼‰"><a href="#LinkList-ï¼ˆé“¾è¡¨ï¼‰" class="headerlink" title="LinkList ï¼ˆé“¾è¡¨ï¼‰"></a>LinkList ï¼ˆé“¾è¡¨ï¼‰</h4><p>â€‹LinkedListæ˜¯ç”¨é“¾è¡¨ç»“æ„å­˜å‚¨æ•°æ®çš„ï¼Œå¾ˆé€‚åˆæ•°æ®çš„åŠ¨æ€æ’å…¥å’Œåˆ é™¤ï¼Œéšæœºè®¿é—®å’Œéå†é€Ÿåº¦æ¯”è¾ƒ æ…¢ã€‚å¦å¤–ï¼Œä»–è¿˜æä¾›äº† Listæ¥å£ä¸­æ²¡æœ‰å®šä¹‰çš„æ–¹æ³•ï¼Œä¸“é—¨ç”¨äºæ“ä½œè¡¨å¤´å’Œè¡¨å°¾å…ƒç´ ï¼Œå¯ä»¥å½“ä½œå † æ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—ä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java é›†åˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java é›†åˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå…«å¤§å†…éƒ¨æ’åºç®—æ³•</title>
      <link href="/2025/01/01/Java%E5%85%AB%E5%A4%A7%E5%86%85%E9%83%A8%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"/>
      <url>/2025/01/01/Java%E5%85%AB%E5%A4%A7%E5%86%85%E9%83%A8%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="æ’åºç®—æ³•çš„åˆ†ç±»"><a href="#æ’åºç®—æ³•çš„åˆ†ç±»" class="headerlink" title="æ’åºç®—æ³•çš„åˆ†ç±»"></a>æ’åºç®—æ³•çš„åˆ†ç±»</h2><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010135502.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="æ—¶é—´å¤æ‚åº¦ä»¥åŠç©ºé—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦ä»¥åŠç©ºé—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦ä»¥åŠç©ºé—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦ä»¥åŠç©ºé—´å¤æ‚åº¦</h2><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010135701.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ³¨ï¼šä¸ºäº†è¿›è¡Œä¸€å®šçš„æ¯”è¾ƒï¼Œæ­¤å¤„ä¸æŒ‰ç…§ä¸Šé¢çš„é¡ºåºã€‚</p><h2 id="ç›´æ¥æ’å…¥æ’åº"><a href="#ç›´æ¥æ’å…¥æ’åº" class="headerlink" title="ç›´æ¥æ’å…¥æ’åº"></a>ç›´æ¥æ’å…¥æ’åº</h2><p><strong>åŸºæœ¬æ€æƒ³</strong></p><p>åœ¨è¦æ’åºçš„ä¸€ç»„æ•°ä¸­ï¼Œå‡å®šå‰n-1ä¸ªæ•°å·²ç»æ’å¥½åºï¼Œç°åœ¨å°†ç¬¬nä¸ªæ•°æ’åˆ°å‰é¢çš„æœ‰åºæ•°åˆ—ä¸­ï¼Œä½¿å¾—è¿™nä¸ªæ•°ä¹Ÿæ˜¯æ’å¥½é¡ºåºçš„ã€‚å¦‚æ­¤åå¤å¾ªç¯ï¼Œç›´åˆ°å…¨éƒ¨æ’å¥½é¡ºåºã€‚</p><p>åœºæ™¯ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010135262.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ­£å¦‚å½“æˆ‘ä»¬æ‰“ç‰Œçš„æ—¶å€™ï¼Œéœ€è¦å¯¹æ‰‘å…‹ç‰Œæ’åºã€‚æŠ½åˆ°ç‰Œå(å‡è®¾æ¯æ¬¡åªæŠ½ä¸€å¼ )ï¼Œä¾æ¬¡ä»æ’å¥½åºçš„æ’ä¸­ä¸æ‰‹ä¸­çš„ç‰Œè¿›è¡Œæ¯”è¾ƒï¼Œæ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010135149.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥æ’åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] a)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> a.length;</span><br><span class="line">    <span class="comment">//iéœ€è¦å–åˆ°N-1ï¼Œå¹¶ä¸”è¿™é‡Œçš„iæ˜¯ä»1å¼€å§‹çš„ï¼Œå¯ä»¥è¿™ä¹ˆè®¤ä¸ºç¬¬ä¸€ä¸ªå°±æ˜¯ä¸€ä¸ªåˆå§‹çš„æœ‰åºçš„æ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;N;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=i;j&gt;<span class="number">0</span>;j--)&#123;</span><br><span class="line">            <span class="keyword">if</span> ((a[j-<span class="number">1</span>]&lt;a[j]))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tem</span> <span class="operator">=</span> a[j-<span class="number">1</span>];</span><br><span class="line">            a[j-<span class="number">1</span>] = a[j];</span><br><span class="line">            a[j] = tem;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥æ’åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a æ’åºæ•°ç»„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparable[] a)</span>&#123;</span><br><span class="line">    <span class="comment">//å°†a[] æŒ‰å‡åºæ’åº</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> a.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;N;i++)&#123;<span class="comment">//iéœ€è¦å–åˆ°N-1</span></span><br><span class="line">        <span class="comment">//å°†a[i]æ’å…¥åˆ°a[i-1],a[i-2],a[i-3]...ä¹‹ä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j&gt;<span class="number">0</span>&amp;&amp; Example.more(a[j-<span class="number">1</span>],a[j]); j--)&#123;<span class="comment">//Example.less(a[j-1],a[j])</span></span><br><span class="line">            Example.exch(a,j,j-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ä¸ç©ºé—´å¤æ‚åº¦</p><p>å› ä¸ºæ˜¯å†…éƒ¨æ’åºæ‰€ä»¥ç©ºé—´å¤æ‚åº¦å¯ä»¥ç›´æ¥ä¸è€ƒè™‘å°±æ˜¯0(1)ï¼Œæˆ‘ä»¬æ¥çœ‹æ—¶é—´å¤æ‚åº¦ï¼šä¸»è¦ä½“ç°åœ¨æ¯”è¾ƒæ‰€èŠ±çš„æ—¶é—´ä¸Šï¼Œæœ€åçš„æƒ…å†µä¸‹å°±æ˜¯ï¼š0+1+ 2 + 3 +â€¦.+(n-1)&#x3D;(n-1)*n&#x2F;2&#x3D;0(n^2^)ã€‚</p><p>æœ€åæƒ…å†µï¼šæ•°ç»„å·²ç»æ’åºå¥½ï¼Œä½†æ˜¯ä»å¤§åˆ°å°çš„æ’åºï¼Œæ­¤æ—¶æ¯æ¬¡çš„æ¯”è¾ƒåéƒ½éœ€è¦äº¤æ¢</p><p>æœ€å¥½æƒ…å†µï¼šè¿™ä¸ªå½“ç„¶å°±æ˜¯å·²ç»æ’åºå¥½äº†ï¼ˆä»å°åˆ°å¤§ï¼‰</p><h2 id="å¸Œå°”æ’åº"><a href="#å¸Œå°”æ’åº" class="headerlink" title="å¸Œå°”æ’åº"></a>å¸Œå°”æ’åº</h2><p>ä¹Ÿç§°<strong>é€’å‡å¢é‡æ’åºç®—æ³•</strong>ï¼Œæ˜¯æ’å…¥æ’åºçš„ä¸€ç§æ›´é«˜æ•ˆçš„æ”¹è¿›ç‰ˆæœ¬ã€‚å¸Œå°”æ’åºæ˜¯éç¨³å®šæ’åºç®—æ³•ã€‚</p><p>æ’åºæ€æƒ³ï¼šåœ¨è¦æ’åºçš„ä¸€ç»„æ•°ä¸­ï¼Œæ ¹æ®æŸä¸€å¢é‡åˆ†ä¸ºè‹¥å¹²å­åºåˆ—ï¼Œå¹¶å¯¹å­åºåˆ—åˆ†åˆ«è¿›è¡Œæ’å…¥æ’åºã€‚<br>ç„¶åé€æ¸å°†å¢é‡å‡å°,å¹¶é‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚ç›´è‡³å¢é‡ä¸º1,æ­¤æ—¶æ•°æ®åºåˆ—åŸºæœ¬æœ‰åº,æœ€åè¿›è¡Œæ’å…¥æ’åºã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010135300.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span> a[])</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> a.length;</span><br><span class="line">    <span class="comment">// é—´éš”æ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (h &lt; N / <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="comment">// è·å–é€’å¢åºåˆ—</span></span><br><span class="line">        h = <span class="number">3</span> * h + <span class="number">1</span>; <span class="comment">// 1,4,13,40,121,....</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// å°†æ•°ç»„å˜ä¸ºä»»æ„é—´éš”hçš„å…ƒç´ éƒ½æ˜¯æœ‰åºçš„ï¼ˆhæœ‰åºæ•°ç»„ï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> h; i &lt; N; i++) &#123;</span><br><span class="line">            <span class="comment">// å°†a[i] æ’å…¥åˆ°a[i-h],a[i-2*h],a[i-3*h]...ä¹‹ä¸­</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &gt;= h; j -= h) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[j] &lt; a[j - h]) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">tem</span> <span class="operator">=</span> a[j - h];</span><br><span class="line">                    a[j - h] = a[j];</span><br><span class="line">                    a[j] = tem;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        h = h / <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparable[] a)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> a.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (h&lt;N/<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="comment">//è·å–é€’å¢åºåˆ—</span></span><br><span class="line">            h=<span class="number">3</span>*h+<span class="number">1</span>;<span class="comment">//1,4,13,40,121,....</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (h&gt;=<span class="number">1</span>) &#123;</span><br><span class="line"><span class="comment">//            å°†æ•°ç»„å˜ä¸ºä»»æ„é—´éš”hçš„å…ƒç´ éƒ½æ˜¯æœ‰åºçš„ï¼ˆhæœ‰åºæ•°ç»„ï¼‰</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> h; i &lt; N; i++) &#123;</span><br><span class="line">                <span class="comment">//å°†a[i] æ’å…¥åˆ°a[i-h],a[i-2*h],a[i-3*h]...ä¹‹ä¸­</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j=i;j &gt;= h&amp;&amp; Example.more(a[j-h],a[j]);j-=h)&#123;</span><br><span class="line">                    Example.exch(a,j-h,j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            h=h/<span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç©ºé—´å¤æ‚åº¦ï¼š0(1)ï¼Œå†…éƒ¨æ’åº</p><p>æ—¶é—´å¤æ‚åº¦ï¼š O(n^(1.3â€”2)) </p><p>æœ€åæƒ…å†µï¼š </p><p>æœ€å¥½æƒ…å†µï¼š </p><h2 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h2><p>åŸºæœ¬æ€æƒ³ï¼š</p><p>åœ¨é•¿åº¦ä¸ºNçš„æ— åºæ•°ç»„ä¸­ï¼Œ</p><p>ç¬¬ä¸€æ¬¡éå†n-1ä¸ªæ•°ï¼Œæ‰¾åˆ°æœ€å°çš„æ•°å€¼ä¸ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼›<br>ç¬¬äºŒæ¬¡éå†n-2ä¸ªæ•°ï¼Œæ‰¾åˆ°æœ€å°çš„æ•°å€¼ä¸ç¬¬äºŒä¸ªå…ƒç´ äº¤æ¢ï¼›<br>ã€‚ã€‚ã€‚<br>ç¬¬n-1æ¬¡éå†ï¼Œæ‰¾åˆ°æœ€å°çš„æ•°å€¼ä¸ç¬¬n-1ä¸ªå…ƒç´ äº¤æ¢ï¼Œæ’åºå®Œæˆ</p><p>åœºæ™¯ï¼šä¸Šä¸€ä¸ªåœºæ™¯ä¸­æ˜¯æŠ½åˆ°ä¸€å¼ ç‰Œåæ’å…¥åˆ°æ‰‹ä¸­å·²ç»æ’å¥½åºçš„æ‰‹ç‰Œä¹‹ä¸­ã€‚è€Œé€‰æ‹©æ’åºæœ‰ç‚¹ä¸åŒï¼Œå®ƒæ˜¯ä»æ²¡æœ‰æ’åºçš„ç‰Œä¸­é€‰å–åˆ°æœ€å°çš„æ”¾å…¥å·²æ’åºçš„æœ«å°¾ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010135297.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€‰æ‹©æ’åº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a éœ€è¦æ’åºçš„æ•°ç»„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] a)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> a.length;</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ˜¯ä»0å¼€å§‹çš„ï¼Œå› ä¸ºåç»­çš„æ“ä½œå¦‚æœéœ€è¦çš„è¯ä¼šå¯¹ä¸‹æ ‡ä¸º0çš„ä½ç½®è¿›è¡Œèµ‹å€¼æ“ä½œ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;N-<span class="number">1</span>;i++)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;N;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i]&lt;a[j])&#123;</span><br><span class="line">                min = j;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tem</span> <span class="operator">=</span> a[i]; <span class="comment">//å°†äº¤æ¢æ”¾åˆ°ifå¤–é¢</span></span><br><span class="line">            a[i] = a[j];</span><br><span class="line">            a[j] = tem;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparable[] a)</span>&#123;</span><br><span class="line">    <span class="comment">//å°†a[]æŒ‰å‡åºæ’åº</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">N</span> <span class="operator">=</span> a.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;N-<span class="number">1</span>;i++)&#123; <span class="comment">//ä¹¦ä¸­è¿™é‡Œæ˜¯for (int i=0;i&lt;N;i++) è€ƒè™‘è¾¹ç•Œè¿™é‡Œåªéœ€è¦æ‰§è¡Œåˆ°a.length-2å°±å¯ä»¥äº†</span></span><br><span class="line">        <span class="comment">//å°†a[i]å’Œa[i+1..N]ä¸­æœ€å°çš„å…ƒç´ äº¤æ¢</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;N;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (Example.more(a[min],a[j])) &#123;<span class="comment">//ä¹¦ä¸­è¿™é‡Œä¸ºï¼šExample.less(a[j],a[min])</span></span><br><span class="line">                min = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Example.exch(a,i,min);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç©ºé—´å¤æ‚åº¦ï¼š0(1)ï¼Œå†…éƒ¨æ’åº</p><p>æ—¶é—´å¤æ‚åº¦ï¼š0(n^2^)ä¸»è¦ä½“ç°åœ¨</p><p>æœ€åæƒ…å†µï¼šä»¥æ’å¥½åºï¼ˆä»å¤§åˆ°å°ï¼‰</p><p>æœ€å¥½æƒ…å†µï¼šä»¥æ’åºå¥½ï¼ˆä»å°åˆ°å¤§ï¼‰</p><p>ç›´æ¥æ’å…¥æ’åºä¸é€‰æ‹©æ’åºçš„å¯è§†æ¯”è¾ƒï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010135970.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><p>å½’å¹¶ï¼šå°†ä¸¤ä¸ªæœ‰åºçš„æ•°ç»„å½’å¹¶æˆä¸€ä¸ªæ›´å¤§çš„æœ‰åºæ•°ç»„ã€‚æ ¹æ®è¿™ä¸ªæ“ä½œå°±å¾—åˆ°äº†é€’å½’æ’åºç®—æ³•ï¼šå½’å¹¶æ’åºã€‚</p><p>åŸç†ï¼šè¦å°†ä¸€ä¸ªæ•°ç»„æ’åºï¼Œå¯ä»¥å…ˆï¼ˆé€’å½’çš„ï¼‰å°†å®ƒåˆ†æˆä¸¤åŠåˆ†åˆ«æ’åºï¼Œç„¶åå½’å¹¶èµ·æ¥ã€‚</p><p>å½’å¹¶æœ€å¸å¼•äººçš„æ€§è´¨å°±æ˜¯å®ƒèƒ½å¤Ÿä¿è¯ä»»æ„é•¿åº¦ä¸ºNçš„æ•°ç»„æ’åºæ‰€éœ€è¦æ—¶é—´å’ŒNlogNæˆæ­£æ¯”ï¼šä¸»è¦ç¼ºç‚¹åˆ™æ˜¯å®ƒæ‰€éœ€è¦çš„é¢å¤–ç©ºé—´å’ŒNæˆæ­£æ¯”ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010135847.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MergeSort</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergerSort</span><span class="params">(<span class="type">int</span>[] array)</span>&#123;</span><br><span class="line">        mergerSort(array,<span class="number">0</span>,array.length-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ç°å½’å¹¶æ’åºçš„å…·ä½“æ€è·¯</span></span><br><span class="line"><span class="comment">     * é€’å½’æ¯ä¸ªæ•°ç»„å¹¶æ’åºçš„è¿‡ç¨‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> low</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hight</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergerSort</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> low, <span class="type">int</span> hight)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> low +(hight - low) /<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (low&lt;hight) &#123;</span><br><span class="line">            <span class="comment">//å¤„ç†å·¦è¾¹</span></span><br><span class="line">            mergerSort(array, low, mid);</span><br><span class="line"><span class="comment">//            å¤„ç†å³è¾¹</span></span><br><span class="line">            mergerSort(array, mid + <span class="number">1</span>, hight);</span><br><span class="line"><span class="comment">//            å½’å¹¶</span></span><br><span class="line">            merger(array, mid, low, hight);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†ä¸¤ä¸ªæœ‰åºæ•°ç»„è¿›è¡Œå½’å¹¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array å¾…æ’åºçš„æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> middle  ä¸­é—´çš„ä½ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> low  èµ·å§‹çš„ä½ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hight ç»“æŸçš„ä½ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merger</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> middle, <span class="type">int</span> low, <span class="type">int</span> hight)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> middle+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span>[] temp = <span class="keyword">new</span> <span class="title class_">int</span>[array.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">tIndex</span> <span class="operator">=</span> low,cIndex = low;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¸å¿ƒä»£ç ï¼Œå®Œæˆæ¯”è¾ƒ</span></span><br><span class="line">        <span class="keyword">while</span> (low &lt;= middle &amp;&amp; j &lt;= hight) &#123;</span><br><span class="line">            <span class="keyword">if</span>(array[low] &lt; array[j])&#123;</span><br><span class="line">                temp[tIndex++] = array[low++];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                temp[tIndex++] = array[j++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æœªå½’å¹¶å®Œçš„æ•°ç»„æ¥è¿›è¡Œæ·»åŠ </span></span><br><span class="line">        <span class="keyword">while</span>(low &lt;= middle)&#123;</span><br><span class="line">            temp[tIndex++] = array[low++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (j &lt;= hight)&#123;</span><br><span class="line">            temp[tIndex++] = array[j++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æ’åºå¥½æ•°ç»„èµ‹å€¼ç»™åŸæ•°ç»„</span></span><br><span class="line">        <span class="keyword">while</span> (cIndex &lt;= hight) &#123;</span><br><span class="line">            array[cIndex]  = temp[cIndex];</span><br><span class="line">            cIndex++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> b[] = &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">3</span>&#125;;</span><br><span class="line">        mergerSort(b);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> s:b)&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot; &quot;</span>+s);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><p>å¿«é€Ÿæ’åºæ˜¯ä¸€ç§åˆ†æ²»çš„æ’åºç®—æ³•ã€‚å®ƒå°†ä¸€ä¸ªæ•°ç»„åˆ†ä¸ºä¸¤ä¸ªæ•°ç»„ï¼Œä¸¤éƒ¨åˆ†ç‹¬ç«‹çš„æ’åºã€‚å¿«é€Ÿæ’åºä¸å½’å¹¶æ’åºæ˜¯äº’è¡¥çš„ï¼šå½’å¹¶æ’åºå°†æ•°ç»„åˆ†ä¸ºä¸¤ä¸ªå­æ•°ç»„åˆ†åˆ«æ’åºï¼Œå¹¶å°†æœ‰åºçš„å­æ•°ç»„å½’å¹¶ä»¥å°†æ•´ä¸ªæ•°ç»„æ’åºï¼›è€Œå¿«é€Ÿæ’åºå°†æ•°ç»„æ’åºçš„æ–¹å¼åˆ™æ˜¯å½“ä¸¤ä¸ªæ•°ç»„éƒ½æœ‰åºæ—¶æ•´ä¸ªæ•°ç»„ä¹Ÿå°±è‡ªç„¶æœ‰åºäº†ã€‚åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸­ï¼Œé€’å½’è°ƒç”¨å‘ç”Ÿåœ¨å¤„ç†æ•´ä¸ªæ•°ç»„ä¹‹å‰ï¼›åœ¨ç¬¬äºŒç§æƒ…å†µä¸­ï¼Œé€’å½’è°ƒç”¨å‘ç”Ÿåœ¨å¤„ç†æ•´ä¸ªæ•°ç»„ä¹‹åã€‚åœ¨å½’å¹¶æ’åºä¸­ï¼Œä¸€ä¸ªæ•°ç»„è¢«åˆ†ä¸ºä¸¤åŠï¼›åœ¨å¿«é€Ÿæ’åºä¸­ï¼Œåˆ‡åˆ†çš„ä½ç½®å–å†³äºæ•°ç»„çš„å†…å®¹ã€‚</p><p>è¯¥æ–¹æ³•çš„åŸºæœ¬æ€æƒ³ï¼š</p><ul><li>1ï¼å…ˆä»æ•°åˆ—ä¸­å–å‡ºä¸€ä¸ªæ•°ä½œä¸ºåŸºå‡†æ•°ã€‚</li><li>2ï¼åˆ†åŒºè¿‡ç¨‹ï¼Œå°†æ¯”è¿™ä¸ªæ•°å¤§çš„æ•°å…¨æ”¾åˆ°å®ƒçš„å³è¾¹ï¼Œå°äºæˆ–ç­‰äºå®ƒçš„æ•°å…¨æ”¾åˆ°å®ƒçš„å·¦è¾¹ã€‚</li><li>3ï¼å†å¯¹å·¦å³åŒºé—´é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°å„åŒºé—´åªæœ‰ä¸€ä¸ªæ•°ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickSort</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line">        quickSort(arr,<span class="number">0</span>,arr.length-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] arr,<span class="type">int</span> start,<span class="type">int</span> end)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start&lt;end)&#123;</span><br><span class="line">            <span class="comment">//æŠŠæ•°ç»„ä¸­çš„ç¬¬0ä¸ªæ•°å­—ä½œä¸ºæ ‡å‡†æ•°</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">stard</span> <span class="operator">=</span> arr[start];</span><br><span class="line">            <span class="comment">//è®°å½•éœ€è¦æ’åºçš„ä¸‹æ ‡</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> start;</span><br><span class="line">            <span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> end;</span><br><span class="line">            <span class="comment">//å¾ªç¯æ‰¾æ¯”æ ‡å‡†æ•°å¤§çš„æ•°å’Œæ¯”æ ‡å‡†æ•°å°çš„æ•°</span></span><br><span class="line">            <span class="keyword">while</span>(low&lt;high)&#123;</span><br><span class="line">                <span class="comment">//å³è¾¹çš„æ•°å­—æ¯”æ ‡å‡†æ•°å¤§</span></span><br><span class="line">                <span class="keyword">while</span>(low&lt;high &amp;&amp; stard&lt;=arr[high])&#123;</span><br><span class="line">                    high--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//ä½¿ç”¨å³è¾¹çš„æ•°å­—æ›¿æ¢å·¦è¾¹çš„æ•°</span></span><br><span class="line">                arr[low] = arr[high];</span><br><span class="line">                <span class="comment">//å¦‚æœå·¦è¾¹çš„æ•°å­—æ¯”æ ‡å‡†æ•°å°</span></span><br><span class="line">                <span class="keyword">while</span>(low&lt;high &amp;&amp; arr[low]&lt;=stard)&#123;</span><br><span class="line">                    low++;</span><br><span class="line">                &#125;</span><br><span class="line">                arr[high] = arr[low];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æŠŠæ ‡å‡†æ•°èµ‹ç»™lowæ‰€åœ¨ä½ç½®çš„å…ƒç´ (lowæˆ–highéƒ½å¯ä»¥ï¼Œå› ä¸ºå®ƒä»¬ä¸¤ä¸ªéƒ½é‡å¤äº†)</span></span><br><span class="line">            arr[low] = stard;</span><br><span class="line">            <span class="comment">//å¤„ç†æ‰€æœ‰çš„å°äºæ ‡å‡†æ•°çš„å·¦è¾¹çš„æ•°å­—</span></span><br><span class="line">            quickSort(arr, start, low);</span><br><span class="line">            <span class="comment">//å¤„ç†æ‰€æœ‰çš„å¤§äºæ ‡å‡†æ•°çš„å³è¾¹çš„æ•°å­—</span></span><br><span class="line">            quickSort(arr, low+<span class="number">1</span>, end);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">1</span>&#125;;</span><br><span class="line">        sort(arr);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h2><p>å †æ’åºæ˜¯åˆ©ç”¨<strong>å †</strong>è¿™ç§æ•°æ®ç»“æ„è€Œè®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ï¼Œå †æ’åºæ˜¯ä¸€ç§<strong>é€‰æ‹©æ’åºï¼Œ</strong>å®ƒçš„æœ€åï¼Œæœ€å¥½ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(nlogn)ï¼Œå®ƒä¹Ÿæ˜¯ä¸ç¨³å®šæ’åºã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010136275.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™ç§é€»è¾‘ç»“æ„æ˜ å°„åˆ°æ•°ç»„ä¸­å°±æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010136186.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapSort</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String []args)</span>&#123;</span><br><span class="line">        <span class="type">int</span> []arr = &#123;<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>&#125;;</span><br><span class="line">        sort(arr);</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span> []arr)</span>&#123;</span><br><span class="line">        <span class="comment">//1.æ„å»ºå¤§é¡¶å †</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=arr.length/<span class="number">2</span>-<span class="number">1</span>;i&gt;=<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="comment">//ä»ç¬¬ä¸€ä¸ªéå¶å­ç»“ç‚¹ä»ä¸‹è‡³ä¸Šï¼Œä»å³è‡³å·¦è°ƒæ•´ç»“æ„</span></span><br><span class="line">            adjustHeap(arr,i,arr.length);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.è°ƒæ•´å †ç»“æ„+äº¤æ¢å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=arr.length-<span class="number">1</span>;j&gt;<span class="number">0</span>;j--)&#123;</span><br><span class="line">            swap(arr,<span class="number">0</span>,j);<span class="comment">//å°†å †é¡¶å…ƒç´ ä¸æœ«å°¾å…ƒç´ è¿›è¡Œäº¤æ¢</span></span><br><span class="line">            adjustHeap(arr,<span class="number">0</span>,j);<span class="comment">//é‡æ–°å¯¹å †è¿›è¡Œè°ƒæ•´</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è°ƒæ•´å¤§é¡¶å †ï¼ˆä»…æ˜¯è°ƒæ•´è¿‡ç¨‹ï¼Œå»ºç«‹åœ¨å¤§é¡¶å †å·²æ„å»ºçš„åŸºç¡€ä¸Šï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">adjustHeap</span><span class="params">(<span class="type">int</span> []arr,<span class="type">int</span> i,<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[i];<span class="comment">//å…ˆå–å‡ºå½“å‰å…ƒç´ i</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=i*<span class="number">2</span>+<span class="number">1</span>;k&lt;length;k=k*<span class="number">2</span>+<span class="number">1</span>)&#123;<span class="comment">//ä»iç»“ç‚¹çš„å·¦å­ç»“ç‚¹å¼€å§‹ï¼Œä¹Ÿå°±æ˜¯2i+1å¤„å¼€å§‹</span></span><br><span class="line">            <span class="keyword">if</span>(k+<span class="number">1</span>&lt;length &amp;&amp; arr[k]&lt;arr[k+<span class="number">1</span>])&#123;<span class="comment">//å¦‚æœå·¦å­ç»“ç‚¹å°äºå³å­ç»“ç‚¹ï¼ŒkæŒ‡å‘å³å­ç»“ç‚¹</span></span><br><span class="line">                k++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(arr[k] &gt;temp)&#123;<span class="comment">//å¦‚æœå­èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹ï¼Œå°†å­èŠ‚ç‚¹å€¼èµ‹ç»™çˆ¶èŠ‚ç‚¹ï¼ˆä¸ç”¨è¿›è¡Œäº¤æ¢ï¼‰</span></span><br><span class="line">                arr[i] = arr[k];</span><br><span class="line">                i = k;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        arr[i] = temp;<span class="comment">//å°†tempå€¼æ”¾åˆ°æœ€ç»ˆçš„ä½ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº¤æ¢å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> []arr,<span class="type">int</span> a ,<span class="type">int</span> b)</span>&#123;</span><br><span class="line">        <span class="type">int</span> temp=arr[a];</span><br><span class="line">        arr[a] = arr[b];</span><br><span class="line">        arr[b] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h2><p>å†’æ³¡æ’åºï¼Œå½“ç„¶å†’æ³¡å°±å’Œå’Œç”Ÿæ´»ä¸­çš„å†’æ³¡æœ‰ä¸€å®šå…³ç³»çš„ã€‚çƒ§å¼€æ°´æ—¶ä¼šæœ‰è®¸å¤šçš„æ°”æ³¡å‘æ°´é¢å†’å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯å¯†åº¦å°çš„å‘ä¸Šç§»åŠ¨ã€‚</p><p>åŸºæœ¬æ€æƒ³ï¼šæ¯ä¸€æ¬¡æŠŠæœ€å¤§çš„æ•°æ”¾åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œç›´è‡³æ•°ç»„æ’åºå®Œæˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å†’æ³¡æ’åº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">BubbleSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; arr.length ; i++) &#123;<span class="comment">//æ’åºéœ€è¦çš„è¶Ÿæ•°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; arr.length - i ; j++) &#123;<span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(arr[j + <span class="number">1</span>] &lt; arr[j]) &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">tem</span> <span class="operator">=</span> arr[j + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">arr[j + <span class="number">1</span>] = arr[j];</span><br><span class="line"></span><br><span class="line">arr[j] = tem;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h2><p>åŸºæœ¬æ€æƒ³ï¼šå°†æ‰€æœ‰å¾…æ¯”è¾ƒæ•°å€¼ï¼ˆæ­£æ•´æ•°ï¼‰ç»Ÿä¸€ä¸ºåŒæ ·çš„æ•°ä½é•¿åº¦ï¼Œæ•°ä½è¾ƒçŸ­çš„æ•°å‰é¢è¡¥é›¶ã€‚ç„¶åï¼Œä»æœ€ä½ä½å¼€å§‹ï¼Œä¾æ¬¡è¿›è¡Œä¸€æ¬¡æ’åºã€‚è¿™æ ·ä»æœ€ä½ä½æ’åºä¸€ç›´åˆ°æœ€é«˜ä½æ’åºå®Œæˆä»¥å,æ•°åˆ—å°±å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚</p><p>ç®—æ³•æ­¥éª¤ï¼š</p><ul><li>å°†æ‰€æœ‰å¾…æ¯”è¾ƒæ•°å€¼ï¼ˆæ­£æ•´æ•°ï¼‰ç»Ÿä¸€ä¸ºåŒæ ·çš„æ•°ä½é•¿åº¦ï¼Œæ•°ä½è¾ƒçŸ­çš„æ•°å‰é¢è¡¥é›¶ã€‚</li><li>ä»æœ€ä½ä½å¼€å§‹ï¼Œä¾æ¬¡è¿›è¡Œä¸€æ¬¡æ’åºã€‚</li><li>è¿™æ ·ä»æœ€ä½ä½æ’åºä¸€ç›´åˆ°æœ€é«˜ä½æ’åºå®Œæˆä»¥å, æ•°åˆ—å°±å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚</li></ul><p>åŠ¨æ€æ•ˆæœç¤ºæ„å›¾ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202501010136215.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºæ•°æ’åº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RadixSort</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> a[] = &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">100</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">3</span>&#125;;</span><br><span class="line">        sort(a,<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">for</span> (Integer i:a)&#123;</span><br><span class="line">            System.out.print(<span class="string">&quot; &quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºæ•°æ’åº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array å¾…æ’åºæ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> d æœ€é«˜ä½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] array,<span class="type">int</span> d)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> n=<span class="number">1</span>;<span class="comment">//ä»£è¡¨ä½æ•°å¯¹åº”çš„æ•°ï¼š1,10,100...</span></span><br><span class="line">        <span class="type">int</span> k=<span class="number">0</span>;<span class="comment">//ä¿å­˜æ¯ä¸€ä½æ’åºåçš„ç»“æœç”¨äºä¸‹ä¸€ä½çš„æ’åºè¾“å…¥</span></span><br><span class="line">        <span class="type">int</span> length=array.length;</span><br><span class="line">        <span class="type">int</span> [][]bucket=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>][length];<span class="comment">//æ’åºæ¡¶ç”¨äºä¿å­˜æ¯æ¬¡æ’åºåçš„ç»“æœï¼Œè¿™ä¸€ä½ä¸Šæ’åºç»“æœç›¸åŒçš„æ•°å­—æ”¾åœ¨åŒä¸€ä¸ªæ¡¶é‡Œ</span></span><br><span class="line">        <span class="type">int</span> []order=<span class="keyword">new</span> <span class="title class_">int</span>[length];<span class="comment">//ç”¨äºä¿å­˜æ¯ä¸ªæ¡¶é‡Œæœ‰å¤šå°‘ä¸ªæ•°å­—</span></span><br><span class="line">        <span class="keyword">while</span>(n&lt;=d)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> num:array) <span class="comment">//å°†æ•°ç»„arrayé‡Œçš„æ¯ä¸ªæ•°å­—æ”¾åœ¨ç›¸åº”çš„æ¡¶é‡Œ</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> digit=(num/n)%<span class="number">10</span>;<span class="comment">//è®¡ç®—å•ä½ 0-9</span></span><br><span class="line">                bucket[digit][order[digit]]=num;</span><br><span class="line">                order[digit]++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;length;i++)<span class="comment">//å°†å‰ä¸€ä¸ªå¾ªç¯ç”Ÿæˆçš„æ¡¶é‡Œçš„æ•°æ®è¦†ç›–åˆ°åŸæ•°ç»„ä¸­ç”¨äºä¿å­˜è¿™ä¸€ä½çš„æ’åºç»“æœ</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(order[i]!=<span class="number">0</span>)<span class="comment">//è¿™ä¸ªæ¡¶é‡Œæœ‰æ•°æ®ï¼Œä»ä¸Šåˆ°ä¸‹éå†è¿™ä¸ªæ¡¶å¹¶å°†æ•°æ®ä¿å­˜åˆ°åŸæ•°ç»„ä¸­</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;order[i];j++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        array[k]=bucket[i][j];</span><br><span class="line">                        k++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                order[i]=<span class="number">0</span>;<span class="comment">//å°†æ¡¶é‡Œè®¡æ•°å™¨ç½®0ï¼Œç”¨äºä¸‹ä¸€æ¬¡ä½æ’åº</span></span><br><span class="line">            &#125;</span><br><span class="line">            n*=<span class="number">10</span>;</span><br><span class="line">            k=<span class="number">0</span>;<span class="comment">//å°†kç½®0ï¼Œç”¨äºä¸‹ä¸€è½®ä¿å­˜ä½æ’åºç»“æœ</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><p><a href="https://www.jianshu.com/p/8340dfaea3af">https://www.jianshu.com/p/8340dfaea3af</a></p><p><a href="https://www.cnblogs.com/chengxiao/p/6129630.html">å›¾è§£æ’åºç®—æ³•(ä¸‰)ä¹‹å †æ’åº</a></p><p>ç®—æ³•ï¼ˆç¬¬å››ç‰ˆï¼‰</p><p>å·¥å…·ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TODO ç±»æè¿°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qijian.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/21 21:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹ä¼ è¿›æ¥çš„ä¸¤ä¸ªå‚æ•°è¿›è¡Œæ¯”è‚© ç¬¬ä¸€ä¸ªå‚æ•°æ›´å¤§è¿”å›1ï¼Œæ›´å°è¿”å›-1ï¼Œç›¸ç­‰è¿”å›0</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v éœ€æ¯”è¾ƒçš„å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w éœ€æ¯”è¾ƒçš„å‚æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> væ¯”wå¤§è¿”å›1ï¼Œå°è¿”å›-1ï¼Œç›¸ç­‰è¿”å›0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">more</span><span class="params">(Comparable v, Comparable w)</span> &#123;</span><br><span class="line">        <span class="comment">//compareToï¼švæ¯”wå¤§è¿”å›1ï¼Œå°è¿”å›-1ï¼Œç›¸ç­‰è¿”å›0</span></span><br><span class="line">        <span class="keyword">return</span> v.compareTo(w) &gt; <span class="number">0</span>;<span class="comment">//ç®—æ³•ï¼ˆç¬¬å››ç‰ˆï¼‰è¿™é‡Œæ˜¯v.compareTo(w) &lt; 0ï¼Œæˆ‘è§‰å¾—è¿™é‡Œç”¨&gt;æ›´åˆé€‚å¹¶ä¸”æŠŠæ–¹æ³•ç­¾åæ”¹ä¸ºäº†more</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°ç»„å†…ä¸¤æ•°äº¤æ¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> a æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> j æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">exch</span><span class="params">(Comparable[] a, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">Comparable</span> <span class="variable">t</span> <span class="operator">=</span> a[i];</span><br><span class="line">        a[i] = a[j];</span><br><span class="line">        a[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(Comparable[] a)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt;a.length; i++) &#123;</span><br><span class="line">            System.out.print(a[i] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isSorted</span><span class="params">(Comparable[] a)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; a.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(less(a[i],a [i-<span class="number">1</span>])) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TODO ç±»æè¿°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> qijian.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/22 8:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ui</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“å°æ•´ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> a æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span> []a)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;a.length;i++) &#123;</span><br><span class="line">            System.out.print(a[i]+<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“å°æ•°ç»„æ’åºä¸­çš„æŸè¶Ÿé¡ºåº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> a æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> k è¶Ÿæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(<span class="type">int</span> []a,<span class="type">int</span> k)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¬¬&quot;</span>+k+<span class="string">&quot;èºº:&quot;</span>+ Arrays.toString(a));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code> return false;&#125;</code></pre><p>}</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```java</span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * TODO ç±»æè¿°</span><br><span class="line"> *</span><br><span class="line"> * @author qijian.</span><br><span class="line"> * @date 2021/7/22 8:58</span><br><span class="line"> */</span><br><span class="line">public class ui &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ‰“å°æ•´ä¸ªæ•°ç»„</span><br><span class="line">     * @param a æ•°ç»„</span><br><span class="line">     */</span><br><span class="line">    public static void print(int []a) &#123;</span><br><span class="line">        for(int i = 0;i&lt;a.length;i++) &#123;</span><br><span class="line">            System.out.print(a[i]+&quot; &quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ‰“å°æ•°ç»„æ’åºä¸­çš„æŸè¶Ÿé¡ºåº</span><br><span class="line">     * @param a æ•°ç»„</span><br><span class="line">     * @param k è¶Ÿæ•°</span><br><span class="line">     */</span><br><span class="line">    public static void process(int []a,int k) &#123;</span><br><span class="line">        System.out.println(&quot;ç¬¬&quot;+k+&quot;èºº:&quot;+ Arrays.toString(a));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java æ’åºç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯å¯å›æ”¶</title>
      <link href="/2024/12/31/%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E6%98%AF%E5%8F%AF%E5%9B%9E%E6%94%B6/"/>
      <url>/2024/12/31/%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E6%98%AF%E5%8F%AF%E5%9B%9E%E6%94%B6/</url>
      
        <content type="html"><![CDATA[<h4 id="åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶"><a href="#åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶"></a>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶</h4><p>&#x3D;&#x3D;<strong>Javaçš„å†…å­˜ç®¡ç†å­ç³»ç»Ÿï¼Œæ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚</strong>&#x3D;&#x3D;</p><p><strong>å¼•ç”¨è®¡æ•°æ³•</strong></p><p>ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨ï¼Œè®¡æ•°å™¨å°±åŠ  1 ã€‚å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨å°±å‡ 1 ã€‚ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º 0 çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</p><p>å¼•ç”¨è®¡æ•°æ³•å®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºä¸­<strong>æ²¡æœ‰é€‰æ‹©è¿™ä¸ªç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œæœ€ä¸»è¦çš„åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹å‰ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜</strong>ã€‚</p><p>ç›¸äº’å¼•ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°†Main classè®¾ç½®ä¸ºæƒ³è¦æŸ¥çœ‹GCæ—¥å¿—çš„ç±»</span></span><br><span class="line"><span class="comment"> * VM options : -XX:+PrintGCDetails</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReferenceCountingGC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">Object</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæˆå‘˜å˜é‡çš„å”¯ä¸€æ„ä¹‰å°±æ˜¯å ç‚¹å†…å­˜ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨GCæ—¥å¿—ä¸­çœ‹æ¸…æ¥šæ˜¯å¦æœ‰å›æ”¶è¿‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] bigSize = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">2</span> * _1MB];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ReferenceCountingGC</span> <span class="variable">objectA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceCountingGC</span>();</span><br><span class="line">        <span class="type">ReferenceCountingGC</span> <span class="variable">objectB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceCountingGC</span>();</span><br><span class="line">        objectA.reference = objectB;</span><br><span class="line">        objectB.reference = objectA;</span><br><span class="line">        objectA = <span class="literal">null</span>;</span><br><span class="line">        objectB = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//å‡è®¾åœ¨è¿™è¡Œå‘ç”ŸGCï¼ŒobjectAå’ŒobjectBæ˜¯å¦èƒ½å¤Ÿè¢«å›æ”¶</span></span><br><span class="line">        System.gc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [PSYoungGen: 8030K-&gt;872K(75776K)] 8030K-&gt;880K(249344K)</span></span><br><span class="line"><span class="comment"> * å¦‚æœä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡å°†ä¼šæ— æ³•å›æ”¶ã€‚</span></span><br><span class="line"><span class="comment"> * è€Œç°åœ¨ä¸¤ä¸ªå¯¹è±¡è¢«å›æ”¶äº†ï¼Œè¯´æ˜Javaä½¿ç”¨çš„ä¸æ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•æ¥è¿›è¡Œæ ‡è®°çš„ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202412312051939.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨Javaé¢†åŸŸï¼Œè‡³å°‘ä¸»æµçš„Javaè™šæ‹Ÿæœºé‡Œé¢éƒ½æ²¡æœ‰é€‰ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œä¸»è¦åŸå› æ˜¯ï¼Œå¿…é¡»è¦é…åˆå¤§é‡çš„é¢å¤–å¤„ç†æ‰èƒ½ä¿è¯æ­£ç¡®çš„å·¥ä½œï¼Œæ¯”å¦‚å•çº¯çš„å¼•ç”¨è®¡ç®—å¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´ç›¸äº’å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚</p><p><strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong></p><p>é€šè¿‡ä¸€ç³»åˆ—çš„ç§°ä¸º â€œGC Rootsâ€ çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹é›†ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢è¿‡ç¨‹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸º<strong>å¼•ç”¨é“¾</strong>ï¼ˆReference Chainï¼‰ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ—¶ä¸å¯ç”¨çš„ã€‚</p><p>åˆ©ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤å®šå¯¹è±¡æ˜¯å¦å¯å›æ”¶</p><p>å¯¹è±¡object5ï¼Œobject6ï¼Œobject7è™½ç„¶æ²¡æœ‰ç›¸äº’å…³è”ï¼Œä½†æ˜¯ä»–ä»¬åˆ°GC Rootsæ˜¯ä¸å¯è¾¾çš„ï¼Œå› æ­¤ä»–ä»¬åˆ¤å®šä¸ºå¯å›æ”¶å¯¹è±¡</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202412312051565.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>JavaæŠ€æœ¯ä½“ç³»é‡Œé¢ã€‚å›ºå®šå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬ä¸€ä¸‹å‡ ç§ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>åœ¨æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨å¯¹è±¡ï¼Œæ¯”å¦‚ç±»çš„å¼•ç”¨å‹é™æ€å˜é‡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆNativeæ–¹æ³•ï¼‰</li><li>Javaè™šæ‹Ÿæœºå†…éƒ¨çš„å¼•ç”¨ï¼Œå¦‚åŸºæœ¬æ•°æ®ç±»å‹å¯¹åº”çš„Classå¯¹è±¡ï¼Œä¸€äº›å¸¸é©»å¯¹è±¡ï¼ˆNullPointExceptionï¼ŒOutOfMemoryError)ç­‰ï¼Œè¿˜æœ‰ä¸€äº›ç±»åŠ è½½å™¨</li><li>æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronizedå…³é”®å­—ï¼‰æ”¯æŒçš„å¯¹è±¡<br>ceptionï¼ŒOutOfMemoryError)ç­‰ï¼Œè¿˜æœ‰ä¸€äº›ç±»åŠ è½½å™¨</li><li>æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronizedå…³é”®å­—ï¼‰æ”¯æŒçš„å¯¹è±¡</li><li>åæ˜ Javaè™šæ‹Ÿæœºå†…éƒ¨æƒ…å†µçš„JMXBean,JVMTIä¸­æ³¨å†Œå›è°ƒï¼Œæœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> JVM åƒåœ¾å›æ”¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM çŸ¥è¯†æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼‚å¸¸</title>
      <link href="/2024/12/30/%E5%BC%82%E5%B8%B8/"/>
      <url>/2024/12/30/%E5%BC%82%E5%B8%B8/</url>
      
        <content type="html"><![CDATA[<h3 id="å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸"><a href="#å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸" class="headerlink" title="å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸"></a><strong>å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸</strong></h3><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202406090213443.png" alt="image-20240609021307544"></p><p><strong>ä¸€ã€é¦–å…ˆæ˜¯å¼‚å¸¸çš„æœ¬è´¨</strong></p><p>å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸ï¼Œéƒ½æ˜¯ç»§æ‰¿è‡ª Throwable è¿™ä¸ªç±»ä¸­ï¼Œåˆ†åˆ«æ˜¯ Error å’Œ Exceptionï¼ŒError æ˜¯ç¨‹åºæŠ¥é”™ï¼Œç³»ç»Ÿæ”¶åˆ°æ— æ³•å¤„ç†çš„é”™è¯¯æ¶ˆæ¯ï¼Œå®ƒå’Œç¨‹åºæœ¬èº«æ— å…³ã€‚Excetpion æ˜¯æŒ‡ç¨‹åºè¿è¡Œæ—¶æŠ›å‡ºéœ€è¦å¤„ç†çš„å¼‚å¸¸ä¿¡æ¯å¦‚æœä¸ä¸»åŠ¨æ•è·ï¼Œåˆ™ä¼šè¢« jvm å¤„ç†ã€‚</p><p><strong>äºŒã€ç„¶åæ˜¯å¯¹å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸çš„å®šä¹‰</strong></p><p>å‰é¢è¯´è¿‡<strong>å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸å‡æ´¾ç”Ÿè‡ª Exception è¿™ä¸ªç±»</strong>ã€‚</p><ol><li><p>(å¦‚å›¾)æ‰€è°“çš„å—æ£€å¼‚å¸¸ï¼Œè¡¨ç¤ºåœ¨<strong>ç¼–è¯‘çš„æ—¶å€™å¼ºåˆ¶æ£€æŸ¥çš„å¼‚å¸¸</strong>ï¼Œè¿™ç§å¼‚å¸¸éœ€è¦æ˜¾ç¤ºçš„é€šè¿‡try&#x2F;catch æ¥æ•æ‰ï¼Œæˆ–è€…é€šè¿‡ throws æŠ›å‡ºå»ï¼Œå¦åˆ™ä»ç¨‹åºæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202406100244314.png" alt="image-20240610024425618"></p></li><li><p>éå—æ£€å¼‚å¸¸çš„å®šä¹‰æ˜¯&#x3D;&#x3D;ç¨‹åºä¸éœ€è¦ä¸»åŠ¨æ•è·è¯¥å¼‚å¸¸&#x3D;&#x3D;ï¼Œä¸€èˆ¬å‘ç”Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œæ¯”å¦‚NullPointException</p><p>åœ¨ Java é‡Œé¢ï¼Œæ‰€æœ‰çš„å¼‚å¸¸éƒ½æ˜¯ç»§æ‰¿è‡ª java.lang.Throwable ç±»ï¼ŒThrowableæœ‰ä¸¤ä¸ªç›´æ¥å­ç±»ï¼ŒError å’Œ Exceptionã€‚</p><p>Error ç”¨æ¥è¡¨ç¤ºç¨‹åºåº•å±‚æˆ–è€…ç¡¬ä»¶æœ‰å…³çš„é”™è¯¯ï¼Œè¿™ç§é”™è¯¯å’Œç¨‹åºæœ¬èº«æ— å…³ï¼Œæ¯”å¦‚å¸¸è§çš„OOM å¼‚å¸¸ã€‚è¿™ç§å¼‚å¸¸å’Œç¨‹åºæœ¬èº«æ— å…³ï¼Œæ‰€ä»¥ä¸éœ€è¦æ£€æŸ¥ï¼Œå±äºéå—æ£€å¼‚å¸¸ã€‚</p><p>Exception è¡¨ç¤ºç¨‹åºä¸­çš„å¼‚å¸¸ï¼Œå¯èƒ½æ˜¯ç”±äºç¨‹åºä¸ä¸¥è°¨å¯¼è‡´çš„ï¼Œæ¯”å¦‚NullPointerExceptionã€‚</p><p>Exception ä¸‹é¢æ´¾ç”Ÿäº† RuntimeException å’Œå…¶ä»–å¼‚å¸¸ï¼Œå…¶ä¸­ RuntimeException è¿è¡Œæ—¶å¼‚å¸¸ï¼Œä¹Ÿæ˜¯å±äºéå—æ£€å¼‚å¸¸ã€‚æ‰€ä»¥ï¼Œé™¤äº† Error å’Œ RuntimeException åŠæ´¾ç”Ÿç±»ä»¥å¤–ï¼Œå…¶ä»–å¼‚å¸¸éƒ½æ˜¯å±äºå—æ£€å¼‚å¸¸ï¼Œæ¯”å¦‚ IOExceptionã€SQLExceptionã€‚</p><p>ä¹‹æ‰€ä»¥åœ¨ Java ä¸­è¦è®¾è®¡ä¸€äº›å¼ºåˆ¶æ£€æŸ¥çš„å¼‚å¸¸ï¼Œæˆ‘è®¤ä¸ºä¸»è¦åŸå› æ˜¯è€ƒè™‘åˆ°ç¨‹åºçš„æ­£ç¡®æ€§ã€ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p><p>æ¯”å¦‚æ•°æ®åº“å¼‚å¸¸ã€æ–‡ä»¶è¯»å–å¼‚å¸¸ï¼Œè¿™äº›å¼‚å¸¸æ˜¯ç¨‹åºæ— æ³•æå‰é¢„æ–™åˆ°çš„ï¼Œä½†æ˜¯ä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œå°±ä¼šé€ æˆèµ„æºè¢«å ç”¨å¯¼è‡´ç¨‹åºå‡ºç°é—®é¢˜ã€‚</p><p>æ‰€ä»¥è¿™äº›å¼‚å¸¸æˆ‘ä»¬éœ€è¦ä¸»åŠ¨æ•è·ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åšå‡ºç›¸åº”çš„å¤„ç†ï¼Œæ¯”å¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€æ–‡ä»¶æµçš„é‡Šæ”¾ç­‰ã€‚</p></li></ol><p><strong>ä¸‰ã€æœ€åæˆ‘è¿˜å¯ä»¥è¯´ä¸‹ä»–ä»¬ä¼˜ç‚¹å’Œç¼ºç‚¹</strong></p><p>å—æ£€å¼‚å¸¸ä¼˜ç‚¹æœ‰ä¸¤ä¸ªï¼š</p><p>â€‹ï¬ ç¬¬ä¸€ï¼Œå®ƒå¯ä»¥å“åº”ä¸€ä¸ªæ˜ç¡®çš„é”™è¯¯æœºåˆ¶ï¼Œè¿™äº›é”™è¯¯åœ¨å†™ä»£ç çš„æ—¶å€™å¯ä»¥éšæ—¶æ•è·å¹¶ä¸”èƒ½å¾ˆå¥½çš„æé«˜ä»£ç çš„å¥å£®æ€§ã€‚</p><p>â€‹ï¬ ç¬¬äºŒï¼Œåœ¨ä¸€äº›è¿æ¥æ“ä½œä¸­ï¼Œå®ƒèƒ½å¾ˆå¥½çš„æé†’æˆ‘ä»¬å…³æ³¨å¼‚å¸¸ä¿¡æ¯ï¼Œå¹¶åšå¥½é¢„é˜²å·¥ä½œã€‚</p><p><strong>ä¸è¿‡å—æ£€å¼‚å¸¸çš„ç¼ºç‚¹æ˜¯</strong>ï¼š</p><p>æŠ›å‡ºå—æ£€å¼‚å¸¸çš„æ—¶å€™éœ€è¦ä¸Šå£°æ˜ï¼Œè€Œè¿™ä¸ªåšæ³•ä¼šç›´æ¥ç ´åæ–¹æ³•ç­¾åå¯¼è‡´ç‰ˆæœ¬ä¸å…¼å®¹ã€‚è¿™ä¸ªæ¶å¿ƒç‰¹æ€§å¯¼è‡´æˆ‘ä¼šç»å¸¸ä½¿ç”¨ RuntimeException åŒ…è£…ã€‚éå—æ£€å¼‚å¸¸çš„å¥½å¤„æ˜¯å¯ä»¥å»æ‰ä¸€äº›ä¸éœ€è¦çš„å¼‚å¸¸å¤„ç†ä»£ç ï¼Œè€Œä¸å¥½ä¹‹å¤„æ˜¯å¼€å‘äººå‘˜å¯èƒ½å¿½ç•¥æŸäº›åº”è¯¥å¤„ç†çš„å¼‚å¸¸ï¼Œå¯¼è‡´å¸¦æ¥ä¸€äº›éšè—å¾ˆæ·±çš„ Bugï¼Œæ¯”å¦‚æµå¿˜è®°å…³é—­ï¼Ÿè¿æ¥å¿˜è®°é‡Šæ”¾ç­‰ã€‚</p><h3 id="try-catch-finally"><a href="#try-catch-finally" class="headerlink" title="try-catch-finally"></a>try-catch-finally</h3><p>try å—ï¼šç”¨äºåŒ…è£¹å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç ã€‚</p><p>catch å—ï¼ˆå¯é€‰ï¼‰ï¼šç”¨äºæ•è·å¹¶å¤„ç†<code>try</code>å—ä¸­æŠ›å‡ºçš„å¼‚å¸¸ã€‚å¯ä»¥æœ‰å¤šä¸ª<code>catch</code>å—æ¥æ•è·ä¸åŒç±»å‹çš„å¼‚å¸¸ã€‚</p><p>finally å—ï¼ˆå¯é€‰ï¼‰ï¼šæ— è®ºæ˜¯å¦æ•è·åˆ°å¼‚å¸¸ï¼Œ<code>finally</code>å—ä¸­çš„ä»£ç éƒ½ä¼šè¢«æ‰§è¡Œã€‚å®ƒä¸»è¦ç”¨äºæ‰§è¡Œå¿…è¦çš„æ¸…ç†å·¥ä½œï¼Œå¦‚å…³é—­æ–‡ä»¶ã€é‡Šæ”¾èµ„æºç­‰ã€‚</p><p>å½“<code>try</code>å—ä¸­åŒ…å«<code>return</code>è¯­å¥æ—¶ï¼Œæ‰§è¡Œæµç¨‹ä¼šæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š</p><ol><li>æ‰§è¡Œ<code>try</code>å—ä¸­çš„ä»£ç ï¼šå¦‚æœ<code>try</code>å—ä¸­çš„ä»£ç æ­£å¸¸æ‰§è¡Œåˆ°<code>return</code>è¯­å¥ï¼Œåˆ™å‡†å¤‡è¿”å›ç»“æœã€‚</li><li>æ‰§è¡Œ<code>finally</code>å—ï¼šåœ¨è¿”å›ç»“æœä¹‹å‰ï¼Œ<code>finally</code>å—ä¸­çš„ä»£ç ä¼šè¢«æ‰§è¡Œã€‚è¿™æ„å‘³ç€<code>finally</code>å—ä¸­çš„ä»£ç ä¼šåœ¨<code>return</code>è¯­å¥ä¹‹åçš„è¿”å›å€¼è¢«å®é™…è¿”å›ç»™è°ƒç”¨è€…ä¹‹å‰æ‰§è¡Œã€‚</li><li>è¿”å›ç»“æœï¼š<code>finally</code>å—æ‰§è¡Œå®Œæ¯•åï¼Œ<code>try</code>å—ä¸­çš„<code>return</code>è¯­å¥çš„ç»“æœä¼šè¢«è¿”å›ã€‚</li></ol><h5 id="è‹¥try-ä¸­æ²¡æœ‰å¼‚å¸¸ï¼Œåˆ™try-ä¸­è¯­å¥æ‰§è¡Œåˆ°returnå‰ä¸€å¥ï¼Œç„¶åæ‰§è¡Œfinally-ä¸­çš„è¯­å¥ï¼Œæœ€åå›å¤´æ‰§è¡Œtry-ä¸­çš„returnè¯­å¥ã€‚"><a href="#è‹¥try-ä¸­æ²¡æœ‰å¼‚å¸¸ï¼Œåˆ™try-ä¸­è¯­å¥æ‰§è¡Œåˆ°returnå‰ä¸€å¥ï¼Œç„¶åæ‰§è¡Œfinally-ä¸­çš„è¯­å¥ï¼Œæœ€åå›å¤´æ‰§è¡Œtry-ä¸­çš„returnè¯­å¥ã€‚" class="headerlink" title="è‹¥try{}ä¸­æ²¡æœ‰å¼‚å¸¸ï¼Œåˆ™try{}ä¸­è¯­å¥æ‰§è¡Œåˆ°returnå‰ä¸€å¥ï¼Œç„¶åæ‰§è¡Œfinally{}ä¸­çš„è¯­å¥ï¼Œæœ€åå›å¤´æ‰§è¡Œtry{}ä¸­çš„returnè¯­å¥ã€‚"></a>è‹¥try{}ä¸­æ²¡æœ‰å¼‚å¸¸ï¼Œåˆ™try{}ä¸­è¯­å¥æ‰§è¡Œåˆ°returnå‰ä¸€å¥ï¼Œç„¶åæ‰§è¡Œfinally{}ä¸­çš„è¯­å¥ï¼Œæœ€åå›å¤´æ‰§è¡Œtry{}ä¸­çš„returnè¯­å¥ã€‚</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            a = <span class="number">10</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;[try] a = &quot;</span> + a);</span><br><span class="line">            <span class="keyword">return</span> a; <span class="comment">// tryå—ä¸­çš„return</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            a = <span class="number">20</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;[finally] a =&quot;</span> + a); <span class="comment">// æ³¨æ„ï¼šfinallyå—ä¸ä¼šæ”¹å˜tryå—ä¸­çš„è¿”å›å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> getA();</span><br><span class="line">        System.out.println(<span class="string">&quot;[result] a =&quot;</span> + a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">try</span>] a = <span class="number">10</span></span><br><span class="line">[<span class="keyword">finally</span>] a =<span class="number">20</span></span><br><span class="line">[result] a =<span class="number">10</span></span><br></pre></td></tr></table></figure><p>åˆ†æï¼š</p><p>åœ¨Javaä¸­ï¼Œ<code>finally</code>å—ä¸­çš„ä»£ç ä¸ä¼šé˜»æ­¢<code>try</code>æˆ–<code>catch</code>å—ä¸­çš„<code>return</code>è¯­å¥æ‰§è¡Œï¼Œä½†<code>finally</code>å—ä¸­çš„ä»£ç ä¼šåœ¨<code>return</code>è¯­å¥ä¹‹å‰æ‰§è¡Œï¼ˆåœ¨è¿”å›å€¼è¢«ç¡®å®šä¹‹åï¼Œä½†åœ¨æ–¹æ³•çœŸæ­£é€€å‡ºä¹‹å‰ï¼‰ã€‚</p><p>ç„¶è€Œï¼Œç”±äº<code>finally</code>å—ä¸èƒ½æ”¹å˜<code>try</code>æˆ–<code>catch</code>å—ä¸­å·²ç¡®å®šçš„è¿”å›å€¼ï¼ˆé™¤éæ˜¯é€šè¿‡æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œæ‰€ä»¥å®é™…ä¸Šè¿”å›çš„æ˜¯<code>try</code>æˆ–<code>catch</code>å—ä¸­è®¡ç®—å¾—åˆ°çš„å€¼ã€‚</p><p>ä¸è¿‡ï¼Œä¸ºäº†å±•ç¤ºæµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ä»£ç ï¼Œä½†è¦çŸ¥é“<code>finally</code>å—ä¸èƒ½ç›´æ¥â€œå›å¤´â€æ‰§è¡Œ<code>return</code>è¯­å¥ã€‚</p><h5 id="å¦‚æœcatch-ä¸­æœ‰returnè¯­å¥å¹¶ä¸”finallyè¯­å¥ä¸­æ²¡æœ‰returnï¼Œå½“tryè¯­å¥å‡ºç°å¼‚å¸¸æ—¶ï¼Œå°±ä¼šæ‰§è¡Œcatchä¸­çš„çš„returnè¯­å¥ã€‚"><a href="#å¦‚æœcatch-ä¸­æœ‰returnè¯­å¥å¹¶ä¸”finallyè¯­å¥ä¸­æ²¡æœ‰returnï¼Œå½“tryè¯­å¥å‡ºç°å¼‚å¸¸æ—¶ï¼Œå°±ä¼šæ‰§è¡Œcatchä¸­çš„çš„returnè¯­å¥ã€‚" class="headerlink" title="å¦‚æœcatch{}ä¸­æœ‰returnè¯­å¥å¹¶ä¸”finallyè¯­å¥ä¸­æ²¡æœ‰returnï¼Œå½“tryè¯­å¥å‡ºç°å¼‚å¸¸æ—¶ï¼Œå°±ä¼šæ‰§è¡Œcatchä¸­çš„çš„returnè¯­å¥ã€‚"></a>å¦‚æœcatch{}ä¸­æœ‰returnè¯­å¥å¹¶ä¸”finallyè¯­å¥ä¸­æ²¡æœ‰returnï¼Œå½“tryè¯­å¥å‡ºç°å¼‚å¸¸æ—¶ï¼Œå°±ä¼šæ‰§è¡Œcatchä¸­çš„çš„returnè¯­å¥ã€‚</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            a = <span class="number">10</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;[try] a = &quot;</span> + a);</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> a; <span class="comment">// tryå—ä¸­çš„return</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            a = <span class="number">11</span>;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            a = <span class="number">20</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;[finally] a =&quot;</span> + a); <span class="comment">// æ³¨æ„ï¼šfinallyå—ä¸ä¼šæ”¹å˜tryå—ä¸­çš„è¿”å›å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> getA();</span><br><span class="line">        System.out.println(<span class="string">&quot;[result] a =&quot;</span> + a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">try</span>] a = <span class="number">10</span></span><br><span class="line">[<span class="keyword">finally</span>] a =<span class="number">20</span></span><br><span class="line">[result] a =<span class="number">11</span></span><br></pre></td></tr></table></figure><p>åˆ†æï¼š</p><p>â€‹å¦‚ä¸Šï¼Œ<code>try</code>è¯­å¥å¿«æŠ›å‡ºäº†å¼‚å¸¸ï¼Œè¢«<code>catch</code>è¯­å¥æŠ“å–åï¼Œå°±ä¼šæ‰§è¡Œ<code>return</code>è¯­å¥ã€‚æ­¤æ—¶ï¼Œä¸ä¼šç«‹å³è¿”å›ï¼Œä¼šå…ˆæ‰§è¡Œ<code>finally</code>è¯­å¥å¿«ï¼Œä½†æ˜¯<code>finally</code>è¯­å¥å—æ²¡æœ‰<code>return</code>æ‰€ä»¥å¹¶ä¸ä¼šä¿®æ”¹æ–¹æ³•çš„è¿”å›å€¼ã€‚</p><h5 id="å¦‚æœfinallyè¯­å¥ä¸­æœ‰returnè¯­å¥ï¼Œä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸æœ€åçš„è¿”å›å€¼éƒ½æ˜¯åˆfinallyè¯­å¥ä¸­çš„returnå†³å®šã€‚"><a href="#å¦‚æœfinallyè¯­å¥ä¸­æœ‰returnè¯­å¥ï¼Œä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸æœ€åçš„è¿”å›å€¼éƒ½æ˜¯åˆfinallyè¯­å¥ä¸­çš„returnå†³å®šã€‚" class="headerlink" title="å¦‚æœfinallyè¯­å¥ä¸­æœ‰returnè¯­å¥ï¼Œä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸æœ€åçš„è¿”å›å€¼éƒ½æ˜¯åˆfinallyè¯­å¥ä¸­çš„returnå†³å®šã€‚"></a>å¦‚æœfinallyè¯­å¥ä¸­æœ‰returnè¯­å¥ï¼Œä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸æœ€åçš„è¿”å›å€¼éƒ½æ˜¯åˆfinallyè¯­å¥ä¸­çš„returnå†³å®šã€‚</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            a = <span class="number">10</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;[try] a = &quot;</span> + a);</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> a; <span class="comment">// tryå—ä¸­çš„return</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            a = <span class="number">11</span>;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            a = <span class="number">20</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;[finally] a =&quot;</span> + a); <span class="comment">// æ³¨æ„ï¼šfinallyå—ä¸ä¼šæ”¹å˜tryå—ä¸­çš„è¿”å›å€¼</span></span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> getA();</span><br><span class="line">        System.out.println(<span class="string">&quot;[result] a =&quot;</span> + a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">try</span>] a = <span class="number">10</span></span><br><span class="line">[<span class="keyword">finally</span>] a =<span class="number">20</span></span><br><span class="line">[result] a =<span class="number">20</span></span><br></pre></td></tr></table></figure><h3 id="å¾ªç¯è¯­å¥ä¸­çš„å¼‚å¸¸"><a href="#å¾ªç¯è¯­å¥ä¸­çš„å¼‚å¸¸" class="headerlink" title="å¾ªç¯è¯­å¥ä¸­çš„å¼‚å¸¸"></a>å¾ªç¯è¯­å¥ä¸­çš„å¼‚å¸¸</h3><h5 id="try-catch-åœ¨-for-å¾ªç¯-å¤–é¢"><a href="#try-catch-åœ¨-for-å¾ªç¯-å¤–é¢" class="headerlink" title="try  catch  åœ¨ for å¾ªç¯ å¤–é¢"></a>try  catch  åœ¨ for å¾ªç¯ å¤–é¢</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;[try] a = &quot;</span> + a);</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> a; <span class="comment">// tryå—ä¸­çš„return</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            a = <span class="number">11</span>;</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            a = <span class="number">20</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;[finally] a =&quot;</span> + a); <span class="comment">// æ³¨æ„ï¼šfinallyå—ä¸ä¼šæ”¹å˜tryå—ä¸­çš„è¿”å›å€¼</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> getA();</span><br><span class="line">        System.out.println(<span class="string">&quot;[result] a =&quot;</span> + a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">try</span>] a = <span class="number">5</span></span><br><span class="line">[<span class="keyword">try</span>] a = <span class="number">5</span></span><br><span class="line">[<span class="keyword">finally</span>] a =<span class="number">20</span></span><br><span class="line">[result] a =<span class="number">11</span></span><br></pre></td></tr></table></figure><p>ç»“è®ºï¼š</p><p><code>try  catch</code>  åœ¨<code>for</code>å¾ªç¯ å¤–é¢ çš„æ—¶å€™ï¼Œ å¦‚æœ forå¾ªç¯è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œ é‚£ä¹ˆforå¾ªç¯ä¼šç»ˆæ­¢ã€‚</p><h5 id="try-catch-åœ¨-for-å¾ªç¯-é‡Œé¢"><a href="#try-catch-åœ¨-for-å¾ªç¯-é‡Œé¢" class="headerlink" title="try  catch  åœ¨ for å¾ªç¯ é‡Œé¢"></a>try  catch  åœ¨ for å¾ªç¯ é‡Œé¢</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;[try] i = &quot;</span> + i);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                a = <span class="number">11</span>;</span><br><span class="line">              <span class="comment">// return a; å¦‚æœæ­¤å¤„æœ‰è¿”å›å½“å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™å°±ä¼šç»ˆæ­¢åé¢çš„é€»è¾‘ï¼Œå¹¶è¿”å›ç»“æœå€¼</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a; <span class="comment">// tryå—ä¸­çš„return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> getA();</span><br><span class="line">        System.out.println(<span class="string">&quot;[result] a =&quot;</span> + a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">try</span>] i = <span class="number">0</span></span><br><span class="line">[<span class="keyword">try</span>] i = <span class="number">2</span></span><br><span class="line">[<span class="keyword">try</span>] i = <span class="number">3</span></span><br><span class="line">[<span class="keyword">try</span>] i = <span class="number">4</span></span><br><span class="line">[result] a =<span class="number">11</span></span><br></pre></td></tr></table></figure><p>åˆ†æï¼š</p><p>â€‹<code>try  catch </code> åœ¨ <code>for</code> å¾ªç¯ é‡Œé¢ çš„æ—¶å€™ï¼Œ å¦‚æœ forå¾ªç¯è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œå¼‚å¸¸è¢«catchæŠ“æ‰ï¼Œä¸å½±å“forå¾ªç¯ ç»§ç»­æ‰§è¡Œã€‚</p><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><h6 id="å—æ£€å¼‚å¸¸ï¼ˆChecked-Exceptionsï¼‰"><a href="#å—æ£€å¼‚å¸¸ï¼ˆChecked-Exceptionsï¼‰" class="headerlink" title="å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionsï¼‰"></a>å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionsï¼‰</h6><p>â€‹å—æ£€å¼‚å¸¸æ˜¯é‚£äº›åœ¨ç¼–è¯‘æ—¶è¢«æ£€æŸ¥çš„å¼‚å¸¸ã€‚è¿™æ„å‘³ç€å¦‚æœä»£ç ä¸­å­˜åœ¨å¯èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸çš„æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šå¼ºåˆ¶è¦æ±‚ä½ å¤„ç†è¿™äº›å¼‚å¸¸ã€‚ä½ å¯ä»¥é€šè¿‡ <code>try-catch</code> å—æ¥æ•è·è¿™äº›å¼‚å¸¸ï¼Œæˆ–è€…åœ¨æ–¹æ³•ç­¾åä¸­ä½¿ç”¨ <code>throws</code> å…³é”®å­—å°†å¼‚å¸¸ä¼ æ’­å‡ºå»ã€‚</p><h6 id="éå—æ£€å¼‚å¸¸ï¼ˆUnchecked-Exceptionsï¼‰"><a href="#éå—æ£€å¼‚å¸¸ï¼ˆUnchecked-Exceptionsï¼‰" class="headerlink" title="éå—æ£€å¼‚å¸¸ï¼ˆUnchecked Exceptionsï¼‰"></a>éå—æ£€å¼‚å¸¸ï¼ˆUnchecked Exceptionsï¼‰</h6><p>éå—æ£€å¼‚å¸¸åŒ…æ‹¬è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntime Exceptionsï¼‰å’Œé”™è¯¯ï¼ˆErrorsï¼‰ã€‚è¿™äº›å¼‚å¸¸åœ¨ç¼–è¯‘æ—¶ä¸ä¼šè¢«æ£€æŸ¥ï¼Œå› æ­¤ç¼–è¯‘å™¨ä¸ä¼šå¼ºåˆ¶è¦æ±‚ä½ å¤„ç†å®ƒä»¬ã€‚éå—æ£€å¼‚å¸¸é€šå¸¸æ˜¯ç”±ç¨‹åºä¸­çš„ç¼–ç¨‹é”™è¯¯å¼•èµ·çš„ï¼Œä¾‹å¦‚ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆ<code>NullPointerException</code>ï¼‰ã€æ•°ç»„ç´¢å¼•è¶Šç•Œå¼‚å¸¸ï¼ˆ<code>ArrayIndexOutOfBoundsException</code>ï¼‰ç­‰ã€‚</p><blockquote><ul><li><strong>å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionsï¼‰</strong>ï¼šåœ¨ç¼–è¯‘æ—¶è¢«æ£€æŸ¥ï¼Œå¿…é¡»åœ¨ä»£ç ä¸­æ˜¾å¼å¤„ç†æˆ–å£°æ˜ã€‚</li><li><strong>éå—æ£€å¼‚å¸¸ï¼ˆUnchecked Exceptionsï¼‰</strong>ï¼šåŒ…æ‹¬è¿è¡Œæ—¶å¼‚å¸¸å’Œé”™è¯¯ï¼Œåœ¨ç¼–è¯‘æ—¶ä¸è¢«æ£€æŸ¥ï¼Œå¯ä»¥é€‰æ‹©æ€§å¤„ç†ã€‚</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> java å¼‚å¸¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java çŸ¥è¯†æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‚²è§‚é”å’Œä¹è§‚é”</title>
      <link href="/2024/12/23/%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81/"/>
      <url>/2024/12/23/%E6%82%B2%E8%A7%82%E9%94%81%E5%92%8C%E4%B9%90%E8%A7%82%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h1 id="æ‚²è§‚é”å’Œä¹è§‚é”"><a href="#æ‚²è§‚é”å’Œä¹è§‚é”" class="headerlink" title="æ‚²è§‚é”å’Œä¹è§‚é”"></a>æ‚²è§‚é”å’Œä¹è§‚é”</h1><h3 id="1ã€åˆæ­¥è®¤è¯†"><a href="#1ã€åˆæ­¥è®¤è¯†" class="headerlink" title="1ã€åˆæ­¥è®¤è¯†"></a>1ã€åˆæ­¥è®¤è¯†</h3><p>æ‚²è§‚é”ï¼š&#x3D;&#x3D;è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¸€å®šæœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œå› æ­¤åœ¨è·å–æ•°æ®çš„æ—¶å€™ä¼šå…ˆåŠ é”ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹ã€‚&#x3D;&#x3D;synchronizedå…³é”®å­—å’ŒLockçš„å®ç°ç±»éƒ½æ˜¯æ‚²è§‚é”ã€‚é€‚åˆå†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œå…ˆåŠ é”å¯ä»¥ä¿è¯å†™æ“ä½œæ—¶æ•°æ®æ­£ç¡®ã€‚æ˜¾å¼çš„é”å®šä¹‹åå†æ“ä½œåŒæ­¥èµ„æºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=============æ‚²è§‚é”çš„è°ƒç”¨æ–¹å¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">m1</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//åŠ é”åçš„ä¸šåŠ¡é€»è¾‘......</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªlockå¯¹è±¡çš„å‰æä¸‹</span></span><br><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(); <span class="comment">// é»˜è®¤false</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">m2</span><span class="params">()</span> &#123;</span><br><span class="line">lock.lock();...</span><br></pre></td></tr></table></figure><p>ä¹è§‚é”:&#x3D;&#x3D;ä¹è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®æ—¶ä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šæ·»åŠ é”ï¼Œåªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¹‹å‰æœ‰æ²¡æœ‰åˆ«çš„çº¿ç¨‹æ›´æ–°äº†è¿™ä¸ªæ•°æ®ã€‚å¦‚æœè¿™ä¸ªæ•°æ®æ²¡æœ‰è¢«æ›´æ–°ï¼Œå½“å‰çº¿ç¨‹å°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®æˆåŠŸå†™å…¥&#x3D;&#x3D;ã€‚å¦‚æœæ•°æ®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼Œåˆ™æ ¹æ®ä¸åŒçš„å®ç°æ–¹å¼æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚ä¹è§‚é”åœ¨Javaä¸­æ˜¯é€šè¿‡ä½¿ç”¨æ— é”ç¼–ç¨‹æ¥å®ç°ï¼Œæœ€å¸¸é‡‡ç”¨çš„æ˜¯CASç®—æ³•ï¼ŒJavaåŸå­ç±»ä¸­çš„é€’å¢æ“ä½œå°±é€šè¿‡CASè‡ªæ—‹å®ç°çš„ã€‚é€‚åˆè¯»æ“ä½œå¤šçš„åœºæ™¯ï¼Œä¸åŠ é”çš„ç‰¹ç‚¹èƒ½å¤Ÿä½¿å…¶è¯»æ“ä½œçš„æ€§èƒ½å¤§å¹…æå‡ã€‚ä¹è§‚é”åˆ™ç›´æ¥å»æ“ä½œåŒæ­¥èµ„æºï¼Œæ˜¯ä¸€ç§æ— é”ç®—æ³•ï¼Œå¾—ä¹‹æˆ‘å¹¸ä¸å¾—æˆ‘å‘½ï¼Œå†æŠ¢ã€‚</p><p>ä¹è§‚é”ä¸€èˆ¬æœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼š1ã€é‡‡ç”¨ç‰ˆæœ¬å·æœºåˆ¶ã€‚2ã€CASï¼ˆCompare-and-Swapï¼Œå³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼‰ç®—æ³•å®ç°ã€‚</p><blockquote><p>æ‚²è§‚é”ä¸ä¹è§‚é”æ€æƒ³çš„å‡ºç°ï¼šä¸ºäº†åœ¨ä¸åŒåœºæ™¯ä¸­ä¿è¯å¤šçº¿ç¨‹å·¥ä½œçš„å®‰å…¨æ€§ï¼ŒJavaä¸»è¦åŸºäºä¸¤ç§æ€æƒ³è¿›è¡Œçº¿ç¨‹å®‰å…¨æ€§çš„è®¾è®¡</p></blockquote><h3 id="3ã€æ‚²è§‚é”"><a href="#3ã€æ‚²è§‚é”" class="headerlink" title="3ã€æ‚²è§‚é”"></a>3ã€æ‚²è§‚é”</h3><p>â€‹ä¸ºäº†ä¿è¯åœ¨å¤šçº¿ç¨‹å·¥ä½œç¯å¢ƒä¸­èµ„æºæ“ä½œçš„å®‰å…¨æ€§ï¼Œå°±éœ€è¦åœ¨æ“ä½œèµ„æºå‰ç‹¬å è¯¥èµ„æºï¼Œæœ€ååœ¨æ“ä½œå®Œæˆåé‡Šæ”¾è¯¥èµ„æºçš„ç‹¬å æ“ä½œæƒï¼›å…¶ä»–æ“ä½œè€…å¦‚æœéœ€è¦æ“ä½œè¯¥èµ„æºï¼Œåˆ™éœ€è¦ç­‰å¾…ï¼Œç›´åˆ°è‡ªå·±è·å¾—è¯¥èµ„æºçš„ç‹¬å æ“ä½œæƒï¼Œæ‰èƒ½è¿›è¡Œæ“ä½œã€‚</p><p>ç”±æ­¤å¯è§ï¼Œè¿™ç§æ€æƒ³å‡è®¾å¸¦æœ‰ç»å¯¹æ€§ï¼Œå¯¹å®¢è§‚å·¥ä½œç¯å¢ƒæœ‰ä¸¥æ ¼çš„å‰æçº¦æŸï¼Œè¿™ç§å®‰å…¨æ€§æ“ä½œæ€æƒ³ç§°ä¸ºæ‚²è§‚é”æ€æƒ³ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202412240147709.png" alt="image-20241224014717137"></p><h3 id="4ã€ä¹è§‚é”"><a href="#4ã€ä¹è§‚é”" class="headerlink" title="4ã€ä¹è§‚é”"></a>4ã€ä¹è§‚é”</h3><p>â€‹æ“ä½œè€…æ— é¡»è·å¾—èµ„æºçš„æ“ä½œç‹¬å æƒï¼Œä¹Ÿæ— é¡»ç­‰å¾…å…¶ä»–æ“ä½œè€…é‡Šæ”¾èµ„æºçš„ç‹¬å æ“ä½œæƒã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ç§æ— é¡»åŠ é”çš„ï¼Œå¸¦æœ‰å¹¶å‘æ“ä½œæ€§çš„æ€æƒ³ã€‚åœ¨æ“ä½œç»“æŸåï¼Œæ“ä½œè€…åªéœ€æ¯”è¾ƒå®é™…æ“ä½œç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸæ“ä½œç»“æœï¼Œå¦‚æœä¸ç¬¦åˆï¼Œåˆ™æ”¾å¼ƒæœ¬æ¬¡æ“ä½œå¹¶é‡è¯•ã€‚è¿™ç§çº¿ç¨‹å®‰å…¨æ€§çš„æ“ä½œæ€æƒ³ç§°ä¸ºä¹è§‚é”æ€æƒ³ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202412240146929.png" alt="image-20241224014626180"></p><p>â€‹ä¹è§‚é”æ€æƒ³çš„æœ¬è´¨æ˜¯æ— é”ï¼Œè¿™ç§æ€æƒ³å¯¹å®¢è§‚å·¥ä½œæ¡ä»¶çš„é™åˆ¶æ›´å®½æ¾ï¼ŒåŒ…å®¹åº¦æ›´å¥½ï¼›å¯¹å·¥ä½œè¿‡ç¨‹ä¸­äº§ç”Ÿæ“ä½œå†²çªçš„é¢„æµ‹ä¹Ÿæ›´ä¹è§‚ã€‚æ“ä½œè€…åªéœ€åœ¨å¯èƒ½äº§ç”Ÿé”™è¯¯æ•°æ®çš„å…³é”®ä½ç½®åº”ç”¨è¿™ç§å¯¹æ¯”æ–¹å¼ï¼Œæ— é¡»å°†æ“ä½œåœæ­¢å¹¶ç­‰å¾…ã€‚</p><p>â€‹Javaä¸­çš„ä¹è§‚é”æ€æƒ³é€šå¸¸åŸºäºCASï¼ˆCompare and Swapï¼Œæ¯”è¾ƒä¸äº¤æ¢ï¼‰æŠ€æœ¯å®ç°ï¼Œä½†<strong>CASè¿›è¡Œæ¯”è¾ƒçš„åˆ¤å®šä¾æ®åŠæ¯”è¾ƒåæ˜¯å¦è¦è¿›è¡Œé‡è¯•ï¼Œå¾€å¾€ç”±æ“ä½œè€…è‡ªè¡Œå†³å®šã€‚</strong>æ‰€ä»¥åœ¨Javaä¸­ï¼ŒåŸºäºä¹è§‚é”å·¥ä½œçš„å·¥å…·ç±»éƒ½å­˜åœ¨ç±»ä¼¼äºfor(;;)æˆ–while(true)çš„æºç ç»“æ„ï¼Œè¿™å¹¶ä¸æ˜¯BUGï¼Œè€Œæ˜¯ä¸ºäº†åŒ¹é…ä¹è§‚é”çš„å®ç°æ€æƒ³ã€‚ä¾‹å¦‚ï¼Œåœ¨ConcurrentHashMapé›†åˆä¸­ï¼ŒåŸºäºä¹è§‚é”æ€æƒ³æ·»åŠ æ•°æ®å¯¹è±¡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java å¹¶å‘ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java çŸ¥è¯†æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinkedHashMapç±»</title>
      <link href="/2024/11/20/LinkedHashMap%E7%B1%BB/"/>
      <url>/2024/11/20/LinkedHashMap%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h2 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h2><h4 id="LinkedHashMap-ç®€ä»‹"><a href="#LinkedHashMap-ç®€ä»‹" class="headerlink" title="LinkedHashMap ç®€ä»‹"></a><strong>LinkedHashMap ç®€ä»‹</strong></h4><p>LinkedHashMap æ˜¯ Java æä¾›çš„ä¸€ä¸ªé›†åˆç±»ï¼Œå®ƒç»§æ‰¿è‡ª HashMapï¼Œå¹¶åœ¨ HashMap åŸºç¡€ä¸Šç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ç”¨æ¥ä¿è¯å…ƒç´ è¿­ä»£é¡ºåºã€‚</p><p>LinkedHashMapç»§æ‰¿å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedHashMap</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">HashMap</span>&lt;K,V&gt; <span class="keyword">implements</span> <span class="title class_">Map</span>&lt;K,V&gt;</span><br><span class="line">&#123; </span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The head (eldest) of the doubly linked list.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; head;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The tail (youngest) of the doubly linked list.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; tail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">     * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> accessOrder;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411202326737.png" alt="image-20241120232627486"></p><h4 id="Entry-å­—æ®µå±æ€§"><a href="#Entry-å­—æ®µå±æ€§" class="headerlink" title="Entry&lt;K,V&gt; å­—æ®µå±æ€§"></a>Entry&lt;K,V&gt; å­—æ®µå±æ€§</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HashMap.Node subclass for normal LinkedHashMap entries.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span>&lt;K,V&gt; <span class="keyword">extends</span> <span class="title class_">HashMap</span>.Node&lt;K,V&gt; &#123;</span><br><span class="line">    Entry&lt;K,V&gt; before, after;</span><br><span class="line">    Entry(<span class="type">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">        <span class="built_in">super</span>(hash, key, value, next);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„æºç ä¸­å¯ä»¥çœ‹åˆ°<code>head</code> å’Œ<code>tail</code>å±æ€§çš„ç±»å‹ æ˜¯<code>Entry&lt;K,V&gt;</code>ï¼Œ ä¹Ÿå°±æ˜¯è¯´<code>LinkedHashMap</code>çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯Entry ã€‚</p><p>æ³¨æ„âš ï¸ï¼š</p><p>â€‹1ã€<code> Node&lt;K,V&gt; next</code> ç”¨æ¥ç»´æŠ¤æ•´ä¸ªé›†åˆä¸­Entryçš„é¡ºåº;<code>head </code>ã€<code>tail </code>ã€<code>before </code>å’Œ <code>after </code> è¿™å››ä¸ªç”¨æ¥ç»´æŠ¤ä¿è¯é›†åˆé¡ºåºçš„é“¾è¡¨ï¼Œå…¶ä¸­<code>head</code> ä¸ <code>tail</code> ä»£è¡¨é“¾è¡¨çš„å¤´èŠ‚ç‚¹ ä¸ å°¾èŠ‚ç‚¹ï¼Œè€Œ<code>before </code>å’Œ <code>after </code>ä»£è¡¨è¿™ä¸ªåŒå‘åˆ—è¡¨çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ä¸ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p>â€‹2ã€accessOrder é»˜è®¤æ˜¯ false ï¼Œ ä»¥æ’å…¥é¡ºåºè®¿é—®ã€‚å¦‚æœéœ€è¦è®¾ç½®è¿™ä¸ªå€¼åªèƒ½é€šè¿‡å…¶ä¸­ä¸€ä¸ªæ„é€ æ–¹æ³•æ¥è®¾ç½®ï¼Œæ„é€ æ–¹æ³•ï¼š<code>public LinkedHashMap(int initialCapacity, float loadFactor,boolean accessOrder) </code></p><h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><p>1ã€æ— å‚æ„é€ å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class="line"><span class="comment"> * with the default initial capacity (16) and load factor (0.75).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedHashMap</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    accessOrder = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€æŒ‡å®šåˆå§‹å®¹é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class="line"><span class="comment"> * with the specified initial capacity and a default load factor (0.75).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  initialCapacity the initial capacity</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedHashMap</span><span class="params">(<span class="type">int</span> initialCapacity)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(initialCapacity);</span><br><span class="line">    accessOrder = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€æŒ‡å®šåˆå§‹å®¹é‡ä¸åŠ è½½å› å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class="line"><span class="comment"> * with the specified initial capacity and load factor.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  initialCapacity the initial capacity</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  loadFactor      the load factor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class="line"><span class="comment"> *         or the load factor is nonpositive</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedHashMap</span><span class="params">(<span class="type">int</span> initialCapacity, <span class="type">float</span> loadFactor)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(initialCapacity, loadFactor);</span><br><span class="line">    accessOrder = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€æŒ‡å®šåˆå§‹å®¹é‡å’ŒåŠ è½½å› å­ä»¥åŠè¿­ä»£è§„åˆ™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an empty &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance with the</span></span><br><span class="line"><span class="comment"> * specified initial capacity, load factor and ordering mode.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  initialCapacity the initial capacity</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  loadFactor      the load factor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  accessOrder     the ordering mode - &lt;tt&gt;true&lt;/tt&gt; for</span></span><br><span class="line"><span class="comment"> *         access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class="line"><span class="comment"> *         or the load factor is nonpositive</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedHashMap</span><span class="params">(<span class="type">int</span> initialCapacity,</span></span><br><span class="line"><span class="params">                     <span class="type">float</span> loadFactor,</span></span><br><span class="line"><span class="params">                     <span class="type">boolean</span> accessOrder)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(initialCapacity, loadFactor);</span><br><span class="line">    <span class="built_in">this</span>.accessOrder = accessOrder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5ã€æŒ‡å®šé›†åˆä¸­çš„å…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs an insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance with</span></span><br><span class="line"><span class="comment"> * the same mappings as the specified map.  The &lt;tt&gt;LinkedHashMap&lt;/tt&gt;</span></span><br><span class="line"><span class="comment"> * instance is created with a default load factor (0.75) and an initial</span></span><br><span class="line"><span class="comment"> * capacity sufficient to hold the mappings in the specified map.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  m the map whose mappings are to be placed in this map</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if the specified map is null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedHashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    accessOrder = <span class="literal">false</span>;</span><br><span class="line">    putMapEntries(m, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ å…ƒç´ "><a href="#æ·»åŠ å…ƒç´ " class="headerlink" title="æ·»åŠ å…ƒç´ "></a>æ·»åŠ å…ƒç´ </h4><p>â€‹åœ¨LinkedHashMapä¸­ å¯ä»¥å‘ç°ä¸å­˜åœ¨ put æ–¹æ³• ï¼Œ ç›´æ¥è°ƒç”¨HashMapçš„putæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// LinkedHashMap ä½¿ç”¨çš„æ’å…¥æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The table, initialized on first use, and resized as</span></span><br><span class="line"><span class="comment">   * necessary. When allocated, length is always a power of two.</span></span><br><span class="line"><span class="comment">   * (We also tolerate length zero in some operations to allow</span></span><br><span class="line"><span class="comment">   * bootstrapping mechanics that are currently not needed.)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hash æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">      <span class="type">int</span> h;</span><br><span class="line">      <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">                 <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">      Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    <span class="comment">// 1ã€åˆ¤æ–­å“ˆå¸Œè¡¨æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">      <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        <span class="comment">// 2ã€å¦‚æœå“ˆå¸Œè¡¨ä¸ºnull  , åˆå§‹åŒ–å®¹é‡ï¼ˆ16ï¼‰</span></span><br><span class="line">          n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// 3ã€åˆ¤æ–­å½“å‰keyçš„hashå€¼å¯¹åº”çš„ç´¢å¼•ä½ç½®æ˜¯å¦æœ‰å…ƒç´ </span></span><br><span class="line">      <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">        <span class="comment">// 4ã€å¦‚æœå¯¹åº”çš„ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œå¾€å½“å‰ç´¢å¼•ä½ç½®æ”¾å…¥ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">          tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// 5ã€å¦‚æœå¯¹åº”ä½ç½®çš„å…ƒç´ å­˜åœ¨ ï¼Œåˆ¤æ–­å½“å‰ä½ç½®å…ƒç´ keyçš„hashå€¼ä¸æ–°çš„åŠ å…¥å…ƒç´ keyçš„æ˜¯hashï¼Œæ–°æ—§keyæ˜¯å¦ç›¸åŒ</span></span><br><span class="line">          <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">              ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="comment">// 6ã€å¦‚æœkeyæ˜¯ç›¸ç­‰çš„ï¼Œåˆ™è¦†ç›–å€¼</span></span><br><span class="line">              e = p;</span><br><span class="line">        <span class="comment">// 7ã€å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦æ˜¯çº¢é»‘æ ‘</span></span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            <span class="comment">// 8ã€å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™å°†å…ƒç´ å­˜å…¥çº¢é»‘æ ‘èŠ‚ç‚¹ (æ³¨æ„âš ï¸ï¼šæ­¤å¤„å­˜åœ¨linkedHashMapçš„é€»è¾‘)</span></span><br><span class="line">              e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 9ã€å¦‚æœå…ƒç´ keyä¸ç›¸ç­‰å¹¶ä¸”ä¸æ˜¯çº¢é»‘æ ‘ï¼Œåˆ™éå†æ‰€æœ‰çš„èŠ‚ç‚¹</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="comment">// 10ã€å¦‚æœéå†åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ­¤æ—¶è¿˜æ²¡æœ‰æ‰¾åˆ°ç›¸ç­‰çš„èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">                  <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 11ã€åœ¨å°¾éƒ¨å¢åŠ æ–°èŠ‚ç‚¹ ï¼ˆæ³¨æ„âš ï¸ï¼šLinkedHashMapä¸­é‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼‰</span></span><br><span class="line">                      p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// 12ã€å¦‚æœé“¾è¡¨é•¿åº¦å¤§äº8ï¼Œè½¬æ¢æˆçº¢é»‘æ ‘ï¼ˆæ³¨æ„ï¼šbinCount æ˜¯ä»0å¼€å§‹çš„ï¼‰</span></span><br><span class="line">                      <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                          treeifyBin(tab, hash);</span><br><span class="line">                      <span class="keyword">break</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                <span class="comment">// 13ã€å¦‚æœkeyå·²ç»å­˜åœ¨ï¼Œç›´æ¥è¦†ç›–</span></span><br><span class="line">                  <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                      ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                      <span class="keyword">break</span>;</span><br><span class="line">                  p = e;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">              <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">              <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                  e.value = value;</span><br><span class="line">              afterNodeAccess(e);</span><br><span class="line">              <span class="keyword">return</span> oldValue;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ++modCount;</span><br><span class="line">      <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">          resize();</span><br><span class="line">      afterNodeInsertion(evict);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„âš ï¸ï¼š</p><p>â€‹â€¢å…ƒç´ æ•°é‡ <strong>&lt; 8</strong>ï¼šå§‹ç»ˆæ˜¯é“¾è¡¨ã€‚</p><p>â€‹â€¢å…ƒç´ æ•°é‡ <strong>&#x3D; 8</strong>ï¼šè¿˜æ˜¯é“¾è¡¨ã€‚</p><p>â€‹â€¢å…ƒç´ æ•°é‡ <strong>&gt; 8</strong>ï¼šè½¬ä¸ºçº¢é»‘æ ‘ï¼ˆå‰ææ˜¯æ•°ç»„é•¿åº¦è¾¾åˆ° 64ï¼›å¦‚æœæ²¡è¾¾åˆ°ï¼Œåˆ™å…ˆæ‰©å®¹ï¼‰ã€‚</p><p><strong>ä¸ºä»€ä¹ˆä¸ç›´æ¥å†™ TREEIFY_THRESHOLDï¼Ÿ</strong></p><p>è¿™æ˜¯ä¸ºäº†å’Œä» <strong>0 å¼€å§‹è®¡æ•°çš„é€»è¾‘ç»Ÿä¸€</strong>ï¼š</p><p>â€‹â€¢å¦‚æœç›´æ¥å†™ TREEIFY_THRESHOLDï¼Œæ„å‘³ç€åªæœ‰åœ¨é“¾è¡¨ä¸­å·²ç»æœ‰ 9 ä¸ªèŠ‚ç‚¹åæ‰è§¦å‘è½¬æ¢ï¼Œè€Œå®é™…ä¸Šåº”è¯¥åœ¨æ’å…¥ç¬¬ 9 ä¸ªèŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼ˆç¬¬ 8 ä¸ªèŠ‚ç‚¹å­˜åœ¨æ—¶ï¼‰å°±è¿›è¡Œè½¬æ¢ã€‚</p></blockquote><h4 id="newNodeï¼ˆhashï¼Œkeyï¼Œvalueï¼Œnullï¼‰æ–¹æ³•"><a href="#newNodeï¼ˆhashï¼Œkeyï¼Œvalueï¼Œnullï¼‰æ–¹æ³•" class="headerlink" title="newNodeï¼ˆhashï¼Œkeyï¼Œvalueï¼Œnullï¼‰æ–¹æ³•"></a>newNodeï¼ˆhashï¼Œkeyï¼Œvalueï¼Œnullï¼‰æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;K,V&gt; <span class="title function_">newNode</span><span class="params">(<span class="type">int</span> hash, K key, V value, Node&lt;K,V&gt; e)</span> &#123;</span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>.Entry&lt;K,V&gt;(hash, key, value, e);</span><br><span class="line">    linkNodeLast(p);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// link at the end of list</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">linkNodeLast</span><span class="params">(LinkedHashMap.Entry&lt;K,V&gt; p)</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨ä¸´æ—¶å˜é‡è®°å½•å°¾èŠ‚ç‚¹</span></span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; last = tail;</span><br><span class="line">    <span class="comment">// å°†å°¾èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰æ’å…¥çš„èŠ‚ç‚¹</span></span><br><span class="line">    tail = p;</span><br><span class="line">    <span class="keyword">if</span> (last == <span class="literal">null</span>)</span><br><span class="line">        <span class="comment">// å½“å°¾ä¸ºèŠ‚ç‚¹ä¸ºnullçš„æ—¶å€™ï¼Œç›´æ¥å°†æ–°å¢çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹</span></span><br><span class="line">        head = p;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// é“¾è¡¨ä¸ä¸ºç©ºæ˜¯æ—¶å€™ï¼Œå°†ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆæŒ‡é’ˆæŒ‡å‘</span></span><br><span class="line">        p.before = last;</span><br><span class="line">        last.after = p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„âš ï¸ï¼š</p><p> HashMapä¸­æä¾›äº†ä¸‰ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Callbacks to allow LinkedHashMap post-actions</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">afterNodeAccess</span><span class="params">(Node&lt;K,V&gt; p)</span> &#123; &#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">afterNodeInsertion</span><span class="params">(<span class="type">boolean</span> evict)</span> &#123; &#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">afterNodeRemoval</span><span class="params">(Node&lt;K,V&gt; p)</span> &#123; &#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›æ–¹æ³•çš„ç”¨é€”æ˜¯åœ¨å¢åˆ æŸ¥ç­‰æ“ä½œåï¼Œè®© LinkedHashMap æœ‰å¯ä»¥åšä¸€äº›åç½®æ“ä½œã€‚åœ¨HashMapç±»ä¸­ä¸Šé¢çš„ä¸‰ä¸ªæ–¹æ³•ä¸­æ²¡æœ‰å…·ä½“å®ç°ï¼Œåœ¨LinkedHashMapä¸­ä¼šå®ç°äº†å…·ä½“çš„å®ç°ã€‚</p><h4 id="putTreeValæ–¹æ³•"><a href="#putTreeValæ–¹æ³•" class="headerlink" title="putTreeValæ–¹æ³•"></a>putTreeValæ–¹æ³•</h4><p>åœ¨æ·»åŠ çº¢é»‘æ ‘èŠ‚ç‚¹æ—¶ï¼ŒLinkedHashMapä¹Ÿé‡å†™äº†è¯¥æ–¹æ³•çš„newTreeNodeæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TreeNode&lt;K,V&gt; <span class="title function_">newTreeNode</span><span class="params">(<span class="type">int</span> hash, K key, V value, Node&lt;K,V&gt; next)</span> &#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; p = <span class="keyword">new</span> <span class="title class_">TreeNode</span>&lt;K,V&gt;(hash, key, value, next);</span><br><span class="line">  <span class="comment">// HashMap ä¸­æ²¡æœ‰è¿™ä¸ªé€»è¾‘</span></span><br><span class="line">    linkNodeLast(p);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// link at the end of list</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">linkNodeLast</span><span class="params">(LinkedHashMap.Entry&lt;K,V&gt; p)</span> &#123;</span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; last = tail;</span><br><span class="line">    tail = p;</span><br><span class="line">    <span class="keyword">if</span> (last == <span class="literal">null</span>)</span><br><span class="line">        head = p;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        p.before = last;</span><br><span class="line">        last.after = p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="afterNodeAccessï¼ˆeï¼‰æ–¹æ³•"><a href="#afterNodeAccessï¼ˆeï¼‰æ–¹æ³•" class="headerlink" title="afterNodeAccessï¼ˆeï¼‰æ–¹æ³•"></a>afterNodeAccessï¼ˆeï¼‰æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">   * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">final</span> <span class="type">boolean</span> accessOrder;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å½“å‰èŠ‚ç‚¹æ”¾åˆ°åŒå‘é“¾è¡¨çš„å°¾éƒ¨</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">afterNodeAccess</span><span class="params">(Node&lt;K,V&gt; e)</span> &#123; <span class="comment">// move node to last</span></span><br><span class="line">      LinkedHashMap.Entry&lt;K,V&gt; last;</span><br><span class="line">    <span class="comment">// å½“accessOrder = true å¹¶ä¸”å½“å‰èŠ‚ç‚¹ä¸ç­‰äºå°¾éƒ¨èŠ‚ç‚¹tailï¼Œå¹¶ä¸”lastèŠ‚ç‚¹èµ‹å€¼ä¸ºtail</span></span><br><span class="line">      <span class="keyword">if</span> (accessOrder &amp;&amp; (last = tail) != e) &#123;</span><br><span class="line">        <span class="comment">// å½“å‰èŠ‚ç‚¹èµ‹å€¼ç»™p, å¹¶ä¸”è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹ å’Œ åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">          LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">              (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾å½“å‰èŠ‚ç‚¹æŒ‡å‘åä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class="line">          p.after = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ä¸ºnull </span></span><br><span class="line">          <span class="keyword">if</span> (b == <span class="literal">null</span>)</span><br><span class="line">            <span class="comment">// å¦‚æœ p æ˜¯å¤´èŠ‚ç‚¹ï¼Œå°†å¤´æŒ‡é’ˆæŒ‡å‘ p çš„åç»§</span></span><br><span class="line">              head = a;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="comment">// å¦åˆ™è®©å‰é©±èŠ‚ç‚¹æŒ‡å‘ p çš„åç»§</span></span><br><span class="line">              b.after = a;</span><br><span class="line">          <span class="keyword">if</span> (a != <span class="literal">null</span>)</span><br><span class="line">            <span class="comment">// å¦‚æœåç»§èŠ‚ç‚¹å­˜åœ¨ï¼Œè®©å®ƒçš„å‰é©±æŒ‡å‘ p çš„å‰é©±</span></span><br><span class="line">              a.before = b;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="comment">// // å¦‚æœæ²¡æœ‰åç»§èŠ‚ç‚¹ï¼Œæ›´æ–°æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">              last = b;</span><br><span class="line">          <span class="keyword">if</span> (last == <span class="literal">null</span>)</span><br><span class="line">            <span class="comment">// å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œç›´æ¥å°† p è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹</span></span><br><span class="line">              head = p;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å°† p çš„å‰é©±è®¾ä¸ºå½“å‰å°¾èŠ‚ç‚¹</span></span><br><span class="line">              p.before = last;</span><br><span class="line">              <span class="comment">// å°†å½“å‰å°¾èŠ‚ç‚¹çš„åç»§è®¾ä¸º p</span></span><br><span class="line">              last.after = p;</span><br><span class="line">          &#125;</span><br><span class="line">        <span class="comment">// æ›´æ–°å°¾èŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">          tail = p;</span><br><span class="line">          ++modCount;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹æ³•æ˜¯åœ¨accessOrder &#x3D; trueå¹¶ä¸”æ’å…¥çš„å½“å‰èŠ‚ç‚¹ä¸ç­‰äºå°¾èŠ‚ç‚¹æ—¶ï¼Œè¯¥æ–¹æ³•æ‰ä¼šç”Ÿæ•ˆã€‚å¹¶ä¸”è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯å°†æ’å…¥çš„èŠ‚ç‚¹å˜ä¸ºå°¾èŠ‚ç‚¹ï¼Œåé¢åœ¨getæ–¹æ³•ä¸­ä¹Ÿä¼šè°ƒç”¨ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411220247534.png" alt="image-20241122024709163"></p><h4 id="afterNodeInsertion"><a href="#afterNodeInsertion" class="headerlink" title="afterNodeInsertion"></a>afterNodeInsertion</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">afterNodeInsertion</span><span class="params">(<span class="type">boolean</span> evict)</span> &#123; <span class="comment">// possibly remove eldest</span></span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; first;</span><br><span class="line">  <span class="comment">// head æŒ‡å‘é“¾è¡¨çš„å¤´éƒ¨ï¼Œå³æœ€æ—©æ’å…¥çš„èŠ‚ç‚¹ã€‚ </span></span><br><span class="line">    <span class="keyword">if</span> (evict &amp;&amp; (first = head) != <span class="literal">null</span> &amp;&amp; removeEldestEntry(first)) &#123;</span><br><span class="line">        <span class="type">K</span> <span class="variable">key</span> <span class="operator">=</span> first.key;</span><br><span class="line">        <span class="comment">// ç§»é™¤æœ€è€çš„èŠ‚ç‚¹</span></span><br><span class="line">        removeNode(hash(key), key, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªremoveEldestEntry æ–¹æ³• ï¼Œæˆ‘ä»¬å»çœ‹å®ƒçš„å®ç°ä¼šå‘ç°ï¼Œè¯¥æ–¹æ³•æ˜¯ç›´æ¥è¿”å›falseçš„ã€‚è¿™é‡Œå¯ä»¥ç†è§£æˆæ˜¯ä½œè€…ç»™æˆ‘ä»¬ç•™çš„ä¸€ä¸ªå£å­ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿çš„å®ç°æˆ‘ä»¬çš„è¦æ±‚ï¼Œä¾‹å¦‚æˆ‘ä»¬ç»§æ‰¿LinkedHashMapåå†™è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å†™å‡ºLRUç®—æ³•MyBatiså°±æœ‰è¿™ä¹ˆä¸€ä¸ªä¼˜ç§€çš„æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LruCache</span> <span class="keyword">implements</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Cache delegate;</span><br><span class="line">  <span class="keyword">private</span> Map&lt;Object, Object&gt; keyMap;</span><br><span class="line">  <span class="keyword">private</span> Object eldestKey;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">LruCache</span><span class="params">(Cache delegate)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.delegate = delegate;</span><br><span class="line">    setSize(<span class="number">1024</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> delegate.getId();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> delegate.getSize();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSize</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> size)</span> &#123;</span><br><span class="line">    keyMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;Object, Object&gt;(size, <span class="number">.75F</span>, <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">4267176411845948333L</span>;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">removeEldestEntry</span><span class="params">(Map.Entry&lt;Object, Object&gt; eldest)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">tooBig</span> <span class="operator">=</span> size() &gt; size;</span><br><span class="line">        <span class="keyword">if</span> (tooBig) &#123;</span><br><span class="line">          eldestKey = eldest.getKey();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tooBig;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object key, Object value)</span> &#123;</span><br><span class="line">    delegate.putObject(key, value);</span><br><span class="line">    cycleKeyList(key);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    keyMap.get(key); <span class="comment">// touch</span></span><br><span class="line">    <span class="keyword">return</span> delegate.getObject(key);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">removeObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> delegate.removeObject(key);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">    delegate.clear();</span><br><span class="line">    keyMap.clear();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cycleKeyList</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    keyMap.put(key, key);</span><br><span class="line">    <span class="keyword">if</span> (eldestKey != <span class="literal">null</span>) &#123;</span><br><span class="line">      delegate.removeObject(eldestKey);</span><br><span class="line">      eldestKey = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå·±çš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LruCache</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">LinkedHashMap</span>&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity; <span class="comment">// æœ€å¤§å®¹é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LruCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(capacity, <span class="number">0.75f</span>, <span class="literal">true</span>); <span class="comment">// accessOrder = true è¡¨ç¤ºæŒ‰è®¿é—®é¡ºåºæ’åº</span></span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡å†™ removeEldestEntry æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">removeEldestEntry</span><span class="params">(Map.Entry&lt;K, V&gt; eldest)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size() &gt; capacity; <span class="comment">// è¶…è¿‡æœ€å¤§å®¹é‡æ—¶ç§»é™¤æœ€è€çš„å…ƒç´ </span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ æ‰“å°åŠŸèƒ½ï¼Œä¾¿äºè§‚å¯Ÿ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printCache</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Cache: &quot;</span> + <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LruCacheDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º 3 çš„ LRU Cache</span></span><br><span class="line">        LruCache&lt;Integer, String&gt; lruCache = <span class="keyword">new</span> <span class="title class_">LruCache</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ’å…¥ä¸€äº›æ•°æ®</span></span><br><span class="line">        lruCache.put(<span class="number">1</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">        lruCache.put(<span class="number">2</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        lruCache.put(<span class="number">3</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">        lruCache.printCache(); <span class="comment">// è¾“å‡º: &#123;1=A, 2=B, 3=C&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¿é—®ä¸€ä¸ªå·²å­˜åœ¨çš„å…ƒç´ </span></span><br><span class="line">        lruCache.get(<span class="number">1</span>);</span><br><span class="line">        lruCache.printCache(); <span class="comment">// è¾“å‡º: &#123;2=B, 3=C, 1=A&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œè¶…å‡ºå®¹é‡ï¼Œæœ€è€çš„å…ƒç´ è¢«ç§»é™¤</span></span><br><span class="line">        lruCache.put(<span class="number">4</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">        lruCache.printCache(); <span class="comment">// è¾“å‡º: &#123;3=C, 1=A, 4=D&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†æ¬¡æ’å…¥ä¸€ä¸ªæ–°å…ƒç´ </span></span><br><span class="line">        lruCache.put(<span class="number">5</span>, <span class="string">&quot;E&quot;</span>);</span><br><span class="line">        lruCache.printCache(); <span class="comment">// è¾“å‡º: &#123;1=A, 4=D, 5=E&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤å…ƒç´ "><a href="#åˆ é™¤å…ƒç´ " class="headerlink" title="åˆ é™¤å…ƒç´ "></a>åˆ é™¤å…ƒç´ </h4><p>â€‹åœ¨æºç ä¸­å¯ä»¥å‘ç°ï¼ŒLinkedHashMapä¸­æ˜¯æ²¡æœ‰removeæ–¹æ³•çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨çš„æ˜¯HashMapçš„ç§»é™¤æ–¹æ³•ã€‚åŒæ—¶LinkedHashMapé‡å†™äº†hashmapçš„ç§»é™¤æ–¹æ³•ä¸­çš„<strong>afterNodeRemoval</strong>æ–¹æ³•é€»è¾‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">afterNodeRemoval</span><span class="params">(Node&lt;K,V&gt; e)</span> &#123; <span class="comment">// unlink</span></span><br><span class="line">    LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">        (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;</span><br><span class="line">    p.before = p.after = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="literal">null</span>)</span><br><span class="line">        head = a;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        b.after = a;</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="literal">null</span>)</span><br><span class="line">        tail = b;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        a.before = b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è·å–å…ƒç´ "><a href="#è·å–å…ƒç´ " class="headerlink" title="è·å–å…ƒç´ "></a>è·å–å…ƒç´ </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (accessOrder)</span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">    <span class="keyword">return</span> e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éå†LinkedHashMap"><a href="#éå†LinkedHashMap" class="headerlink" title="éå†LinkedHashMap"></a>éå†LinkedHashMap</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">LinkedHashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†æ–¹å¼ä¸€</span></span><br><span class="line">System.out.println(<span class="string">&quot;æ–¹å¼ä¸€&quot;</span>);</span><br><span class="line">Set&lt;Map.Entry&lt;Object, Object&gt;&gt; entries = map.entrySet();</span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; entry : entries) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;key:&quot;</span> + entry.getKey() + <span class="string">&quot;,value:&quot;</span> + entry.getValue());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†æ–¹å¼äºŒ</span></span><br><span class="line">System.out.println(<span class="string">&quot;æ–¹å¼äºŒ&quot;</span>);</span><br><span class="line">Iterator&lt;Map.Entry&lt;Object, Object&gt;&gt; iterator = map.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">    Map.Entry&lt;Object, Object&gt; next = iterator.next();</span><br><span class="line">    System.out.println(<span class="string">&quot;key:&quot;</span> + next.getKey() + <span class="string">&quot;,value:&quot;</span> + next.getValue());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†æ–¹å¼ä¸‰</span></span><br><span class="line">System.out.println(<span class="string">&quot;æ–¹å¼ä¸‰&quot;</span>);</span><br><span class="line">map.forEach((key, value) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;key:&quot;</span> + key + <span class="string">&quot;,value:&quot;</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="LinkedHashMapè¦ç‚¹"><a href="#LinkedHashMapè¦ç‚¹" class="headerlink" title="LinkedHashMapè¦ç‚¹"></a>LinkedHashMapè¦ç‚¹</h3><h4 id="LinkedHashMapç‰¹æ€§å¦‚ä¸‹ï¼š"><a href="#LinkedHashMapç‰¹æ€§å¦‚ä¸‹ï¼š" class="headerlink" title="LinkedHashMapç‰¹æ€§å¦‚ä¸‹ï¼š"></a>LinkedHashMapç‰¹æ€§å¦‚ä¸‹ï¼š</h4><p>1ã€æ”¯æŒéå†æ—¶æŒ‰ç…§æ’å…¥é¡ºåºæœ‰åºè¿›è¡Œè¿­ä»£ã€‚<br>2ã€æ”¯æŒæŒ‰ç…§å…ƒç´ è®¿é—®é¡ºåºæ’åº,é€‚ç”¨äºå°è£… LRU ç¼“å­˜å·¥å…·ã€‚<br>3ã€å› ä¸ºå†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤å„ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥éå†æ—¶çš„æ•ˆç‡å’Œå…ƒç´ ä¸ªæ•°æˆæ­£æ¯”ï¼Œç›¸è¾ƒäºå’Œå®¹é‡æˆæ­£æ¯”çš„ HashMap æ¥è¯´ï¼Œè¿­ä»£æ•ˆç‡ä¼šé«˜å¾ˆå¤šã€‚<br>LinkedHashMap é€»è¾‘ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®ƒæ˜¯åœ¨ HashMap åŸºç¡€ä¸Šåœ¨å„ä¸ªèŠ‚ç‚¹ä¹‹é—´ç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—åŸæœ¬æ•£åˆ—åœ¨ä¸åŒ bucket ä¸Šçš„èŠ‚ç‚¹ã€é“¾è¡¨ã€çº¢é»‘æ ‘æœ‰åºå…³è”èµ·æ¥ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411202317116.png" alt="image-20241120231710846"></p><p><strong>LinkedHashMap ä½¿ç”¨ç¤ºä¾‹</strong></p><p><strong>æ’å…¥é¡ºåºéå†</strong></p><p>å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬æŒ‰ç…§é¡ºåºå¾€ LinkedHashMap æ·»åŠ å…ƒç´ ç„¶åè¿›è¡Œéå†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">LinkedHashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†æ–¹å¼ä¸€</span></span><br><span class="line">System.out.println(<span class="string">&quot;æ–¹å¼ä¸€&quot;</span>);</span><br><span class="line">Set&lt;Map.Entry&lt;Object, Object&gt;&gt; entries = map.entrySet();</span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; entry : entries) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;key:&quot;</span> + entry.getKey() + <span class="string">&quot;,value:&quot;</span> + entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ–¹å¼ä¸€</span><br><span class="line">key:A,value:<span class="number">1</span></span><br><span class="line">key:B,value:<span class="number">2</span></span><br><span class="line">key:C,value:<span class="number">3</span></span><br><span class="line">key:D,value:<span class="number">4</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼ŒLinkedHashMap çš„è¿­ä»£é¡ºåºæ˜¯å’Œæ’å…¥é¡ºåºä¸€è‡´çš„,è¿™ä¸€ç‚¹æ˜¯ HashMap æ‰€ä¸å…·å¤‡çš„ã€‚</p><p><strong>è®¿é—®é¡ºåºéå†</strong></p><p>LinkedHashMap å®šä¹‰äº†æ’åºæ¨¡å¼ accessOrder(boolean ç±»å‹ï¼Œé»˜è®¤ä¸º false)ï¼Œè®¿é—®é¡ºåºåˆ™ä¸º trueï¼Œæ’å…¥é¡ºåºåˆ™ä¸º falseã€‚</p><p>ä¸ºäº†å®ç°è®¿é—®é¡ºåºéå†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼ å…¥ accessOrder å±æ€§çš„ LinkedHashMap æ„é€ æ–¹æ³•ï¼Œå¹¶å°† accessOrder è®¾ç½®ä¸º trueï¼Œè¡¨ç¤ºå…¶å…·å¤‡è®¿é—®æœ‰åºæ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">LinkedHashMap&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;(<span class="number">16</span>, <span class="number">0.75f</span>, <span class="literal">true</span>);</span><br><span class="line">map.put(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;5&quot;</span>);</span><br><span class="line">map.get(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">map.get(<span class="string">&quot;D&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†æ–¹å¼ä¸€</span></span><br><span class="line">System.out.println(<span class="string">&quot;æ–¹å¼ä¸€&quot;</span>);</span><br><span class="line">Set&lt;Map.Entry&lt;Object, Object&gt;&gt; entries = map.entrySet();</span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; entry : entries) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;key:&quot;</span> + entry.getKey() + <span class="string">&quot;,value:&quot;</span> + entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ–¹å¼ä¸€</span><br><span class="line">key:C,value:<span class="number">3</span></span><br><span class="line">key:B,value:<span class="number">5</span></span><br><span class="line">key:A,value:<span class="number">1</span></span><br><span class="line">key:D,value:<span class="number">4</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼ŒLinkedHashMap çš„è¿­ä»£é¡ºåºæ˜¯å’Œè®¿é—®é¡ºåºä¸€è‡´çš„ã€‚</p><p><strong>LRU ç¼“å­˜</strong></p><blockquote><p>This kind of map is well-suited to building LRU caches. Invoking the put, putIfAbsent, get, getOrDefault, compute, computeIfAbsent, computeIfPresent, or merge methods results in an access to the corresponding entry (assuming it exists after the invocation completes).</p></blockquote><p>ä»ä¸Šä¸€ä¸ªæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°é€šè¿‡ LinkedHashMap æˆ‘ä»¬å¯ä»¥å°è£…ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ LRUï¼ˆ<strong>L</strong>east <strong>R</strong>ecently <strong>U</strong>sedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ ç¼“å­˜ï¼Œç¡®ä¿å½“å­˜æ”¾çš„å…ƒç´ è¶…è¿‡å®¹å™¨å®¹é‡æ—¶ï¼Œå°†æœ€è¿‘æœ€å°‘è®¿é—®çš„å…ƒç´ ç§»é™¤ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202412032249993.png" alt="image-20241203224956066"></p><p>å…·ä½“å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>ç»§æ‰¿ LinkedHashMap;</li><li>æ„é€ æ–¹æ³•ä¸­æŒ‡å®š accessOrder ä¸º true ï¼Œè¿™æ ·åœ¨è®¿é—®å…ƒç´ æ—¶å°±ä¼šæŠŠè¯¥å…ƒç´ ç§»åŠ¨åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œé“¾è¡¨é¦–å…ƒç´ å°±æ˜¯æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„å…ƒç´ ï¼›</li><li>é‡å†™removeEldestEntry æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª boolean å€¼ï¼Œå‘ŠçŸ¥ LinkedHashMap æ˜¯å¦éœ€è¦ç§»é™¤é“¾è¡¨é¦–å…ƒç´ ï¼ˆç¼“å­˜å®¹é‡æœ‰é™ï¼‰ã€‚</li></ul><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œç¬”è€…åˆå§‹åŒ–ç¼“å­˜å®¹é‡ä¸º 2ï¼Œç„¶åæŒ‰ç…§æ¬¡åºå…ˆåæ·»åŠ  4 ä¸ªå…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LRUCache</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">LinkedHashMap</span>&lt;K, V&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®¹é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”è®¾ç½®å®¹é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> capacity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸‰ä¸ªå‚æ•°trueè¡¨ç¤ºæŒ‰ç…§è®¿é—®é¡ºåºæ’åº</span></span><br><span class="line">        <span class="built_in">super</span>(capacity, <span class="number">0.75f</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">removeEldestEntry</span><span class="params">(Map.Entry&lt;K, V&gt; eldest)</span> &#123;</span><br><span class="line">        <span class="comment">// å½“mapä¸­çš„æ•°æ®é‡å¤§äºæŒ‡å®šçš„ç¼“å­˜ä¸ªæ•°çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨åˆ é™¤æœ€è€çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span> size() &gt; capacity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LRUCache&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">LRUCache</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">map.put(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;5&quot;</span>);</span><br><span class="line"></span><br><span class="line">map.forEach((k, v) -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;k:&quot;</span> + k + <span class="string">&quot;,v:&quot;</span> + v);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">k:C,v:<span class="number">3</span></span><br><span class="line">k:D,v:<span class="number">4</span></span><br><span class="line">k:B,v:<span class="number">5</span></span><br></pre></td></tr></table></figure><p>ä»è¾“å‡ºç»“æœæ¥çœ‹ï¼Œç”±äºç¼“å­˜å®¹é‡ä¸º 3 ï¼Œå› æ­¤ï¼Œæ·»åŠ ç¬¬ 4 ä¸ªå…ƒç´ æ—¶ï¼Œç¬¬ 1 ä¸ªå…ƒç´ ä¼šè¢«åˆ é™¤ã€‚æ·»åŠ ç¬¬ 5 ä¸ªå…ƒç´ æ—¶ï¼Œç¬¬ 2 ä¸ªå…ƒç´ ä¼šè¢«åˆ é™¤ã€‚</p><h4 id="LinkedHashMap-å’Œ-HashMap-éå†æ€§èƒ½æ¯”è¾ƒ"><a href="#LinkedHashMap-å’Œ-HashMap-éå†æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="LinkedHashMap å’Œ HashMap éå†æ€§èƒ½æ¯”è¾ƒ"></a>LinkedHashMap å’Œ HashMap éå†æ€§èƒ½æ¯”è¾ƒ</h4><p>LinkedHashMap ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥è®°å½•æ•°æ®æ’å…¥çš„é¡ºåºï¼Œå› æ­¤åœ¨è¿­ä»£éå†ç”Ÿæˆçš„è¿­ä»£å™¨çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§åŒå‘é“¾è¡¨çš„è·¯å¾„è¿›è¡Œéå†çš„ã€‚è¿™ä¸€ç‚¹ç›¸æ¯”äº HashMap é‚£ç§éå†æ•´ä¸ª bucket çš„æ–¹å¼æ¥è¯´ï¼Œé«˜æ•ˆéœ€å¤šã€‚</p><p>è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥ä»ä¸¤è€…çš„è¿­ä»£å™¨ä¸­å¾—ä»¥å°è¯ï¼Œå…ˆæ¥çœ‹çœ‹ HashMap çš„è¿­ä»£å™¨ï¼Œå¯ä»¥çœ‹åˆ° HashMap è¿­ä»£é”®å€¼å¯¹æ—¶ä¼šç”¨åˆ°ä¸€ä¸ª nextNode æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å› next æŒ‡å‘çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¼šä» next å¼€å§‹éå† bucket æ‰¾åˆ°ä¸‹ä¸€ä¸ª bucket ä¸­ä¸ä¸ºç©ºçš„å…ƒç´  Nodeã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ LinkedHashMap çš„è¿­ä»£å™¨åˆ™æ˜¯ç›´æ¥ä½¿ç”¨é€šè¿‡ after æŒ‡é’ˆå¿«é€Ÿå®šä½åˆ°å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ï¼Œç®€æ´é«˜æ•ˆéœ€å¤šã€‚</p><p>ä¸ºäº†éªŒè¯ç¬”è€…æ‰€è¯´çš„è§‚ç‚¹ï¼Œç¬”è€…å¯¹è¿™ä¸¤ä¸ªå®¹å™¨è¿›è¡Œäº†å‹æµ‹ï¼Œæµ‹è¯•æ’å…¥ 1000w å’Œè¿­ä»£ 1000w æ¡æ•°æ®çš„è€—æ—¶ï¼Œä»£ç å¦‚ä¸‹:</p><p>ä»è¾“å‡ºç»“æœæ¥çœ‹ï¼Œå› ä¸º LinkedHashMap éœ€è¦ç»´æŠ¤åŒå‘é“¾è¡¨çš„ç¼˜æ•…ï¼Œæ’å…¥å…ƒç´ ç›¸è¾ƒäº HashMap ä¼šæ›´è€—æ—¶ï¼Œä½†æ˜¯æœ‰äº†åŒå‘é“¾è¡¨æ˜ç¡®çš„å‰åèŠ‚ç‚¹å…³ç³»ï¼Œè¿­ä»£æ•ˆç‡ç›¸å¯¹äºå‰è€…é«˜æ•ˆäº†éœ€å¤šã€‚ä¸è¿‡ï¼Œæ€»ä½“æ¥è¯´å´åˆ«ä¸å¤§ï¼Œæ¯•ç«Ÿæ•°æ®é‡è¿™ä¹ˆåºå¤§ã€‚</p><p><strong>LinkedHashMap å¸¸è§é¢è¯•é¢˜</strong></p><p><strong>ä»€ä¹ˆæ˜¯ LinkedHashMapï¼Ÿ</strong></p><p>LinkedHashMap æ˜¯ Java é›†åˆæ¡†æ¶ä¸­ HashMap çš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒç»§æ‰¿äº† HashMap çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ HashMap çš„åŸºç¡€é‡å†™äº† afterNodeRemovalã€afterNodeInsertionã€afterNodeAccess æ–¹æ³•ã€‚ä½¿ä¹‹æ‹¥æœ‰é¡ºåºæ’å…¥å’Œè®¿é—®æœ‰åºçš„ç‰¹æ€§ã€‚</p><p><strong>LinkedHashMap å¦‚ä½•æŒ‰ç…§æ’å…¥é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ</strong></p><p>LinkedHashMap æŒ‰ç…§æ’å…¥é¡ºåºè¿­ä»£å…ƒç´ æ˜¯å®ƒçš„é»˜è®¤è¡Œä¸ºã€‚LinkedHashMap å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨äºè®°å½•å…ƒç´ çš„æ’å…¥é¡ºåºã€‚å› æ­¤ï¼Œå½“ä½¿ç”¨è¿­ä»£å™¨è¿­ä»£å…ƒç´ æ—¶ï¼Œå…ƒç´ çš„é¡ºåºä¸å®ƒä»¬æœ€åˆæ’å…¥çš„é¡ºåºç›¸åŒã€‚</p><p><strong>LinkedHashMap å¦‚ä½•æŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ ï¼Ÿ</strong></p><p>LinkedHashMap å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¸­çš„ accessOrder å‚æ•°æŒ‡å®šæŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ ã€‚å½“ accessOrder ä¸º true æ—¶ï¼Œæ¯æ¬¡è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ ä¼šè¢«ç§»åŠ¨åˆ°é“¾è¡¨çš„æœ«å°¾ï¼Œå› æ­¤ä¸‹æ¬¡è®¿é—®è¯¥å…ƒç´ æ—¶ï¼Œå®ƒå°±ä¼šæˆä¸ºé“¾è¡¨ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»è€Œå®ç°æŒ‰ç…§è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ ã€‚</p><p><strong>LinkedHashMap å¦‚ä½•å®ç° LRU ç¼“å­˜ï¼Ÿ</strong></p><p>å°† accessOrder è®¾ç½®ä¸º true å¹¶é‡å†™ removeEldestEntry æ–¹æ³•å½“é“¾è¡¨å¤§å°è¶…è¿‡å®¹é‡æ—¶è¿”å› trueï¼Œä½¿å¾—æ¯æ¬¡è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ ä¼šè¢«ç§»åŠ¨åˆ°é“¾è¡¨çš„æœ«å°¾ã€‚ä¸€æ—¦æ’å…¥æ“ä½œè®© removeEldestEntry è¿”å› true æ—¶ï¼Œè§†ä¸ºç¼“å­˜å·²æ»¡ï¼ŒLinkedHashMap å°±ä¼šå°†é“¾è¡¨é¦–å…ƒç´ ç§»é™¤ï¼Œç”±æ­¤æˆ‘ä»¬å°±èƒ½å®ç°ä¸€ä¸ª LRU ç¼“å­˜ã€‚</p><p><strong>LinkedHashMap å’Œ HashMap æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p><p>LinkedHashMap å’Œ HashMap éƒ½æ˜¯ Java é›†åˆæ¡†æ¶ä¸­çš„ Map æ¥å£çš„å®ç°ç±»ã€‚å®ƒä»¬çš„æœ€å¤§åŒºåˆ«åœ¨äºè¿­ä»£å…ƒç´ çš„é¡ºåºã€‚HashMap è¿­ä»£å…ƒç´ çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œè€Œ LinkedHashMap æä¾›äº†æŒ‰ç…§æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºè¿­ä»£å…ƒç´ çš„åŠŸèƒ½ã€‚æ­¤å¤–ï¼ŒLinkedHashMap å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨äºè®°å½•å…ƒç´ çš„æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºï¼Œè€Œ HashMap åˆ™æ²¡æœ‰è¿™ä¸ªé“¾è¡¨ã€‚å› æ­¤ï¼ŒLinkedHashMap çš„æ’å…¥æ€§èƒ½å¯èƒ½ä¼šæ¯” HashMap ç•¥ä½ï¼Œä½†å®ƒæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å¹¶ä¸”è¿­ä»£æ•ˆç‡ç›¸è¾ƒäº HashMap æ›´åŠ é«˜æ•ˆã€‚</p><p><strong>å‚è€ƒæ–‡çŒ®</strong></p><p>â—LinkedHashMap æºç è¯¦ç»†åˆ†æï¼ˆJDK1.8ï¼‰:<a href="https://www.imooc.com/article/22931">https://www.imooc.com/article/22931</a><br>â—HashMap ä¸ LinkedHashMap:<a href="https://www.cnblogs.com/Spground/p/8536148.html">https://www.cnblogs.com/Spground/p/8536148.html</a><br>â—æºäº LinkedHashMap æºç : <a href="https://leetcode.cn/problems/lru-cache/solution/yuan-yu-linkedhashmapyuan-ma-by-jeromememory/">https://leetcode.cn/problems/lru-cache/solution/yuan-yu-linkedhashmapyuan-ma-by-jeromememory/</a></p>]]></content>
      
      
      <categories>
          
          <category> java é›†åˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java é›†åˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Explainè¯¦è§£ä¸ç´¢å¼•æœ€ä½³å®è·µ</title>
      <link href="/2024/11/17/Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
      <url>/2024/11/17/Explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h3 id="Explainå·¥å…·ä»‹ç»"><a href="#Explainå·¥å…·ä»‹ç»" class="headerlink" title="Explainå·¥å…·ä»‹ç»"></a>Explainå·¥å…·ä»‹ç»</h3><p>ä½¿ç”¨EXPLAINå…³é”®å­—å¯ä»¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒSQLè¯­å¥ï¼Œåˆ†æä½ çš„æŸ¥è¯¢è¯­å¥æˆ–æ˜¯ç»“æ„çš„æ€§èƒ½ç“¶é¢ˆ</p><p>explain ï¼šæ‰§è¡ŒæŸ¥è¯¢ä¼šè¿”å›æ‰§è¡Œè®¡åˆ’çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æ‰§è¡Œè¿™æ¡SQL</p><p>æ³¨æ„ï¼šå¦‚æœ from ä¸­åŒ…å«å­æŸ¥è¯¢ï¼Œä»ä¼šæ‰§è¡Œè¯¥å­æŸ¥è¯¢ï¼Œå°†ç»“æœæ”¾å…¥ä¸´æ—¶è¡¨ä¸­</p><p>æ¡ˆä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">USE t_explain;</span><br><span class="line">DROP TABLE IF EXISTS `actor`; </span><br><span class="line">CREATE TABLE `actor` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) NOT NULL,</span><br><span class="line">  `name` varchar(<span class="number">45</span>) DEFAULT NULL,</span><br><span class="line">  `update_time` datetime DEFAULT NULL,</span><br><span class="line">  PRIMARY <span class="title function_">KEY</span> <span class="params">(`id`)</span></span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO `actor` (`id`, `name`, `update_time`) VALUES (<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;2017-12-22 15:27:18&#x27;</span>), (<span class="number">2</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;2017-12-22 15:27:18&#x27;</span>), (<span class="number">3</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;2017-12-22 15:27:18&#x27;</span>);</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `film`;</span><br><span class="line">CREATE TABLE `film` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(<span class="number">10</span>) DEFAULT NULL,</span><br><span class="line">  PRIMARY <span class="title function_">KEY</span> <span class="params">(`id`)</span>,</span><br><span class="line">  KEY `idx_name` (`name`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO `film` (`id`, `name`) VALUES (<span class="number">3</span>,<span class="string">&#x27;film0&#x27;</span>),(<span class="number">1</span>,<span class="string">&#x27;film1&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;film2&#x27;</span>);</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `film_actor`;</span><br><span class="line">CREATE TABLE `film_actor` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) NOT NULL,</span><br><span class="line">  `film_id` <span class="type">int</span>(<span class="number">11</span>) NOT NULL,</span><br><span class="line">  `actor_id` <span class="type">int</span>(<span class="number">11</span>) NOT NULL,</span><br><span class="line">  `remark` varchar(<span class="number">255</span>) DEFAULT NULL,</span><br><span class="line">  PRIMARY <span class="title function_">KEY</span> <span class="params">(`id`)</span>,</span><br><span class="line">  KEY `idx_film_actor_id` (`film_id`,`actor_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO `film_actor` (`id`, `film_id`, `actor_id`) VALUES (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h2 id="explainå®æˆ˜"><a href="#explainå®æˆ˜" class="headerlink" title="explainå®æˆ˜"></a>explainå®æˆ˜</h2><p>åœ¨æŸ¥è¯¢ä¸­çš„æ¯ä¸ªè¡¨ä¼šè¾“å‡ºä¸€è¡Œï¼Œå¦‚æœæœ‰ä¸¤ä¸ªè¡¨é€šè¿‡ join è¿æ¥æŸ¥è¯¢ï¼Œé‚£ä¹ˆä¼šè¾“å‡ºä¸¤è¡Œï¼›</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170304599.png" alt="img"></p><p>æ³¨æ„ï¼šexplainå†ä¸åŒçš„ç‰ˆæœ¬æœ‰å¾®å°çš„å·®åˆ«ã€‚</p><p><strong>explain ä¸¤ä¸ªå˜ç§</strong></p><p>1ï¼‰<strong>explain extended</strong>ï¼šä¼šåœ¨ explain çš„åŸºç¡€ä¸Šé¢å¤–æä¾›ä¸€äº›æŸ¥è¯¢ä¼˜åŒ–çš„ä¿¡æ¯ã€‚</p><p>2ï¼‰<strong>explain partitions</strong>ï¼šç›¸æ¯” explain å¤šäº†ä¸ª partitions å­—æ®µï¼Œå¦‚æœæŸ¥è¯¢æ˜¯åŸºäºåˆ†åŒºè¡¨çš„è¯ï¼Œä¼šæ˜¾ç¤ºæŸ¥è¯¢å°†è®¿é—®çš„åˆ†åŒºã€‚</p><p>rows * <em>filtered&#x2F;100</em> å¯ä»¥<strong>ä¼°ç®—</strong>å‡ºå°†è¦å’Œ explain ä¸­å‰ä¸€ä¸ªè¡¨è¿›è¡Œè¿æ¥çš„è¡Œæ•°ï¼ˆå‰ä¸€ä¸ªè¡¨æŒ‡ explain ä¸­çš„idå€¼æ¯”å½“å‰è¡¨idå€¼å°çš„è¡¨ï¼‰</p><p><strong>explain extended</strong>ï¼šä¼šåœ¨ explain çš„åŸºç¡€ä¸Šé¢å¤–æä¾›ä¸€äº›æŸ¥è¯¢ä¼˜åŒ–çš„ä¿¡æ¯ã€‚ç´§éšå…¶åé€šè¿‡ show warnings å‘½ä»¤å¯ä»¥å¾—åˆ°ä¼˜åŒ–åçš„æŸ¥è¯¢è¯­å¥ï¼Œä»è€Œçœ‹å‡ºä¼˜åŒ–å™¨ä¼˜åŒ–äº†ä»€ä¹ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain extended select * from actor;</span><br><span class="line">show warnings;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šé¢ä¸¤æ¡è¯­å¥åæˆªå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170305180.png" alt="img"></p><h3 id="explainä¸­çš„åˆ—"><a href="#explainä¸­çš„åˆ—" class="headerlink" title="explainä¸­çš„åˆ—"></a>explainä¸­çš„åˆ—</h3><h4 id="id"><a href="#id" class="headerlink" title="id:"></a><strong>id:</strong></h4><p>â€‹select çš„åºåˆ—å·ï¼Œæœ‰å‡ ä¸ª select å°±æœ‰å‡ ä¸ªid</p><h4 id="select-type"><a href="#select-type" class="headerlink" title="select_type:"></a><strong>select_type:</strong></h4><p>â€‹è¡¨ç¤ºå¯¹åº”è¡Œæ˜¯ç®€å•è¿˜æ˜¯å¤æ‚çš„æŸ¥è¯¢</p><p>1ï¼‰simpleï¼šç®€å•æŸ¥è¯¢ã€‚æŸ¥è¯¢ä¸åŒ…å«å­æŸ¥è¯¢å’Œunion</p><p>2ï¼‰primaryï¼šå¤æ‚æŸ¥è¯¢ä¸­æœ€å¤–å±‚çš„ select<br>3ï¼‰subqueryï¼šåŒ…å«åœ¨ select ä¸­çš„å­æŸ¥è¯¢ï¼ˆä¸åœ¨ from å­å¥ä¸­ï¼‰<br>4ï¼‰derivedï¼šåŒ…å«åœ¨ from å­å¥ä¸­çš„å­æŸ¥è¯¢ã€‚MySQLä¼šå°†ç»“æœå­˜æ”¾åœ¨ä¸€ä¸ªä¸´æ—¶è¡¨ä¸­ï¼Œä¹Ÿç§°ä¸ºæ´¾ç”Ÿè¡¨ï¼ˆderivedçš„è‹±æ–‡å«ä¹‰ï¼‰</p><p>5ï¼‰unionï¼šåœ¨ union ä¸­çš„ç¬¬äºŒä¸ªå’Œéšåçš„ select</p><h4 id="tableåˆ—"><a href="#tableåˆ—" class="headerlink" title="tableåˆ—"></a>tableåˆ—</h4><p>è¿™ä¸€åˆ—è¡¨ç¤º explain çš„ä¸€è¡Œæ­£åœ¨è®¿é—®å“ªä¸ªè¡¨ã€‚<br>å½“ from å­å¥ä¸­æœ‰å­æŸ¥è¯¢æ—¶ï¼Œtableåˆ—æ˜¯  æ ¼å¼ï¼Œè¡¨ç¤ºå½“å‰æŸ¥è¯¢ä¾èµ– id&#x3D;N çš„æŸ¥è¯¢ï¼Œäºæ˜¯å…ˆæ‰§è¡Œ id&#x3D;N çš„æŸ¥è¯¢ã€‚<br>å½“æœ‰ union æ—¶ï¼ŒUNION RESULT çš„ table åˆ—çš„å€¼ä¸º&lt;union1,2&gt;ï¼Œ1å’Œ2è¡¨ç¤ºå‚ä¸ union çš„ select è¡Œidã€‚</p><h4 id="typeåˆ—"><a href="#typeåˆ—" class="headerlink" title="typeåˆ—"></a>typeåˆ—</h4><p>è¡¨ç¤ºå…³è”ç±»å‹æˆ–è®¿é—®ç±»å‹ï¼Œå³MySQLå†³å®šå¦‚ä½•æŸ¥æ‰¾è¡¨ä¸­çš„è¡Œï¼ŒæŸ¥æ‰¾æ•°æ®è¡Œè®°å½•çš„å¤§æ¦‚èŒƒå›´ã€‚</p><p>ä¾æ¬¡ä»æœ€ä¼˜åˆ°æœ€å·®åˆ†åˆ«ä¸ºï¼šsystem &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½è¾¾åˆ°ref<br><strong>NULLï¼š</strong>mysqlèƒ½å¤Ÿåœ¨ä¼˜åŒ–é˜¶æ®µåˆ†è§£æŸ¥è¯¢è¯­å¥ï¼Œåœ¨æ‰§è¡Œé˜¶æ®µç”¨ä¸ç€å†è®¿é—®è¡¨æˆ–ç´¢å¼•ã€‚</p><p><strong>const, systemï¼š</strong>mysqlèƒ½å¯¹æŸ¥è¯¢çš„æŸéƒ¨åˆ†è¿›è¡Œä¼˜åŒ–å¹¶å°†å…¶è½¬åŒ–æˆä¸€ä¸ªå¸¸é‡ï¼ˆå¯ä»¥çœ‹show warnings çš„ç»“æœï¼‰ã€‚ç”¨äºprimary key æˆ– unique key çš„æ‰€æœ‰åˆ—ä¸å¸¸æ•°æ¯”è¾ƒæ—¶ï¼Œæ‰€ä»¥è¡¨æœ€å¤šæœ‰ä¸€ä¸ªåŒ¹é…è¡Œï¼Œè¯»å–1æ¬¡ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«ã€‚systemæ˜¯constçš„ç‰¹ä¾‹ï¼Œè¡¨é‡Œåªæœ‰ä¸€æ¡å…ƒç»„åŒ¹é…æ—¶ä¸ºsystem</p><p><strong>eq_refï¼š</strong>primary key æˆ– unique key ç´¢å¼•çš„æ‰€æœ‰éƒ¨åˆ†è¢«è¿æ¥ä½¿ç”¨ ï¼Œæœ€å¤šåªä¼šè¿”å›ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„è®°å½•ã€‚</p><p><strong>refï¼š</strong>ç›¸æ¯” eq_refï¼Œä¸ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼Œè€Œæ˜¯ä½¿ç”¨æ™®é€šç´¢å¼•æˆ–è€…å”¯ä¸€æ€§ç´¢å¼•çš„éƒ¨åˆ†å‰ç¼€ï¼Œç´¢å¼•è¦å’ŒæŸä¸ªå€¼ç›¸æ¯”è¾ƒï¼Œå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œã€‚</p><ol><li>ç®€å• select æŸ¥è¯¢ï¼Œnameæ˜¯æ™®é€šç´¢å¼•ï¼ˆéå”¯ä¸€ç´¢å¼•ï¼‰</li><li>å…³è”è¡¨æŸ¥è¯¢ï¼Œ<strong>ç´¢å¼•å…³è”æŸ¥è¯¢çš„å­—æ®µã€‚</strong></li></ol><p><strong>rangeï¼š</strong>èŒƒå›´æ‰«æé€šå¸¸å‡ºç°åœ¨ in(), between ,&gt; ,&lt;, &gt;&#x3D; ç­‰æ“ä½œä¸­ã€‚ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥æ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œã€‚</p><p>ä¸è¦ä½¿ç”¨select * from table; å…¨è¡¨æŸ¥æ‰¾ï¼Œå¦‚æœæ•°æ®å¤ªå¤§çš„è¯å†…å­˜å¯èƒ½ä¼šè¢«å æ»¡ã€‚å½“æ²¡æœ‰æ·»åŠ æ¡ä»¶çš„æ—¶å€™ï¼Œä¸ç®¡æ˜¯ä½¿ç”¨ä¸»é”®ç´¢å¼•è¿˜æ˜¯è¾…åŠ©ç´¢å¼•éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾çš„ã€‚</p><p><strong>indexï¼š</strong>æ‰«æå…¨ç´¢å¼•å°±èƒ½æ‹¿åˆ°ç»“æœï¼Œä¸€èˆ¬æ˜¯æ‰«ææŸä¸ªäºŒçº§ç´¢å¼•ï¼Œè¿™ç§æ‰«æä¸ä¼šä»ç´¢å¼•æ ‘æ ¹èŠ‚ç‚¹å¼€å§‹å¿«é€ŸæŸ¥æ‰¾ï¼Œè€Œæ˜¯ç›´æ¥å¯¹äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹éå†å’Œæ‰«æï¼Œé€Ÿåº¦è¿˜æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œè¿™ç§æŸ¥è¯¢ä¸€èˆ¬ä¸ºä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•ä¸€èˆ¬æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™ç§é€šå¸¸æ¯”ALLå¿«ä¸€äº›ã€‚</p><p><strong>æ³¨æ„ï¼š å¦‚æœæœç´¢çš„ç»“æœé›†åœ¨ä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•éƒ½å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆä¼šä¼˜å…ˆé€‰æ‹©è¾…åŠ©ç´¢å¼•ã€‚</strong>å¦‚æœè¾…åŠ©ç´¢å¼•ä¸å…¨æœ‰ï¼Œé‚£ä¹ˆéœ€è¦å›è¡¨æ•ˆç‡å°±ä¼šæ¯”è¾ƒä½ã€‚</p><p><strong>ALLï¼š</strong>å³å…¨è¡¨æ‰«æï¼Œæ‰«æä½ çš„èšç°‡ç´¢å¼•çš„æ‰€æœ‰å¶å­èŠ‚ç‚¹ã€‚é€šå¸¸æƒ…å†µä¸‹è¿™éœ€è¦å¢åŠ ç´¢å¼•æ¥è¿›è¡Œä¼˜åŒ–äº†ã€‚</p><h4 id="possible-keysï¼š"><a href="#possible-keysï¼š" class="headerlink" title="possible_keysï¼š"></a><strong>possible_keys</strong>ï¼š</h4><p>â€‹è¿™ä¸€åˆ—æ˜¾ç¤ºæŸ¥è¯¢å¯èƒ½ä½¿ç”¨å“ªäº›ç´¢å¼•æ¥æŸ¥æ‰¾ã€‚</p><h4 id="keyï¼š"><a href="#keyï¼š" class="headerlink" title="keyï¼š"></a><strong>keyï¼š</strong></h4><p>â€‹è¿™ä¸€åˆ—æ˜¾ç¤ºmysqlå®é™…é‡‡ç”¨å“ªä¸ªç´¢å¼•æ¥ä¼˜åŒ–å¯¹è¯¥è¡¨çš„è®¿é—®ã€‚</p><h4 id="key-lenï¼š"><a href="#key-lenï¼š" class="headerlink" title="key_lenï¼š"></a><strong>key_lenï¼š</strong></h4><p>â€‹è¿™ä¸€åˆ—æ˜¾ç¤ºäº†mysqlåœ¨ç´¢å¼•é‡Œä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå€¼å¯ä»¥ç®—å‡ºå…·ä½“ä½¿ç”¨äº†ç´¢å¼•ä¸­çš„å“ªäº›åˆ—ã€‚å¦‚æœç´¢å¼•å­—æ®µä½¿ç”¨çš„æ˜¯int é‚£ä¹ˆ key_len æ˜¾ç¤º 4ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯è”åˆ é‚£ä¹ˆå°±æ˜¯æ‰€æœ‰è”åˆç´¢å¼•ä¸­çš„ç´¢å¼•å­—æ®µé•¿åº¦ä¹‹å’Œã€‚</p><h4 id="refåˆ—"><a href="#refåˆ—" class="headerlink" title="refåˆ—:"></a><strong>refåˆ—:</strong></h4><p>â€‹è¿™ä¸€åˆ—æ˜¾ç¤ºäº†åœ¨keyåˆ—è®°å½•çš„ç´¢å¼•ä¸­ï¼Œè¡¨æŸ¥æ‰¾å€¼æ‰€ç”¨åˆ°çš„åˆ—æˆ–å¸¸é‡ï¼Œå¸¸è§çš„æœ‰ï¼šconstï¼ˆå¸¸é‡ï¼‰ï¼Œå­—æ®µåï¼ˆä¾‹ï¼šfilm.idï¼‰</p><h4 id="rows"><a href="#rows" class="headerlink" title="rows:"></a><strong>rows:</strong></h4><p>â€‹mysqlä¼°è®¡è¦è¯»å–å¹¶æ£€æµ‹çš„è¡Œæ•°,å¹¶ä¸æ˜¯ç»“æœé›†é‡Œçš„è¡Œæ•°ã€‚</p><h4 id="Extraåˆ—ï¼š"><a href="#Extraåˆ—ï¼š" class="headerlink" title="Extraåˆ—ï¼š"></a><strong>Extraåˆ—ï¼š</strong></h4><p>å±•ç¤ºçš„æ˜¯é¢å¤–ä¿¡æ¯</p><ul><li>Using indexï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•</li><li>Using whereï¼šä½¿ç”¨ where è¯­å¥æ¥å¤„ç†ç»“æœï¼Œå¹¶ä¸”æŸ¥è¯¢çš„åˆ—æœªè¢«ç´¢å¼•è¦†ç›–ã€‚</li><li>Using index conditionï¼šæŸ¥è¯¢çš„åˆ—ä¸å®Œå…¨è¢«ç´¢å¼•è¦†ç›–ï¼Œwhereæ¡ä»¶ä¸­æ˜¯ä¸€ä¸ªå‰å¯¼åˆ—çš„èŒƒå›´ï¼›</li><li>Using temporaryï¼šmysqléœ€è¦åˆ›å»ºä¸€å¼ ä¸´æ—¶è¡¨æ¥å¤„ç†æŸ¥è¯¢ã€‚<strong>éœ€è¦è¿›è¡Œä¼˜åŒ–ï¼Œé¦–å…ˆæ˜¯æƒ³åˆ°ç”¨ç´¢å¼•æ¥ä¼˜åŒ–ã€‚</strong><br><code>explain select distinct name from actor;</code>æ²¡æœ‰ç´¢å¼•éœ€è¦å°†ç»“æœæŸ¥è¯¢å‡ºæ¥ï¼Œç„¶ååœ¨é›¶æ—¶çš„å†…å­˜é‡Œçš„è¡¨è¿›è¡Œå»é‡ã€‚<br><code>explain select distinct name from film;</code>å»ºç«‹äº†nameçš„ç´¢å¼•ï¼Œæ­¤æ—¶æŸ¥è¯¢ï¼Œextraæ˜¯using index,æ²¡æœ‰ç”¨ä¸´æ—¶è¡¨ã€‚</li><li>Using filesortï¼šå°†ç”¨å¤–éƒ¨æ’åºè€Œä¸æ˜¯ç´¢å¼•æ’åºï¼Œæ•°æ®è¾ƒå°æ—¶ä»å†…å­˜æ’åºï¼Œå¦åˆ™éœ€è¦åœ¨ç£ç›˜å®Œæˆæ’åºã€‚<br><code>explain select * from actor order by name;</code>æœªåˆ›å»ºç´¢å¼•ï¼Œä¼šæµè§ˆactoræ•´ä¸ªè¡¨ï¼Œä¿å­˜æ’åºå…³é”®å­—nameå’Œå¯¹åº”çš„idï¼Œç„¶åæ’åºnameå¹¶æ£€ç´¢è¡Œè®°å½•ã€‚<br><code>explain select * from film order by name;</code>å»ºç«‹äº†idx_nameç´¢å¼•,æ­¤æ—¶æŸ¥è¯¢æ—¶extraæ˜¯using indexã€‚</li><li>Select tables optimized awayï¼šä½¿ç”¨æŸäº›èšåˆå‡½æ•°ï¼ˆæ¯”å¦‚ maxã€minï¼‰æ¥è®¿é—®å­˜åœ¨ç´¢å¼•çš„æŸä¸ªå­—æ®µã€‚</li></ul><p>è¦†ç›–ç´¢å¼•ä¸€èˆ¬é’ˆå¯¹çš„æ˜¯è¾…åŠ©ç´¢å¼•ï¼Œæ•´ä¸ªæŸ¥è¯¢ç»“æœåªé€šè¿‡è¾…åŠ©ç´¢å¼•å°±èƒ½æ‹¿åˆ°ç»“æœï¼Œä¸éœ€è¦é€šè¿‡è¾…åŠ©ç´¢å¼•æ ‘æ‰¾åˆ°ä¸»é”®ï¼Œå†é€šè¿‡ä¸»é”®å»ä¸»é”®ç´¢å¼•æ ‘é‡Œè·å–å…¶å®ƒå­—æ®µå€¼ã€‚è¿™æ—¶ä¸éœ€è¦å›è¡¨ã€‚</p><p>select 1 from table â€“ å¢åŠ ä¸´æ—¶åˆ—ï¼Œæ”¾åœ¨è¡¨æœ€åï¼Œ æ¯è¡Œå€¼ä¸º1</p><h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `employees` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">24</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line">  `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;å¹´é¾„&#x27;</span>,</span><br><span class="line">  `position` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;èŒä½&#x27;</span>,</span><br><span class="line">  `hire_time` <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;å…¥èŒæ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_name_age_position` (`name`,`age`,`position`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;å‘˜å·¥è®°å½•è¡¨&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees(name,age,position,hire_time) <span class="keyword">VALUES</span>(<span class="string">&#x27;LiLei&#x27;</span>,<span class="number">22</span>,<span class="string">&#x27;manager&#x27;</span>,NOW());</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees(name,age,position,hire_time) <span class="keyword">VALUES</span>(<span class="string">&#x27;HanMeimei&#x27;</span>, <span class="number">23</span>,<span class="string">&#x27;dev&#x27;</span>,NOW());</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> employees(name,age,position,hire_time) <span class="keyword">VALUES</span>(<span class="string">&#x27;Lucy&#x27;</span>,<span class="number">23</span>,<span class="string">&#x27;dev&#x27;</span>,NOW());</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„employeesè¡¨ä¸­ä½¿ç”¨äº†è”åˆç´¢å¼•åŒ…å«ä¸‰ä¸ªå­—æ®µ<code>name</code>,<code>age</code>,<code>position</code>ã€‚</p><p>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼šåœ¨MySQLå»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆæœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚</p><p>ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆå°±çœ‹ sqlè¯­å¥ç”¨åˆ°çš„ç»“æœé›†ï¼Œæ˜¯å¦åœ¨ç´¢å¼•æ ‘é‡Œèƒ½å¤Ÿå®šä½ã€‚å¹¶ä¸”ä¿è¯æœ‰åºã€‚</p><h4 id="å…¨èŒåŒ¹é…"><a href="#å…¨èŒåŒ¹é…" class="headerlink" title="å…¨èŒåŒ¹é…"></a>å…¨èŒåŒ¹é…</h4><p>æŸ¥çœ‹æ‰§è¡Œæƒ…å†µ<code>explain select * from employees where name = &#39;lilei&#39;;</code> (<strong>åªä½¿ç”¨nameç´¢å¼•</strong>)</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170305448.png" alt="img"></p><p>key_len :  3n + 2 &#x3D; 3 * 24 + 2  (è¿™ä¸€æ¡sqlè¯­å¥åªä½¿ç”¨äº†nameçš„ç´¢å¼•)</p><p><code>EXPLAIN SELECT * FROM employees WHERE name= &#39;LiLei&#39; AND age = 22;</code>ï¼ˆ<strong>ä½¿ç”¨name å’Œ ageç´¢å¼•</strong>ï¼‰</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170305467.png" alt="img"></p><p>key_len : name_len + age_len &#x3D; (3*24 + 2) + 4 &#x3D; 78</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM employees WHERE name= &#x27;LiLei&#x27; AND age = 23 AND position =&#x27;manager&#x27;;</span><br></pre></td></tr></table></figure><p>ï¼ˆ<strong>ä½¿ç”¨name , age å’Œ positionç´¢å¼•</strong>ï¼‰</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170305450.png" alt="img"></p><p>key_len: name_len + age_len+ position_len  &#x3D; (3<em>24 + 2) + 4 + 20</em>  3 + 2 &#x3D; 140</p><h4 id="æœ€å·¦å‰ç¼€æ³•åˆ™"><a href="#æœ€å·¦å‰ç¼€æ³•åˆ™" class="headerlink" title="æœ€å·¦å‰ç¼€æ³•åˆ™"></a><strong>æœ€å·¦å‰ç¼€æ³•åˆ™</strong></h4><p>å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹å¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚ä½†æ˜¯å¦‚æœè‡ªå·±å†™çš„æŸ¥è¯¢è¯­å¥æ²¡æœ‰æ»¡è¶³è¯¥åŸåˆ™ï¼ŒMySQLå†…éƒ¨å›è¿›è¡Œä¼˜åŒ–ï¼Œè¯•å…¶æ»¡è¶³ã€‚ä½†æ˜¯<strong>å»ºè®®è‡ªå·±å†™æ—¶å°±è¦æ»¡è¶³ï¼Œä¸è¦åŠ é‡MySQLçš„è´Ÿæ‹…ã€‚</strong></p><h4 id="ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ"><a href="#ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ" class="headerlink" title="ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ"></a><strong>ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œ</strong></h4><p><strong>ä¸åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œï¼ˆè®¡ç®—ã€å‡½æ•°ã€ï¼ˆè‡ªåŠ¨oræ‰‹åŠ¨ï¼‰ç±»å‹è½¬æ¢ï¼‰ï¼Œé¿å…ç´¢å¼•å¤±æ•ˆè€Œè½¬å‘å…¨è¡¨æ‰«æ</strong></p><p>åŸå› ï¼šå› ä¸ºç´¢å¼•æ ‘é‡Œé¢æ²¡æœ‰è¿™äº›å­—æ®µ</p><h4 id="å­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—"><a href="#å­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—" class="headerlink" title="å­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—"></a>å­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­èŒƒå›´æ¡ä»¶å³è¾¹çš„åˆ—</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name<span class="operator">=</span> <span class="string">&#x27;LiLei&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">22</span> <span class="keyword">AND</span> position <span class="operator">=</span><span class="string">&#x27;manager&#x27;</span>;</span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> name<span class="operator">=</span> <span class="string">&#x27;LiLei&#x27;</span> <span class="keyword">AND</span> age <span class="operator">&gt;</span> <span class="number">22</span> <span class="keyword">AND</span> position <span class="operator">=</span><span class="string">&#x27;manager&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170305142.png" alt="img"></p><p>åœ¨ç¬¬ä¸€ä¸ªå­—æ®µç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªå­—æ®µä¸€å®šæ˜¯æœ‰åºçš„(èŒƒå›´æŸ¥æ‰¾)ã€‚æŒ‰ç…§æœ€å·¦å‰æœ€æ³•åˆ™ï¼Œå‰é¢çš„å­—æ®µç´¢å¼•éƒ½ç”¨åˆ°äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä¸€ä¸ªå°ç»„æœ‰åº</p><h4 id="å‡å°‘-select-è¯­å¥"><a href="#å‡å°‘-select-è¯­å¥" class="headerlink" title="å‡å°‘ select * è¯­å¥"></a>å‡å°‘ select * è¯­å¥</h4><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆåªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ï¼ˆç´¢å¼•åˆ—åŒ…å«æŸ¥è¯¢åˆ—ï¼‰ï¼‰ï¼Œå‡å°‘ select * è¯­å¥</p><h4 id="æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ"><a href="#æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ" class="headerlink" title="æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ"></a>æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</h4><p>mysqlåœ¨ä½¿ç”¨ä¸ç­‰äºï¼ˆï¼&#x3D;æˆ–è€…&lt;&gt;ï¼‰ï¼Œnot in ï¼Œnot exists çš„æ—¶å€™æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ&lt; å°äºã€ &gt; å¤§äºã€ &lt;&#x3D;ã€&gt;&#x3D; è¿™äº›ï¼Œmysqlå†…éƒ¨ä¼˜åŒ–å™¨ä¼šæ ¹æ®æ£€ç´¢æ¯”ä¾‹ã€è¡¨å¤§å°ç­‰å¤šä¸ªå› ç´ æ•´ä½“è¯„ä¼°æ˜¯å¦ä½¿ç”¨ç´¢å¼•</p><h4 id="is-null-is-not-null-ä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•"><a href="#is-null-is-not-null-ä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•" class="headerlink" title="is null,is not null ä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•"></a>is null,is not null ä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•</h4><h4 id="like"><a href="#like" class="headerlink" title="like"></a>like</h4><p>likeä»¥é€šé…ç¬¦å¼€å¤´ï¼ˆâ€™$abcâ€¦â€™ï¼‰mysqlç´¢å¼•å¤±æ•ˆä¼šå˜æˆå…¨è¡¨æ‰«ææ“ä½œ</p><p>%å­—ç¬¦ä¸²:ä¸èƒ½èµ°ç´¢å¼•,ç™¾åˆ†å·åœ¨å‰ä¼šè®©MySQLè®¤ä¸ºå­—ç¬¦ä¸²ä¹‹å‰è¿˜æœ‰å…¶ä»–å­—ç¬¦ä¸²ï¼Œè·³è¿‡è¿™å…¶ä»–å­—ç¬¦ä¸²åœ¨ç´¢å¼•æ ‘é‡Œå°±ä¸æ˜¯æœ‰åºçš„äº†ã€‚</p><p>å­—ç¬¦ä¸²%ï¼šèƒ½èµ°ç´¢å¼•ï¼Œä½¿ç”¨ç´¢å¼•çš„å­—ç¬¦ä¸²ï¼Œç´¢å¼•å°±å¯ä»¥èµ°ç´¢å¼•ã€‚</p><p>é—®é¢˜ï¼šè§£å†³likeâ€™%å­—ç¬¦ä¸²%â€™ç´¢å¼•ä¸è¢«ä½¿ç”¨çš„æ–¹æ³•ï¼Ÿ<br>aï¼‰ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ŒæŸ¥è¯¢å­—æ®µå¿…é¡»æ˜¯å»ºç«‹è¦†ç›–ç´¢å¼•å­—æ®µ</p><p>bï¼‰å¦‚æœä¸èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•åˆ™å¯èƒ½éœ€è¦å€ŸåŠ©æœç´¢å¼•æ“</p><h4 id="å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆ"><a href="#å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆ"></a>å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•å¤±æ•ˆ</h4><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170305007.png" alt="img"></p><h4 id="å°‘ç”¨oræˆ–in"><a href="#å°‘ç”¨oræˆ–in" class="headerlink" title="å°‘ç”¨oræˆ–in"></a>å°‘ç”¨oræˆ–in</h4><p>ç”¨å®ƒæŸ¥è¯¢æ—¶ï¼Œmysqlä¸ä¸€å®šä½¿ç”¨ç´¢å¼•ï¼Œmysqlå†…éƒ¨ä¼˜åŒ–å™¨ä¼šæ ¹æ®æ£€ç´¢æ¯”ä¾‹ã€è¡¨å¤§å°ç­‰å¤šä¸ªå› ç´ æ•´ä½“è¯„<br>ä¼°æ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼Œè¯¦è§èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–</p><h4 id="èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–"><a href="#èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–"></a>èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–</h4><p>æ²¡èµ°ç´¢å¼•åŸå› ï¼šmysqlå†…éƒ¨ä¼˜åŒ–å™¨ä¼šæ ¹æ®æ£€ç´¢æ¯”ä¾‹ã€è¡¨å¤§å°ç­‰å¤šä¸ªå› ç´ æ•´ä½“è¯„ä¼°æ˜¯å¦ä½¿ç”¨ç´¢å¼•ã€‚æ¯”å¦‚ï¼šå¯èƒ½æ˜¯ç”±äºå•æ¬¡æ•°æ®é‡æŸ¥è¯¢è¿‡å¤§å¯¼è‡´ä¼˜åŒ–å™¨æœ€ç»ˆé€‰æ‹©ä¸èµ°ç´¢å¼•ã€‚<br>ä¼˜åŒ–æ–¹æ³•ï¼šå¯ä»¥å°†å¤§çš„èŒƒå›´æ‹†åˆ†æˆå¤šä¸ªå°èŒƒå›´ã€‚</p><h3 id="ç´¢å¼•ä½¿ç”¨æ€»ç»“ï¼š"><a href="#ç´¢å¼•ä½¿ç”¨æ€»ç»“ï¼š" class="headerlink" title="ç´¢å¼•ä½¿ç”¨æ€»ç»“ï¼š"></a>ç´¢å¼•ä½¿ç”¨æ€»ç»“ï¼š</h3><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170305025.png" alt="img"></p><p><strong>like KK%ç›¸å½“äº&#x3D;å¸¸é‡ï¼Œ%KKå’Œ%KK% ç›¸å½“äºèŒƒå›´</strong></p><p>è¯´æ˜ï¼š</p><p>key_lenè®¡ç®—è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li><p>å­—ç¬¦ä¸²ï¼Œchar(n)å’Œvarchar(n)ï¼Œ5.0.3ä»¥åç‰ˆæœ¬ä¸­ï¼Œ<strong>nå‡ä»£è¡¨å­—ç¬¦æ•°ï¼Œè€Œä¸æ˜¯å­—èŠ‚æ•°ï¼Œ</strong>å¦‚æœæ˜¯utf-8ï¼Œä¸€ä¸ªæ•°å­—æˆ–å­—æ¯å 1ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªæ±‰å­—å 3ä¸ªå­—èŠ‚</p></li><li></li><li><p>char(n)ï¼šå¦‚æœå­˜æ±‰å­—é•¿åº¦å°±æ˜¯ 3n å­—èŠ‚</p></li><li><p>varchar(n)ï¼šå¦‚æœå­˜æ±‰å­—åˆ™é•¿åº¦æ˜¯ 3n + 2 å­—èŠ‚ï¼ŒåŠ çš„2å­—èŠ‚ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸²é•¿åº¦ï¼Œå› ä¸ºvarcharæ˜¯å˜é•¿å­—ç¬¦ä¸²</p></li><li><p>æ•°å€¼ç±»å‹</p></li><li></li><li><p>tinyintï¼š1å­—èŠ‚</p></li><li><p>smallintï¼š2å­—èŠ‚</p></li><li><p>intï¼š4å­—èŠ‚</p></li><li><p>bigintï¼š8å­—èŠ‚</p></li><li><p>æ—¶é—´ç±»å‹</p></li><li></li><li><p>dateï¼š3å­—èŠ‚</p></li><li><p>timestampï¼š4å­—èŠ‚</p></li><li><p>datetimeï¼š8å­—èŠ‚</p></li><li><p>å¦‚æœå­—æ®µå…è®¸ä¸º NULLï¼Œéœ€è¦1å­—èŠ‚è®°å½•æ˜¯å¦ä¸º NULL</p></li></ul><p>ç´¢å¼•æœ€å¤§é•¿åº¦æ˜¯768å­—èŠ‚ï¼Œå½“å­—ç¬¦ä¸²è¿‡é•¿æ—¶ï¼Œmysqlä¼šåšä¸€ä¸ªç±»ä¼¼å·¦å‰ç¼€ç´¢å¼•çš„å¤„ç†ï¼Œå°†å‰åŠéƒ¨åˆ†çš„å­—ç¬¦æå–å‡ºæ¥åšç´¢å¼•ã€‚</p><p>charï¼šå®šé•¿ï¼Œæ•ˆç‡é«˜ï¼Œä¸€èˆ¬ç”¨äºå›ºå®šé•¿åº¦çš„è¡¨å•æäº¤æ•°æ®å­˜å‚¨ ï¼›ä¾‹å¦‚ï¼šèº«ä»½è¯å·ï¼Œæ‰‹æœºå·ï¼Œç”µè¯ï¼Œå¯†ç ç­‰</p><p>varcharï¼šä¸å®šé•¿ï¼Œæ•ˆç‡åä½</p>]]></content>
      
      
      <categories>
          
          <category> mysql çŸ¥è¯†æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ç†è§£MySQLåº•å±‚æ•°æ®ç»“æ„ä¸ç®—æ³•</title>
      <link href="/2024/11/17/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3MySQL%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
      <url>/2024/11/17/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3MySQL%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h3><ol><li>ç´¢å¼•æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ’å¥½åºçš„æ•°æ®ç»“æ„</li><li>ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼šäºŒå‰æ ‘ï¼Œçº¢é»‘æ ‘ï¼ŒHashè¡¨ï¼ŒB-æ ‘</li></ol><p>æ²¡æœ‰åŠ ç´¢å¼•</p><p>æ²¡æœ‰åŠ ç´¢å¼•æ—¶ï¼ŒMySQLåº•å±‚æ˜¯ä¸€è¡Œä¸€è¡Œçš„è¿›è¡ŒæŸ¥æ‰¾çš„ï¼Œå½“æ‰¾åˆ°age&#x3D;18çš„å­—æ®µåä¾ç„¶ä¸èƒ½ç¡®å®šåé¢çš„æ•°æ®æ˜¯å¦è¿˜æœ‰age&#x3D;18çš„å­—æ®µï¼Œæ‰€ä»¥ä¾ç„¶éœ€è¦ç»§ç»­æŸ¥æ‰¾ï¼Œä¸€æ¬¡æŸ¥æ‰¾å°±æ˜¯ä¸€æ¬¡ç£ç›˜IOï¼ˆMysql é€šè¿‡ç£ç›˜ IO æ¬¡æ•°è¡¡é‡æŸ¥è¯¢æ•ˆç‡çš„ï¼‰ï¼Œå¦‚æœä¸€å¼ è¡¨æœ‰10ä¸‡æ¡æ•°æ®é‚£ä¹ˆå°±éœ€è¦è¿›è¡Œ10ä¸‡æ¬¡çš„æŸ¥æ‰¾ï¼ŒæŠŠæ•°æ®ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜çš„é€Ÿåº¦ä¸å¿«ï¼Œå¦‚æœæ•°æ®é‡å¤§çš„è¯ï¼Œéœ€è¦èŠ±è´¹ç›¸å½“å¤šçš„æ—¶é—´ï¼Œæ‰èƒ½æ‰«æå®Œæ•´å¼ è¡¨ã€‚</p><p>B-Tree</p><p>å¶èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦ï¼Œå¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆä¸ºç©º</p><p>æ‰€æœ‰ç´¢å¼•å…ƒç´ ä¸é‡å¤</p><p>èŠ‚ç‚¹ä¸­çš„æ•°æ®ç´¢å¼•ä»å·¦åˆ°å³é€’å¢æ’åˆ—</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170256516.png" alt="img"></p><p>B+Tree(B-Treeå˜ç§)</p><p>éå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨dataï¼Œåªå­˜å‚¨ç´¢å¼•(å†—ä½™)ï¼Œå¯ä»¥æ”¾æ›´å¤šçš„ç´¢å¼•</p><p>å¶å­èŠ‚ç‚¹åŒ…å«æ‰€æœ‰ç´¢å¼•å­—æ®µ</p><p>å¶å­èŠ‚ç‚¹ç”¨æŒ‡é’ˆè¿æ¥ï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170256253.png" alt="img"></p><p>æŸ¥æ‰¾ç®—æ³•ï¼šæŠ˜åŠæŸ¥æ‰¾ ï¼Œ æ‰¾30â€“(å°†ä¸Šå›¾æœ€ä¸Šé¢çš„æ•°æ®é¡µåŠ è½½åˆ°å†…å­˜) â€“&gt; (15,56)â€”ï¼ˆå°†ä¸Šå›¾ç¬¬äºŒè¡Œçš„æ•°æ®é¡µåŠ è½½åˆ°å†…å­˜ï¼‰â€“&gt;(20,49)â€“&gt;â€¦  30</p><p>ä¸€ä¸ª B+ æ ‘çš„èŠ‚ç‚¹ä¸­åˆ°åº•å­˜å¤šå°‘ä¸ªå…ƒç´ æœ€åˆé€‚ä½ æœ‰äº†è§£è¿‡ä¹ˆï¼Ÿ</p><p>æ”¾æ»¡å¯ä»¥å­˜æ”¾å¤šå°‘ ï¼š 16kb&#x2F;(8+6)b  X  16kb&#x2F;(8+6)b  X  16KB</p><p>B+ æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸ºä¸€é¡µæˆ–é¡µçš„å€æ•°æœ€ä¸ºåˆé€‚ã€‚(é¡µæ˜¯InnoDBç®¡ç†å­˜å‚¨ç©ºé—´çš„åŸºæœ¬å•ä½ï¼ŒInnoDBå°†æ•°æ®åº“ä¸­çš„æ•°æ®å­˜å‚¨åœ¨é¡µè¿™ä¸ªåŸºæœ¬å­˜å‚¨å•ä½é‡Œã€‚é¡µä¹Ÿæ˜¯å†…å­˜å’Œç£ç›˜äº¤äº’çš„åŸºæœ¬å•ä½ï¼Œæ•°æ®åº“ä»ç£ç›˜ä¸­è¯»å–è‹¥å¹²ä¸ªé¡µé¢å¤§å°çš„æ•°æ®åˆ°å†…å­˜ï¼Œä¹Ÿå°†å†…å­˜ä¸­è‹¥å¹²ä¸ªå¤§å°çš„æ•°æ®åˆ·æ–°åˆ°ç£ç›˜ã€‚ä¸€ä¸ªé¡µçš„å†…å­˜å¤§å°ä¸º16KB)</p><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°å°äº 1 é¡µï¼Œé‚£ä¹ˆè¯»å–è¿™ä¸ªèŠ‚ç‚¹çš„æ—¶å€™å…¶å®ä¹Ÿä¼šè¯»å‡º1é¡µï¼Œé€ æˆèµ„æºçš„æµªè´¹ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°å¤§äº 1 é¡µï¼Œæ¯”å¦‚ 1.2 é¡µï¼Œé‚£ä¹ˆè¯»å–è¿™ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ä¼šè¯»å‡º2é¡µï¼Œä¹Ÿä¼šé€ æˆèµ„æºçš„æµªè´¹ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170256341.png" alt="img"></p><p>MyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„(éèšé›†)</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170256321.png" alt="img"></p><h4 id="ç´¢å¼•å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­"><a href="#ç´¢å¼•å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­" class="headerlink" title="ç´¢å¼•å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­"></a><strong>ç´¢å¼•å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­</strong></h4><p>ç´¢å¼•æ˜¯å æ®ç‰©ç†ç©ºé—´çš„ï¼Œåœ¨ä¸åŒçš„å­˜å‚¨å¼•æ“ä¸­ï¼Œç´¢å¼•å­˜åœ¨çš„æ–‡ä»¶ä¹Ÿä¸åŒ</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170256302.png" alt="img"></p><p>InnoDBç´¢å¼•å®ç°(èšé›†)</p><p>è¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„æ–‡ä»¶</p><p>èšé›†ç´¢å¼•-å¶èŠ‚ç‚¹åŒ…å«äº†å®Œæ•´çš„æ•°æ®è®°å½•</p><p>ä¸ºä»€ä¹ˆå»ºè®®InnoDBè¡¨å¿…é¡»å»ºä¸»é”®ï¼Œå¹¶ä¸”æ¨èä½¿ç”¨æ•´å‹çš„è‡ªå¢ä¸»é”®ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆéä¸»é”®ç´¢å¼•ç»“æ„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ï¼Ÿ(ä¸€è‡´æ€§å’ŒèŠ‚çœå­˜å‚¨ç©ºé—´)</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170257973.png" alt="img"></p><p>è”åˆç´¢å¼•çš„åº•å±‚å­˜å‚¨ç»“æ„é•¿ä»€ä¹ˆæ ·ï¼Ÿ</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411170257683.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> mysql çŸ¥è¯†æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RocketMQçš„ç¼–ç¨‹æ¨¡å‹</title>
      <link href="/2024/11/17/RocketMQ%E7%9A%84%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B/"/>
      <url>/2024/11/17/RocketMQ%E7%9A%84%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="RocketMQçš„ç¼–ç¨‹æ¨¡å‹"><a href="#RocketMQçš„ç¼–ç¨‹æ¨¡å‹" class="headerlink" title="RocketMQçš„ç¼–ç¨‹æ¨¡å‹"></a>RocketMQçš„ç¼–ç¨‹æ¨¡å‹</h2><ul><li>æ¶ˆæ¯å‘é€è€…çš„å›ºå®šæ­¥éª¤1.åˆ›å»ºæ¶ˆæ¯ç”Ÿäº§è€…producerï¼Œå¹¶åˆ¶å®šç”Ÿäº§è€…ç»„å<br>2.æŒ‡å®šNameserveråœ°å€<br>3.å¯åŠ¨producer<br>4.åˆ›å»ºæ¶ˆæ¯å¯¹è±¡ï¼ŒæŒ‡å®šä¸»é¢˜Topicã€Tagå’Œæ¶ˆæ¯ä½“<br>5.å‘é€æ¶ˆæ¯<br>6.å…³é—­ç”Ÿäº§è€…producer</li><li>æ¶ˆæ¯æ¶ˆè´¹è€…çš„å›ºå®šæ­¥éª¤1.åˆ›å»ºæ¶ˆè´¹è€…Consumerï¼Œåˆ¶å®šæ¶ˆè´¹è€…ç»„å<br>2.æŒ‡å®šNameserveråœ°å€<br>3.è®¢é˜…ä¸»é¢˜Topicå’ŒTag<br>4.è®¾ç½®å›è°ƒå‡½æ•°ï¼Œå¤„ç†æ¶ˆæ¯<br>5.å¯åŠ¨æ¶ˆè´¹è€…consumer</li></ul><h2 id="RocketMQçš„æ¶ˆæ¯æ ·ä¾‹"><a href="#RocketMQçš„æ¶ˆæ¯æ ·ä¾‹" class="headerlink" title="RocketMQçš„æ¶ˆæ¯æ ·ä¾‹"></a>RocketMQçš„æ¶ˆæ¯æ ·ä¾‹</h2><h3 id="1-æ¶ˆæ¯çš„å‘é€åˆ†ä¸ºä¸‰ç§ï¼š"><a href="#1-æ¶ˆæ¯çš„å‘é€åˆ†ä¸ºä¸‰ç§ï¼š" class="headerlink" title="1.æ¶ˆæ¯çš„å‘é€åˆ†ä¸ºä¸‰ç§ï¼š"></a>1.æ¶ˆæ¯çš„å‘é€åˆ†ä¸ºä¸‰ç§ï¼š</h3><p>åŒæ­¥å‘é€ï¼Œå¼‚æ­¥å‘é€ï¼Œå•å‘å‘é€ã€‚</p><p>å•å‘å‘é€ï¼šè¡¨ç¤ºç”Ÿäº§è€…æŠŠæ¶ˆæ¯å‘mqæ¨é€åå°±ä¸ç®¡äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">producer.sendOneway(msg);//æ²¡æœ‰è¿”å›å€¼</span><br></pre></td></tr></table></figure><p>åŒæ­¥å‘é€ï¼šå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™mqå¹¶ä¸”mqç›¸åº”åï¼Œå†ç»§ç»­è‡ªå·±çš„é€»è¾‘ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SendResult</span> <span class="variable">sendResult</span> <span class="operator">=</span> producer.send(msg);</span><br></pre></td></tr></table></figure><p>å¼‚æ­¥å‘é€ï¼šå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™mqå‘é€æ¶ˆæ¯åå°±ä¸ç®¡äº†ï¼Œæ¥ç€åšè‡ªå·±çš„äº‹æƒ…ï¼Œä½†æ˜¯ä¼šç»™mqä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚mqåœ¨å®Œæˆæ¶ˆæ¯åä¼šå›è¿‡æ¥è¯·æ±‚ç”Ÿäº§è€…ï¼Œç”Ÿäº§è€…ä¼šæœ‰ä¸€ä¸ªå›è°ƒçš„å‡½æ•°ï¼Œåœ¨å›è°ƒçš„æ–¹æ³•é‡Œé¢æ‰§è¡Œé€»è¾‘ï¼Œä½†æ˜¯é‡Œé¢æ‰§è¡Œçš„é€»è¾‘pruducerå°±ä¸ç®¡äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">String[] args) <span class="keyword">throws</span> MQClientException, InterruptedException, UnsupportedEncodingException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;Jodie_Daily_test&quot;</span>);</span><br><span class="line">        producer.setNamesrvAddr(<span class="string">&quot;192.168.85.3:9876&quot;</span>);</span><br><span class="line">        producer.start();</span><br><span class="line">        producer.setRetryTimesWhenSendAsyncFailed(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">messageCount</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="comment">//ç”±äºæ˜¯å¼‚æ­¥å‘é€ï¼Œè¿™é‡Œå¼•å…¥ä¸€ä¸ªcountDownLatchï¼Œä¿è¯æ‰€æœ‰Producerå‘é€æ¶ˆæ¯çš„å›è°ƒæ–¹æ³•éƒ½æ‰§è¡Œå®Œäº†å†åœæ­¢ProduceræœåŠ¡ã€‚</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">CountDownLatch</span> <span class="variable">countDownLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(messageCount);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; messageCount; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> i;</span><br><span class="line">                <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;TopicTest&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;TagA&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;OrderID188&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Hello world&quot;</span>.getBytes(RemotingHelper.DEFAULT_CHARSET));</span><br><span class="line">                producer.send(msg, <span class="keyword">new</span> <span class="title class_">SendCallback</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(SendResult sendResult)</span> &#123;</span><br><span class="line">                        countDownLatch.countDown();</span><br><span class="line">                        System.out.printf(<span class="string">&quot;%-10d OK %s %n&quot;</span>, index, sendResult.getMsgId());</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onException</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">                        countDownLatch.countDown();</span><br><span class="line">                        System.out.printf(<span class="string">&quot;%-10d Exception %s %n&quot;</span>, index, e);</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæˆ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        countDownLatch.await(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">        producer.shutdown();</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€‚"><a href="#ä½¿ç”¨æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€‚" class="headerlink" title="ä½¿ç”¨æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€‚"></a>ä½¿ç”¨æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ã€‚</h3><p>æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æœ‰ä¸¤ç§æ¨¡å¼ï¼Œä¸€ç§æ˜¯æ¶ˆè´¹è€…ä¸»åŠ¨å»Brokerä¸Šæ‹‰å–æ¶ˆæ¯çš„æ‹‰æ¨¡å¼ï¼Œå¦ä¸€ç§æ˜¯æ¶ˆè´¹è€…ç­‰å¾…BrokeræŠŠæ¶ˆæ¯æ¨é€è¿‡æ¥çš„æ¨æ¨¡å¼ã€‚</p><h3 id="2-é¡ºåºæ¶ˆæ¯"><a href="#2-é¡ºåºæ¶ˆæ¯" class="headerlink" title="2.é¡ºåºæ¶ˆæ¯"></a>2.é¡ºåºæ¶ˆæ¯</h3><p>â€‹ä¸ç®¡è®¢å•åœ¨å¤šä¸ªConsumerå®ä¾‹ä¹‹å‰æ˜¯å¦‚ä½•åˆ†é…çš„ï¼Œæ¯ä¸ªè®¢å•ä¸‹çš„å¤šæ¡æ¶ˆæ¯é¡ºåºéƒ½æ˜¯å›ºå®šä»0~nçš„ã€‚RocketMQä¿è¯çš„æ˜¯æ¶ˆæ¯çš„<strong>å±€éƒ¨æœ‰åºï¼Œè€Œä¸æ˜¯å…¨å±€æœ‰åº</strong>ã€‚</p><p><img src="/RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B.assets/image-20220601143000520.png" alt="image-20220601143000520"></p><p>â€‹ä¸ºäº†ä¿éšœæ¶ˆæ¯çš„æœ‰åºcç«¯è·å–æ¶ˆæ¯å…ˆä»ä¸€ä¸ªmessagequeueä¸­è·å–æ‰€æœ‰æ¶ˆæ¯ï¼Œå†ä»ä¸‹ä¸€ä¸ªè·å–ã€‚ä¿è¯äº†æ¶ˆæ¯æœ‰åºã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">consumer.registerMessageListener(<span class="keyword">new</span> <span class="title class_">MessageListenerOrderly</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> ConsumeOrderlyStatus <span class="title function_">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; msgs, ConsumeOrderlyContext context)</span> &#123;</span><br><span class="line">                context.setAutoCommit(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">for</span>(MessageExt msg:msgs)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯å†…å®¹ &quot;</span>+<span class="keyword">new</span> <span class="title class_">String</span>(msg.getBody()));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ConsumeOrderlyStatus.SUCCESS;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><h3 id="3-å¹¿æ’­æ¶ˆæ¯"><a href="#3-å¹¿æ’­æ¶ˆæ¯" class="headerlink" title="3 å¹¿æ’­æ¶ˆæ¯"></a>3 å¹¿æ’­æ¶ˆæ¯</h3><p>â€‹å¹¿æ’­æ¶ˆæ¯å¹¶æ²¡æœ‰ç‰¹å®šçš„æ¶ˆæ¯æ¶ˆè´¹è€…æ ·ä¾‹ï¼Œè¿™æ˜¯å› ä¸ºè¿™æ¶‰åŠåˆ°æ¶ˆè´¹è€…çš„é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ã€‚åœ¨é›†ç¾¤çŠ¶æ€MessageModel.CLUSTERING)ä¸‹ï¼Œæ¯ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„ä¸€ä¸ªå®ä¾‹æ¶ˆè´¹åˆ°(è¿™è·Ÿkafkaå’ŒrabbitMQçš„é›†ç¾¤æ¨¡å¼æ˜¯ä¸€æ ·çš„)ã€‚è€Œå¹¿æ’­æ¨¡å¼åˆ™æ˜¯æŠŠæ¶ˆæ¯å‘ç»™äº†æ‰€æœ‰è®¢é˜…äº†å¯¹åº”ä¸»é¢˜çš„æ¶ˆè´¹è€…ï¼Œè€Œä¸ç®¡æ¶ˆè´¹è€…æ˜¯ä¸æ˜¯åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consumer.setMessageModel(MessageModel.BROADCASTING);</span><br></pre></td></tr></table></figure><h3 id="4-å»¶è¿Ÿæ¶ˆæ¯"><a href="#4-å»¶è¿Ÿæ¶ˆæ¯" class="headerlink" title="4 å»¶è¿Ÿæ¶ˆæ¯"></a>4 å»¶è¿Ÿæ¶ˆæ¯</h3><p>â€‹å»¶è¿Ÿæ¶ˆæ¯å®ç°çš„æ•ˆæœå°±æ˜¯åœ¨è°ƒç”¨producer.sendæ–¹æ³•åï¼Œæ¶ˆæ¯å¹¶ä¸ä¼šç«‹å³å‘é€å‡ºå»ï¼Œè€Œæ˜¯ä¼šç­‰ä¸€æ®µæ—¶é—´å†å‘é€å‡ºå»ã€‚è¿™æ˜¯RocketMQç‰¹æœ‰çš„ä¸€ä¸ªåŠŸèƒ½ã€‚</p><p>â€‹å»¶è¿Ÿæ—¶é—´çš„è®¾ç½®å°±æ˜¯åœ¨Messageæ¶ˆæ¯å¯¹è±¡ä¸Šè®¾ç½®ä¸€ä¸ªå»¶è¿Ÿçº§åˆ«message.setDelayTimeLevel(3);&#x2F;&#x2F;10ç§’ï¼Œ3ä»£è¡¨çº§åˆ«ã€‚ï¼ˆä½†æ˜¯åœ¨å•†ä¸šç‰ˆä¸­æ˜¯å¯ä»¥ç›´æ¥è®¾ç½®æ—¶é—´çš„ï¼‰</p><p><img src="/RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B.assets/image-20220601145358527.png" alt="image-20220601145358527"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledMessageProducer</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// Instantiate a producer to send scheduled messages</span></span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;ExampleProducerGroup&quot;</span>);</span><br><span class="line">        <span class="comment">// Launch producer</span></span><br><span class="line">        producer.start();</span><br><span class="line">        <span class="type">int</span> <span class="variable">totalMessagesToSend</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; totalMessagesToSend; i++) &#123;</span><br><span class="line">            <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;TestTopic&quot;</span>, (<span class="string">&quot;Hello scheduled message &quot;</span> + i).getBytes());</span><br><span class="line">            <span class="comment">// This message will be delivered to consumer 10 seconds later.</span></span><br><span class="line">            message.setDelayTimeLevel(<span class="number">3</span>);</span><br><span class="line">            <span class="comment">// Send the message</span></span><br><span class="line">            producer.send(message);</span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">        <span class="comment">// Shutdown producer after use.</span></span><br><span class="line">        producer.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-æ‰¹é‡æ¶ˆæ¯"><a href="#5-æ‰¹é‡æ¶ˆæ¯" class="headerlink" title="5 æ‰¹é‡æ¶ˆæ¯"></a>5 æ‰¹é‡æ¶ˆæ¯</h3><p>â€‹æ‰¹é‡æ¶ˆæ¯æ˜¯æŒ‡å°†å¤šæ¡æ¶ˆæ¯åˆå¹¶æˆä¸€ä¸ªæ‰¹é‡æ¶ˆæ¯ï¼Œä¸€æ¬¡å‘é€å‡ºå»ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥å‡å°‘ç½‘ç»œIOï¼Œæå‡ååé‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Message&gt; messages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">messages.add(<span class="keyword">new</span> <span class="title class_">Message</span>(topic, <span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;OrderID001&quot;</span>, <span class="string">&quot;Hello world 0&quot;</span>.getBytes()));</span><br><span class="line">messages.add(<span class="keyword">new</span> <span class="title class_">Message</span>(topic, <span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;OrderID002&quot;</span>, <span class="string">&quot;Hello world 1&quot;</span>.getBytes()));</span><br><span class="line">messages.add(<span class="keyword">new</span> <span class="title class_">Message</span>(topic, <span class="string">&quot;Tag&quot;</span>, <span class="string">&quot;OrderID003&quot;</span>, <span class="string">&quot;Hello world 2&quot;</span>.getBytes()));</span><br><span class="line"></span><br><span class="line">producer.send(messages);</span><br><span class="line">producer.shutdown();</span><br></pre></td></tr></table></figure><p>â€‹å®˜ç½‘ä»¥åŠæµ‹è¯•ä»£ç ä¸­æœ‰å…³é”®çš„æ³¨é‡Šï¼šå¦‚æœæ‰¹é‡æ¶ˆæ¯å¤§äº1MBå°±ä¸è¦ç”¨ä¸€ä¸ªæ‰¹æ¬¡å‘é€ï¼Œè€Œè¦æ‹†åˆ†æˆå¤šä¸ªæ‰¹æ¬¡æ¶ˆæ¯å‘é€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ‰¹æ¬¡æ¶ˆæ¯çš„å¤§å°ä¸è¦è¶…è¿‡1MBã€‚</p><p>â€‹å®é™…ä½¿ç”¨æ—¶ï¼Œè¿™ä¸ª1MBçš„é™åˆ¶å¯ä»¥ç¨å¾®æ‰©å¤§ç‚¹ï¼Œå®é™…æœ€å¤§çš„é™åˆ¶æ˜¯4194304å­—èŠ‚ï¼Œå¤§æ¦‚4MBã€‚ä½†æ˜¯ä½¿ç”¨æ‰¹é‡æ¶ˆæ¯æ—¶ï¼Œè¿™ä¸ªæ¶ˆæ¯é•¿åº¦ç¡®å®æ˜¯å¿…é¡»è€ƒè™‘çš„ä¸€ä¸ªé—®é¢˜ã€‚è€Œä¸”æ‰¹é‡æ¶ˆæ¯çš„ä½¿ç”¨æ˜¯æœ‰ä¸€å®šé™åˆ¶çš„ï¼Œè¿™äº›æ¶ˆæ¯åº”è¯¥æœ‰ç›¸åŒçš„Topicï¼Œç›¸åŒçš„waitStoreMsgOKã€‚è€Œä¸”ä¸èƒ½æ˜¯å»¶è¿Ÿæ¶ˆæ¯ã€äº‹åŠ¡æ¶ˆæ¯ç­‰ã€‚</p><h3 id="6-è¿‡æ»¤æ¶ˆæ¯"><a href="#6-è¿‡æ»¤æ¶ˆæ¯" class="headerlink" title="6 è¿‡æ»¤æ¶ˆæ¯"></a>6 è¿‡æ»¤æ¶ˆæ¯</h3><p>ä¸»è¦æ˜¯çœ‹æ¶ˆæ¯æ¶ˆè´¹è€…ã€‚consumer.subscribe(â€œTagFilterTestâ€, â€œTagA || TagCâ€); è¿™å¥åªè®¢é˜…TagAå’ŒTagCçš„æ¶ˆæ¯ã€‚</p><p>TAGæ˜¯RocketMQä¸­ç‰¹æœ‰çš„ä¸€ä¸ªæ¶ˆæ¯å±æ€§ã€‚RocketMQçš„æœ€ä½³å®è·µä¸­å°±å»ºè®®ï¼Œä½¿ç”¨RocketMQæ—¶ï¼Œä¸€ä¸ªåº”ç”¨å¯ä»¥å°±ç”¨ä¸€ä¸ªTopicï¼Œè€Œåº”ç”¨ä¸­çš„ä¸åŒä¸šåŠ¡å°±ç”¨TAGæ¥åŒºåˆ†ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶ï¼Œå°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯åªèƒ½æœ‰ä¸€ä¸ªTAGï¼Œè¿™åœ¨ä¸€äº›æ¯”è¾ƒå¤æ‚çš„åœºæ™¯å°±æœ‰ç‚¹ä¸è¶³äº†ã€‚ è¿™æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨SQLè¡¨è¾¾å¼æ¥å¯¹æ¶ˆæ¯è¿›è¡Œè¿‡æ»¤ã€‚</p><h3 id="7-äº‹åŠ¡æ¶ˆæ¯"><a href="#7-äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="7 äº‹åŠ¡æ¶ˆæ¯"></a>7 äº‹åŠ¡æ¶ˆæ¯</h3><p><strong>è¿™ä¸ªäº‹åŠ¡æ¶ˆæ¯æ˜¯RocketMQæä¾›çš„ä¸€ä¸ªéå¸¸æœ‰ç‰¹è‰²çš„åŠŸèƒ½ï¼Œéœ€è¦ç€é‡ç†è§£</strong>ã€‚</p><p><strong>é¦–å…ˆ</strong>ï¼Œæˆ‘ä»¬äº†è§£ä¸‹ä»€ä¹ˆæ˜¯äº‹åŠ¡æ¶ˆæ¯ã€‚å®˜ç½‘çš„ä»‹ç»æ˜¯ï¼šäº‹åŠ¡æ¶ˆæ¯æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„ä¸¤é˜¶æ®µæäº¤çš„æ¶ˆæ¯å®ç°ã€‚ä»–å¯ä»¥<strong>ä¿è¯æœ¬åœ°äº‹åŠ¡æ‰§è¡Œä¸æ¶ˆæ¯å‘é€ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸¤ä¸ªæ“ä½œä¸€èµ·æˆåŠŸæˆ–è€…ä¸€èµ·å¤±è´¥ã€‚</strong></p><p><strong>å…¶æ¬¡</strong>ï¼Œæˆ‘ä»¬æ¥ç†è§£ä¸‹äº‹åŠ¡æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ã€‚<strong>äº‹åŠ¡æ¶ˆæ¯åªä¿è¯æ¶ˆæ¯å‘é€è€…çš„æœ¬åœ°äº‹åŠ¡ä¸å‘æ¶ˆæ¯è¿™ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§</strong>ï¼Œå› æ­¤ï¼Œäº‹åŠ¡æ¶ˆæ¯çš„ç¤ºä¾‹åªæ¶‰åŠåˆ°æ¶ˆæ¯å‘é€è€…ï¼Œå¯¹äºæ¶ˆæ¯æ¶ˆè´¹è€…æ¥è¯´ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚</p><p>äº‹åŠ¡æ¶ˆæ¯çš„å…³é”®æ˜¯åœ¨TransactionMQProducerä¸­æŒ‡å®šäº†ä¸€ä¸ªTransactionListeneräº‹åŠ¡ç›‘å¬å™¨ï¼Œè¿™ä¸ªäº‹åŠ¡ç›‘å¬å™¨å°±æ˜¯äº‹åŠ¡æ¶ˆæ¯çš„å…³é”®æ§åˆ¶å™¨ã€‚æºç ä¸­çš„æ¡ˆä¾‹æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘è¿™é‡Œå‡†å¤‡äº†ä¸€ä¸ªæ›´æ¸…æ™°æ˜äº†çš„äº‹åŠ¡ç›‘å¬å™¨ç¤ºä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨æ‰§è¡ŒsendMessageInTransactionæ–¹æ³•çš„æ—¶å€™å°±ä¼šæ‰§è¡Œç›‘å¬å™¨çš„executeLocalTransactionæ–¹æ³•ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´å°±ä¼šæ‰§è¡ŒcheckLocalTransactionæ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionListenerImpl</span> <span class="keyword">implements</span> <span class="title class_">TransactionListener</span> &#123;</span><br><span class="line"> <span class="comment">//åœ¨æäº¤å®Œäº‹åŠ¡æ¶ˆæ¯åæ‰§è¡Œã€‚</span></span><br><span class="line"> <span class="comment">//è¿”å›COMMIT_MESSAGEçŠ¶æ€çš„æ¶ˆæ¯ä¼šç«‹å³è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ã€‚</span></span><br><span class="line"> <span class="comment">//è¿”å›ROLLBACK_MESSAGEçŠ¶æ€çš„æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒã€‚</span></span><br><span class="line"> <span class="comment">//è¿”å›UNKNOWNçŠ¶æ€çš„æ¶ˆæ¯ä¼šç”±Brokerè¿‡ä¸€æ®µæ—¶é—´å†æ¥å›æŸ¥äº‹åŠ¡çš„çŠ¶æ€ã€‚</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message msg, Object arg)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">tags</span> <span class="operator">=</span> msg.getTags();</span><br><span class="line">        <span class="comment">//TagAçš„æ¶ˆæ¯ä¼šç«‹å³è¢«æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.contains(tags,<span class="string">&quot;TagA&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">        <span class="comment">//TagBçš„æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(StringUtils.contains(tags,<span class="string">&quot;TagB&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">        <span class="comment">//å…¶ä»–æ¶ˆæ¯ä¼šç­‰å¾…Brokerè¿›è¡Œäº‹åŠ¡çŠ¶æ€å›æŸ¥ã€‚</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> LocalTransactionState.UNKNOW;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">//åœ¨å¯¹UNKNOWNçŠ¶æ€çš„æ¶ˆæ¯è¿›è¡ŒçŠ¶æ€å›æŸ¥æ—¶æ‰§è¡Œã€‚è¿”å›çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LocalTransactionState <span class="title function_">checkLocalTransaction</span><span class="params">(MessageExt msg)</span> &#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">tags</span> <span class="operator">=</span> msg.getTags();</span><br><span class="line">        <span class="comment">//TagCçš„æ¶ˆæ¯è¿‡ä¸€æ®µæ—¶é—´ä¼šè¢«æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.contains(tags,<span class="string">&quot;TagC&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">        <span class="comment">//TagDçš„æ¶ˆæ¯ä¹Ÿä¼šåœ¨çŠ¶æ€å›æŸ¥æ—¶è¢«ä¸¢å¼ƒæ‰</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(StringUtils.contains(tags,<span class="string">&quot;TagD&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">        <span class="comment">//å‰©ä¸‹TagEçš„æ¶ˆæ¯ä¼šåœ¨å¤šæ¬¡çŠ¶æ€å›æŸ¥åæœ€ç»ˆä¸¢å¼ƒ</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> LocalTransactionState.UNKNOW;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡æ¶ˆæ¯çš„å®ç°æœºåˆ¶ï¼š</p><p><img src="/RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B.assets/image-20220602090841525.png" alt="image-20220602090841525"></p><p>äº‹åŠ¡æ¶ˆæ¯æœºåˆ¶çš„å…³é”®æ˜¯åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šå°†æ¶ˆæ¯è½¬ä¸ºä¸€ä¸ªhalfåŠæ¶ˆæ¯ï¼Œå¹¶å­˜å…¥RocketMQå†…éƒ¨çš„ä¸€ä¸ª RMQ_SYS_TRANS_HALF_TOPIC è¿™ä¸ªTopicï¼Œè¿™æ ·å¯¹æ¶ˆè´¹è€…æ˜¯ä¸å¯è§çš„ã€‚å†ç»è¿‡ä¸€ç³»åˆ—äº‹åŠ¡æ£€æŸ¥é€šè¿‡åï¼Œå†å°†æ¶ˆæ¯è½¬å­˜åˆ°ç›®æ ‡Topicï¼Œè¿™æ ·å¯¹æ¶ˆè´¹è€…å°±å¯è§äº†ã€‚</p><blockquote><p>halfæ¶ˆæ¯å¯¹ä¸‹æ¸¸ä¸å¯è§</p></blockquote><p>å®ä¾‹è§£é‡Šï¼š</p><p><img src="/RocketMQ%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B.assets/image-20220602102252616.png" alt="image-20220602102252616"></p><p>â€‹1.å‘é€halfæ¶ˆæ¯ç»™mq</p><p>â€‹2.è¿”å›æ¶ˆæ¯ç»“æœ</p><p>â€‹3.æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ï¼Œå‘mqè¿”å›æœ¬åœ°äº‹åŠ¡çš„çŠ¶æ€ã€‚å¦‚æœçŠ¶æ€æ˜¯commitçš„è¯äº‹åŠ¡å°±æäº¤äº†ï¼Œå¹¶æŠŠæ¶ˆæ¯ç»™ä¸‹æ¸¸æœåŠ¡å»æ¶ˆè´¹ã€‚å¦‚æœæ˜¯rollbackçŠ¶æ€å°±ç›´æ¥æŠŠé£Ÿç‰©ä¸¢å¼ƒã€‚</p><p>â€‹4.å¦‚æœæ˜¯unknowçŠ¶æ€ï¼Œmqå°±ä¼šè¿‡ä¸€æ®µæ—¶é—´å›æŸ¥äº‹åŠ¡çš„çŠ¶æ€ã€‚ç”Ÿäº§è€…å°±ä¼šå»æ£€æŸ¥æœ¬åœ°äº‹åŠ¡çš„çŠ¶æ€ã€‚ç„¶åå†å‘mqè¿”å›ä¸€ä¸ªäº‹åŠ¡æ£€æŸ¥çš„çŠ¶æ€ã€‚ä¸€ç›´å¾ªç¯5ï¼Œ6ï¼Œ7ã€‚è¿™é‡Œmqé»˜è®¤å›æŸ¥15æ¬¡å¦‚æœæ£€æŸ¥15æ¬¡åçŠ¶æ€è¿˜æ˜¯æœªçŸ¥æœ€ç»ˆå°±ä¼šç¡®è®¤äº‹åŠ¡çš„å¤±è´¥çš„ã€‚</p><p>â€‹5.æ ¹æ®ä¿¡æ¯çŠ¶æ€æäº¤æˆ–å›æ»šã€‚</p><p>1.ä¸ºä»€ä¹ˆè¦å‘é€halfæ¶ˆæ¯ï¼Ÿ<br>åœ¨è¿›è¡Œæœ¬åœ°äº‹åŠ¡ä¹‹å‰ç¡®å®šmqæ˜¯å¦è¿è¡Œæ­£å¸¸</p><p>2.halfæˆåŠŸï¼Œæ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¤±è´¥æ€ä¹ˆåŠï¼Ÿ</p><p>â€‹ä¸šåŠ¡ä¸­éœ€è¦èµ¶ç´§é˜»æ­¢è¿™ä¸ªæ¶ˆæ¯ã€‚è¿™æ—¶å€™å¯ä»¥é©¬ä¸Šå‘mqè¿”å›ä¸€ä¸ªrollbackçŠ¶æ€å»å›æ»šã€‚</p><h3 id="8-ACLæƒé™æ§åˆ¶"><a href="#8-ACLæƒé™æ§åˆ¶" class="headerlink" title="8 ACLæƒé™æ§åˆ¶"></a>8 ACLæƒé™æ§åˆ¶</h3><p>â€‹æƒé™æ§åˆ¶ï¼ˆACLï¼‰ä¸»è¦ä¸ºRocketMQæä¾›Topicèµ„æºçº§åˆ«çš„ç”¨æˆ·è®¿é—®æ§åˆ¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> RocketMQ åŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RocketMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RocketMQå®‰è£…</title>
      <link href="/2024/11/17/RocketMQ%E5%AE%89%E8%A3%85/"/>
      <url>/2024/11/17/RocketMQ%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h2 id="RocketMQå®‰è£…"><a href="#RocketMQå®‰è£…" class="headerlink" title="RocketMQå®‰è£…"></a>RocketMQå®‰è£…</h2><h3 id="å®‰è£…å‰å‡†å¤‡"><a href="#å®‰è£…å‰å‡†å¤‡" class="headerlink" title="å®‰è£…å‰å‡†å¤‡"></a>å®‰è£…å‰å‡†å¤‡</h3><p>1.RocketMQæ˜¯ä½¿ç”¨Javaè¯­è¨€ç¼–å†™çš„æ‰€ä»¥åœ¨å®‰è£…è¯¥MQå‰éœ€è¦Javaç¯å¢ƒã€‚</p><p>2.å‡†å¤‡å¥½RocketMQ</p><p>â€‹RocketMQè¿è¡Œç‰ˆæœ¬ä¸‹è½½åœ°å€ï¼š <a href="https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.7.1/rocketmq-all-4.7.1-bin-release.zip">https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.7.1/rocketmq-all-4.7.1-bin-release.zip</a></p><p>â€‹RocketMQæºç ç‰ˆæœ¬ä¸‹è½½åœ°å€ï¼š <a href="https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.7.1/rocketmq-all-4.7.1-source-release.zip">https://www.apache.org/dyn/closer.cgi?path=rocketmq/4.7.1/rocketmq-all-4.7.1-source-release.zip</a></p><h3 id="å¿«é€Ÿå®‰è£…"><a href="#å¿«é€Ÿå®‰è£…" class="headerlink" title="å¿«é€Ÿå®‰è£…"></a>å¿«é€Ÿå®‰è£…</h3><p>æŠŠä¸‹è½½çš„rocketmq-all-4.7.1-bin-release.zipåœ¨æœ¬åœ°å®Œæˆè§£å‹ï¼Œå¹¶ä¸Šä¼ åˆ°&#x2F;app&#x2F;rocketmqç›®å½•ã€‚</p><p>æŠŠrocketmqçš„binç›®å½•ä¹Ÿé…ç½®åˆ°ç¯å¢ƒå˜é‡å½“ä¸­ã€‚ vi ~&#x2F;.bash_profileï¼ŒåŠ å…¥ä»¥ä¸‹å†…å®¹ï¼Œå¹¶æ‰§è¡Œsource ~&#x2F;.bash_profileè®©ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ROCKETMQ_HOME=/app/rocketmq/rocketmq-all-4.7.1-bin-release</span><br></pre></td></tr></table></figure><p>è¿™æ ·RocketMQå°±å®‰è£…å®Œæˆäº†ã€‚</p><h3 id="å¿«é€Ÿå¯åŠ¨"><a href="#å¿«é€Ÿå¯åŠ¨" class="headerlink" title="å¿«é€Ÿå¯åŠ¨"></a>å¿«é€Ÿå¯åŠ¨</h3><p>RocketMQç”±ä»¥ä¸‹è¿™å‡ ä¸ªç»„ä»¶ç»„æˆ</p><ol><li>NameServer : æä¾›è½»é‡çº§çš„Brokerè·¯ç”±æœåŠ¡ã€‚</li><li>Brokerï¼šå®é™…å¤„ç†æ¶ˆæ¯å­˜å‚¨ã€è½¬å‘ç­‰æœåŠ¡çš„æ ¸å¿ƒç»„ä»¶ã€‚</li><li>Producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…é›†ç¾¤ã€‚é€šå¸¸æ˜¯ä¸šåŠ¡ç³»ç»Ÿä¸­çš„ä¸€ä¸ªåŠŸèƒ½æ¨¡å—ã€‚</li><li>Consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…é›†ç¾¤ã€‚é€šå¸¸ä¹Ÿæ˜¯ä¸šåŠ¡ç³»ç»Ÿä¸­çš„ä¸€ä¸ªåŠŸèƒ½æ¨¡å—ã€‚</li></ol><p>æ‰€ä»¥æˆ‘ä»¬è¦å¯åŠ¨RocketMQæœåŠ¡ï¼Œéœ€è¦å…ˆå¯åŠ¨NameServerã€‚</p><h3 id="å¯åŠ¨NameServer"><a href="#å¯åŠ¨NameServer" class="headerlink" title="å¯åŠ¨NameServer"></a><strong>å¯åŠ¨NameServer</strong></h3><p>åœ¨$ROCKETMQ_HOME&#x2F;binç›®å½•ä¸‹æœ‰ä¸ªmqadminsrvå¯ä»¥å¯åŠ¨RocketMQçš„NameServeræœåŠ¡ã€‚</p><blockquote><p>æ³¨æ„:RocketMQé»˜è®¤é¢„è®¾çš„JVMå†…å­˜æ˜¯4G(æœ€ä½³é…ç½®)ã€‚ä½†æ˜¯é€šå¸¸æˆ‘ä»¬ç”¨è™šæ‹Ÿæœºçš„è¯éƒ½æ˜¯ä¸å¤Ÿ4Gå†…å­˜çš„ï¼Œæ‰€ä»¥éœ€è¦è°ƒæ•´ä¸‹JVMå†…å­˜å¤§å°ã€‚ä¿®æ”¹çš„æ–¹å¼æ˜¯ç›´æ¥ä¿®æ”¹å®‰è£…ç›®å½•ä¸‹çš„binç›®å½•ä¸­çš„runserver.shã€‚ ç”¨vi runserver.shç¼–è¾‘è¿™ä¸ªè„šæœ¬ï¼Œåœ¨è„šæœ¬ä¸­æ‰¾åˆ°è¿™ä¸€è¡Œè°ƒæ•´å†…å­˜å¤§å°ä¸º512M</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPT=<span class="string">&quot;$&#123;JAVA_OPT&#125; -server -Xms512m -Xmx512m -Xmn256m - XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\QiJian\AppData\Roaming\Typora\typora-user-images\image-20220531093010948.png" alt="image-20220531093010948"></p><p>é™é»˜å¯åŠ¨çš„æ–¹å¼å¯åŠ¨NameServeræœåŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nohup bin/mqnamesrv &amp;</span><br><span class="line">å¦‚æœä¿å­˜å°±ä½¿ç”¨ï¼š</span><br><span class="line">nohup bin/mqnamesrv &gt; nohup.out <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br></pre></td></tr></table></figure><blockquote><p>é™é»˜æ–¹å¼å¯åŠ¨ï¼šä¸å ç”¨æ§åˆ¶å°ï¼Œåå°æ‰§è¡Œ</p></blockquote><p><img src="C:\Users\QiJian\AppData\Roaming\Typora\typora-user-images\image-20220531101003247.png" alt="image-20220531101003247"></p><h3 id="å¯åŠ¨Broker"><a href="#å¯åŠ¨Broker" class="headerlink" title="å¯åŠ¨Broker"></a><strong>å¯åŠ¨Broker</strong></h3><p>å¯åŠ¨Brokerçš„è„šæœ¬æ˜¯runbroker.shã€‚Brokerçš„é»˜è®¤é¢„è®¾å†…å­˜æ˜¯8Gï¼Œå¯åŠ¨å‰ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼ŒåŒæ ·éœ€è¦è°ƒæ•´ä¸‹JVMå†…å­˜.(vi runbroker.sh)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPT=<span class="string">&quot;$&#123;JAVA_OPT&#125; -server -Xms512m -Xmx512m -Xmn256m&quot;</span></span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°$ROCKETMQ_HOME&#x2F;conf&#x2F;broker.confï¼Œ viæŒ‡ä»¤è¿›è¡Œç¼–è¾‘ï¼Œåœ¨æœ€ä¸‹é¢åŠ å…¥ä¸€ä¸ªé…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autoCreateTopicEnable=<span class="literal">true</span> #é»˜è®¤å€¼æ˜¯<span class="literal">true</span>ï¼Œå¯ä»¥åŒæ­¥å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼Œè®©Brokerå¯åŠ¨æ—¶åŠ è½½ï¼Œæ¥æ”¹å˜è¯¥å€¼ã€‚</span><br></pre></td></tr></table></figure><p>é™é»˜å¯åŠ¨çš„æ–¹å¼å¯åŠ¨runbroker.sh</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nohup ../bin/mqbroker &amp;</span><br><span class="line">æˆ–</span><br><span class="line">nohup ./bin/mqbroker &gt; nohup.out <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤è¡Œå¿«é€ŸéªŒè¯"><a href="#å‘½ä»¤è¡Œå¿«é€ŸéªŒè¯" class="headerlink" title="å‘½ä»¤è¡Œå¿«é€ŸéªŒè¯"></a><strong>å‘½ä»¤è¡Œå¿«é€ŸéªŒè¯</strong></h3><p>åœ¨RocketMQçš„å®‰è£…åŒ…ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªtools.shå·¥å…·å¯ä»¥ç”¨æ¥åœ¨å‘½ä»¤è¡Œå¿«é€ŸéªŒè¯RocketMQæœåŠ¡ã€‚</p><p>é¦–å…ˆéœ€è¦é…ç½®ä¸€ä¸ªç¯å¢ƒå˜é‡NAMESRV_ADDRæŒ‡å‘æˆ‘ä»¬å¯åŠ¨çš„NameServeræœåŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.bash_profile</span><br><span class="line">    </span><br><span class="line">export NAMESRV_ADDR=<span class="string">&#x27;localhost:9876&#x27;</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨æ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼šé»˜è®¤ä¼šå‘1000æ¡æ¶ˆæ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/tools.sh org.apache.rocketmq.example.quickstart.Producer</span><br></pre></td></tr></table></figure><p><img src="C:\Users\QiJian\AppData\Roaming\Typora\typora-user-images\image-20220531134231074.png" alt="image-20220531134231074"></p><p>å¯åŠ¨æ¶ˆæ¯æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer</span><br></pre></td></tr></table></figure><p><img src="C:\Users\QiJian\AppData\Roaming\Typora\typora-user-images\image-20220531134421318.png" alt="image-20220531134421318"></p><h3 id="å…³é—­RocketMQæœåŠ¡"><a href="#å…³é—­RocketMQæœåŠ¡" class="headerlink" title="å…³é—­RocketMQæœåŠ¡"></a><strong>å…³é—­RocketMQæœåŠ¡</strong></h3><p>è¦å…³é—­RocketMQæœåŠ¡å¯ä»¥é€šè¿‡mqshutdownè„šæœ¬ç›´æ¥å…³é—­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span>å…³é—­NameServer </span><br><span class="line">    sh bin/mqshutdown namesrv </span><br><span class="line"># <span class="number">2.</span>å…³é—­Broker </span><br><span class="line">    sh bin/mqshutdown broker</span><br></pre></td></tr></table></figure><h3 id="æ­å»ºç®¡ç†æ§åˆ¶å°"><a href="#æ­å»ºç®¡ç†æ§åˆ¶å°" class="headerlink" title="æ­å»ºç®¡ç†æ§åˆ¶å°"></a><strong>æ­å»ºç®¡ç†æ§åˆ¶å°</strong></h3><p>åœ°å€ï¼š <a href="https://github.com/apache/rocketmq-externals">https://github.com/apache/rocketmq-externals</a></p><p>ä¸‹è½½ä¸‹æ¥åï¼Œè¿›å…¥å…¶ä¸­çš„rocket-consoleç›®å½•ï¼Œä½¿ç”¨mavenè¿›è¡Œç¼–è¯‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocketmq.config.namesrvAddr=localhost:<span class="number">9876</span></span><br></pre></td></tr></table></figure><h2 id="å¿«é€Ÿæ­å»ºRocketMQé›†ç¾¤"><a href="#å¿«é€Ÿæ­å»ºRocketMQé›†ç¾¤" class="headerlink" title="å¿«é€Ÿæ­å»ºRocketMQé›†ç¾¤"></a>å¿«é€Ÿæ­å»ºRocketMQé›†ç¾¤</h2><h3 id="1ã€æœºå™¨ç¯å¢ƒ"><a href="#1ã€æœºå™¨ç¯å¢ƒ" class="headerlink" title="1ã€æœºå™¨ç¯å¢ƒ"></a>1ã€æœºå™¨ç¯å¢ƒ</h3><p>å‡†å¤‡ä¸‰å°æœºå™¨ï¼Œéƒ½è¿›è¡Œå¦‚ä¸‹é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">æ‰“å¼€æ–‡ä»¶åè¿½åŠ ï¼š</span><br><span class="line"><span class="number">192.168</span><span class="number">.85</span><span class="number">.3</span> worker1</span><br><span class="line"><span class="number">192.168</span><span class="number">.85</span><span class="number">.4</span> worker2</span><br><span class="line"><span class="number">192.168</span><span class="number">.85</span><span class="number">.5</span> worker3</span><br></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºç”¨æˆ·"><a href="#2ã€åˆ›å»ºç”¨æˆ·" class="headerlink" title="2ã€åˆ›å»ºç”¨æˆ·"></a>2ã€åˆ›å»ºç”¨æˆ·</h3><p>useradd oper</p><p>passwd oper (å¯†ç è¾“å…¥ 123qweasd)</p><h3 id="3ã€ç³»ç»Ÿé…ç½®"><a href="#3ã€ç³»ç»Ÿé…ç½®" class="headerlink" title="3ã€ç³»ç»Ÿé…ç½®"></a>3ã€ç³»ç»Ÿé…ç½®</h3><h4 id="å…å¯†ç™»å½•"><a href="#å…å¯†ç™»å½•" class="headerlink" title="å…å¯†ç™»å½•"></a>å…å¯†ç™»å½•</h4><p>åˆ‡æ¢operç”¨æˆ·ï¼Œåœ¨worker1ä¸Š ç”Ÿæˆkey</p><p>ssh-kengen</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ†å‘ç»™å…¶ä»–æœºå™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id worker1</span><br><span class="line">ssh-copy-id worker2</span><br><span class="line">ssh-copy-id worker3</span><br><span class="line"></span><br><span class="line">ç™»å…¥å…¶ä»–æœºå™¨åªéœ€è¦</span><br><span class="line">ssh worker2</span><br><span class="line">é€€å‡º</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><h4 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br><span class="line">firewall-cmd --state </span><br></pre></td></tr></table></figure><h3 id="4ã€é…ç½®RocketMQé›†ç¾¤"><a href="#4ã€é…ç½®RocketMQé›†ç¾¤" class="headerlink" title="4ã€é…ç½®RocketMQé›†ç¾¤"></a>4ã€é…ç½®RocketMQé›†ç¾¤</h3><p>ä¸ºäº†ä¾¿äºè§‚å¯Ÿï¼Œè¿™æ¬¡æ­å»ºä¸€ä¸ª2ä¸»2ä»å¼‚æ­¥åˆ·ç›˜çš„é›†ç¾¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šä½¿ç”¨conf&#x2F;2m-2s-asyncä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œå®é™…é¡¹ç›®ä¸­ï¼Œä¸ºäº†è¾¾åˆ°é«˜å¯ç”¨ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨dlegerã€‚é¢„å¤‡è®¾è®¡çš„é›†ç¾¤æƒ…å†µå¦‚ä¸‹ï¼š</p><table><thead><tr><th>æœºå™¨å</th><th>nemaeServerèŠ‚ç‚¹éƒ¨ç½²</th><th>brokerèŠ‚ç‚¹éƒ¨ç½²</th></tr></thead><tbody><tr><td>worker1</td><td>nameserver</td><td></td></tr><tr><td>worker2</td><td>nameserver</td><td>broker-a, broker-b-s</td></tr><tr><td>worker3</td><td>nameserver</td><td>broker-b,broker-a-s</td></tr></tbody></table><p>æ‰€ä»¥ä¿®æ”¹çš„é…ç½®æ–‡ä»¶æ˜¯è¿›å…¥rocketmqçš„configç›®å½•ä¸‹ä¿®æ”¹2m-2s-asyncçš„é…ç½®æ–‡ä»¶ã€‚â€“åªéœ€è¦é…ç½®broker.confã€‚</p><blockquote><p>åœ¨rocketmqçš„configç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°rocketmqå»ºè®®çš„å„ç§é…ç½®æ–¹å¼ï¼š</p><ul><li>2m-2s-async: 2ä¸»2ä»å¼‚æ­¥åˆ·ç›˜(ååé‡è¾ƒå¤§ï¼Œä½†æ˜¯æ¶ˆæ¯å¯èƒ½ä¸¢å¤±),</li><li>2m-2s-sync:2ä¸»2ä»åŒæ­¥åˆ·ç›˜(ååé‡ä¼šä¸‹é™ï¼Œä½†æ˜¯æ¶ˆæ¯æ›´å®‰å…¨)ï¼Œ</li><li>2m-noslave:2ä¸»æ— ä»(å•ç‚¹æ•…éšœ)ï¼Œç„¶åè¿˜å¯ä»¥ç›´æ¥é…ç½®broker.confï¼Œè¿›è¡Œå•ç‚¹ç¯å¢ƒé…ç½®ã€‚</li><li>è€Œdlegerå°±æ˜¯ç”¨æ¥å®ç°ä¸»ä»åˆ‡æ¢çš„ã€‚é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¼šåŸºäºRaftåè®®éšæœºé€‰ä¸¾å‡ºä¸€ä¸ªleaderï¼Œå…¶ä»–çš„å°±éƒ½æ˜¯followerã€‚é€šå¸¸æ­£å¼ç¯å¢ƒéƒ½ä¼šé‡‡ç”¨è¿™ç§æ–¹å¼æ¥æ­å»ºé›†ç¾¤ã€‚</li></ul></blockquote><p>æˆ‘ä»¬è¿™æ¬¡é‡‡ç”¨2m-2s-asyncçš„æ–¹å¼æ­å»ºé›†ç¾¤ã€‚</p><h3 id="5ã€é…ç½®ç¬¬ä¸€ç»„broker-a"><a href="#5ã€é…ç½®ç¬¬ä¸€ç»„broker-a" class="headerlink" title="5ã€é…ç½®ç¬¬ä¸€ç»„broker-a"></a>5ã€é…ç½®ç¬¬ä¸€ç»„broker-a</h3><p>åœ¨<strong>worker2</strong>ä¸Šå…ˆé…ç½®borker-açš„masterèŠ‚ç‚¹ã€‚å…ˆé…ç½®2m-2s-async&#x2F;broker-a.properties</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#æ‰€å±é›†ç¾¤åå­—ï¼Œåå­—ä¸€æ ·çš„èŠ‚ç‚¹å°±åœ¨åŒä¸€ä¸ªé›†ç¾¤å†…</span><br><span class="line">brokerClusterName=rocketmq-cluster</span><br><span class="line">#brokeråå­—ï¼Œåå­—ä¸€æ ·çš„èŠ‚ç‚¹å°±æ˜¯ä¸€ç»„ä¸»ä»èŠ‚ç‚¹ã€‚</span><br><span class="line">brokerName=broker-a</span><br><span class="line">#brokerid,<span class="number">0</span>å°±è¡¨ç¤ºæ˜¯Masterï¼Œ&gt;<span class="number">0</span>çš„éƒ½æ˜¯è¡¨ç¤º Slave</span><br><span class="line">brokerId=<span class="number">0</span></span><br><span class="line">#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²</span><br><span class="line">namesrvAddr=worker1:<span class="number">9876</span>;worker2:<span class="number">9876</span>;worker3:<span class="number">9876</span></span><br><span class="line">#åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°</span><br><span class="line">defaultTopicQueueNums=<span class="number">4</span></span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateTopicEnable=<span class="literal">true</span></span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateSubscriptionGroup=<span class="literal">true</span></span><br><span class="line">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£</span><br><span class="line">listenPort=<span class="number">10911</span></span><br><span class="line">#åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ <span class="number">4</span>ç‚¹</span><br><span class="line">deleteWhen=<span class="number">04</span></span><br><span class="line">#æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ <span class="number">48</span> å°æ—¶</span><br><span class="line">fileReservedTime=<span class="number">120</span></span><br><span class="line">#commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G</span><br><span class="line">mapedFileSizeCommitLog=<span class="number">1073741824</span></span><br><span class="line">#ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´</span><br><span class="line">mapedFileSizeConsumeQueue=<span class="number">300000</span></span><br><span class="line">#destroyMapedFileIntervalForcibly=<span class="number">120000</span></span><br><span class="line">#redeleteHangedFileInterval=<span class="number">120000</span></span><br><span class="line">#æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´</span><br><span class="line">diskMaxUsedSpaceRatio=<span class="number">88</span></span><br><span class="line">#å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathRootDir=/app/rocketmq/store</span><br><span class="line">#commitLog å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathCommitLog=/app/rocketmq/store/commitlog</span><br><span class="line">#æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathConsumeQueue=/app/rocketmq/store/consumequeue</span><br><span class="line">#æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathIndex=/app/rocketmq/store/index</span><br><span class="line">#checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">storeCheckpoint=/app/rocketmq/store/checkpoint</span><br><span class="line">#abort æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">abortFile=/app/rocketmq/store/abort</span><br><span class="line">#é™åˆ¶çš„æ¶ˆæ¯å¤§å°</span><br><span class="line">maxMessageSize=<span class="number">65536</span></span><br><span class="line">#flushCommitLogLeastPages=<span class="number">4</span></span><br><span class="line">#flushConsumeQueueLeastPages=<span class="number">2</span></span><br><span class="line">#flushCommitLogThoroughInterval=<span class="number">10000</span></span><br><span class="line">#flushConsumeQueueThoroughInterval=<span class="number">60000</span></span><br><span class="line">#Broker çš„è§’è‰²</span><br><span class="line">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="line">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="line">#- SLAVE</span><br><span class="line">brokerRole=ASYNC_MASTER</span><br><span class="line">#åˆ·ç›˜æ–¹å¼</span><br><span class="line">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="line">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br><span class="line">flushDiskType=ASYNC_FLUSH</span><br><span class="line">#checkTransactionMessageEnable=<span class="literal">false</span></span><br><span class="line">#å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#sendMessageThreadPoolNums=<span class="number">128</span></span><br><span class="line">#æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#pullMessageThreadPoolNums=<span class="number">128</span></span><br></pre></td></tr></table></figure><p>è¯¥èŠ‚ç‚¹å¯¹åº”çš„ä»èŠ‚ç‚¹åœ¨<strong>worker3</strong>ä¸Šã€‚ä¿®æ”¹2m-2s-async&#x2F;broker-a-s.properties <code>åªéœ€è¦ä¿®æ”¹brokerIdå’ŒbrokerRole</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#æ‰€å±é›†ç¾¤åå­—ï¼Œåå­—ä¸€æ ·çš„èŠ‚ç‚¹å°±åœ¨åŒä¸€ä¸ªé›†ç¾¤å†…</span><br><span class="line">brokerClusterName=rocketmq-cluster</span><br><span class="line">#brokeråå­—ï¼Œåå­—ä¸€æ ·çš„èŠ‚ç‚¹å°±æ˜¯ä¸€ç»„ä¸»ä»èŠ‚ç‚¹ã€‚</span><br><span class="line">brokerName=broker-a</span><br><span class="line">#brokerid,<span class="number">0</span>å°±è¡¨ç¤ºæ˜¯Masterï¼Œ&gt;<span class="number">0</span>çš„éƒ½æ˜¯è¡¨ç¤º Slave</span><br><span class="line">brokerId=<span class="number">1</span></span><br><span class="line">#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²</span><br><span class="line">namesrvAddr=worker1:<span class="number">9876</span>;worker2:<span class="number">9876</span>;worker3:<span class="number">9876</span></span><br><span class="line">#åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°</span><br><span class="line">defaultTopicQueueNums=<span class="number">4</span></span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateTopicEnable=<span class="literal">true</span></span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateSubscriptionGroup=<span class="literal">true</span></span><br><span class="line">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£</span><br><span class="line">listenPort=<span class="number">11011</span></span><br><span class="line">#åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ <span class="number">4</span>ç‚¹</span><br><span class="line">deleteWhen=<span class="number">04</span></span><br><span class="line">#æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ <span class="number">48</span> å°æ—¶</span><br><span class="line">fileReservedTime=<span class="number">120</span></span><br><span class="line">#commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G</span><br><span class="line">mapedFileSizeCommitLog=<span class="number">1073741824</span></span><br><span class="line">#ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´</span><br><span class="line">mapedFileSizeConsumeQueue=<span class="number">300000</span></span><br><span class="line">#destroyMapedFileIntervalForcibly=<span class="number">120000</span></span><br><span class="line">#redeleteHangedFileInterval=<span class="number">120000</span></span><br><span class="line">#æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´</span><br><span class="line">diskMaxUsedSpaceRatio=<span class="number">88</span></span><br><span class="line">#å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathRootDir=/app/rocketmq/storeSlave</span><br><span class="line">#commitLog å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathCommitLog=/app/rocketmq/storeSlave/commitlog</span><br><span class="line">#æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathConsumeQueue=/app/rocketmq/storeSlave/consumequeue</span><br><span class="line">#æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathIndex=/app/rocketmq/storeSlave/index</span><br><span class="line">#checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">storeCheckpoint=/app/rocketmq/storeSlave/checkpoint</span><br><span class="line">#abort æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">abortFile=/app/rocketmq/storeSlave/abort</span><br><span class="line">#é™åˆ¶çš„æ¶ˆæ¯å¤§å°</span><br><span class="line">maxMessageSize=<span class="number">65536</span></span><br><span class="line">#flushCommitLogLeastPages=<span class="number">4</span></span><br><span class="line">#flushConsumeQueueLeastPages=<span class="number">2</span></span><br><span class="line">#flushCommitLogThoroughInterval=<span class="number">10000</span></span><br><span class="line">#flushConsumeQueueThoroughInterval=<span class="number">60000</span></span><br><span class="line">#Broker çš„è§’è‰²</span><br><span class="line">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="line">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="line">#- SLAVE</span><br><span class="line">brokerRole=SLAVE</span><br><span class="line">#åˆ·ç›˜æ–¹å¼</span><br><span class="line">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="line">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br><span class="line">flushDiskType=ASYNC_FLUSH</span><br><span class="line">#checkTransactionMessageEnable=<span class="literal">false</span></span><br><span class="line">#å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#sendMessageThreadPoolNums=<span class="number">128</span></span><br><span class="line">#æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#pullMessageThreadPoolNums=<span class="number">128</span></span><br></pre></td></tr></table></figure><h3 id="3ã€é…ç½®ç¬¬äºŒç»„Broker-b"><a href="#3ã€é…ç½®ç¬¬äºŒç»„Broker-b" class="headerlink" title="3ã€é…ç½®ç¬¬äºŒç»„Broker-b"></a>3ã€é…ç½®ç¬¬äºŒç»„Broker-b</h3><p>è¿™ä¸€ç»„brokerçš„ä¸»èŠ‚ç‚¹åœ¨<strong>worker3</strong>ä¸Šï¼Œæ‰€ä»¥éœ€è¦é…ç½®worker3ä¸Šçš„config&#x2F;2m-2s-async&#x2F;broker-b.properties</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#æ‰€å±é›†ç¾¤åå­—ï¼Œåå­—ä¸€æ ·çš„èŠ‚ç‚¹å°±åœ¨åŒä¸€ä¸ªé›†ç¾¤å†…</span><br><span class="line">brokerClusterName=rocketmq-cluster</span><br><span class="line">#brokeråå­—ï¼Œåå­—ä¸€æ ·çš„èŠ‚ç‚¹å°±æ˜¯ä¸€ç»„ä¸»ä»èŠ‚ç‚¹ã€‚</span><br><span class="line">brokerName=broker-b</span><br><span class="line">#brokerid,0å°±è¡¨ç¤ºæ˜¯Masterï¼Œ&gt;0çš„éƒ½æ˜¯è¡¨ç¤º Slave</span><br><span class="line">brokerId=0</span><br><span class="line">#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²</span><br><span class="line">namesrvAddr=worker1:9876;worker2:9876;worker3:9876</span><br><span class="line">#åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°</span><br><span class="line">defaultTopicQueueNums=4</span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateTopicEnable=true</span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateSubscriptionGroup=true</span><br><span class="line">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£</span><br><span class="line">listenPort=10911</span><br><span class="line">#åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹</span><br><span class="line">deleteWhen=04</span><br><span class="line">#æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶</span><br><span class="line">fileReservedTime=120</span><br><span class="line">#commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G</span><br><span class="line">mapedFileSizeCommitLog=1073741824</span><br><span class="line">#ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´</span><br><span class="line">mapedFileSizeConsumeQueue=300000</span><br><span class="line">#destroyMapedFileIntervalForcibly=120000</span><br><span class="line">#redeleteHangedFileInterval=120000</span><br><span class="line">#æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´</span><br><span class="line">diskMaxUsedSpaceRatio=88</span><br><span class="line">#å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathRootDir=/app/rocketmq/store</span><br><span class="line">#commitLog å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathCommitLog=/app/rocketmq/store/commitlog</span><br><span class="line">#æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathConsumeQueue=/app/rocketmq/store/consumequeue</span><br><span class="line">#æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathIndex=/app/rocketmq/store/index</span><br><span class="line">#checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">storeCheckpoint=/app/rocketmq/store/checkpoint</span><br><span class="line">#abort æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">abortFile=/app/rocketmq/store/abort</span><br><span class="line">#é™åˆ¶çš„æ¶ˆæ¯å¤§å°</span><br><span class="line">maxMessageSize=65536</span><br><span class="line">#flushCommitLogLeastPages=4</span><br><span class="line">#flushConsumeQueueLeastPages=2</span><br><span class="line">#flushCommitLogThoroughInterval=10000</span><br><span class="line">#flushConsumeQueueThoroughInterval=60000</span><br><span class="line">#Broker çš„è§’è‰²</span><br><span class="line">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="line">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="line">#- SLAVE</span><br><span class="line">brokerRole=ASYNC_MASTER</span><br><span class="line">#åˆ·ç›˜æ–¹å¼</span><br><span class="line">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="line">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br><span class="line">flushDiskType=ASYNC_FLUSH</span><br><span class="line">#checkTransactionMessageEnable=false</span><br><span class="line">#å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#sendMessageThreadPoolNums=128</span><br><span class="line">#æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#pullMessageThreadPoolNums=128</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨å¯¹åº”çš„slaveåœ¨worker2ä¸Šï¼Œä¿®æ”¹work2ä¸Šçš„ conf&#x2F;2m-2s-async&#x2F;broker-b-s.properties</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#æ‰€å±é›†ç¾¤åå­—ï¼Œåå­—ä¸€æ ·çš„èŠ‚ç‚¹å°±åœ¨åŒä¸€ä¸ªé›†ç¾¤å†…</span><br><span class="line">brokerClusterName=rocketmq-cluster</span><br><span class="line">#brokeråå­—ï¼Œåå­—ä¸€æ ·çš„èŠ‚ç‚¹å°±æ˜¯ä¸€ç»„ä¸»ä»èŠ‚ç‚¹ã€‚</span><br><span class="line">brokerName=broker-b</span><br><span class="line">#brokerid,<span class="number">0</span>å°±è¡¨ç¤ºæ˜¯Masterï¼Œ&gt;<span class="number">0</span>çš„éƒ½æ˜¯è¡¨ç¤º Slave</span><br><span class="line">brokerId=<span class="number">1</span></span><br><span class="line">#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²</span><br><span class="line">namesrvAddr=worker1:<span class="number">9876</span>;worker2:<span class="number">9876</span>;worker3:<span class="number">9876</span></span><br><span class="line">#åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°</span><br><span class="line">defaultTopicQueueNums=<span class="number">4</span></span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateTopicEnable=<span class="literal">true</span></span><br><span class="line">#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­</span><br><span class="line">autoCreateSubscriptionGroup=<span class="literal">true</span></span><br><span class="line">#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£</span><br><span class="line">listenPort=<span class="number">11011</span></span><br><span class="line">#åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ <span class="number">4</span>ç‚¹</span><br><span class="line">deleteWhen=<span class="number">04</span></span><br><span class="line">#æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ <span class="number">48</span> å°æ—¶</span><br><span class="line">fileReservedTime=<span class="number">120</span></span><br><span class="line">#commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1G</span><br><span class="line">mapedFileSizeCommitLog=<span class="number">1073741824</span></span><br><span class="line">#ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´</span><br><span class="line">mapedFileSizeConsumeQueue=<span class="number">300000</span></span><br><span class="line">#destroyMapedFileIntervalForcibly=<span class="number">120000</span></span><br><span class="line">#redeleteHangedFileInterval=<span class="number">120000</span></span><br><span class="line">#æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´</span><br><span class="line">diskMaxUsedSpaceRatio=<span class="number">88</span></span><br><span class="line">#å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathRootDir=/app/rocketmq/storeSlave</span><br><span class="line">#commitLog å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathCommitLog=/app/rocketmq/storeSlave/commitlog</span><br><span class="line">#æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathConsumeQueue=/app/rocketmq/storeSlave/consumequeue</span><br><span class="line">#æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„</span><br><span class="line">storePathIndex=/app/rocketmq/storeSlave/index</span><br><span class="line">#checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">storeCheckpoint=/app/rocketmq/storeSlave/checkpoint</span><br><span class="line">#abort æ–‡ä»¶å­˜å‚¨è·¯å¾„</span><br><span class="line">abortFile=/app/rocketmq/storeSlave/abort</span><br><span class="line">#é™åˆ¶çš„æ¶ˆæ¯å¤§å°</span><br><span class="line">maxMessageSize=<span class="number">65536</span></span><br><span class="line">#flushCommitLogLeastPages=<span class="number">4</span></span><br><span class="line">#flushConsumeQueueLeastPages=<span class="number">2</span></span><br><span class="line">#flushCommitLogThoroughInterval=<span class="number">10000</span></span><br><span class="line">#flushConsumeQueueThoroughInterval=<span class="number">60000</span></span><br><span class="line">#Broker çš„è§’è‰²</span><br><span class="line">#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master</span><br><span class="line">#- SYNC_MASTER åŒæ­¥åŒå†™Master</span><br><span class="line">#- SLAVE</span><br><span class="line">brokerRole=SLAVE</span><br><span class="line">#åˆ·ç›˜æ–¹å¼</span><br><span class="line">#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜</span><br><span class="line">#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜</span><br><span class="line">flushDiskType=ASYNC_FLUSH</span><br><span class="line">#checkTransactionMessageEnable=<span class="literal">false</span></span><br><span class="line">#å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#sendMessageThreadPoolNums=<span class="number">128</span></span><br><span class="line">#æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡</span><br><span class="line">#pullMessageThreadPoolNums=<span class="number">128</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·brokerå°±é…ç½®å®Œæˆäº†ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„é…ç½®é¡¹ï¼š</p><p>1ã€åŒä¸€æœºå™¨ä¸Šä¸¤ä¸ªå®ä¾‹çš„storeç›®å½•ä¸èƒ½ç›¸åŒï¼Œå¦åˆ™ä¼šæŠ¥é”™ Lock failed,MQ already started</p><p>2ã€åŒä¸€æœºå™¨ä¸Šä¸¤ä¸ªå®ä¾‹çš„listenPortä¹Ÿä¸èƒ½ç›¸åŒã€‚å¦åˆ™ä¼šæŠ¥ç«¯å£å ç”¨çš„é”™nameserverä¸éœ€è¦è¿›è¡Œé…ç½®ï¼Œç›´æ¥å¯åŠ¨å°±è¡Œã€‚è¿™ä¹Ÿçœ‹å‡ºnameserveræ˜¯æ— çŠ¶æ€çš„ã€‚</p></blockquote><h3 id="7ã€å¯åŠ¨RocketMQ"><a href="#7ã€å¯åŠ¨RocketMQ" class="headerlink" title="7ã€å¯åŠ¨RocketMQ"></a>7ã€å¯åŠ¨RocketMQ</h3><h4 id="1ã€å…ˆå¯åŠ¨nameServer"><a href="#1ã€å…ˆå¯åŠ¨nameServer" class="headerlink" title="1ã€å…ˆå¯åŠ¨nameServer"></a>1ã€å…ˆå¯åŠ¨nameServer</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup bin/mqnamesrv &amp;</span><br></pre></td></tr></table></figure><h4 id="2ã€å†å¯åŠ¨broker"><a href="#2ã€å†å¯åŠ¨broker" class="headerlink" title="2ã€å†å¯åŠ¨broker"></a>2ã€å†å¯åŠ¨broker</h4><p>åœ¨<strong>worker2</strong>ä¸Šå¯åŠ¨broker-açš„masterèŠ‚ç‚¹å’Œbroker-bçš„slaveèŠ‚ç‚¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nohup ./mqbroker -c ../conf/2m-2s-async/broker-a.properties &amp;</span><br><span class="line">nohup ./mqbroker -c ../conf/2m-2s-async/broker-b-s.properties &amp;</span><br></pre></td></tr></table></figure><p>åœ¨work3ä¸Šå¯åŠ¨broker-bçš„masterèŠ‚ç‚¹å’Œbroker-açš„slaveèŠ‚ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nohup ./mqbroker -c ../conf/2m-2s-async/broker-b.properties &amp;</span><br><span class="line">nohup ./mqbroker -c ../conf/2m-2s-async/broker-a-s.properties &amp;</span><br></pre></td></tr></table></figure><h4 id="3ã€å¯åŠ¨çŠ¶æ€æ£€æŸ¥"><a href="#3ã€å¯åŠ¨çŠ¶æ€æ£€æŸ¥" class="headerlink" title="3ã€å¯åŠ¨çŠ¶æ€æ£€æŸ¥"></a>3ã€å¯åŠ¨çŠ¶æ€æ£€æŸ¥</h4><p>jpsæŒ‡ä»¤ï¼Œèƒ½çœ‹åˆ°ä¸€ä¸ªNameSrvStartupè¿›ç¨‹å’Œä¸¤ä¸ªBrokerStartupè¿›ç¨‹ã€‚</p><p>nohup.outä¸­ä¹Ÿæœ‰å¯åŠ¨æˆåŠŸçš„æ—¥å¿—ã€‚</p><p>å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹nameServeræ—¥å¿—</span></span><br><span class="line">tail -500f ~/logs/rocketmqlogs/namesrv.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹brokeræ—¥å¿—</span></span><br><span class="line">tail -500f ~/logs/rocketmqlogs/broker.log</span><br></pre></td></tr></table></figure><h4 id="4ã€å‘½ä»¤è¡Œå¿«é€ŸéªŒè¯"><a href="#4ã€å‘½ä»¤è¡Œå¿«é€ŸéªŒè¯" class="headerlink" title="4ã€å‘½ä»¤è¡Œå¿«é€ŸéªŒè¯"></a>4ã€å‘½ä»¤è¡Œå¿«é€ŸéªŒè¯</h4><p>ä¸‰å°æœåŠ¡å™¨éƒ½é…ç½®ä¸Šå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br><span class="line">export NAMESRV_ADDR=&#x27;worker1:9876;worker2:9876;worker3:9876&#x27;</span><br><span class="line"></span><br><span class="line">source  ~/.bash_profile</span><br></pre></td></tr></table></figure><h3 id="8-æµ‹è¯•mqadminç®¡ç†å·¥å…·"><a href="#8-æµ‹è¯•mqadminç®¡ç†å·¥å…·" class="headerlink" title="8,æµ‹è¯•mqadminç®¡ç†å·¥å…·"></a>8,æµ‹è¯•mqadminç®¡ç†å·¥å…·</h3><p>åœ°å€ï¼š <a href="https://github.com/apache/rocketmq-externals">https://github.com/apache/rocketmq-externals</a></p><p>ä¸‹è½½ä¸‹æ¥åï¼Œè¿›å…¥å…¶ä¸­çš„rocket-consoleç›®å½•ï¼Œä½¿ç”¨mavenè¿›è¡Œç¼–è¯‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean <span class="keyword">package</span> -Dmaven.test.skip=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¼ è‡³æœåŠ¡å™¨ï¼ŒjaråŒ…çš„å½“å‰ç›®å½•ä¸‹å¢åŠ ä¸€ä¸ªapplication.propertiesæ–‡ä»¶ï¼Œè¦†ç›–jaråŒ…ä¸­é»˜è®¤çš„ä¸€ä¸ªå±æ€§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocketmq.config.namesrvAddr=worker1:9876;worker2:9876;worker3:9876</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar rocketmq-console-ng-1.0.1.jar</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> RocketMQ åŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RocketMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡zookeeperæµ…è°ˆä¸€è‡´æ€§ç®—æ³•</title>
      <link href="/2024/11/17/%E9%80%9A%E8%BF%87zookeeper%E6%B5%85%E8%B0%88%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/"/>
      <url>/2024/11/17/%E9%80%9A%E8%BF%87zookeeper%E6%B5%85%E8%B0%88%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="é€šè¿‡zookeeperæµ…è°ˆä¸€è‡´æ€§ç®—æ³•"><a href="#é€šè¿‡zookeeperæµ…è°ˆä¸€è‡´æ€§ç®—æ³•" class="headerlink" title="é€šè¿‡zookeeperæµ…è°ˆä¸€è‡´æ€§ç®—æ³•"></a>é€šè¿‡zookeeperæµ…è°ˆä¸€è‡´æ€§ç®—æ³•</h1><h2 id="CAPå®šç†ä»‹ç»"><a href="#CAPå®šç†ä»‹ç»" class="headerlink" title="CAPå®šç†ä»‹ç»"></a>CAPå®šç†ä»‹ç»</h2><p>CAP å®šç†æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒConsistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€ Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼Œä¸‰è€…ä¸å¯å…¼å¾—ã€‚</p><blockquote><p>é€šä¿—æ¥è¯´ï¼š</p><p>ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šå½“ç³»ç»Ÿæ•°æ®å‘ç”Ÿæ›´æ–°æ“ä½œåï¼Œå„ä¸ªä¸»æœºä¸­çš„æ•°æ®ä»ç„¶å¤„äºä¸€è‡´çš„çŠ¶æ€ã€‚</p><p>å¯ç”¨æ€§ï¼ˆAï¼‰ï¼šå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªè¯·æ±‚ï¼Œç³»ç»Ÿæ€»æ˜¯å¯ä»¥åœ¨æœ‰é™çš„æ—¶é—´å†…å¯¹ç”¨æˆ·åšå‡ºå“åº”ã€‚</p><p>åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœæ—¶ï¼Œä»èƒ½å¤Ÿä¿è¯å¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§æˆ–å¯ç”¨æ€§çš„æœåŠ¡ã€‚</p></blockquote><p>â€‹å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œç½‘ç»œğŸ›œç¯å¢ƒæ˜¯ç›¸å¯¹ä¸å¯æ§åˆ¶çš„ï¼Œå‡ºç°ç½‘ç»œåˆ†åŒºæ˜¯ä¸å¯é¿å…çš„ã€‚ç½‘ç»œåˆ†åŒºçš„å‡ºç°å¾ˆå¯èƒ½å°±ä¼šå¸¦æ¥è„‘è£‚é—®é¢˜ï¼ˆä¾‹å¦‚ï¼šæœºæˆ¿ä¹‹é—´çš„ç½‘ç»œé€šä¿¡å‡ºç°æ•…éšœï¼‰ï¼Œè¿™å°±ä¼šå¯¼è‡´é›†ç¾¤åˆ†è£‚æˆä¸¤ä¸ªæˆ–å¤šä¸ªï¼Œå®ƒä»¬éƒ½è®¤ä¸ºåªæœ‰è‡ªå·±æ²¡æœ‰å´©æºƒï¼Œéƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚å¯¹äºzkè¿™åˆ†å¸ƒå¼åè°ƒç³»ç»Ÿæ¥è¯´ï¼Œæ•°æ®çš„ä¸€è‡´æ€§æ˜¯åŸºæœ¬çš„è¦æ±‚ï¼Œå®ƒéœ€è¦ä¿è¯åœ¨ä»»ä½•æ—¶åˆ»è®¿é—®éƒ½èƒ½å¾—åˆ°ä¸€è‡´æ€§çš„æ•°æ®ç»“æœï¼Œæ‰€ä»¥åˆ†åŒºå®¹é”™æ€§æ˜¯éœ€è¦ä¿è¯çš„ã€‚zké»˜è®¤æ˜¯é€šè¿‡<strong>â€œè¿‡åŠæœºåˆ¶â€</strong>é˜²æ­¢è„‘è£‚çš„ã€‚</p><p>â€‹ä¸éš¾å‘ç°ï¼Œä¸€è‡´æ€§å’Œå¯ç”¨æ€§æ˜¯ä¸èƒ½åŒæ—¶ä¿è¯çš„ã€‚åŸå› ï¼šæ•°æ®åŒæ­¥æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œåœ¨åŒæ­¥çš„æœŸé—´ï¼Œè‹¥å…è®¸clientè®¿é—®ï¼Œåˆ™clientä»ä¸åŒèŠ‚ç‚¹è¯»å–åˆ°çš„æ•°æ®å°±å¯èƒ½æ˜¯ä¸åŒçš„ï¼ˆç‰ºç‰²äº†ä¸€è‡´æ€§ä¿è¯äº†å¯ç”¨æ€§ï¼‰ã€‚è‹¥ä¸å…è®¸clientè®¿é—®ï¼Œåˆ™clientåœ¨åŒæ­¥æœŸé—´æ— æ³•è·å–æœåŠ¡ï¼Œä½†æ˜¯åœ¨åŒæ­¥åæ— è®ºè®¿é—®å“ªä¸ªèŠ‚ç‚¹è¯»å–çš„æ•°æ®éƒ½ä¼šæ˜¯ä¸€æ ·çš„ï¼ˆç‰ºç‰²äº†å¯ç”¨æ€§ä»è€Œä¿è¯ä¸€è‡´æ€§ï¼‰ã€‚</p><blockquote><p>ç½‘ç»œåˆ†åŒºæ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºç½‘ç»œæ•…éšœã€èŠ‚ç‚¹æ•…éšœç­‰åŸå› ï¼Œå¯¼è‡´é›†ç¾¤ä¸­çš„èŠ‚ç‚¹è¢«åˆ†å‰²æˆå¤šä¸ªç‹¬ç«‹çš„å­é›†ï¼Œæ¯ä¸ªå­é›†ä¹‹é—´æ— æ³•è¿›è¡Œé€šä¿¡çš„ç°è±¡ã€‚ç½‘ç»œåˆ†åŒºä¼šå¯¼è‡´åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¸€è‡´æ€§å—åˆ°å½±å“ï¼Œå› æ­¤éœ€è¦é‡‡å–ä¸€å®šçš„æªæ–½æ¥é¿å…æˆ–è§£å†³ç½‘ç»œåˆ†åŒºé—®é¢˜ã€‚</p></blockquote><h2 id="BASE-ç†è®º"><a href="#BASE-ç†è®º" class="headerlink" title="BASE ç†è®º"></a><strong>BASE</strong> <strong>ç†è®º</strong></h2><p>â€‹BASE æ˜¯ Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’Œ Eventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç®€å†™ï¼ŒBASE æ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå…¶æ¥æºäºå¯¹å¤§è§„æ¨¡äº’è”ç½‘ç³»ç»Ÿåˆ†å¸ƒå¼å®è·µçš„ç»“è®ºï¼Œæ˜¯åŸºäº CAP å®šç†é€æ­¥æ¼”åŒ–è€Œæ¥çš„ã€‚</p><p>BASE ç†è®ºçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªç³»ç»Ÿéƒ½å¯ä»¥æ ¹æ®è‡ªèº«çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</strong></p><p>1.åŸºæœ¬å¯ç”¨ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿå‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚ä½“ç°åœ¨ï¼šå“åº”æ—¶é—´ä¸Šçš„æŸå¤±  å’Œ åŠŸèƒ½ä¸Šçš„æŸå¤±ï¼ˆæœåŠ¡é™çº§ï¼‰ã€‚</p><p>2.è½¯çŠ¶æ€ï¼šå…è®¸ç³»ç»Ÿæ•°æ®å­˜åœ¨çš„ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ã€‚ä¾‹å¦‚å…è®¸zkä¹‹é—´çš„æ•°æ®åŒæ­¥å­˜åœ¨ä¸€å®šçš„æ•°æ®å»¶è¿Ÿã€‚</p><p>3.æœ€ç»ˆä¸€è‡´æ€§ï¼šå¼ºè°ƒæ‰€æœ‰çš„æ•°æ®å‰¯æœ¬åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œ<strong>æœ€ç»ˆ</strong>èƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€ã€‚</p><h2 id="ä»zkçš„è§’åº¦è°ˆcp"><a href="#ä»zkçš„è§’åº¦è°ˆcp" class="headerlink" title="ä»zkçš„è§’åº¦è°ˆcp"></a>ä»zkçš„è§’åº¦è°ˆcp</h2><p>â€‹åœ¨zké›†ç¾¤ä¸­ï¼ŒleaderèŠ‚ç‚¹å®•æœºåï¼Œæ•´ä¸ªé›†ç¾¤ä¼šæœ‰ä¸€æ®µæ—¶é—´æ˜¯ä¸èƒ½è¢«è®¿é—®çš„ï¼Œåé¢åˆå¯ä»¥è®¿é—®äº†ã€‚åœ¨è¿™æ®µä¸å¯è®¿é—®çš„æ—¶é—´å†…ï¼Œzké›†ç¾¤æ˜¯åœ¨åšleaderé€‰ä¸¾ï¼ŒæœŸé—´æ˜¯ä¸æ¥å—å®¢æˆ·ç«¯çš„è¯»å†™æ“ä½œçš„ã€‚ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£åœ¨leaderé€‰ä¸¾æœŸé—´ï¼Œzké›†ç¾¤æ˜¯å¤„äºç˜«ç—ªæœŸé—´çš„ï¼ŒåŒæ­¥å®Œæ¯•åè¯»å–åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´æ€§çš„æ•°æ®ã€‚æ»¡è¶³äº†ä¸€è‡´æ€§ï¼Œç‰ºç‰²äº†ä¸€å®šçš„å¯ç”¨æ€§ã€‚</p><h2 id="åˆ†å¸ƒå¼ä¸€è‡´æ€§"><a href="#åˆ†å¸ƒå¼ä¸€è‡´æ€§" class="headerlink" title="åˆ†å¸ƒå¼ä¸€è‡´æ€§"></a>åˆ†å¸ƒå¼ä¸€è‡´æ€§</h2><p>â€‹é€šä¿—æ¥è¯´ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯å°†å¤šä¸ªæ“ä½œç»„æˆä¸€ä¸ªäº‹åŠ¡æ¥å®Œæˆï¼Œå¹¶ä¸”è¿™å¤šä¸ªæ“ä½œè¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥ã€‚è¿™ä¸ªå¾ˆæœ‰åçš„ä¸€ä¸ªå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ç»„ä»¶å°±æ˜¯é˜¿é‡Œçš„seatsã€‚ä¸€èˆ¬åˆ†å¸ƒå¼ä¸€è‡´æ€§æ˜¯ç”±åˆ†å¸ƒå¼äº‹åŠ¡å®ç°çš„ï¼Œéœ€è¦ä¿è¯å®¢æˆ·ç«¯ä»åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªserverèŠ‚ç‚¹è·å–çš„æ•°æ®ï¼Œåœ¨æŸä¸€æ®µæ—¶é—´æ˜¯å¯ä»¥ä¿è¯æ˜¯ä¸€è‡´çš„ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚</p><p>2PCç®—æ³•ï¼šæ¯ä¸€ä¸ªserverå¯¹æœ¬åœ°äº‹åŠ¡çš„ç¡®è®¤ï¼Œéœ€è¦ç»å†ä¸¤ä¸ªé˜¶æ®µï¼Œprepareé˜¶æ®µå’Œcommité˜¶æ®µã€‚åœ¨MySQLä¸­é€šè¿‡2pcä¿è¯<strong>Redoå’ŒBinlogçš„ä¿æŒä¸€è‡´</strong>ã€‚1ï¼‰å½“äº‹åŠ¡æäº¤æ—¶InnoDBå­˜å‚¨å¼•æ“è¿›è¡Œprepareæ“ä½œï¼Œå°†æ•°æ®å†™å…¥åˆ°binglogæ—¥å¿—ä¸­ã€‚2ï¼‰InnoDBå­˜å‚¨å¼•æ“å°†äº‹åŠ¡å†™å…¥åˆ°Redo Logæ–‡ä»¶ä¸­ã€‚åœ¨seataçš„äº‹åŠ¡æ¨¡å¼ä¸­XAï¼ŒATï¼ŒTCCéƒ½æ˜¯2PCçš„ã€‚</p><p>3PCç®—æ³•ï¼šåœ¨2PCçš„åŸºç¡€ä¸Šæ–°å¢ä¸€ä¸ªAccepté˜¶æ®µï¼ˆæäº¤æŒ‡ä»¤é˜¶æ®µï¼‰ã€‚è¯¥é˜¶æ®µä¸»è¦æ˜¯äº‹åŠ¡åè°ƒè€…ï¼ˆTCï¼‰å‘èµ„æºç®¡ç†è€…ï¼ˆRMï¼‰å‘é€acceptæŒ‡ä»¤ï¼ŒRMæ”¶åˆ°æŒ‡ä»¤ååˆ¤æ–­æ˜¯å¦å¯ä»¥å®Œæˆè‡ªå·±çš„äº‹ç‰©å¹¶ä¸”å°†åˆ¤æ–­ç»“æœç»™TCã€‚</p><p>Paxosç®—æ³•ï¼šè¯¥ç®—æ³•è¦è§£å†³çš„é—®é¢˜æ˜¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä½•å°±æŸä¸ªå†³è®®è¾¾æˆä¸€è‡´ã€‚ZABï¼ˆZookeeper Atomic Broadcastï¼‰åè®®æ˜¯Paxosç®—æ³•çš„ä¸€ç§å·¥ä¸šå®ç°ã€‚åœ¨zookeeperä¸­ä½¿ç”¨ä¸€ä¸ªå•ä¸€ä¸»è¿›ç¨‹æ¥æ¥æ”¶å¹¶å¤„ç†å®¢æˆ·ç«¯çš„æ‰€æœ‰è¯·æ±‚ï¼ˆå†™è¯·æ±‚ï¼‰,å½“æ•°æ®å‘ç”Ÿå˜æ›´ï¼ŒZABé‡‡ç”¨åŸå­å¹¿æ’­åè®®ï¼Œä»¥äº‹åŠ¡ææ¡ˆ Proposal çš„å½¢å¼å¹¿æ’­åˆ°æ‰€æœ‰çš„å‰¯æœ¬è¿›ç¨‹ä¸Šå¹¶ä¸”ä¸ºæ¯ä¸€ä¸ªäº‹åŠ¡åˆ†é…ä¸€ä¸ªå…¨å±€é€’å¢çš„ç¼–å·Xid.  å®¢æˆ·ç«¯è¿æ¥åˆ°ä¸€ä¸ªz ké›†ç¾¤åï¼Œå¦‚æœæ˜¯è¯»è¯·æ±‚,é‚£ä¹ˆå½“å‰èŠ‚ç‚¹å°±ä¼šæ ¹æ®è‡ªå·±ä¿å­˜çš„æ•°æ®å¯¹å…¶è¿›è¡Œç›¸åº”æ•°æ®è¿”å›ã€‚å¦‚æœæ˜¯å†™è¯·æ±‚å¹¶ä¸”ä¸æ˜¯leaderèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹å°±ä¼šé¦–å…ˆå°†è¯·æ±‚è½¬å‘ç»™leaderèŠ‚ç‚¹ï¼ŒleaderèŠ‚ç‚¹ä»¥ææ¡ˆçš„æ–¹å¼å¹¿æ’­è¯¥å†™æ“ä½œï¼Œåªæœ‰è¶…è¿‡<strong>è¿‡åŠçš„èŠ‚ç‚¹åŒæ„è¯¥å†™æ“ä½œè¯¥å†™è¯·æ±‚æ‰ä¼šè¢«æäº¤</strong>ï¼Œç„¶åleaderå¹¿æ’­ç»™æ‰€æœ‰çš„followerèŠ‚ç‚¹ï¼Œé€šçŸ¥å®ƒä»¬åŒæ­¥æ•°æ®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> zookeeper åŸºç¡€çŸ¥è¯† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé˜»å¡ä¸æ­»é”</title>
      <link href="/2024/11/17/MySQL%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81/"/>
      <url>/2024/11/17/MySQL%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQLé˜»å¡ä¸æ­»é”"><a href="#MySQLé˜»å¡ä¸æ­»é”" class="headerlink" title="MySQLé˜»å¡ä¸æ­»é”"></a>MySQLé˜»å¡ä¸æ­»é”</h1><h2 id="é˜»å¡"><a href="#é˜»å¡" class="headerlink" title="é˜»å¡"></a>é˜»å¡</h2><p>å› ä¸ºä¸åŒé”ä¹‹é—´çš„å…¼å®¹æ€§å…³ç³»ï¼Œåœ¨æœ‰äº›æ—¶åˆ»ä¸€ä¸ªäº‹åŠ¡ä¸­çš„é”éœ€è¦ç­‰å¾…å¦ä¸€ä¸ªäº‹åŠ¡ä¸­çš„é”é‡Šæ”¾å®ƒæ‰€å ç”¨çš„èµ„æºï¼Œè¿™å°±æ˜¯é˜»å¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹ç­‰å¾…æ—¶é—´</span><br><span class="line">show variables like &#x27;innodb_lock_wait_timeout&#x27;;</span><br><span class="line">SET@@innodb_lock_wait_timeout=60;</span><br><span class="line"># æ˜¯å¦åœ¨ç­‰å¾…è¶…æ—¶æ—¶å¯¹è¿›è¡Œä¸­çš„äº‹åŠ¡è¿›è¡Œå›æ»šæ“ä½œ</span><br><span class="line">show variables like &#x27;innodb_rollback_on_timeout&#x27;;</span><br><span class="line"></span><br><span class="line">#è®¾ç½®ç­‰å¾…æ—¶é—´  é»˜è®¤50ç§’</span><br><span class="line">SET@@innodb_lock_wait_timeout=60;  </span><br><span class="line">#è®¾ç½®æ˜¯å¦åœ¨ç­‰å¾…è¶…æ—¶æ—¶å¯¹è¿›è¡Œä¸­çš„äº‹åŠ¡è¿›è¡Œå›æ»šæ“ä½œ  é»˜è®¤æ˜¯OFF ä»£è¡¨ä¸å›æ»š</span><br><span class="line">SET@@innodb_rollback_on_timeout=on;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81%EF%BC%88%E5%9B%BE1%EF%BC%89.png" alt="image-20230814102157758"></p><p>è®¾ç½®å€¼ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81%EF%BC%88%E5%9B%BE2%EF%BC%89.png" alt="image-20230815165901211"></p><p>æ³¨æ„ï¼šå‚æ•°<code>innodb_lock_wait_timeout</code> å‚æ•°æ˜¯åŠ¨æ€çš„ï¼Œåœ¨mysqlè¿è¡Œæ—¶å¯è¿›è¡Œè°ƒæ•´ï¼Œ<code>innodb_rollback_on_timeout</code>å‚æ•°æ˜¯é™æ€çš„ï¼Œä¸å¯åœ¨è¿è¡Œæ—¶è¿›è¡Œä¿®æ”¹ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><p>éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š<strong>åœ¨é»˜è®¤æƒ…å†µä¸‹InnoDBå­˜å‚¨å¼•æ“ä¸ä¼šå›æ»šè¶…æ—¶å¼•å‘çš„é”™è¯¯å¼‚å¸¸ã€‚</strong>ï¼ˆå…¶å®InnoDBå­˜å‚¨å¼•æ“åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½ä¸ä¼šå¯¹å¼‚å¸¸è¿›è¡Œå›æ»šã€‚ï¼‰</p><p>å¼‚å¸¸å®ä¾‹æ¼”ç¤ºï¼š</p><p>å·¦è¾¹ä¸ºä¼šè¯Aï¼Œå³è¾¹ä¸ºä¼šè¯Bã€‚åˆå§‹çŠ¶æ€æ•°æ®åº“è¡¨filmä¸­æœ‰3æ¡æ•°æ®ï¼ŒIDï¼Œåˆ†åˆ«ä¸º3ï¼Œ5ï¼Œ6ï¼›</p><p>é¦–å…ˆä¼šè¯A å¼€å¯äº†äº‹åŠ¡Aï¼Œå¹¶ä¸”åœ¨Next-Key Lockç®—æ³•ä¸‹é”å®šäº†å°ä¸5åŒ…å«5çš„è®°å½•ã€‚äº‹åŠ¡Bæ­£å¸¸æ’å…¥è®°å½•ID:7ï¼Œå½“æ’å…¥ID:4 æ—¶å°±è¿›äººé˜»å¡çŠ¶æ€äº†</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81%EF%BC%88%E5%9B%BE%E4%B8%89%EF%BC%89.png" alt="image-20230815174128914"></p><p>å½“äº‹åŠ¡Bè¾¾åˆ°äº‹åŠ¡è¶…æ—¶é—´æ—¶é—´æ—¶ï¼ŒæŠ¥é”™<code>ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction</code>.</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81%EF%BC%88%E5%9B%BE%E5%9B%9B%EF%BC%89.png" alt="image-20230815174608612"></p><p>è¿™æ—¶äº‹åŠ¡Båœ¨æ­¤æŸ¥è¯¢ä¼šå‘ç°ï¼Œ<strong>ID:7 è¿™æ¡è®°å½•ä¾ç„¶å­˜åœ¨ï¼Œè¿™æ˜¯å› ä¸ºäº‹åŠ¡Bè™½ç„¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†æ˜¯æ—¢æ²¡æœ‰è¿›è¡Œcommit æ“ä½œä¹Ÿæ²¡æœ‰è¿›è¡Œ rollbackæ“ä½œã€‚</strong>è¿™æ˜¯éå¸¸å±é™©çš„ï¼Œå› ä¸ºæ­¤æ—¶æ•°æ®åº“ä¸€è‡´æ€§ç‰¹æ€§è¢«æ‰“ç ´äº†ã€‚å› æ­¤æ­¤æ—¶ç”¨æˆ·å¿…é¡»åˆ¤æ–­æ˜¯å¦éœ€è¦COMMITè¿˜æ˜¯ROLLBACKï¼Œä¹‹åå†è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81%EF%BC%88%E5%9B%BE%E4%BA%94%EF%BC%89.png" alt="image-20230815175103979"></p><p>ä¸€èˆ¬æƒ…å†µè¿™æ—¶äº‹åŠ¡Béœ€è¦è¿›è¡Œ rollbackæ“ä½œï¼Œå…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81%EF%BC%88%E5%9B%BE%E5%85%AD%EF%BC%89.png" alt="image-20230815175620413"></p><h2 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h2><p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºé”èµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ã€‚</p><p>å½“å‘ç”Ÿæ­»é”çš„æ—¶å€™ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨äº‹åŠ¡éƒ½å°†æ— æ³•è¿›è¡Œä¸‹å»ã€‚</p><blockquote><p>æ­»é”äº§ç”Ÿçš„æ¡ä»¶ï¼š</p><ul><li>äº’æ–¥æ¡ä»¶<br>ä¸´ç•Œèµ„æºæ˜¯ç‹¬å èµ„æºï¼Œè¿›ç¨‹åº”äº’æ–¥ä¸”æ’ä»–çš„ä½¿ç”¨è¿™äº›èµ„æºã€‚</li><li>å æœ‰å’Œç­‰å¾…æ¡ä»¶<br>è¿›ç¨‹åœ¨è¯·æ±‚èµ„æºå¾—ä¸åˆ°æ»¡è¶³è€Œç­‰å¾…æ—¶ï¼Œä¸é‡Šæ”¾å·²å æœ‰èµ„æºã€‚</li><li>ä¸å‰¥å¤ºæ¡ä»¶<br>åˆç§°ä¸å¯æŠ¢å ï¼Œå·²è·èµ„æºåªèƒ½ç”±è¿›ç¨‹è‡ªæ„¿é‡Šæ”¾ï¼Œä¸å…è®¸è¢«å…¶ä»–è¿›ç¨‹å‰¥å¤ºã€‚</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶<br>åˆç§°ç¯è·¯æ¡ä»¶ï¼Œå­˜åœ¨å¾ªç¯ç­‰å¾…é“¾ï¼Œå…¶ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…é“¾ä¸­ç­‰å¾…ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€æŒæœ‰çš„èµ„æºï¼Œé€ æˆè¿™ç»„è¿›ç¨‹å¤„äºæ°¸è¿œç­‰å¾…çŠ¶æ€ã€‚</li></ul></blockquote><p>å¦‚ä½•è§£å†³æ­»é”é—®é¢˜ï¼š</p><p>1.è¶…æ—¶æœºåˆ¶ï¼šå½“ä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…æ—¶ï¼Œå¦‚æœç­‰å¾…æ—¶é—´è¶…è¿‡è®¾ç½®çš„æŸä¸€é˜ˆå€¼æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œå›æ»šï¼Œå¦ä¸€ä¸ªç­‰å¾…çš„äº‹åŠ¡å°±èƒ½ç»§ç»­è¿›è¡Œã€‚åœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œ<code>innodb_lock_wait_timeout</code>è®¾ç½®è¶…æ—¶çš„æ—¶é—´ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€æ¡è®°å½•æ˜¯æœ‰å¾ˆå¤šundo logçš„æˆ–è€…undo ç‰ˆæœ¬é“¾æœ‰å¾ˆå¤šç‰ˆæœ¬çš„ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡æ“ä½œæ›´æ–°äº†å¾ˆå¤šè¡Œï¼Œè¿™æ—¶å€™å¦‚æœè¦è¿›è¡Œå›æ»šæ‰€å ç”¨çš„æ—¶é—´å¯èƒ½å°±ä¼šå¾ˆå¤šã€‚</p><p>2.ä½¿ç”¨wai t-for graph ï¼ˆç­‰å¾…å›¾ï¼‰è¿›è¡Œæ­»é”æ£€æµ‹ï¼Œæ•°æ®åº“éœ€è¦ä¿å­˜é”çš„ä¿¡æ¯é“¾è¡¨å’Œäº‹åŠ¡ç­‰å¾…é“¾è¡¨ã€‚æˆ‘ä»¬é€šè¿‡é”çš„ä¿¡æ¯é“¾è¡¨å’Œäº‹åŠ¡ç­‰å¾…é“¾è¡¨å°±å¯ä»¥æ„é€ å‡ºä¸€å¼ å›¾ï¼Œå¦‚æœå›¾ä¸­å­˜åœ¨å›è·¯é‚£å°±è¯´æ˜å‡ºç°äº†æ­»é”ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81_%E9%93%BE%E8%A1%A8%EF%BC%88%E5%9B%BE%E4%B8%83%EF%BC%89.png" alt="image-20230815235528149"></p><p>â€‹äº‹åŠ¡å’Œé”çŠ¶æ€å›¾</p><p>ä¸Šå›¾ä¸­ï¼Œtransaction wait list ä¸­æœ‰å››ä¸ªäº‹åŠ¡ï¼Œäº‹åŠ¡t2å¯¹row1åŠ äº†xé”ï¼Œäº‹åŠ¡t1å¯¹row1åŠ äº†sé”ï¼Œå¹¶ä¸”äº‹åŠ¡t1éœ€è¦ç­‰å¾…äº‹åŠ¡t2ä¸­çš„row1èµ„æºï¼Œå› æ­¤wait-for graphå›¾ä¸­æœ‰ä¸€æ¡è¾¹å†²èŠ‚ç‚¹t1æŒ‡å‘t2ã€‚ row2è®°å½•çš„æƒ…å†µåŒç†ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%98%BB%E5%A1%9E%E4%B8%8E%E6%AD%BB%E9%94%81%20wait-%20for%20graph%EF%BC%88%E5%9B%BE%E5%85%AB%EF%BC%89.png" alt="image-20230816001239711"></p><p>â€‹wait-for graph</p><p>è§‚å¯Ÿå‘ç°ï¼Œt1 å’Œ t2 å­˜åœ¨å›è·¯ï¼Œå› æ­¤å­˜åœ¨æ­»é”ã€‚</p><blockquote><p>é˜…è¯»åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æ„è¯†åˆ°å› ä¸ºMySQLæ•°æ®åº“æ˜¯ä¸€ä¸ªå¹¶å‘çš„ç¨‹åºï¼Œæ‰€ä»¥æ‰å­˜åœ¨æ­»é”ã€‚å› ä¸ºå¦‚æœç¨‹åºæ˜¯ä¸²è¡Œçš„ï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸ä¼šå‘ç”Ÿæ­»é”äº†ã€‚</p></blockquote><p>æ­»é”ç¤ºä¾‹ï¼š</p><p>æœ‰ä¸¤ä¸ªäº‹åŠ¡Aï¼ŒBï¼š äº‹åŠ¡Aå½“å‰è¯»æŸ¥è¯¢è®°å½•ID:5 ,äº‹åŠ¡Bå½“å‰è¯»æŸ¥è¯¢ID:6ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/%E6%AD%BB%E9%94%81%E7%A4%BA%E4%BE%8B%EF%BC%881%EF%BC%89.png" alt="image-20230816002539299"></p><p>æ¥ç€äº¤æ¢ä¸€ä¸‹ï¼š</p><p>äº‹åŠ¡Aå½“å‰è¯»æŸ¥è¯¢è®°å½•ID:6 ,äº‹åŠ¡Bå½“å‰è¯»æŸ¥è¯¢ID:5</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/%E6%AD%BB%E9%94%81%E7%A4%BA%E4%BE%8B%EF%BC%882%EF%BC%89.png" alt="image-20230816003007483"></p><p>ä¼šå‘ç°ä¸¤ä¸ªäº‹åŠ¡ä¸­çš„äº‹åŠ¡Bç«‹é©¬å°±æŠ¥é”™ï¼š<code>ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction</code></p><p><strong>é€šå¸¸æ¥è¯´InnoDBå­˜å‚¨å¼•æ“é€‰æ‹©å›æ»šundoé‡æœ€å°çš„äº‹åŠ¡ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> MySQL æ·±å…¥å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLä¸­çš„é”æœºåˆ¶</title>
      <link href="/2024/11/17/MySQL%E4%B8%AD%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/"/>
      <url>/2024/11/17/MySQL%E4%B8%AD%E7%9A%84%E9%94%81%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQLä¸­çš„é”æœºåˆ¶"><a href="#MySQLä¸­çš„é”æœºåˆ¶" class="headerlink" title="MySQLä¸­çš„é”æœºåˆ¶"></a>MySQLä¸­çš„é”æœºåˆ¶</h1><blockquote><p>æŠ›ç –å¼•ç‰ï¼šå¤šä¸ªæŸ¥è¯¢éœ€è¦åœ¨åŒä¸€æ—¶åˆ»è¿›è¡Œæ•°æ®çš„ä¿®æ”¹ï¼Œå°±ä¼šäº§ç”Ÿå¹¶å‘æ§åˆ¶çš„é—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦å¦‚ä½•é¿å…å†™ä¸ªé—®é¢˜ä»è€Œä¿è¯æˆ‘ä»¬çš„æ•°æ®åº“æ•°æ®ä¸ä¼šè¢«ç ´åã€‚</p></blockquote><h2 id="é”çš„æ¦‚å¿µ"><a href="#é”çš„æ¦‚å¿µ" class="headerlink" title="é”çš„æ¦‚å¿µ"></a>é”çš„æ¦‚å¿µ</h2><p>è¯»é”æ˜¯å…±äº«çš„äº’ç›¸ä¸é˜»å¡çš„ã€‚å¤šä¸ªäº‹åŠ¡åœ¨å¬ä¸€æ—¶åˆ»å¯ä»¥åŒæ—¶è¯»å–åŒä¸€èµ„æºï¼Œè€Œç›¸äº’ä¸å¹²æ‰°ã€‚</p><p>å†™é”çš„æ’ä»–çš„ã€‚ä¸€ä¸ªå†™é”ä¼šé˜»å¡å…¶ä»–å†™é”æˆ–è¯»é”ã€‚å‡ºäºå®‰å…¨è€ƒè™‘åªæœ‰è¿™æ ·æ‰èƒ½ä¿è¯åœ¨ç»™å®šçš„æ—¶é—´é‡Œåªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½å¤Ÿæ‰§è¡Œå†™å…¥ï¼Œå¹¶é˜²æ­¢å…¶ä»–äº‹åŠ¡è¯»å–æ­£å†™å…¥çš„åŒä¸€èµ„æºã€‚</p><h2 id="é”å¸¦æ¥çš„é—®é¢˜"><a href="#é”å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="é”å¸¦æ¥çš„é—®é¢˜"></a>é”å¸¦æ¥çš„é—®é¢˜</h2><p>é€šè¿‡é”å®šæœºåˆ¶å¯ä»¥å®ç°äº‹åŠ¡çš„éš”ç¦»æ€§è¦æ±‚ï¼Œä½¿å¾—äº‹åŠ¡å¯ä»¥å¹¶å‘çš„å·¥ä½œï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸‰ä¸ªé—®é¢˜ï¼šè„è¯»ï¼Œä¸å¯é‡å¤è¯»å’Œä¸¢å¤±æ›´æ–°ã€‚</p><h3 id="è„è¯»"><a href="#è„è¯»" class="headerlink" title="è„è¯»"></a>è„è¯»</h3><blockquote><p>è„æ•°æ®ï¼šæœªæäº¤çš„æ•°æ®</p></blockquote><p>å¦‚æœè¯»åˆ°äº†è„æ•°æ®å³ä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–åˆ°å¦ä¸€ä¸ªäº‹åŠ¡ä¸­æœªæäº¤çš„æ•°æ®é‚£å°±è¿èƒŒäº†äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚</p><p>æ‰€ä»¥è„è¯»æ˜¯æŒ‡åœ¨ä¸åŒçš„äº‹åŠ¡ä¸‹ï¼Œå½“å‰äº‹åŠ¡å¯ä»¥è¯»å–åˆ°å¦å¤–äº‹åŠ¡çš„æœªæäº¤çš„æ•°æ®ï¼Œç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥è¯»å–åˆ°è„æ•°æ®ã€‚</p><p>æ¼”ç¤ºï¼š</p><p>åˆå§‹çŠ¶æ€ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%94%81%E6%9C%BA%E5%88%B6(%E5%9B%BE1).png" alt="image-20230813233401790"></p><p>å°†ä¼šè¯Aï¼ŒBè®¾ç½®éš”ç¦»çº§åˆ«ä¸ºRU</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> session transaction isolation level READ UNCOMMITTED;</span><br></pre></td></tr></table></figure><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%94%81%E6%9C%BA%E5%88%B6(%E5%9B%BE2).png" alt="image-20230813235156382"></p><p>ä¼šè¯Aæ’å…¥ä¸€æ¡æ•°æ®</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%94%81%E6%9C%BA%E5%88%B6(%E5%9B%BE3).png" alt="image-20230814000655870"></p><p>è¿™æ—¶å€™äº‹åŠ¡Båœ¨æ­¤æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä¼šå‘ç°äº‹åŠ¡Bè¯»å–åˆ°äº†äº‹åŠ¡Aæ–°å¢çš„æ•°æ®ã€‚æ³¨æ„ï¼šæ­¤æ—¶äº‹åŠ¡Aæ²¡æœ‰æäº¤ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%94%81%E6%9C%BA%E5%88%B6(%E5%9B%BE4).png" alt="image-20230814000932266"></p><h3 id="ä¸å¯é‡å¤è¯»"><a href="#ä¸å¯é‡å¤è¯»" class="headerlink" title="ä¸å¯é‡å¤è¯»"></a>ä¸å¯é‡å¤è¯»</h3><p>åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ä¸¤æ¬¡è¯»å–åˆ°çš„æ•°æ®æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™ä¸­æƒ…å†µè¢«ç§°ä¸ºä¸å¯é‡å¤è¯»ã€‚</p><p>ä¸è„è¯»çš„åŒºåˆ«ï¼šè„è¯»æ˜¯è¯»å–åˆ°äº†æœªæäº¤çš„æ•°æ®ï¼Œè€Œä¸å¯é‡å¤è¯»æ˜¯è¯»å–åˆ°çš„å´æ˜¯å·²ç»æäº¤çš„æ•°æ®ï¼Œä½†æ˜¯è¿åäº†æ•°æ®åº“äº‹åŠ¡ä¸€è‡´æ€§çš„è¦æ±‚ã€‚</p><p>æ¼”ç¤ºï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%94%81%E6%9C%BA%E5%88%B6(%E5%9B%BE5).png" alt="image-20230814002516720"></p><p>äº‹åŠ¡Bæ’å…¥ä¸€æ¡æ•°æ®å¹¶ä¸”æäº¤</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%94%81%E6%9C%BA%E5%88%B6(%E5%9B%BE6).png" alt="image-20230814002726465"></p><p>äº‹åŠ¡Aåœ¨æ­¤æ‰§è¡Œselectè¯­å¥,äº‹åŠ¡Aè¯»å–åˆ°äº†äº‹åŠ¡Bæäº¤çš„æ•°æ®</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E9%94%81%E6%9C%BA%E5%88%B6(%E5%9B%BE7).png" alt="image-20230814002910671"></p><p>ä¸€èˆ¬æ¥è¯´ä¸å¯é‡å¤è¯»é—®é¢˜æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºè¯»å–åˆ°çš„æ˜¯å·²ç»æäº¤çš„æ•°æ®ï¼Œæœ¬èº«ä¸ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ã€‚ä¾‹å¦‚Oracle å’Œ SQL Serverçš„é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å°±æ˜¯RCã€‚ MySQLé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯RRã€‚</p><p><strong>åœ¨MySQL InnoDBä¸­é€šè¿‡ä½¿ç”¨ Next-key lock ç®—æ³•æ¥é¿å…ä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œå¹¶ä¸”å°†ä¸å¯é‡å¤è¯»é—®é¢˜å®šä¹‰ä¸ºå¹»è¯»ï¼ˆPhantom problemï¼‰</strong></p><h3 id="ä¸¢å¤±æ›´æ–°"><a href="#ä¸¢å¤±æ›´æ–°" class="headerlink" title="ä¸¢å¤±æ›´æ–°"></a>ä¸¢å¤±æ›´æ–°</h3><p>ä¸€ä¸ªæ•°æ®çš„æ›´æ–°ä¼šè¢«å¦ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°æ“ä½œæ‰€è¦†ç›–ï¼Œä»è€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</p><p>ç¬¬ä¸€ç§ä¸¢å¤±ï¼š</p><p>Aäº‹åŠ¡æ’¤é”€æ—¶ï¼ŒæŠŠå·²ç»æäº¤çš„Bäº‹åŠ¡çš„æ›´æ–°æ•°æ®è¦†ç›–äº†ã€‚è¿™ç§é”™è¯¯å¯èƒ½é€ æˆå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œé€šè¿‡ä¸‹é¢çš„è´¦æˆ·å–æ¬¾è½¬è´¦å°±å¯ä»¥çœ‹å‡ºæ¥ï¼š</p><table><thead><tr><th>æ—¶é—´</th><th>å–æ¬¾äº‹åŠ¡A</th><th>è½¬è´¦äº‹åŠ¡B</th></tr></thead><tbody><tr><td>T1</td><td><strong>å¼€å§‹äº‹åŠ¡</strong></td><td></td></tr><tr><td>T2</td><td></td><td><strong>å¼€å§‹äº‹åŠ¡</strong></td></tr><tr><td>T3</td><td>æŸ¥è¯¢è´¦æˆ·ä½™é¢ä¸º1000å…ƒ</td><td></td></tr><tr><td>T4</td><td></td><td>æŸ¥è¯¢è´¦æˆ·ä½™é¢ä¸º1000å…ƒ</td></tr><tr><td>T5</td><td></td><td>æ±‡å…¥100å…ƒæŠŠä½™é¢æ”¹ä¸º1100å…ƒ</td></tr><tr><td>T6</td><td></td><td><strong>æäº¤äº‹åŠ¡</strong></td></tr><tr><td>T7</td><td>å–å‡º100å…ƒæŠŠä½™é¢æ”¹ä¸º900å…ƒ</td><td></td></tr><tr><td>T8</td><td><strong>æ’¤é”€äº‹åŠ¡</strong></td><td></td></tr><tr><td>T9</td><td><strong>ä½™é¢æ¢å¤ä¸º1000</strong> <strong>å…ƒï¼ˆä¸¢å¤±æ›´æ–°ï¼‰</strong></td><td></td></tr></tbody></table><p>ç¬¬äºŒç±»ä¸¢å¤±æ›´æ–°</p><p>Aäº‹åŠ¡è¦†ç›–Bäº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œé€ æˆBäº‹åŠ¡æ‰€åšæ“ä½œä¸¢å¤±ï¼š</p><table><thead><tr><th>æ—¶é—´</th><th>è½¬è´¦äº‹åŠ¡A</th><th>å–æ¬¾äº‹åŠ¡B</th></tr></thead><tbody><tr><td>T1</td><td></td><td><strong>å¼€å§‹äº‹åŠ¡</strong></td></tr><tr><td>T2</td><td><strong>å¼€å§‹äº‹åŠ¡</strong></td><td></td></tr><tr><td>T3</td><td></td><td>æŸ¥è¯¢è´¦æˆ·ä½™é¢ä¸º1000å…ƒ</td></tr><tr><td>T4</td><td>æŸ¥è¯¢è´¦æˆ·ä½™é¢ä¸º1000å…ƒ</td><td></td></tr><tr><td>T5</td><td></td><td>å–å‡º100å…ƒæŠŠä½™é¢æ”¹ä¸º900å…ƒ</td></tr><tr><td>T6</td><td></td><td><strong>æäº¤äº‹åŠ¡</strong></td></tr><tr><td>T7</td><td>æ±‡å…¥100å…ƒ</td><td></td></tr><tr><td>T8</td><td><strong>æäº¤äº‹åŠ¡</strong></td><td></td></tr><tr><td>T9</td><td><strong>æŠŠä½™é¢æ”¹ä¸º1100</strong> <strong>å…ƒï¼ˆä¸¢å¤±æ›´æ–°ï¼‰</strong></td><td></td></tr></tbody></table><p>è¦é¿å…ä¸¢å¤±æ›´æ–°çš„å‘ç”Ÿï¼Œéœ€è¦è®©äº‹åŠ¡åœ¨è¿™ç§æƒ…å†µçš„æ“ä½œå˜æˆä¸²è¡ŒåŒ–ï¼Œè€Œä¸æ˜¯å¹¶è¡Œæ“ä½œã€‚å³ä¸Šé¢çš„selectæ“ä½œä¸­åŠ ä¸Šæ’ä»–é”ã€‚</p><h2 id="MySQLé”çš„åˆ†ç±»ï¼š"><a href="#MySQLé”çš„åˆ†ç±»ï¼š" class="headerlink" title="MySQLé”çš„åˆ†ç±»ï¼š"></a>MySQLé”çš„åˆ†ç±»ï¼š</h2><h3 id="æŒ‰ç…§é”çš„ç²’åº¦æ¥è¯´"><a href="#æŒ‰ç…§é”çš„ç²’åº¦æ¥è¯´" class="headerlink" title="æŒ‰ç…§é”çš„ç²’åº¦æ¥è¯´"></a>æŒ‰ç…§é”çš„ç²’åº¦æ¥è¯´</h3><p>MySQLä¸»è¦åŒ…å«ä¸‰ç§ç±»å‹ï¼ˆçº§åˆ«ï¼‰çš„é”å®šæœºåˆ¶ï¼š</p><p>å…¨å±€é”ï¼šé”çš„æ˜¯æ•´ä¸ªdatabaseã€‚</p><p>è¡¨çº§é”ï¼šé”çš„æ˜¯æŸä¸ªtableã€‚ (è¡¨æ’ä»–é”ï¼Œè¡¨å…±äº«é”ï¼Œå…ƒæ•°æ®é”ï¼Œè‡ªå¢é”)</p><p>è¡Œçº§é”ï¼šé”çš„æ˜¯æŸè¡Œæ•°æ®ï¼Œä¹Ÿå¯èƒ½é”å®šè¡Œä¹‹é—´çš„é—´éš™ã€‚ç”±æŸäº›å­˜å‚¨å¼•æ“å®ç°ï¼Œæ¯”å¦‚InnoDBã€‚</p><h3 id="InnoDBçš„è¡Œçº§é”ï¼ŒæŒ‰ç…§é”å®šèŒƒå›´æ¥è¯´"><a href="#InnoDBçš„è¡Œçº§é”ï¼ŒæŒ‰ç…§é”å®šèŒƒå›´æ¥è¯´" class="headerlink" title="InnoDBçš„è¡Œçº§é”ï¼ŒæŒ‰ç…§é”å®šèŒƒå›´æ¥è¯´"></a>InnoDBçš„è¡Œçº§é”ï¼ŒæŒ‰ç…§é”å®šèŒƒå›´æ¥è¯´</h3><p>åˆ†ä¸ºå››ç§ï¼š</p><p>1.è®°å½•é”ï¼ˆRecord Locksï¼‰:é”å®šç´¢å¼•ä¸­ä¸€æ¡è®°å½•ã€‚</p><p>2.é—´éš™é”ï¼ˆGap Locksï¼‰:è¦ä¹ˆé”ä½ç´¢å¼•è®°å½•ä¸­é—´çš„å€¼ï¼Œè¦ä¹ˆé”ä½ç¬¬ä¸€ä¸ªç´¢å¼•è®°å½•å‰é¢çš„å€¼æˆ–è€…æœ€åä¸€ä¸ªç´¢</p><p>å¼•è®°å½•åé¢çš„å€¼ã€‚</p><p>3.ä¸´é”®é”ï¼ˆNext-Key Locksï¼‰:æ˜¯ç´¢å¼•è®°å½•ä¸Šçš„è®°å½•é”å’Œåœ¨ç´¢å¼•è®°å½•ä¹‹å‰çš„é—´éš™é”çš„ç»„åˆï¼ˆé—´éš™é”+è®°å½•</p><p>é”ï¼‰ã€‚</p><p>4.æ’å…¥æ„å‘é”(Insert Intention Locks)ï¼šåšinsertæ“ä½œæ—¶æ·»åŠ çš„å¯¹è®°å½•idçš„é”ã€‚</p><h3 id="InnoDBçš„è¡Œçº§é”ï¼ŒæŒ‰ç…§åŠŸèƒ½æ¥è¯´"><a href="#InnoDBçš„è¡Œçº§é”ï¼ŒæŒ‰ç…§åŠŸèƒ½æ¥è¯´" class="headerlink" title="InnoDBçš„è¡Œçº§é”ï¼ŒæŒ‰ç…§åŠŸèƒ½æ¥è¯´"></a>InnoDBçš„è¡Œçº§é”ï¼ŒæŒ‰ç…§åŠŸèƒ½æ¥è¯´</h3><p>åˆ†ä¸ºä¸¤ç§ï¼š</p><p>1.å…±äº«é”ï¼ˆSï¼‰ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡å»è¯»ä¸€è¡Œï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’ä»–é”ã€‚</p><p>2.æ’ä»–é”ï¼ˆXï¼‰ï¼šå…è®¸è·å¾—æ’ä»–é”çš„äº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡å–å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«è¯»é”å’Œæ’ä»–å†™é”ã€‚</p><p>InnoDBè¡Œé”æ˜¯é€šè¿‡ç»™ç´¢å¼•ä¸Šçš„ç´¢å¼•é¡¹åŠ é”æ¥å®ç°çš„ï¼Œå› æ­¤InnoDBè¿™ç§è¡Œé”å®ç°ç‰¹ç‚¹æ„å‘³ç€ï¼šåªæœ‰é€šè¿‡</p><p>ç´¢å¼•æ¡ä»¶æ£€ç´¢çš„æ•°æ®ï¼ŒInnoDBæ‰ä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ï¼ŒInnoDBå°†ä½¿ç”¨è¡¨é”ï¼</p><blockquote><p>æ³¨æ„ï¼šæ’å…¥æ„å‘é”</p><p>ï¼ˆ1ï¼‰æ’å…¥æ„å‘é”æ˜¯ä¸€ç§Gapé”ï¼Œä¸æ˜¯æ„å‘é”ï¼Œåœ¨insertæ“ä½œæ—¶äº§ç”Ÿã€‚</p><p>ï¼ˆ2ï¼‰åœ¨å¤šäº‹åŠ¡åŒæ—¶å†™å…¥ä¸åŒæ•°æ®è‡³åŒä¸€ç´¢å¼•é—´éš™çš„æ—¶å€™ï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…å…¶ä»–äº‹åŠ¡å®Œæˆï¼Œä¸ä¼šå‘ç”Ÿé”ç­‰ å¾…ã€‚</p><p>ï¼ˆ3ï¼‰å‡è®¾æœ‰ä¸€ä¸ªè®°å½•ç´¢å¼•åŒ…å«é”®å€¼4å’Œ7ï¼Œä¸åŒçš„äº‹åŠ¡åˆ†åˆ«æ’å…¥5å’Œ6ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªåŠ åœ¨4-7ä¹‹ é—´çš„æ’å…¥æ„å‘é”ï¼Œè·å–åœ¨æ’å…¥è¡Œä¸Šçš„æ’å®ƒé”ï¼Œä½†æ˜¯ä¸ä¼šè¢«äº’ç›¸é”ä½ï¼Œå› ä¸ºæ•°æ®è¡Œå¹¶ä¸å†²çªã€‚</p><p>ï¼ˆ4ï¼‰æ’å…¥æ„å‘é”ä¸ä¼šé˜»æ­¢ä»»ä½•é”ï¼Œå¯¹äºæ’å…¥çš„è®°å½•ä¼šæŒæœ‰ä¸€ä¸ªè®°å½•é”ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> MySQL æ·±å…¥å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MYSQLå¹»è¯»é—®é¢˜</title>
      <link href="/2024/11/17/MYSQL%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98/"/>
      <url>/2024/11/17/MYSQL%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="MYSQLå¹»è¯»é—®é¢˜"><a href="#MYSQLå¹»è¯»é—®é¢˜" class="headerlink" title="MYSQLå¹»è¯»é—®é¢˜"></a>MYSQLå¹»è¯»é—®é¢˜</h1><h2 id="å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¹»è¯»æ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote><p> â€œPhantom Problemæ˜¯æŒ‡åœ¨åŒä¸€äº‹åŠ¡ä¸‹ï¼Œè¿ç»­æ‰§è¡Œä¸¤æ¬¡åŒæ ·çš„SQLè¯­å¥å¯èƒ½å¯¼è‡´ä¸åŒçš„ç»“æœï¼Œç¬¬äºŒæ¬¡çš„SQLè¯­å¥å¯èƒ½ä¼šè¿”å›ä¹‹å‰ä¸å­˜åœ¨çš„è¡Œã€‚â€æ‘˜å½•æ¥è‡ª MySQLæŠ€æœ¯å†…å¹•ï¼šInnoDBå­˜å‚¨å¼•æ“(ç¬¬2ç‰ˆ) (æ•°æ®åº“æŠ€æœ¯ä¸›ä¹¦)</p></blockquote><p>â€‹ é€šä¿—æ¥è¯´å°±æ˜¯ï¼Œtime1:äº‹åŠ¡Aè¯»å–æŸä¸ªèŒƒå›´ï¼Œtime2:äº‹åŠ¡Båœ¨è¿™ä¸ªèŒƒå›´ä¸­æ’å…¥äº†ä¸€æ¡æ–°è®°å½•å¹¶æäº¤äº‹åŠ¡ï¼Œtime3:äº‹åŠ¡Aå†æ¬¡è¯»å–è¯¥èŒƒå›´çš„è®°å½•æ—¶è¯»å–åˆ°äº‹åŠ¡Bæ–°å¢çš„è®°å½•ã€‚</p><p>å¦‚ä¸‹ï¼š</p><p>ç›®å‰InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œæ•°æ®åº“æœ‰è¡¨å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for film</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `film`;</span><br><span class="line">CREATE TABLE `film` (</span><br><span class="line">  `id` int NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(10) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb3;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of film</span><br><span class="line">-- ----------------------------</span><br><span class="line">BEGIN;</span><br><span class="line">INSERT INTO `film` (`id`, `name`) VALUES (1, &#x27;film1&#x27;);</span><br><span class="line">INSERT INTO `film` (`id`, `name`) VALUES (2, &#x27;film2&#x27;);</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure><p>Time1: å¼€å¯äº‹åŠ¡A ï¼Œ æŸ¥è¯¢è¡¨filmä¸­çš„æ‰€æœ‰è®°å½•ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/mysql%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98_%E5%9B%BE%E4%B8%80.png" alt="image-20230813021444925"></p><p>Time2:åœ¨filmè¡¨ä¸­æ’å…¥ä¸€æ¡ID ä¸º 3çš„è®°å½•</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/MySQL%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98_%E5%9B%BE%E4%BA%8C.png" alt="image-20230813022134189"></p><p>Time3:  äº‹åŠ¡AæŸ¥è¯¢è¡¨filmä¸­æ‰€æœ‰çš„æ•°æ®ï¼›æ³¨æ„è¿™æ—¶selectå‡ºçš„è®°å½•ä¸­æ˜¯æ²¡æœ‰IDä¸º3çš„è®°å½•ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/MySQL%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98_%E5%9B%BE%E4%B8%89.png"></p><p>ä½†æ˜¯æˆ‘ä»¬ä¼šå‘ç°update ID ä¸º3çš„è®°å½•æ˜¯æˆåŠŸçš„ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡Aæ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°äº‹åŠ¡Bæ–°å¢çš„IDä¸º3çš„è®°å½•ã€‚</p><p><img src="/./MYSQL%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98.assets/MySQL%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98_%E5%9B%BE%E5%9B%9B.png" alt="image-20230813023334007"></p><p>è¿™æ—¶å†å»è¯»åŒºæ•°æ®å‘ç°æ˜¯å¯ä»¥è¯»å–åˆ°çš„</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/MySQL%E5%B9%BB%E8%AF%BB%E9%97%AE%E9%A2%98_%E5%9B%BE%E5%9B%9B.png" alt="image-20230813023520771"></p><p>è¿™å°±æ˜¯å¹»è¯»é—®é¢˜ã€‚</p><h2 id="å¦‚ä½•é¿å…å¹»è¯»é—®é¢˜ï¼Ÿ"><a href="#å¦‚ä½•é¿å…å¹»è¯»é—®é¢˜ï¼Ÿ" class="headerlink" title="å¦‚ä½•é¿å…å¹»è¯»é—®é¢˜ï¼Ÿ"></a>å¦‚ä½•é¿å…å¹»è¯»é—®é¢˜ï¼Ÿ</h2><p>åœ¨RRçº§åˆ«ä¸‹ï¼Œé‡‡ç”¨Next-Key Lockingçš„ç®—æ³•é¿å…å¹»è¯»é—®é¢˜ï¼Œå³ä½¿ç”¨FOR UPDATEã€‚</p><blockquote><p>SELECT * FROM film  FOR UPDATE;</p></blockquote><p>å¯¹äºä¸Šé¢çš„SQLè¯­å¥ï¼Œä¼šå°†ï¼ˆ-âˆï¼Œ+âˆï¼‰è¿™ä¸ªèŒƒå›´åŠ é”ï¼Œå› æ­¤åœ¨è¿™ä¸ªèŒƒå›´å†…çš„æ’å…¥éƒ½æ˜¯ä¸å…è®¸çš„ï¼Œä»è€Œé¿å…å¹»è¯»ã€‚å½“ç„¶å¦‚æœæ˜¯id &gt; 2 èŒƒå›´æŸ¥æ‰¾é‚£ä¹ˆé”ä½çš„ä¹Ÿå°±æ˜¯(2,+âˆ)ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MySQL æ·±å…¥å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¹¶å‘ç¼–ç¨‹ï¼ˆä¸€ï¼‰</title>
      <link href="/2024/11/17/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2024/11/17/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-å¹¶å‘ç¼–ç¨‹ï¼ˆä¸€ï¼‰"><a href="#Java-å¹¶å‘ç¼–ç¨‹ï¼ˆä¸€ï¼‰" class="headerlink" title="Java å¹¶å‘ç¼–ç¨‹ï¼ˆä¸€ï¼‰"></a>Java å¹¶å‘ç¼–ç¨‹ï¼ˆä¸€ï¼‰</h1><h2 id="1ã€ç›¸å…³æ¦‚å¿µ"><a href="#1ã€ç›¸å…³æ¦‚å¿µ" class="headerlink" title="1ã€ç›¸å…³æ¦‚å¿µ"></a>1ã€ç›¸å…³æ¦‚å¿µ</h2><h3 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h3><p>è¿›ç¨‹ï¼šè¿›ç¨‹æŒ‡æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œè¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ã€ç§æœ‰çš„åŸºæœ¬è¿è¡Œèµ„æºé›†åˆã€‚é€šå¸¸ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„å†…å­˜ç©ºé—´ã€‚</p><p>çº¿ç¨‹ï¼šæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§çš„è¿›ç¨‹ã€‚è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æä¾›äº†ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œä½†åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¯”åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹éœ€è¦çš„èµ„æºè¦å°‘ã€‚</p><blockquote><p>Java å¹¶å‘ç¼–ç¨‹ä¹‹ç¾ä¸­å¦‚ä¸‹æè¿°è¿›ç¨‹ä¸çº¿ç¨‹ï¼š</p><p>è¿›ç¨‹æ˜¯ä»£ç åœ¨æ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹åˆ™æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œè·¯å¾„ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºã€‚</p></blockquote><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411161529037.png" alt="image-20241116152919659"></p><p>å½“å¯åŠ¨mainå‡½æ•°çš„æ—¶å€™å…¶å®å°±æ˜¯å¯åŠ¨äº†ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œè€Œmainå‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹å°±æ˜¯è¿™ä¸ªè¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹æ˜¯ä¸»çº¿ç¨‹ã€‚</p><p>å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„å †å’Œæ–¹æ³•åŒºèµ„æºï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨å’Œæ ˆåŒºåŸŸã€‚</p><h3 id="å¹¶å‘å’Œå¹¶è¡Œ"><a href="#å¹¶å‘å’Œå¹¶è¡Œ" class="headerlink" title="å¹¶å‘å’Œå¹¶è¡Œ"></a>å¹¶å‘å’Œå¹¶è¡Œ</h3><blockquote><p>æ³¨æ„ä¸ç®¡æ˜¯å¹¶å‘è¿˜æ˜¯å¹¶è¡Œéƒ½æ˜¯ä»¥æ±‚æœ€å¤§åŒ–CUPçš„ä½¿ç”¨ç‡ã€‚</p></blockquote><p><strong>å¹¶è¡Œ(parallel)<strong>ï¼š</strong>æŒ‡åœ¨åŒä¸€æ—¶åˆ»ï¼Œæœ‰å¤šæ¡æŒ‡ä»¤åœ¨å¤šä¸ªå¤„ç†å™¨ä¸ŠåŒæ—¶æ‰§è¡Œ</strong>ã€‚æ‰€ä»¥æ— è®ºä»å¾®è§‚è¿˜æ˜¯ä»å®è§‚æ¥çœ‹ï¼ŒäºŒè€…éƒ½æ˜¯ä¸€èµ·æ‰§è¡Œçš„ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411161457201.png" alt="image-20241116145727100"></p><p>**å¹¶å‘(concurrency)**ï¼šæŒ‡åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œï¼Œä½†å¤šä¸ªè¿›ç¨‹æŒ‡ä»¤è¢«å¿«é€Ÿçš„è½®æ¢æ‰§è¡Œï¼Œä½¿å¾—åœ¨å®è§‚ä¸Šå…·æœ‰å¤šä¸ªè¿›ç¨‹åŒæ—¶æ‰§è¡Œçš„æ•ˆæœï¼Œä½†åœ¨å¾®è§‚ä¸Šå¹¶ä¸æ˜¯åŒæ—¶æ‰§è¡Œçš„ï¼Œåªæ˜¯æŠŠæ—¶é—´åˆ†æˆè‹¥å¹²æ®µï¼Œä½¿å¤šä¸ªè¿›ç¨‹å¿«é€Ÿäº¤æ›¿çš„æ‰§è¡Œã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202411161510634.png" alt="image-20241116151017272"></p><h2 id="2ã€çº¿ç¨‹çš„åˆ›å»º"><a href="#2ã€çº¿ç¨‹çš„åˆ›å»º" class="headerlink" title="2ã€çº¿ç¨‹çš„åˆ›å»º"></a>2ã€çº¿ç¨‹çš„åˆ›å»º</h2><h4 id="æ–¹å¼1ï¼šä½¿ç”¨-Threadç±»æˆ–ç»§æ‰¿Threadç±»"><a href="#æ–¹å¼1ï¼šä½¿ç”¨-Threadç±»æˆ–ç»§æ‰¿Threadç±»" class="headerlink" title="æ–¹å¼1ï¼šä½¿ç”¨ Threadç±»æˆ–ç»§æ‰¿Threadç±»"></a><strong>æ–¹å¼1ï¼šä½¿ç”¨ Threadç±»æˆ–ç»§æ‰¿Threadç±»</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºçº¿ç¨‹å¯¹è±¡ </span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123; </span><br><span class="line">   <span class="comment">// è¦æ‰§è¡Œçš„ä»»åŠ¡ </span></span><br><span class="line">  &#125; &#125;;</span><br><span class="line"><span class="comment">// å¯åŠ¨çº¿ç¨‹ </span></span><br><span class="line">t.start();</span><br><span class="line"></span><br><span class="line">æˆ–</span><br><span class="line">  </span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; System.out.println(Thread.currentThread().getName())).start(); </span><br><span class="line"></span><br><span class="line">æˆ–</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello from a thread!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloThread</span>();</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šè°ƒç”¨start()æ–¹æ³•åçº¿ç¨‹æ²¡æœ‰ç«‹é©¬æ‰§è¡Œï¼Œè€Œæ˜¯å¤„äºå°±ç»ªçŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€æ˜¯æŒ‡è¯¥çº¿ç¨‹å·²ç»è·å¾—äº†é™¤CPUèµ„æºå¤–çš„å…¶ä»–èµ„æºï¼Œç­‰å¾…è·å–cpuèµ„æºæ‰ä¼šæ­£çœŸå¤„äºè¿è¡ŒçŠ¶æ€ã€‚ä¸€æ—¦run()æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œè¯¥çº¿ç¨‹å°±å¤„äºç»ˆæ­¢çŠ¶æ€ã€‚</p><p>åŒºåˆ«ï¼š</p><p>ä½¿ç”¨ç»§æ‰¿çš„å¥½å¤„æ˜¯ï¼šåœ¨run()æ–¹æ³•å†…è·å–å½“å‰çº¿ç¨‹ç›´æ¥ä½¿ç”¨thiså°±å¯ä»¥äº†ï¼Œæ— éœ€ä½¿ç”¨Thread.currentThread()æ–¹æ³•ã€‚ä¸å¥½çš„åœ°æ–¹æ˜¯Javaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œå¦‚æœç»§æ‰¿äº†Threadç±»ï¼Œé‚£ä¹ˆä¹…ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ã€‚</p><p>å­˜åœ¨é—®é¢˜ï¼š</p><p>ä»»åŠ¡ä¸ä»£ç æ²¡æœ‰åˆ†ç¦»ï¼Œå½“å¤šä¸ªçº¿ç¨‹æ‰§è¡Œä¸€æ ·çš„ä»»åŠ¡ä»£ç æ—¶éœ€è¦å¤šåˆ†ä»»åŠ¡ä»£ç ã€‚</p></blockquote><h4 id="æ–¹å¼2ï¼šå®ç°-Runnable-æ¥å£é…åˆThread"><a href="#æ–¹å¼2ï¼šå®ç°-Runnable-æ¥å£é…åˆThread" class="headerlink" title="æ–¹å¼2ï¼šå®ç° Runnable æ¥å£é…åˆThread"></a><strong>æ–¹å¼2ï¼šå®ç° Runnable æ¥å£é…åˆThread</strong></h4><p>æŠŠã€çº¿ç¨‹ã€‘å’Œã€ä»»åŠ¡ã€‘ï¼ˆè¦æ‰§è¡Œçš„ä»£ç ï¼‰åˆ†å¼€</p><ul><li>Thread ä»£è¡¨çº¿ç¨‹</li><li>Runnable å¯è¿è¡Œçš„ä»»åŠ¡ï¼ˆçº¿ç¨‹è¦æ‰§è¡Œçš„ä»£ç ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123; </span><br><span class="line">    <span class="comment">// è¦æ‰§è¡Œçš„ä»»åŠ¡ </span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;; </span><br><span class="line"><span class="comment">// åˆ›å»ºçº¿ç¨‹å¯¹è±¡ </span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>( runnable ); <span class="comment">// å¯åŠ¨çº¿ç¨‹ </span></span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure><p><strong>å­˜åœ¨çš„é—®é¢˜ï¼š</strong></p><p><strong>Runnableæ²¡æœ‰è¿”å›å€¼ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼šéœ€è¦è‡ªå·±æ‰‹åŠ¨æŠ›å¼‚å¸¸</p><p>Callableå¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜</p><h4 id="æ–¹å¼3ï¼šä½¿ç”¨æœ‰è¿”å›å€¼çš„-Callable"><a href="#æ–¹å¼3ï¼šä½¿ç”¨æœ‰è¿”å›å€¼çš„-Callable" class="headerlink" title="æ–¹å¼3ï¼šä½¿ç”¨æœ‰è¿”å›å€¼çš„ Callable"></a><strong>æ–¹å¼3ï¼šä½¿ç”¨æœ‰è¿”å›å€¼çš„ Callable</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ç°Callableæ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CallableTask</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;callable come in ...&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// æ–¹å¼ä¸€</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºFutureTaskç±»ï¼Œæ¥å—MyThreadã€‚</span></span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">CallableTask</span>());</span><br><span class="line">        <span class="comment">//å°†FutureTaskå¯¹è±¡æ”¾åˆ°Threadç±»çš„æ„é€ å™¨é‡Œé¢ã€‚</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask, <span class="string">&quot;AA&quot;</span>).start();</span><br><span class="line">        <span class="type">int</span> <span class="variable">result01</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="comment">//ç”¨FutureTaskçš„getæ–¹æ³•å¾—åˆ°è¿”å›å€¼ã€‚</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result02</span> <span class="operator">=</span> futureTask.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;result=&quot;</span> + (result01 + result02));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–¹å¼äºŒ</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//æäº¤ä»»åŠ¡ï¼Œå¹¶ç”¨ Futureæäº¤è¿”å›ç»“æœ</span></span><br><span class="line">        Future&lt;Integer&gt; future = service.submit(<span class="keyword">new</span> <span class="title class_">CallableTask</span>());</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">result</span> <span class="operator">=</span> future.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;result=&quot;</span> +  result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>å°ç»“ï¼š</p><p>ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼æ˜¯æ–¹ä¾¿ä¼ æ‰¿ï¼Œä½ å¯ä»¥åœ¨ç±»é‡Œé¢æ·»åŠ æˆå‘˜å˜é‡ï¼Œé€šè¿‡setæ–¹æ³•è®¾ç½®å‚æ•°æˆ–é€šè¿‡æ„é€ å‡½æ•°è¿›è¡Œä¼ å‚ã€‚ä¸å¥½çš„åœ°æ–¹æ˜¯Javaä¸æ”¯æŒå¤šåŸºç¡€ï¼Œå¦‚æœç»§æ‰¿äº†Threadç±»ï¼Œé‚£ä¹ˆå­ç±»å°±ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»è€ŒRunnableåˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚</p><p>å¦‚æœä½¿ç”¨Runnableæ–¹å¼ï¼Œåˆ™åªèƒ½ä½¿ç”¨ä¸»çº¿ç¨‹é‡Œé¢è¢«å£°æ˜ä¸ºfinalçš„å˜é‡ã€‚</p><p>å‰ä¸¤ä¸ªæ–¹å¼éƒ½æ²¡æœ‰åŠæ³•æ‹¿åˆ°ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œä½†æ˜¯Callableæ–¹å¼å¯ä»¥</p></blockquote><h2 id="3ã€çº¿ç¨‹å¹¶å‘åŸºç¡€"><a href="#3ã€çº¿ç¨‹å¹¶å‘åŸºç¡€" class="headerlink" title="3ã€çº¿ç¨‹å¹¶å‘åŸºç¡€"></a>3ã€çº¿ç¨‹å¹¶å‘åŸºç¡€</h2><h4 id="3-1-wait-æ–¹æ³•"><a href="#3-1-wait-æ–¹æ³•" class="headerlink" title="3.1 wait() æ–¹æ³•"></a>3.1 wait() æ–¹æ³•</h4><p>å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªå…±äº«å˜é‡çš„wait()æ–¹æ³•æ—¶ï¼Œè¯¥è°ƒç”¨çº¿ç¨‹ä¼šè¢«<strong>é˜»å¡</strong>æŒ‚èµ·ï¼Œç›´åˆ°å‘ç°ä¸‹é¢å‡ ä¸ªäº‹æƒ…ä¹‹ä¸€æ‰è¿”å›ï¼š</p><p>ï¼ˆ1ï¼‰å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥å…±äº«å¯¹è±¡çš„notify()æˆ–è€…notifyAll()æ–¹æ³•ã€‚</p><p>ï¼ˆ2ï¼‰å…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥çº¿ç¨‹çš„interrupt()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹æŠ›å‡ºInterruptedExecptionå¼‚å¸¸è¿”å›</p><p>å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè°ƒç”¨wait()æ–¹æ³•çš„çº¿ç¨‹æ²¡æœ‰äº‹å…ˆè·å¾—è¯¥å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼Œåˆ™è°ƒç”¨wait()æ–¹æ³•æ—¶è°ƒç”¨çº¿ç¨‹ä¼šæŠ›å‡º&#x3D;&#x3D;IllegalMonitorStateException&#x3D;&#x3D;å¼‚å¸¸</p><p>ä¸€ä¸ªçº¿ç¨‹å¦‚ä½•è·å–ä¸€ä¸ªå…±äº«å˜é‡çš„ç›‘è§†å™¨é”ï¼Ÿ</p><p>1ã€æ‰§è¡ŒsynchronizedåŒæ­¥ä»£ç å—ï¼Œä½¿ç”¨è¯¥å…±äº«å˜é‡ä½œä¸ºå‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (å…±äº«å˜é‡) &#123;&#125;</span><br></pre></td></tr></table></figure><p>2ã€è°ƒç”¨è¯¥å…±äº«é”å˜é‡çš„æ–¹æ³•ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•ä½¿ç”¨äº†synchronizedä¿®é¥°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>&#123; </span><br><span class="line">  <span class="comment">//do someThing  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-wait-long-timeout"><a href="#3-2-wait-long-timeout" class="headerlink" title="3.2 wait(long timeout)"></a>3.2 wait(long timeout)</h4><p>â€‹å¦‚æœå°†timeoutè®¾ç½®ä¸º0åˆ™å’Œwaitæ–¹æ³•æ•ˆæœä¸€æ ·ï¼Œå› ä¸ºåœ¨waitæ–¹æ³•å†…éƒ¨å°±æ˜¯è°ƒç”¨äº†waitï¼ˆ0ï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåœ¨è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œä¼ é€’äº†ä¸€ä¸ªè´Ÿçš„timeoutåˆ™ä¼šæŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸</p><h4 id="3-3-notify-å‡½æ•°"><a href="#3-3-notify-å‡½æ•°" class="headerlink" title="3.3 notify() å‡½æ•°"></a>3.3 notify() å‡½æ•°</h4><p>â€‹ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å…±äº«å¯¹è±¡çš„notifyï¼ˆï¼‰æ–¹æ³•åï¼Œä¼šå”¤é†’ä¸€ä¸ªåœ¨è¯¥å…±äº«å˜é‡ä¸Šè°ƒç”¨waitç³»åˆ—æ–¹æ³•åè¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ä¸€ä¸ªå…±äº«å˜é‡ä¸Šå¯èƒ½ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…ï¼Œå…·ä½“å”¤é†’å“ªä¸ªç­‰å¾…çš„çº¿ç¨‹æ˜¯éšæœºçš„ã€‚</p><h4 id="3-4-notifyAll-å‡½æ•°"><a href="#3-4-notifyAll-å‡½æ•°" class="headerlink" title="3.4 notifyAll() å‡½æ•°"></a>3.4 notifyAll() å‡½æ•°</h4><p>â€‹ä¸åŒäºåœ¨å…±äº«å˜é‡ä¸Šè°ƒç”¨notifyï¼ˆï¼‰å‡½æ•°ä¼šå”¤é†’è¢«é˜»å¡åˆ°è¯¥å…±äº«å˜é‡ä¸Šçš„ä¸€ä¸ªçº¿ç¨‹ï¼ŒnotifyAllï¼ˆï¼‰æ–¹æ³•åˆ™ä¼šå”¤é†’æ‰€æœ‰åœ¨è¯¥å…±äº«å˜é‡ä¸Šç”±äºè°ƒç”¨waitç³»åˆ—æ–¹æ³•è€Œè¢«æŒ‚èµ·çš„çº¿ç¨‹</p><h4 id="3-5-ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»ˆæ­¢çš„joinæ–¹æ³•"><a href="#3-5-ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»ˆæ­¢çš„joinæ–¹æ³•" class="headerlink" title="3.5 ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»ˆæ­¢çš„joinæ–¹æ³•"></a>3.5 ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»ˆæ­¢çš„joinæ–¹æ³•</h4><p>â€‹ç­‰å¾…è°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹ç»“æŸä¹‹åï¼Œç¨‹åºå†ç»§ç»­æ‰§è¡Œï¼Œä¸€èˆ¬ç”¨äºç­‰å¾…å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œå®Œç»“æœä¹‹åæ‰èƒ½ç»§ç»­è¿è¡Œçš„åœºæ™¯ã€‚</p><h4 id="3-6-yieldæ–¹æ³•"><a href="#3-6-yieldæ–¹æ³•" class="headerlink" title="3.6 yieldæ–¹æ³•"></a>3.6 <strong>yieldæ–¹æ³•</strong></h4><ul><li>yieldä¼šé‡Šæ”¾CPUèµ„æºï¼Œè®©å½“å‰çº¿ç¨‹ä» Running è¿›å…¥ RunnableçŠ¶æ€ï¼Œè®©ä¼˜å…ˆçº§æ›´é«˜ï¼ˆè‡³å°‘æ˜¯ç›¸åŒï¼‰çš„çº¿ç¨‹è·å¾—æ‰§è¡Œæœºä¼šï¼Œä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼›</li><li>å‡è®¾å½“å‰è¿›ç¨‹åªæœ‰mainçº¿ç¨‹ï¼Œå½“è°ƒç”¨yieldä¹‹åï¼Œmainçº¿ç¨‹ä¼šç»§ç»­è¿è¡Œï¼Œå› ä¸ºæ²¡æœ‰æ¯”å®ƒä¼˜å…ˆçº§æ›´é«˜çš„çº¿ç¨‹ï¼›</li><li>å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨</li></ul><h4 id="3-7-sleepæ–¹æ³•"><a href="#3-7-sleepæ–¹æ³•" class="headerlink" title="3.7 sleepæ–¹æ³•"></a>3.7 <strong>sleepæ–¹æ³•</strong></h4><ul><li>è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä» <em>Running</em> è¿›å…¥TIMED_WAITINGçŠ¶æ€ï¼Œä¸ä¼šé‡Šæ”¾å¯¹è±¡é”</li><li>å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ interrupt æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º InterruptedExceptionï¼Œå¹¶ä¸”ä¼šæ¸…é™¤ä¸­æ–­æ ‡å¿—</li><li>ç¡çœ ç»“æŸåçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œ</li><li>sleepå½“ä¼ å…¥å‚æ•°ä¸º0æ—¶ï¼Œå’Œyieldç›¸åŒ</li></ul><h4 id="3-8-stopæ–¹æ³•-åœæ­¢çº¿å¹¶ä¸”é‡Šæ”¾é”"><a href="#3-8-stopæ–¹æ³•-åœæ­¢çº¿å¹¶ä¸”é‡Šæ”¾é”" class="headerlink" title="3.8 stopæ–¹æ³•(åœæ­¢çº¿å¹¶ä¸”é‡Šæ”¾é”)"></a>3.8 <strong>stopæ–¹æ³•(åœæ­¢çº¿å¹¶ä¸”é‡Šæ”¾é”)</strong></h4><p>stop()æ–¹æ³•å·²ç»è¢«jdkåºŸå¼ƒï¼ŒåŸå› å°±æ˜¯stop()æ–¹æ³•å¤ªè¿‡äºæš´åŠ›ï¼Œå¼ºè¡ŒæŠŠæ‰§è¡Œåˆ°ä¸€åŠçš„çº¿ç¨‹ç»ˆæ­¢ã€‚</p><p>stopä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œå¯èƒ½ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> java å¹¶å‘ç¼–ç¨‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java çŸ¥è¯†æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥ç†è§£MySQLåº•å±‚æ•°æ®ç»“æ„ç®—æ³•</title>
      <link href="/2024/11/14/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3MySQL%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AE%97%E6%B3%95/"/>
      <url>/2024/11/14/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3MySQL%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h3><ol><li>ç´¢å¼•æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ’å¥½åºçš„æ•°æ®ç»“æ„</li><li>ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼šäºŒå‰æ ‘ï¼Œçº¢é»‘æ ‘ï¼ŒHashè¡¨ï¼ŒB-æ ‘</li></ol><h3 id="åˆ†æselectè¯­å¥"><a href="#åˆ†æselectè¯­å¥" class="headerlink" title="åˆ†æselectè¯­å¥"></a>åˆ†æselectè¯­å¥</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">18</span>;</span><br></pre></td></tr></table></figure><h4 id="æ²¡æœ‰åŠ ç´¢å¼•"><a href="#æ²¡æœ‰åŠ ç´¢å¼•" class="headerlink" title="æ²¡æœ‰åŠ ç´¢å¼•"></a>æ²¡æœ‰åŠ ç´¢å¼•</h4><p>æ²¡æœ‰åŠ ç´¢å¼•æ—¶ï¼ŒMySQLåº•å±‚æ˜¯é€šè¿‡ä¸€è¡Œä¸€è¡Œçš„è¿›è¡ŒæŸ¥æ‰¾çš„ï¼Œå½“æ‰¾æ‰¾åˆ°age&#x3D;18çš„å­—æ®µåä¾ç„¶ä¸èƒ½ç¡®å®šåé¢çš„æ•°æ®æ—¶å€™è¿˜æœ‰age&#x3D;18çš„å­—æ®µï¼Œæ‰€ä»¥ä¾ç„¶éœ€è¦ç»§ç»­æŸ¥æ‰¾ï¼Œä¸€æ¬¡æŸ¥æ‰¾å°±æ˜¯ä¸€æ¬¡ç£ç›˜IOï¼ˆ<strong>Mysql é€šè¿‡ç£ç›˜ IO æ¬¡æ•°è¡¡é‡æŸ¥è¯¢æ•ˆç‡</strong>çš„ï¼‰ï¼Œå¦‚æœä¸€å¼ è¡¨æœ‰10ä¸‡æ¡æ•°æ®é‚£ä¹ˆå°±éœ€è¦è¿›è¡Œ10ä¸‡æ¬¡çš„æŸ¥æ‰¾ï¼ŒæŠŠæ•°æ®ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜çš„é€Ÿåº¦ä¸å¿«ï¼Œå¦‚æœæ•°æ®é‡å¤§çš„è¯ï¼Œéœ€è¦èŠ±è´¹ç›¸å½“å¤šçš„æ—¶é—´ï¼Œæ‰èƒ½æ‰«æå®Œæ•´å¼ è¡¨ã€‚</p><h4 id="åŠ ç´¢å¼•ï¼ˆäºŒå‰æ ‘ï¼‰"><a href="#åŠ ç´¢å¼•ï¼ˆäºŒå‰æ ‘ï¼‰" class="headerlink" title="åŠ ç´¢å¼•ï¼ˆäºŒå‰æ ‘ï¼‰"></a>åŠ ç´¢å¼•ï¼ˆäºŒå‰æ ‘ï¼‰</h4><p>åŠ ç´¢å¼•åï¼ŒMySQLçš„æŸ¥æ‰¾å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œç´¢å¼•å°±æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¦‚æœç´¢å¼•æ˜¯äºŒå‰æ ‘çš„è¯ï¼Œå°±é€šè¿‡äºŒå‰æ ‘æ¥æŸ¥æ‰¾ã€‚ä½¿ç”¨ageç´¢å¼•åï¼Œå°±å…ˆå»äºŒå‰æ ‘é‡Œå»æŸ¥æ‰¾ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹å°±ç›¸å½“äºæ˜¯é”®å€¼å¯¹keyå­˜å‚¨çš„æ˜¯ageçš„å€¼ï¼Œvalueå­˜å‚¨çš„å°±æ˜¯æ–‡ä»¶åœ°å€æŒ‡é’ˆï¼ˆæŒ‡å‘ä¸€åˆ—çš„æ•°æ®ï¼‰ã€‚è¦çŸ¥é“äºŒå‰æ ‘ä¸­ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼å¤§äºå®ƒçš„å·¦å­©å­å°äºå®ƒçš„å³å­©å­ï¼Œæ‰€ä»¥æŸ¥æ‰¾é€Ÿåº¦ä¼šå¾ˆå¿«ã€‚</p><h4 id="MySQLç´¢å¼•ä½¿ç”¨çš„æ•°æ®ç»“æ„"><a href="#MySQLç´¢å¼•ä½¿ç”¨çš„æ•°æ®ç»“æ„" class="headerlink" title="MySQLç´¢å¼•ä½¿ç”¨çš„æ•°æ®ç»“æ„"></a>MySQLç´¢å¼•ä½¿ç”¨çš„æ•°æ®ç»“æ„</h4><p>ä½“ä¼šäº†ä¸€æŠŠç´¢å¼•æŸ¥æ‰¾æ•°æ®ç»“æ„ï¼Œå‘ç°ç´¢å¼•ç¡®å®æé«˜äº†æˆ‘ä»¬çš„æŸ¥æ‰¾é€Ÿåº¦ã€‚è€Œæˆ‘ä»¬çŸ¥é“MySQLç´¢å¼•ä½¿ç”¨é¢æ•°æ®ç»“æ„æ˜¯B+æ ‘ï¼Œå…ˆä¸è€ƒè™‘ä¸ºä»€ä¹ˆé€‰ç”¨B+æ ‘ï¼Œå…ˆæ¥è€ƒè™‘ä¸ºä»€ä¹ˆä¸é€‰ç”¨äºŒå‰æ ‘ï¼Œå› ä¸ºäºŒå‰æ ‘å­˜åœ¨å¼Šç«¯ï¼Œå½“æ•°æ®æ˜¯æŒ‰ä¸€å®šé¡ºåºæ¥å­˜å‚¨çš„è¯ï¼ŒäºŒå‰æ ‘å°±ä¼šé€€åŒ–æˆé“¾è¡¨ï¼Œè¿™æ ·çš„è¯æŸ¥æ‰¾é€Ÿåº¦å°±æ²¡æœ‰å¾—åˆ°æå‡ã€‚é‚£æœ‰æ²¡æœ‰ä¸€ç§æ•°æ®ç»“æ„èƒ½å¤Ÿåšåˆ°é¿å…è¿™ç§å¼Šç«¯å‘¢?æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¹³è¡¡äºŒå‰æ ‘çº¢é»‘æ ‘ã€‚</p><p>ç»™å‡ºä¸€æ®µæ•°æ®1,2,3,4,5,6,7,8,9ã€‚</p><p>ç”¨äºŒå‰æ ‘å­˜å‚¨</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/cca300c2b09b2b9a2f2efb0761104b08.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç”¨çº¢é»‘æ ‘æ¥å­˜å‚¨ï¼Œå¦‚ä¸‹</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/dff171ece61403399d2eef6cf2e776b8.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä»çº¢é»‘æ ‘é¢æ„å»ºä¸­å‘ç°å½“çº¢é»‘æ ‘è‡ªèº«ä¸èƒ½æ»¡è¶³çº¢é»‘æ ‘çš„ç‰¹æ€§çš„æ—¶å€™ï¼Œçº¢é»‘æ ‘ä¼šè‡ªæ—‹ï¼Œä»¥ä¿æŒçº¢é»‘æ ‘çš„ç‰¹æ€§ã€‚é‚£ä¹ˆæ—¢ç„¶è§£å†³äº†é€€åŒ–æˆé“¾è¡¨çš„é—®é¢˜ä¸ºä»€ä¹ˆåˆæ²¡æœ‰é€‰æ‹©å®ƒå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è¦çŸ¥é“<strong>AVL æ ‘å’Œçº¢é»‘æ ‘åŸºæœ¬éƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­æ‰ä¼šä½¿ç”¨çš„æ•°æ®ç»“æ„</strong>ã€‚&#x3D;&#x3D;åœ¨å¤§è§„æ¨¡æ•°æ®å­˜å‚¨çš„æ—¶å€™ï¼Œçº¢é»‘æ ‘å¾€å¾€å‡ºç°ç”±äº<strong>æ ‘çš„æ·±åº¦è¿‡å¤§</strong>è€Œé€ æˆç£ç›˜ IO è¯»å†™è¿‡äºé¢‘ç¹ï¼Œè¿›è€Œå¯¼è‡´æ•ˆç‡ä½ä¸‹çš„æƒ…å†µ&#x3D;&#x3D;ã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬çŸ¥é“è¦è·å–ç£ç›˜ä¸Šæ•°æ®ï¼Œå¿…é¡»å…ˆé€šè¿‡ç£ç›˜ç§»åŠ¨è‡‚ç§»åŠ¨åˆ°æ•°æ®æ‰€åœ¨çš„æŸ±é¢ï¼Œç„¶åæ‰¾åˆ°æŒ‡å®šç›˜é¢ï¼Œæ¥ç€æ—‹è½¬ç›˜é¢æ‰¾åˆ°æ•°æ®æ‰€åœ¨çš„ç£é“ï¼Œæœ€åå¯¹æ•°æ®è¿›è¡Œè¯»å†™ã€‚ç£ç›˜ IO ä»£ä»·ä¸»è¦èŠ±è´¹åœ¨æŸ¥æ‰¾æ‰€éœ€çš„æŸ±é¢ä¸Šï¼Œæ ‘çš„æ·±åº¦è¿‡å¤§ä¼šé€ æˆç£ç›˜ IO é¢‘ç¹è¯»å†™ã€‚æ ¹æ®<strong>ç£ç›˜æŸ¥æ‰¾å­˜å–çš„æ¬¡æ•°å¾€å¾€ç”±æ ‘çš„é«˜åº¦æ‰€å†³å®š</strong>ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æŸç§è¾ƒå¥½çš„æ ‘ç»“æ„å‡å°‘æ ‘çš„ç»“æ„å°½é‡å‡å°‘æ ‘çš„é«˜åº¦æ¥ä¼˜åŒ–ã€‚</p><p>è¿™æ—¶æœ‰äººå°±ä¼šè¯´B-æ ‘ï¼Œå¾ˆå¥½B-æ ‘èƒ½å¤Ÿè§£å†³æ ‘çš„æ·±åº¦çš„é—®é¢˜</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹B-æ ‘çš„ç´¢å¼•åŸç†ï¼šB-æ ‘çš„æœç´¢ï¼Œä»æ ¹ç»“ç‚¹å¼€å§‹ï¼Œå¯¹ç»“ç‚¹å†…çš„å…³é”®å­—ï¼ˆæœ‰åºï¼‰åºåˆ—è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœå‘½ä¸­åˆ™ç»“æŸï¼Œå¦åˆ™è¿›å…¥æŸ¥è¯¢å…³é”®å­—æ‰€å±èŒƒå›´çš„å„¿å­ç»“ç‚¹ï¼›é‡å¤ï¼Œç›´åˆ°æ‰€å¯¹åº”çš„å„¿å­æŒ‡é’ˆä¸ºç©ºï¼Œæˆ–å·²ç»æ˜¯å¶å­ç»“ç‚¹ï¼›å› æ­¤ï¼ŒB-Treeçš„æŸ¥æ‰¾è¿‡ç¨‹æ˜¯ä¸€ä¸ªé¡ºæŒ‡é’ˆæŸ¥æ‰¾ç»“ç‚¹å’Œåœ¨ç»“ç‚¹çš„å…³é”®å­—ä¸­è¿›è¡ŒæŸ¥æ‰¾çš„äº¤å‰è¿›è¡Œçš„è¿‡ç¨‹ã€‚</p><p>æ¥ä¸‹æ¥çœ‹çœ‹B-æ ‘å¯¹æ•°æ®çš„å­˜å‚¨ï¼Œä¾ç„¶ä½¿ç”¨ä¸Šé¢çš„æ•°æ®1,2,3,4,5,6,7,8,9ï¼Œä¸”è®¾ç½®Max.degree&#x3D;4</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/c98586533d551318bf53fb805cf59bdd.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>äº†è§£å®ŒB-æ ‘çš„ç´¢å¼•åŸç†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ‹æ‰‹å«ç»äº†ï¼ŒB-æ ‘ç›¸å¯¹äºçº¢é»‘æ ‘ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†æ ‘çš„é«˜åº¦é—®é¢˜äº†ï¼Œé‚£ä¹ˆmysqlçš„ç´¢å¼•å°±å¯ä»¥ä½¿ç”¨B-æ ‘äº†å§ã€‚è¿™æ—¶å€™mysqlå°±ä¼šç»™ä½ å½“å¤´ä¸€å‡»ï¼Œmysqlå®é™…ä½¿ç”¨çš„æ•°æ®ç»“æ„æ˜¯B+æ ‘ã€‚</p><p>B+æ ‘å­˜å‚¨1,2,3,4,5,6,7,8,9ï¼Œä¸”è®¾ç½®Max.degree&#x3D;4</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/b0932bb9028181676831650b465beb76.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é€šè¿‡ä»¥ä¸Šçš„å›¾æœ‰ä¸€å®šæ•°æ®ç»“æ„åŸºç¡€çš„æœ‹å‹å°±ä¼šæƒ³èµ·ä¸€äº›åŒºåˆ«</p><p>è¿™é‡Œå°±ç›´æ¥è´´ä¸Šæ€»ç»“ï¼š</p><p>Bæ ‘çš„ç‰¹å¾ï¼š</p><ul><li><strong>å…³é”®å­—é›†åˆåˆ†å¸ƒåœ¨æ•´é¢—æ ‘ä¸­</strong></li><li><strong>ä»»ä½•ä¸€ä¸ªå…³é”®å­—å‡ºç°ä¸”åªå‡ºç°åœ¨ä¸€ä¸ªç»“ç‚¹ä¸­</strong></li><li>æœç´¢æœ‰å¯èƒ½åœ¨éå¶å­ç»“ç‚¹ç»“æŸï¼ˆ<strong>dataä¸åœ¨èŠ‚ç‚¹</strong>ï¼‰</li><li>å…¶æœç´¢æ€§èƒ½ç­‰ä»·äºåœ¨å…³é”®å­—å…¨é›†å†…åšä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾</li><li>è‡ªåŠ¨å±‚æ¬¡æ§åˆ¶</li></ul><p>B+æ ‘çš„ç‰¹å¾ï¼š</p><ul><li>æ‰€æœ‰å…³é”®å­—éƒ½å‡ºç°åœ¨å¶å­ç»“ç‚¹çš„é“¾è¡¨ä¸­ï¼ˆç¨ å¯†ç´¢å¼•ï¼‰ï¼Œä¸”é“¾è¡¨ä¸­çš„å…³é”®å­—æ°å¥½æ˜¯æœ‰åºçš„</li><li><strong>ä¸å¯èƒ½åœ¨éå¶å­ç»“ç‚¹å‘½ä¸­ï¼ˆdataåŸŸåœ¨å¶å­èŠ‚ç‚¹ï¼‰</strong></li><li>éå¶å­ç»“ç‚¹ç›¸å½“äºæ˜¯å¶å­ç»“ç‚¹çš„ç´¢å¼•ï¼ˆç¨€ç–ç´¢å¼•ï¼‰ï¼Œ<strong>å¶å­ç»“ç‚¹ç›¸å½“äºæ˜¯å­˜å‚¨ï¼ˆå…³é”®å­—ï¼‰æ•°æ®çš„æ•°æ®å±‚</strong></li><li>æ¯ä¸€ä¸ªå¶å­èŠ‚ç‚¹éƒ½åŒ…å«æŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»è€Œæ–¹ä¾¿å¶å­èŠ‚ç‚¹çš„èŒƒå›´éå†ã€‚</li><li>æ›´é€‚åˆæ–‡ä»¶ç´¢å¼•ç³»ç»Ÿ</li></ul><p>B+æ ‘æ˜¯Bæ ‘çš„ä¸€ä¸ªå˜ä½“ï¼ŒåŒºåˆ«åœ¨äºï¼ŒB+æ ‘ï¼š</p><ol><li><strong>å¶å­ç»“ç‚¹åŒ…å«æ‰€æœ‰å…³é”®å­—ä»¥åŠæŒ‡å‘ç›¸åº”è®°å½•çš„æŒ‡é’ˆ</strong></li><li><strong>å¶å­ç»“ç‚¹ä¸­çš„å…³é”®å­—æœ‰åºï¼Œç›¸é‚»èŠ‚ç‚¹ç”¨æŒ‡é’ˆè¿æ¥</strong></li><li>éå¶å­ç»“ç‚¹ä»…å­˜å‚¨å…¶å­æ ‘çš„æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰å…³é”®å­—ï¼Œå¯ä»¥çœ‹æˆæ˜¯ç´¢å¼•</li></ol><h4 id="B-æ ‘ä½œä¸ºæ•°æ®åº“ç´¢å¼•çš„åŸå› "><a href="#B-æ ‘ä½œä¸ºæ•°æ®åº“ç´¢å¼•çš„åŸå› " class="headerlink" title="B+ æ ‘ä½œä¸ºæ•°æ®åº“ç´¢å¼•çš„åŸå› "></a><strong>B+ æ ‘ä½œä¸ºæ•°æ®åº“ç´¢å¼•çš„åŸå› </strong></h4><ul><li>B+ æ ‘<strong>éå¶ç»“ç‚¹ä»…å­˜å‚¨å…¶å­æ ‘çš„æœ€å¤§ï¼ˆæˆ–æœ€å°ï¼‰å…³é”®å­—ï¼ˆä¸å­˜æ”¾çœŸæ­£æ•°æ®ï¼‰</strong>ï¼Œä¸€ä¸ªç»“ç‚¹å¯ä»¥å­˜å‚¨æ›´å¤šçš„å…³é”®å­—</li><li>æ¯ä¸ªç»“ç‚¹èƒ½ç´¢å¼•çš„<strong>èŒƒå›´æ›´å¤§æ›´ç²¾ç¡®</strong></li><li>B+ æ ‘å•æ¬¡ç£ç›˜IOçš„<strong>ä¿¡æ¯é‡å¤§</strong>äº B æ ‘ï¼ŒI&#x2F;O çš„æ¬¡æ•°ç›¸å¯¹å‡å°‘</li><li><strong>MySQLæ˜¯ä¸€ç§å…³ç³»å‹æ•°æ®åº“ï¼ŒåŒºé—´è®¿é—®æ˜¯å¸¸è§çš„ä¸€ç§æƒ…å†µï¼ŒB+æ ‘å¶ç»“ç‚¹å¢åŠ çš„é“¾æŒ‡é’ˆï¼ŒåŠ å¼ºäº†åŒºé—´è®¿é—®æ€§ï¼›B æ ‘åˆ™æ— æ³•è¿›è¡ŒåŒºé—´æŸ¥æ‰¾</strong></li></ul><h4 id="ç´¢å¼•å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­"><a href="#ç´¢å¼•å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­" class="headerlink" title="ç´¢å¼•å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­"></a><strong>ç´¢å¼•å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­</strong></h4><p>ç´¢å¼•æ˜¯å æ®ç‰©ç†ç©ºé—´çš„ï¼Œåœ¨ä¸åŒçš„å­˜å‚¨å¼•æ“ä¸­ï¼Œç´¢å¼•å­˜åœ¨çš„æ–‡ä»¶ä¹Ÿä¸åŒ</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/5511cbc5e57f914971bc925bdc121ada.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="MySQLå¶ç»“æ„ç¤ºæ„å›¾"><a href="#MySQLå¶ç»“æ„ç¤ºæ„å›¾" class="headerlink" title="MySQLå¶ç»“æ„ç¤ºæ„å›¾"></a>MySQLå¶ç»“æ„ç¤ºæ„å›¾</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/02bd101f4e88b36dad26c45c31dd334b.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h4 id="èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•"><a href="#èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•" class="headerlink" title="èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•"></a>èšé›†ç´¢å¼•ä¸éèšé›†ç´¢å¼•</h4><ul><li><p>èšç°‡ç´¢å¼•ï¼šå°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°äº†ä¸€å—ï¼Œæ‰¾åˆ°ç´¢å¼•ä¹Ÿå°±æ‰¾åˆ°äº†æ•°æ®ï¼Œä¸»æ–‡ä»¶æŒ‰ç…§å¯¹åº”å­—æ®µæ’åºå­˜å‚¨ï¼Œç´¢å¼•æ–‡ä»¶æ— é‡å¤æ’åºå­˜å‚¨ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/e12ebf746e3c75f4af813f9f6f32e5c2.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>èšé›†ï¼šæŠŠç´¢å¼•çš„å…ƒç´ å’Œæ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆ*.ibdï¼‰</li></ul></li><li><p>éèšç°‡ç´¢å¼•ï¼šå°†æ•°æ®å­˜å‚¨äºç´¢å¼•åˆ†å¼€ç»“æ„ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹æŒ‡å‘äº†æ•°æ®çš„å¯¹åº”è¡Œï¼Œä¸»æ–‡ä»¶å¹¶æ²¡æœ‰æŒ‰ç…§å¯¹åº”å­—æ®µæ’åºå­˜å‚¨ï¼Œç´¢å¼•æ–‡ä»¶æœ‰é‡å¤æ’åºå­˜å‚¨ã€‚<br><img src="https://i-blog.csdnimg.cn/blog_migrate/4c0995c2262bec4cf8c9a1eec7d9d780.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><ul><li>éèšé›†ï¼šæŠŠç´¢å¼•çš„å…ƒç´ å’Œæ•°æ®å­˜å‚¨åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œ*.MYIå­˜å‚¨ç´¢å¼•ï¼Œ *.MYDå­˜å‚¨æ•°æ®</li></ul></li></ul><h4 id="InnoDBç´¢å¼•çš„å®ç°ï¼ˆèšé›†ï¼‰"><a href="#InnoDBç´¢å¼•çš„å®ç°ï¼ˆèšé›†ï¼‰" class="headerlink" title="InnoDBç´¢å¼•çš„å®ç°ï¼ˆèšé›†ï¼‰"></a>InnoDBç´¢å¼•çš„å®ç°ï¼ˆèšé›†ï¼‰</h4><ul><li>è¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„æ–‡ä»¶</li><li>èšé›†ç´¢å¼•å¶å­ç»“ç‚¹åŒ…å«å®Œæ•´çš„æ•°æ®è®°å½•</li><li>ä¸ºä»€ä¹ˆInnoDBè¡¨å¿…é¡»æœ‰ä¸»é”®ï¼Œå¹¶ä¸”æ¨èä½¿ç”¨æ•´å½¢çš„è‡ªå¢ä¸»é”®ï¼Ÿ<ul><li>å¦‚æœè®¾ç½®äº†ä¸»é”®ï¼Œé‚£ä¹ˆInnoDBä¼šé€‰æ‹©ä¸»é”®ä½œä¸ºèšé›†ç´¢å¼•ã€</li><li>å¦‚æœæ²¡æœ‰æ˜¾å¼å®šä¹‰ä¸»é”®ï¼Œåˆ™InnoDBä¼šé€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å«æœ‰NULLå€¼çš„å”¯ä¸€ç´¢å¼•ä½œä¸ºä¸»é”®ç´¢å¼•ã€å¦‚æœä¹Ÿæ²¡æœ‰è¿™æ ·çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™InnoDBä¼šé€‰æ‹©å†…ç½®6å­—èŠ‚é•¿çš„ROWIDä½œä¸ºéšå«çš„èšé›†ç´¢å¼•(ROWIDéšç€è¡Œè®°å½•çš„å†™å…¥è€Œä¸»é”®é€’å¢)ã€‚</li><li>MySQLå®˜æ–¹å·¥ç¨‹å¸ˆå°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ï¼ˆæ›´å…·ä¸»é”®æ¥å­˜å‚¨ï¼‰</li><li>å¦‚æœè¡¨ä½¿ç”¨&#x3D;&#x3D;è‡ªå¢ä¸»é”®&#x3D;&#x3D;é‚£ä¹ˆæ¯æ¬¡æ’å…¥æ–°çš„è®°å½•ï¼Œè®°å½•å°±ä¼šé¡ºåºæ·»åŠ åˆ°<strong>å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„åç»­</strong>ä½ç½®ï¼Œä¸»é”®çš„é¡ºåºæŒ‰ç…§æ•°æ®è®°å½•çš„æ’å…¥é¡ºåºæ’åˆ—ï¼Œè‡ªåŠ¨æœ‰åºã€‚å½“ä¸€é¡µå†™æ»¡ï¼Œå°±ä¼šè‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µ</li><li>å¦‚æœä½¿ç”¨&#x3D;&#x3D;éè‡ªå¢ä¸»é”®&#x3D;&#x3D;ï¼ˆå¦‚æœèº«ä»½è¯å·æˆ–å­¦å·ç­‰ï¼‰ç”±äºæ¯æ¬¡æ’å…¥ä¸»é”®çš„å€¼è¿‘ä¼¼äºéšæœºï¼Œå› æ­¤æ¯æ¬¡æ–°çºªå½•éƒ½è¦è¢«æ’åˆ°<strong>ç°æœ‰ç´¢å¼•é¡µå¾—ä¸­é—´æŸä¸ªä½ç½®</strong>ï¼Œæ­¤æ—¶MySQLä¸å¾—ä¸ä¸ºäº†å°†æ–°è®°å½•æ’åˆ°åˆé€‚ä½ç½®è€Œç§»åŠ¨æ•°æ®ï¼Œç”šè‡³ç›®æ ‡é¡µé¢å¯èƒ½å·²ç»è¢«å›å†™åˆ°ç£ç›˜ä¸Šè€Œä»ç¼“å­˜ä¸­æ¸…æ‰ï¼Œæ­¤æ—¶åˆè¦ä»ç£ç›˜ä¸Šè¯»å›æ¥ï¼Œè¿™å¢åŠ äº†å¾ˆå¤šå¼€é”€ï¼ŒåŒæ—¶é¢‘ç¹çš„ç§»åŠ¨ã€åˆ†é¡µæ“ä½œé€ æˆäº†å¤§é‡çš„ç¢ç‰‡ï¼Œå¾—åˆ°äº†ä¸å¤Ÿç´§å‡‘çš„ç´¢å¼•ç»“æ„ï¼Œåç»­ä¸å¾—ä¸é€šè¿‡OPTIMIZE TABLEæ¥é‡å»ºè¡¨å¹¶ä¼˜åŒ–å¡«å……é¡µé¢ã€‚</li><li>uuidçš„ä½¿ç”¨ä¸æ•´å½¢çš„å¯¹æ¯”ï¼šuuidæ¯”æ•´å½¢å ç”¨æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼›æ•´å½¢çš„æ¯”è¾ƒæ•ˆç‡æ›´å¿«ï¼ˆUUIDæ˜¯16å­—èŠ‚128ä½é•¿çš„æ•°å­—ï¼Œé€šå¸¸ä»¥36å­—èŠ‚çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼‰</li></ul></li><li>ä¸ºä»€ä¹ˆéä¸»é”®ç´¢å¼•ç»“æ„å¶å­ç»“ç‚¹å­˜å‚¨ä¸»é”®ï¼Ÿï¼ˆä¸€è‡´æ€§å’ŒèŠ‚çº¦å­˜å‚¨ç©ºé—´ï¼‰<ul><li><strong>ä¿æŒä¸€è‡´æ€§ï¼š</strong><br>å½“æ•°æ®åº“è¡¨è¿›è¡ŒDMLæ“ä½œæ—¶ï¼ŒåŒä¸€è¡Œè®°å½•çš„é¡µåœ°å€ä¼šå‘ç”Ÿæ”¹å˜ï¼Œå› éä¸»é”®ç´¢å¼•ä¿å­˜çš„æ˜¯ä¸»é”®çš„å€¼ï¼Œæ— éœ€è¿›è¡Œæ›´æ”¹ã€‚</li><li>** èŠ‚çœå­˜å‚¨ç©ºé—´ï¼š**<br>Innodbæ•°æ®æœ¬èº«å°±å·²ç»æ±‡èšåˆ°ä¸»é”®ç´¢å¼•æ‰€åœ¨çš„B+æ ‘ä¸Šäº†ï¼Œ å¦‚æœæ™®é€šç´¢å¼•è¿˜ç»§ç»­å†ä¿å­˜ä¸€ä»½æ•°æ®ï¼Œå°±ä¼šå¯¼è‡´æœ‰å¤šå°‘ç´¢å¼•å°±è¦å­˜å¤šå°‘ä»½æ•°æ®ã€‚</li></ul></li></ul><p>å‚è€ƒï¼š</p><ol><li><a href="https://blog.csdn.net/wangfeijiu/article/details/113409719">https://blog.csdn.net/wangfeijiu/article/details/113409719</a></li><li><a href="https://long97.blog.csdn.net/article/details/106084627">https://long97.blog.csdn.net/article/details/106084627</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> mysql çŸ¥è¯†æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬”è®°æ€»ç»“</title>
      <link href="/2024/11/14/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
      <url>/2024/11/14/Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h1 id="JavaåŸºç¡€"><a href="#JavaåŸºç¡€" class="headerlink" title="JavaåŸºç¡€"></a>JavaåŸºç¡€</h1><h2 id="Javaæ•°æ®ç±»å‹"><a href="#Javaæ•°æ®ç±»å‹" class="headerlink" title="Javaæ•°æ®ç±»å‹"></a>Javaæ•°æ®ç±»å‹</h2><p>åœ¨Javaä¸­çš„æ•°æ®ç±»å‹æœ‰å››ç±»å…«ç§</p><h3 id="æ•´æ•°å‹ï¼šbyte-short-int-long"><a href="#æ•´æ•°å‹ï¼šbyte-short-int-long" class="headerlink" title="æ•´æ•°å‹ï¼šbyte short int long"></a>æ•´æ•°å‹ï¼šbyte short int long</h3><p>byte ï¼š1å­—èŠ‚ï¼Œ8ä½ï¼Œ  1 byte &#x3D; 8 bitsï¼Œ byte çš„é»˜è®¤å€¼ 0 </p><p>Short:  å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯16ä½ï¼Œ1 short &#x3D; 2 byte &#x3D; 16 bitsï¼Œ é»˜è®¤å€¼ 0ï¼›</p><p>Int: å ç”¨å››ä¸ªå­—èŠ‚ï¼Œ32ä½ï¼Œ1 int &#x3D; 32 bitsï¼Œé»˜è®¤0ï¼›</p><p>long : å ç”¨å…«å­—èŠ‚ï¼Œ64ä½ ï¼Œ 1 long &#x3D; 64 bits , é»˜è®¤0Lï¼›</p><p>å ç”¨å­—èŠ‚ç©ºé—´çš„å¤§å°ï¼š long &gt; int &gt; short &gt; byte</p><h3 id="æµ®ç‚¹å‹"><a href="#æµ®ç‚¹å‹" class="headerlink" title="æµ®ç‚¹å‹"></a>æµ®ç‚¹å‹</h3><p>æµ®ç‚¹å‹æœ‰ä¸¤ç§æ•°æ®ç±»å‹ï¼šfloat å’Œ double</p><p>floatï¼šå•ç²¾åº¦æµ®ç‚¹å‹ï¼Œå ç”¨4ä½ï¼Œ1float &#x3D; 32bits , é»˜è®¤0.01f;</p><p>Double:åŒç²¾åº¦æµ®ç‚¹å‹ï¼Œå ç”¨8ä½ï¼Œ1 double &#x3D; 64 bits ï¼Œé»˜è®¤å€¼ 0.0dï¼›</p><h3 id="å­—ç¬¦å‹"><a href="#å­—ç¬¦å‹" class="headerlink" title="å­—ç¬¦å‹"></a>å­—ç¬¦å‹</h3><p> char: charç±»å‹æ˜¯ä¸€ä¸ªå•ä¸€çš„  16 çš„ <code>Unicode</code>Â·å­—ç¬¦ï¼Œ æœ€å°å€¼æ˜¯**&#x3D;&#x3D;<code>\u0000</code> ( å€¼ä¸º0 )&#x3D;&#x3D;**ï¼Œæœ€å¤§å€¼æ˜¯&#x3D;&#x3D;<code>\uffff</code> ( å€¼ä¸º65535)&#x3D;&#x3D;ï¼Œcharç±»å‹å¯ä»¥å­˜å‚¨ä»»ä½•å­—ç¬¦ï¼Œä¾‹å¦‚char a &#x3D; â€˜Aâ€™.</p><h3 id="å¸ƒå°”å‹"><a href="#å¸ƒå°”å‹" class="headerlink" title="å¸ƒå°”å‹"></a>å¸ƒå°”å‹</h3><p>boolean ï¼š boolean åªæœ‰ä¸¤ä¸ªå€¼ï¼štrueã€falseï¼Œå¯ä»¥ä½¿ç”¨ 1 bit æ¥å­˜å‚¨ï¼Œä½†æ˜¯å…·ä½“å¤§å°æ²¡æœ‰æ˜ç¡®è§„å®šã€‚JVM ä¼šåœ¨ç¼–è¯‘æ—¶æœŸå°† boolean ç±»å‹çš„æ•°æ®è½¬æ¢ä¸º intï¼Œä½¿ç”¨ 1 æ¥è¡¨ç¤º trueï¼Œ0 è¡¨ç¤º falseã€‚</p><p>æ³¨æ„ï¼šä¸Šé¢çš„ä½æ•°ä»£è¡¨çš„æ˜¯å†…å­˜ä¸­çš„å ç”¨ã€‚</p><table><thead><tr><th align="left">ç±»å‹</th><th align="left">ä½æ•°</th><th align="left">èŒƒå›´</th><th align="left">é»˜è®¤å€¼</th></tr></thead><tbody><tr><td align="left">byte</td><td align="left">8</td><td align="left">-2<sup>7</sup> ~ 2<sup>7</sup> - 1</td><td align="left">0</td></tr><tr><td align="left">char</td><td align="left">16</td><td align="left">\u0000 ~ \uffff</td><td align="left">â€˜u0000â€™</td></tr><tr><td align="left">short</td><td align="left">16</td><td align="left">-2<sup>15</sup> ~ 2<sup>15</sup> - 1</td><td align="left">0</td></tr><tr><td align="left">int</td><td align="left">32</td><td align="left">-2<sup>31</sup> ~ 2<sup>31</sup> - 1</td><td align="left">0</td></tr><tr><td align="left">float</td><td align="left">32</td><td align="left">-2<sup>31</sup> ~ 2<sup>31</sup> - 1</td><td align="left">0.0f</td></tr><tr><td align="left">double</td><td align="left">64</td><td align="left">-2<sup>63</sup> ~ 2<sup>63</sup> - 1</td><td align="left">0.0d</td></tr><tr><td align="left">long</td><td align="left">64</td><td align="left">-2<sup>63</sup> ~ 2<sup>63</sup> - 1</td><td align="left">0L</td></tr><tr><td align="left">boolean</td><td align="left">~</td><td align="left">~</td><td align="left">false</td></tr></tbody></table><h2 id="è‡ªåŠ¨æ‹†è£…ç®±"><a href="#è‡ªåŠ¨æ‹†è£…ç®±" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±"></a>è‡ªåŠ¨æ‹†è£…ç®±</h2><p>è£…ç®±ï¼šå°†åŸºæœ¬ç±»å‹ç”¨å®ƒä»¬å¯¹åº”çš„å¼•ç”¨ç±»å‹åŒ…è£…èµ·æ¥ï¼›</p><p>æ‹†ç®±ï¼šå°†åŒ…è£…ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer x = 20; // è£…ç®±    è‡ªåŠ¨è£…ç®±å°±æ˜¯jdkè‡ªå·±è‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆäº†Integer.valueOf()æ–¹æ³•çš„è°ƒç”¨</span><br><span class="line">int y = x;      // æ‹†ç®± è‡ªåŠ¨æ‹†ç®±å°±æ˜¯jdkè‡ªåŠ¨å¸®æˆ‘ä»¬è°ƒç”¨äº†IntValue()æ–¹æ³•</span><br></pre></td></tr></table></figure><p>Integerçš„å€¼åœ¨-128åˆ°127æ—¶ï¼ŒIntegerå¯¹è±¡æ˜¯åœ¨IntegerCache.cacheäº§ç”Ÿï¼Œä¼šå¤ç”¨å·²æœ‰å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªåŒºé—´çš„Integerå¯ä»¥ç›´æ¥ç”¨ç­‰å·è¿›è¡Œåˆ¤æ–­ã€‚<br>Integerçš„å€¼åœ¨-128åˆ°127ä¹‹å¤–æ—¶ï¼ŒIntegerå¯¹è±¡åœ¨å †ä¸Šäº§ç”Ÿï¼Œä¸ä¼šå¤ç”¨å·²æœ‰å¯¹è±¡ï¼Œç”¨ç­‰å·ä¼šè¿”å›false</p><p>æ‰©å±•ï¼š</p><p>ç¼“å­˜ï¼Œä»¥æ”¯æŒ JLS è¦æ±‚çš„ -128 å’Œ 127ï¼ˆå«ï¼‰ä¹‹é—´çš„å€¼çš„è‡ªåŠ¨è£…ç®±çš„å¯¹è±¡æ ‡è¯†è¯­ä¹‰ã€‚ç¼“å­˜åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–ã€‚ç¼“å­˜çš„å¤§å°å¯ä»¥é€šè¿‡ -XXï¼šAutoBoxCacheMax&#x3D; é€‰é¡¹è¿›è¡Œæ§åˆ¶<size>ã€‚åœ¨è™šæ‹Ÿæœºåˆå§‹åŒ–æœŸé—´ï¼Œå¯ä»¥åœ¨ sun.misc.VM ç±»çš„ä¸“ç”¨ç³»ç»Ÿå±æ€§ä¸­è®¾ç½®å¹¶ä¿å­˜ java.lang.Integer.IntegerCache.high å±æ€§ã€‚</p><p><a href="https://blog.csdn.net/qq_43663493/article/details/118943794?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171666010516800197012449%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=171666010516800197012449&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-118943794-null-null.nonecase&utm_term=%E8%A3%85%E7%AE%B1&spm=1018.2226.3001.4450">è‡ªåŠ¨è£…ç®±ä¸è‡ªåŠ¨æ‹†ç®±</a></p><h2 id="String-ã€-StringBufferã€StringBuilder-çš„åŒºåˆ«"><a href="#String-ã€-StringBufferã€StringBuilder-çš„åŒºåˆ«" class="headerlink" title="String ã€ StringBufferã€StringBuilder çš„åŒºåˆ«"></a>String ã€ StringBufferã€StringBuilder çš„åŒºåˆ«</h2><p>String è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸å¯è¢«ç»§æ‰¿ã€‚value æ•°ç»„è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€ value æ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„ã€‚</p><p>åœ¨ Java 8 ä¸­ï¼ŒString å†…éƒ¨ä½¿ç”¨ <code>char</code> æ•°ç»„å­˜å‚¨æ•°æ®ã€‚</p><p>Java 9 ä¹‹åï¼ŒString ç±»çš„å®ç°æ”¹ç”¨ <code>byte</code> æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²ï¼ŒåŒæ—¶ä½¿ç”¨ <code>coder</code> æ¥æ ‡è¯†ä½¿ç”¨äº†å“ªç§ç¼–ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">String</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">char</span> value[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>StringBuilder</code> ä¸ <code>StringBuffer</code> éƒ½ç»§æ‰¿è‡ª <code>AbstractStringBuilder</code> ç±»ï¼Œ<code>AbstractStringBuilder</code> ä¸­ä¹Ÿæ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„ä¿å­˜å­—ç¬¦ä¸² char[] value ä½†æ˜¯æ²¡æœ‰ç”¨ final å…³é”®å­—ä¿®é¥°ï¼Œæ‰€ä»¥è¿™ä¸¤ç§å¯¹è±¡éƒ½æ˜¯å¯å˜çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title class_">Appendable</span>, CharSequence &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span>[] value;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> count;</span><br><span class="line">    </span><br><span class="line">    AbstractStringBuilder() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    AbstractStringBuilder(<span class="type">int</span> capacity) &#123;</span><br><span class="line">        value = <span class="keyword">new</span> <span class="title class_">char</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>String, StringBuffer and StringBuilder</strong></p><ul><li>String ä¸å¯å˜æ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>StringBuffer å’Œ StringBuilder å¯å˜ï¼Œ StringBuilder ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œ StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå†…éƒ¨ä½¿ç”¨ <code>synchronized</code> è¿›è¡ŒåŒæ­¥</li></ul><h3 id="new-String-â€œabcâ€"><a href="#new-String-â€œabcâ€" class="headerlink" title="new String(â€œabcâ€) ?"></a>new String(â€œabcâ€) ?</h3><p>ä½¿ç”¨è¿™ç§æ–¹å¼ä¸€å…±ä¼šåˆ›å»ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ˆå‰ææ˜¯ <code>String Pool</code> ä¸­è¿˜æ²¡æœ‰ â€œabcâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼‰ã€‚</p><ul><li>â€œabcâ€ å±äºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œç¼–è¯‘æ—¶æœŸä¼šåœ¨ <code>String Pool</code> ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼ŒæŒ‡å‘è¿™ä¸ª â€œabcâ€ å­—ç¬¦ä¸²å­—é¢é‡ï¼›</li><li>ä½¿ç”¨ new çš„æ–¹å¼ä¼šåœ¨ <code>å †</code> ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</li></ul><h3 id="String-çš„å‡ ç§æ‹¼æ¥æ–¹å¼åŒº"><a href="#String-çš„å‡ ç§æ‹¼æ¥æ–¹å¼åŒº" class="headerlink" title="String çš„å‡ ç§æ‹¼æ¥æ–¹å¼åŒº"></a>String çš„å‡ ç§æ‹¼æ¥æ–¹å¼åŒº</h3><h4 id="ä½¿ç”¨-æ‹¼æ¥å­—ç¬¦ä¸²"><a href="#ä½¿ç”¨-æ‹¼æ¥å­—ç¬¦ä¸²" class="headerlink" title="ä½¿ç”¨ + æ‹¼æ¥å­—ç¬¦ä¸²"></a><strong>ä½¿ç”¨ <code>+</code> æ‹¼æ¥å­—ç¬¦ä¸²</strong></h4><p><strong>å…¶å®åªæ˜¯Javaæä¾›çš„ä¸€ä¸ªè¯­æ³•ç³–</strong></p><p>åŸç†ï¼šå­—ç¬¦ä¸²å¸¸é‡åœ¨æ‹¼æ¥è¿‡ç¨‹ä¸­ï¼Œå°† String è½¬æˆäº† StringBuilder åï¼Œä½¿ç”¨å…¶ append æ–¹æ³•è¿›è¡Œå¤„ç†çš„</p><h4 id="ä½¿ç”¨concat"><a href="#ä½¿ç”¨concat" class="headerlink" title="ä½¿ç”¨concat:"></a>ä½¿ç”¨<strong>concat</strong>:</h4><p>å…ˆåˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œé•¿åº¦æ˜¯å·²æœ‰å­—ç¬¦ä¸²å’Œå¾…æ‹¼æ¥å­—ç¬¦ä¸²çš„é•¿åº¦ä¹‹å’Œï¼Œå†æŠŠä¸¤ä¸ªå­—ç¬¦ä¸²çš„å€¼å¤åˆ¶åˆ°æ–°çš„å­—ç¬¦æ•°ç»„ä¸­ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªå­—ç¬¦æ•°ç»„åˆ›å»ºä¸€ä¸ªæ–°çš„ String å¯¹è±¡å¹¶è¿”å›.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">concat</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">otherLen</span> <span class="operator">=</span> str.length();</span><br><span class="line">    <span class="keyword">if</span> (otherLen == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> value.length;</span><br><span class="line">    <span class="type">char</span> buf[] = Arrays.copyOf(value, len + otherLen);</span><br><span class="line">    str.getChars(buf, len);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(buf, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿ç®—ç¬¦ä¼˜å…ˆçº§"><a href="#è¿ç®—ç¬¦ä¼˜å…ˆçº§" class="headerlink" title="è¿ç®—ç¬¦ä¼˜å…ˆçº§"></a>è¿ç®—ç¬¦ä¼˜å…ˆçº§</h2><p>&#x3D;&#x3D;ç®—æœ¯è¿ç®—ç¬¦ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œå…³ç³»å’Œé€»è¾‘è¿ç®—ç¬¦ä¼˜å…ˆçº§è¾ƒä½&#x3D;&#x3D;ã€‚å¤šæ•°è¿ç®—ç¬¦å…·æœ‰å·¦ç»“åˆæ€§ï¼Œå•ç›®è¿ç®—ç¬¦ã€ä¸‰ç›®è¿ç®—ç¬¦ã€èµ‹å€¼è¿ç®—ç¬¦å…·æœ‰å³ç»“åˆæ€§ã€‚</p><table><thead><tr><th align="left">ä¼˜å…ˆçº§</th><th align="left">è¿ç®—ç¬¦</th><th align="left">ç»“æ ¸æ€§</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">() ã€[] ã€{}</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">2</td><td align="left">!ã€ +ã€ -ã€ ~ã€ ++ã€ â€“</td><td align="left">ä»å³å¾€å·¦</td></tr><tr><td align="left">3</td><td align="left">*ã€ &#x2F;ã€ %</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">4</td><td align="left">+ã€ -</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">5</td><td align="left">&lt;&lt;ã€ &gt;&gt;ã€ &gt;&gt;&gt;</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">6</td><td align="left">&lt;ã€ &lt;&#x3D;ã€ &gt;ã€ &gt;&#x3D;ã€ instanceof</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">7</td><td align="left">&#x3D;&#x3D;ã€ !&#x3D;</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">8</td><td align="left">&amp;</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">9</td><td align="left">^</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">10</td><td align="left">|</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">11</td><td align="left">&amp;&amp;</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">12</td><td align="left">||</td><td align="left">ä»å·¦å¾€å³</td></tr><tr><td align="left">13</td><td align="left">?:</td><td align="left">ä»å³å¾€å·¦</td></tr><tr><td align="left">14</td><td align="left">&#x3D;ã€ +&#x3D;ã€ -&#x3D;ã€ *&#x3D;ã€ &#x2F;&#x3D;ã€ &amp;&#x3D;ã€ |&#x3D;ã€ ^&#x3D;ã€ ~&#x3D;ã€ &lt;&lt;&#x3D;ã€ &gt;&gt;&#x3D;ã€  &gt;&gt;&gt;&#x3D;</td><td align="left">ä»å³å¾€å·¦</td></tr></tbody></table><h2 id="é‡è½½ä¸é‡å†™"><a href="#é‡è½½ä¸é‡å†™" class="headerlink" title="é‡è½½ä¸é‡å†™"></a>é‡è½½ä¸é‡å†™</h2><p>é‡è½½ï¼š å‘ç”Ÿåœ¨åŒä¸€ä¸ªç±»ä¸­ï¼Œ&#x3D;&#x3D;æ–¹æ³•åå¿…é¡»ç›¸åŒï¼Œå‚æ•°ç±»å‹ä¸åŒã€ä¸ªæ•°ä¸åŒã€é¡ºåºä¸åŒ&#x3D;&#x3D;</p><p>é‡å†™ï¼š å‘ç”Ÿåœ¨çˆ¶å­ç±»ä¸­ï¼Œæ–¹æ³•åã€å‚æ•°åˆ—è¡¨å¿…é¡»ç›¸åŒï¼Œè¿”å›å€¼èŒƒå›´å°äºç­‰äºçˆ¶ç±»ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸èŒƒå›´å°äºç­‰äºçˆ¶ç±»ï¼Œè®¿é—®ä¿®é¥°ç¬¦èŒƒå›´å¤§äºç­‰äºçˆ¶ç±».</p><p>å“ªäº›æ–¹æ³•ä¸å¯ä»¥è¢«é‡å†™ï¼šfinal æ–¹æ³•ã€<strong>é™æ€æ–¹æ³•</strong>ã€private ä¸å¯è§æ–¹æ³•</p><p>å¯¹è±¡çš„å¤šæ€æ€§ï¼š</p><ul><li>å­ç±»å¦‚æœé‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé€šè¿‡å­ç±»å¯¹è±¡è°ƒç”¨çš„ä¸ä¸€å®šæ˜¯å­ç±»é‡å†™è¿‡çš„ä»£ç </li><li>éé™æ€æ–¹æ³•é»˜è®¤çš„è°ƒç”¨å¯¹è±¡æ˜¯ this</li><li>this å¯¹è±¡åœ¨æ„é€ å™¨æˆ–è€…è¯´ <code>&lt;init&gt;</code> æ–¹æ³•ä¸­å°±æ˜¯åœ¨è¿˜èƒ½å¤Ÿåœ¨åˆ›å»ºçš„å¯¹è±¡</li></ul><h3 id="Object-ç±»é€šç”¨æ–¹æ³•"><a href="#Object-ç±»é€šç”¨æ–¹æ³•" class="headerlink" title="Object ç±»é€šç”¨æ–¹æ³•"></a>Object ç±»é€šç”¨æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> Class&lt;?&gt; getClass()<span class="comment">//è¿”å›å½“å‰è¿è¡Œæ—¶å¯¹è±¡çš„Classå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> <span class="comment">//è¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¸»è¦ä½¿ç”¨åœ¨å“ˆå¸Œè¡¨ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> <span class="comment">//ç”¨äºæ¯”è¾ƒ 2 ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">native</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException<span class="comment">//åˆ›å»ºå¹¶è¿”å›å½“å‰å¯¹è±¡çš„ä¸€ä»½æ‹·è´ã€‚å¯¹äºä»»ä½•å¯¹è±¡ xï¼Œè¡¨è¾¾å¼ x.clone() != x ä¸ºtrueï¼Œx.clone().getClass() == x.getClass() ä¸º true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span><span class="comment">//è¿”å›ç±»çš„åå­—@å®ä¾‹çš„å“ˆå¸Œç çš„16è¿›åˆ¶çš„å­—ç¬¦ä¸²ã€‚å»ºè®®Objectæ‰€æœ‰çš„å­ç±»éƒ½é‡å†™è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">()</span><span class="comment">//å”¤é†’ä¸€ä¸ªåœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åœ¨ç­‰å¾…åªä¼šä»»æ„å”¤é†’ä¸€ä¸ª</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">notifyAll</span><span class="params">()</span><span class="comment">//å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout)</span> <span class="keyword">throws</span> InterruptedException<span class="comment">//æš‚åœçº¿ç¨‹çš„æ‰§è¡Œã€‚æ³¨æ„ï¼šsleepæ–¹æ³•æ²¡æœ‰é‡Šæ”¾é”ï¼Œè€Œwaitæ–¹æ³•é‡Šæ”¾äº†é” ã€‚timeoutæ˜¯ç­‰å¾…æ—¶é—´</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">(<span class="type">long</span> timeout, <span class="type">int</span> nanos)</span> <span class="keyword">throws</span> InterruptedException<span class="comment">//å¤šäº†nanoså‚æ•°ï¼Œè¡¨ç¤ºé¢å¤–æ—¶é—´(æ¯«ç§’)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">wait</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123; &#125;<span class="comment">//å®ä¾‹è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ—¶å€™è§¦å‘çš„æ“ä½œ</span></span><br></pre></td></tr></table></figure><h2 id="ä¸-equals"><a href="#ä¸-equals" class="headerlink" title="&#x3D;&#x3D; ä¸ equals"></a>&#x3D;&#x3D; ä¸ equals</h2><p>&#x3D;&#x3D; : åŸºæœ¬æ•°æ®ç±»å‹æ¯”è¾ƒçš„æ˜¯å€¼ï¼Œå¼•ç”¨æ•°æ®ç±»å‹æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€</p><p>equals : åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰</p><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>String é‡å†™ equals æ–¹æ³•ï¼Œå› ä¸º Object çš„ equals æ–¹æ³•æ˜¯æ¯”è¾ƒçš„å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œè€Œ String çš„ equals æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å€¼</li><li>åœ¨è‡ªå®šä¹‰ç±»é‡å†™ equals æ–¹æ³•å¿…é¡»é‡å†™ hashCode æ–¹æ³•</li><li>hashCode() ç›¸ç­‰æ˜¯ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰çš„å¿…è¦ä¸å……åˆ†æ¡ä»¶</li><li>equals ç›¸ç­‰æ˜¯ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰çš„å¿…è¦æ¡ä»¶</li></ul><h3 id="æ·±æ‹·è´å’Œæµ…æ‹·è´"><a href="#æ·±æ‹·è´å’Œæµ…æ‹·è´" class="headerlink" title="æ·±æ‹·è´å’Œæµ…æ‹·è´"></a>æ·±æ‹·è´å’Œæµ…æ‹·è´</h3><ul><li>æµ…æ‹·è´ï¼šæ‹·è´å¯¹è±¡ä¸åŸå¯¹è±¡çš„å¼•ç”¨æ—¶åŒä¸€ä¸ªå¯¹è±¡</li><li>æ·±æ‹·è´ï¼šæ‹·è´å¯¹è±¡ä¸åŸå¯¹è±¡çš„å¼•ç”¨ä¸ºä¸åŒå¯¹è±¡</li></ul><h3 id="æ–¹æ³•çš„å‚æ•°ä¼ é€’æœºåˆ¶"><a href="#æ–¹æ³•çš„å‚æ•°ä¼ é€’æœºåˆ¶" class="headerlink" title="æ–¹æ³•çš„å‚æ•°ä¼ é€’æœºåˆ¶"></a>æ–¹æ³•çš„å‚æ•°ä¼ é€’æœºåˆ¶</h3><p><strong>åŸºæœ¬æ•°æ®ç±»å‹</strong>ï¼šä¼ é€’æ•°æ®å€¼</p><p><strong>å¼•ç”¨ç±»å‹</strong>ï¼šä¼ é€’åœ°å€å€¼</p><p><strong>ç‰¹æ®Šç±»å‹</strong>ï¼šStringã€åŒ…è£…ç±»ç­‰å¯¹è±¡çš„ä¸å¯å˜æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">    <span class="type">int</span>[] arr = &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    <span class="type">Test</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    change(i, str, num, arr, t);</span><br><span class="line"></span><br><span class="line">    System.out.println(i); <span class="comment">// 1</span></span><br><span class="line">    System.out.println(str); <span class="comment">// hello</span></span><br><span class="line">    System.out.println(num); <span class="comment">// 200</span></span><br><span class="line">    System.out.println(Arrays.toString(arr)); <span class="comment">// [2,3,3]</span></span><br><span class="line">    System.out.println(t.a); <span class="comment">// 11</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span> j, String s, Integer n, <span class="type">int</span>[] a, Test t)</span>&#123;</span><br><span class="line">    j += <span class="number">1</span>;</span><br><span class="line">    s += <span class="string">&quot;world&quot;</span>;</span><br><span class="line">    n += <span class="number">1</span>;</span><br><span class="line">    a[<span class="number">0</span>] += <span class="number">1</span>;</span><br><span class="line">    t.a += <span class="number">1</span>; <span class="comment">// ä¿®æ”¹çš„æ˜¯å¯¹è±¡çš„æ‹·è´</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h3><h4 id="final"><a href="#final" class="headerlink" title="final"></a>final</h4><ul><li>ç±» ï¼š ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼Œæ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼åœ°æŒ‡å®šä¸ºfinalæ–¹æ³•</li><li>å˜é‡ : åŸºæœ¬æ•°æ®ç±»å‹å˜é‡åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½æ›´æ”¹ï¼›å¼•ç”¨ç±»å‹çš„å˜é‡åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½å†è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡</li><li>æ–¹æ³• ï¼š æ–¹æ³•é”å®šï¼Œç¦æ­¢è¢«ç»§æ‰¿ç±»é‡å†™</li></ul><h4 id="static"><a href="#static" class="headerlink" title="static"></a>static</h4><p>åˆå§‹åŒ–é¡ºåºï¼š<strong>é™æ€å˜é‡å’Œé™æ€è¯­å¥å—ä¼˜å…ˆäºå®ä¾‹å˜é‡å’Œæ™®é€šè¯­å¥å—</strong>ï¼Œé™æ€å˜é‡å’Œé™æ€è¯­å¥å—çš„åˆå§‹åŒ–é¡ºåºå–å†³äºå®ƒä»¬åœ¨ä»£ç ä¸­çš„é¡ºåºã€‚</p><p>å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š</p><ul><li>çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</li><li>å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</li><li>çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</li><li>çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</li><li>å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</li><li>å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</li></ul><h2 id="ç±»åˆå§‹åŒ–è¿‡ç¨‹"><a href="#ç±»åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="ç±»åˆå§‹åŒ–è¿‡ç¨‹"></a>ç±»åˆå§‹åŒ–è¿‡ç¨‹</h2><ul><li>ä¸€ä¸ªç±»è¦åˆ›å»ºå®ä¾‹éœ€è¦å…ˆåŠ è½½å¹¶åˆå§‹åŒ–è¯¥ç±»<ul><li>main æ–¹æ³•æ‰€åœ¨çš„ç±»éœ€è¦å…ˆåŠ è½½å’Œåˆå§‹åŒ–</li></ul></li><li>ä¸€ä¸ªå­ç±»è¦åˆå§‹åŒ–éœ€è¦å…ˆåˆå§‹åŒ–çˆ¶ç±»</li><li>ä¸€ä¸ªç±»åˆå§‹åŒ–å°±æ˜¯æ‰§è¡Œ <code>&lt;clinit&gt;</code> æ–¹æ³•<ul><li><clinit>&#96; æ–¹æ³•ç”±é™æ€ç±»å˜é‡æ˜¾ç¤ºèµ‹å€¼ä»£ç å’Œé™æ€ä»£ç å—ç»„æˆ</li><li>ç±»å˜é‡æ˜¾ç¤ºèµ‹å€¼ä»£ç å’Œé™æ€ä»£ç å—ä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œ</li><li><code>&lt;clinit&gt;</code> æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡</li></ul></li></ul><h2 id="å®ä¾‹åˆå§‹åŒ–è¿‡ç¨‹"><a href="#å®ä¾‹åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="å®ä¾‹åˆå§‹åŒ–è¿‡ç¨‹"></a>å®ä¾‹åˆå§‹åŒ–è¿‡ç¨‹</h2><ul><li>å®ä¾‹åˆå§‹åŒ–å°±æ˜¯æ‰§è¡Œ<code>&lt;init&gt;</code>æ–¹æ³•<ul><li><code>&lt;init&gt;</code> æ–¹æ³•å¯èƒ½é‡è½½æœ‰å¤šä¸ªæœ‰å‡ ä¸ªæ„é€ å™¨å°±æœ‰å‡ ä¸ª<code>&lt;init&gt;</code>æ–¹æ³•</li><li><code>&lt;init&gt;</code> æ–¹æ³•ç”±éé™æ€å®ä¾‹å˜é‡æ˜¾ç¤ºèµ‹å€¼ä»£ç å’Œéé™æ€ä»£ç å—ã€å¯¹åº”ç‹—åœ¨å…¶ä»£ç ç»„æˆ</li><li>éé™æ€å®ä¾‹å˜é‡æ˜¾ç¤ºèµ‹å€¼ä»£ç å’Œéé™æ€ä»£ç å—ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œï¼Œæ„é€ å™¨ä»£ç æœ€åæ‰§è¡Œ</li><li>æ¯æ¬¡åˆ›å»ºå®ä¾‹å¯¹è±¡è°ƒç”¨å¯¹è±¡çš„æ„é€ å™¨ï¼Œæ‰§è¡Œå¯¹åº”çš„<code>&lt;init&gt;</code> æ–¹æ³•</li></ul></li></ul><h2 id="è·å–ç”¨é”®ç›˜è¾“å…¥å¸¸ç”¨çš„ä¸¤ç§æ–¹æ³•"><a href="#è·å–ç”¨é”®ç›˜è¾“å…¥å¸¸ç”¨çš„ä¸¤ç§æ–¹æ³•" class="headerlink" title="è·å–ç”¨é”®ç›˜è¾“å…¥å¸¸ç”¨çš„ä¸¤ç§æ–¹æ³•"></a>è·å–ç”¨é”®ç›˜è¾“å…¥å¸¸ç”¨çš„ä¸¤ç§æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line"><span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span>  <span class="operator">=</span> in.nextLine();</span><br><span class="line">in.close();</span><br><span class="line"><span class="comment">//æ–¹æ³•äºŒï¼š</span></span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in));</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> in.readLine();</span><br></pre></td></tr></table></figure><h1 id="Java-å®¹å™¨"><a href="#Java-å®¹å™¨" class="headerlink" title="Java å®¹å™¨"></a>Java å®¹å™¨</h1><h3 id="å®¹å™¨åˆ†ç±»"><a href="#å®¹å™¨åˆ†ç±»" class="headerlink" title="å®¹å™¨åˆ†ç±»"></a>å®¹å™¨åˆ†ç±»</h3><p>å®¹å™¨ä¸»è¦åŒ…æ‹¬ Collection å’Œ Map ä¸¤ç§ï¼ŒCollection å­˜å‚¨ç€å¯¹è±¡çš„é›†åˆï¼Œè€Œ Map å­˜å‚¨ç€é”®å€¼å¯¹ï¼ˆä¸¤ä¸ªå¯¹è±¡ï¼‰çš„æ˜ å°„è¡¨ã€‚</p><ul><li>Set<ul><li>TreeSetï¼šåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œæ”¯æŒæœ‰åºæ€§æ“ä½œï¼Œä¾‹å¦‚æ ¹æ®ä¸€ä¸ªèŒƒå›´æŸ¥æ‰¾å…ƒç´ çš„æ“ä½œã€‚ä½†æ˜¯æŸ¥æ‰¾æ•ˆç‡ä¸å¦‚HashSetï¼ŒHashSet æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼ŒTreeSet åˆ™ä¸º O(logN)ã€‚</li><li>HashSetï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾ï¼Œä½†ä¸æ”¯æŒæœ‰åºæ€§æ“ä½œã€‚å¹¶ä¸”å¤±å»äº†å…ƒç´ çš„æ’å…¥é¡ºåºä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ ä½¿ç”¨ Iterator éå† HashSet å¾—åˆ°çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚</li><li>LinkedHashSetï¼šå…·æœ‰ HashSet çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œä¸”å†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚</li></ul></li><li>List<ul><li>ArrayListï¼šåŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œæ”¯æŒéšæœºè®¿é—®ã€‚</li><li>Vectorï¼šå’Œ ArrayList ç±»ä¼¼ï¼Œçº¿ç¨‹å®‰å…¨ã€‚</li><li>LinkedListï¼šåŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œåªèƒ½é¡ºåºè®¿é—®ï¼Œä½†æ˜¯å¯ä»¥å¿«é€Ÿåœ°åœ¨é“¾è¡¨ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒLinkedList è¿˜å¯ä»¥ç”¨ä½œæ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—ã€‚</li></ul></li><li>Queue<ul><li>LinkedListï¼šå¯ä»¥ç”¨å®ƒæ¥å®ç°åŒå‘é˜Ÿåˆ—ã€‚</li><li>PriorityQueueï¼šåŸºäºå †ç»“æ„å®ç°ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—ã€‚</li></ul></li></ul><h2 id="Javaå¹¶å‘"><a href="#Javaå¹¶å‘" class="headerlink" title="Javaå¹¶å‘"></a>Javaå¹¶å‘</h2><h2 id="é¢è¯•é—®é¢˜ï¼š"><a href="#é¢è¯•é—®é¢˜ï¼š" class="headerlink" title="é¢è¯•é—®é¢˜ï¼š"></a>é¢è¯•é—®é¢˜ï¼š</h2><p>1ã€åœ¨ä¸€ä¸ªé™æ€æ–¹æ³•å†…è°ƒç”¨ä¸€ä¸ªéé™æ€æˆå‘˜ä¸ºä»€ä¹ˆæ˜¯éæ³•çš„?</p><p>ç”±äºé™æ€æ–¹æ³•å¯ä»¥ä¸é€šè¿‡å¯¹è±¡è¿›è¡Œè°ƒç”¨ï¼Œå› æ­¤åœ¨é™æ€æ–¹æ³•é‡Œï¼Œä¸èƒ½è°ƒç”¨å…¶ä»–éé™æ€å˜é‡ï¼Œä¹Ÿä¸å¯ä»¥è®¿é—®éé™æ€å˜é‡æˆå‘˜ã€‚</p><p>2ã€åœ¨ Java ä¸­å®šä¹‰ä¸€ä¸ªä¸åšäº‹ä¸”æ²¡æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•çš„ä½œç”¨ï¼Ÿ</p><p>Java ç¨‹åºåœ¨æ‰§è¡Œå­ç±»çš„æ„é€ æ–¹æ³•ä¹‹å‰ï¼Œ&#x3D;&#x3D;å¦‚æœæ²¡æœ‰ç”¨ <code>super()</code>æ¥è°ƒç”¨çˆ¶ç±»ç‰¹å®šçš„æ„é€ æ–¹æ³•ï¼Œåˆ™ä¼šè°ƒç”¨çˆ¶ç±»ä¸­æ— å‚æ„é€ æ–¹æ³•&#x3D;&#x3D;ã€‚å¦‚æœçˆ¶ç±»ä¸­åªå®šä¹‰äº†æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œè€Œåœ¨å­ç±»çš„æ„é€ æ–¹æ³•ä¸­åˆæ²¡æœ‰ç”¨ <code>super()</code>æ¥è°ƒç”¨çˆ¶ç±»ä¸­ç‰¹å®šçš„æ„é€ æ–¹æ³•ï¼Œåˆ™ç¼–è¯‘æ—¶å°†å‘ç”Ÿé”™è¯¯ã€‚</p><p>3ã€æŠ½è±¡ç±»ä¸æ¥å£çš„åŒºåˆ«</p><ul><li>æ¥å£çš„æ–¹æ³•é»˜è®¤æ˜¯ <code>public</code> , æ‰€æœ‰æ–¹æ³•åœ¨æ¥å£ä¸­ä¸èƒ½æœ‰å®ç°ï¼ˆJDK 8 æ¥å£å…è®¸æœ‰é»˜è®¤å®ç°ï¼Œé™æ€æ–¹æ³•ï¼‰ï¼›æŠ½è±¡ç±»å¯ä»¥æœ‰éæŠ½è±¡æ–¹æ³•</li><li>æ¥å£ä¸­å®ä¾‹å˜é‡é»˜è®¤ä¸º final ç±»å‹ï¼›æŠ½è±¡ç±»ä¸ä¸€å®š</li><li>ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†åªèƒ½å®ç°ä¸€ä¸ªæŠ½è±¡ç±»</li><li>ä¸€ä¸ªç±»å®ç°æ¥å£éœ€è¦å®ç°æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•</li><li>&#x3D;&#x3D;æ¥å£ä¸èƒ½ç”¨ new å®ä¾‹åŒ–ï¼Œä½†å¯ä»¥å£°æ˜&#x3D;&#x3D;</li></ul><p>4ã€ä¸ºä»€ä¹ˆ Java ä¸­åªæœ‰å€¼ä¼ é€’ï¼Ÿ</p><ul><li>æŒ‰å€¼è°ƒç”¨(call by value)è¡¨ç¤ºæ–¹æ³•æ¥æ”¶çš„æ˜¯è°ƒç”¨è€…æä¾›çš„å€¼ã€‚</li><li>æŒ‰å¼•ç”¨è°ƒç”¨ï¼ˆcall by reference)è¡¨ç¤ºæ–¹æ³•æ¥æ”¶çš„æ˜¯è°ƒç”¨è€…æä¾›çš„å˜é‡åœ°å€ã€‚</li></ul><p>ä¸€ä¸ªæ–¹æ³•å¯ä»¥ä¿®æ”¹ä¼ é€’å¼•ç”¨æ‰€å¯¹åº”çš„å˜é‡å€¼ï¼Œè€Œä¸èƒ½ä¿®æ”¹ä¼ é€’å€¼è°ƒç”¨æ‰€å¯¹åº”çš„å˜é‡å€¼ã€‚</p><p><strong>Java ç¨‹åºè®¾è®¡è¯­è¨€æ€»æ˜¯é‡‡ç”¨æŒ‰å€¼è°ƒç”¨ã€‚æ–¹æ³•å¾—åˆ°çš„æ˜¯æ‰€æœ‰å‚æ•°å€¼çš„ä¸€ä¸ªæ‹·è´ï¼Œæ–¹æ³•ä¸èƒ½ä¿®æ”¹ä¼ é€’ç»™å®ƒçš„ä»»ä½•å‚æ•°å˜é‡çš„å†…å®¹ã€‚</strong></p><p>5ã€Java åºåˆ—åŒ–ä¸­å¦‚æœæœ‰äº›å­—æ®µä¸æƒ³è¿›è¡Œåºåˆ—åŒ–ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å¯¹äºä¸æƒ³è¿›è¡Œåºåˆ—åŒ–çš„å˜é‡ï¼Œä½¿ç”¨ transient å…³é”®å­—ä¿®é¥°ã€‚</p><p>transient å…³é”®å­—çš„ä½œç”¨æ˜¯ï¼šé˜»æ­¢å®ä¾‹ä¸­é‚£äº›ç”¨æ­¤å…³é”®å­—ä¿®é¥°çš„çš„å˜é‡åºåˆ—åŒ–ï¼›å½“å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œè¢« transient ä¿®é¥°çš„å˜é‡å€¼ä¸ä¼šè¢«æŒä¹…åŒ–å’Œæ¢å¤ã€‚transient åªèƒ½ä¿®é¥°å˜é‡ï¼Œä¸èƒ½ä¿®é¥°ç±»å’Œæ–¹æ³•ã€‚</p><h1 id="Javaé›†åˆ"><a href="#Javaé›†åˆ" class="headerlink" title="Javaé›†åˆ"></a>Javaé›†åˆ</h1><h1 id="IOç¼–ç¨‹"><a href="#IOç¼–ç¨‹" class="headerlink" title="IOç¼–ç¨‹"></a>IOç¼–ç¨‹</h1><h1 id="Javaâ€œé”â€"><a href="#Javaâ€œé”â€" class="headerlink" title="Javaâ€œé”â€"></a>Javaâ€œé”â€</h1><h2 id="æ‚²è§‚é”ä¸ä¹è§‚é”"><a href="#æ‚²è§‚é”ä¸ä¹è§‚é”" class="headerlink" title="æ‚²è§‚é”ä¸ä¹è§‚é”"></a>æ‚²è§‚é”ä¸ä¹è§‚é”</h2><p>æ‚²è§‚é”ï¼š&#x3D;&#x3D;è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¸€å®šæœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œå› æ­¤åœ¨è·å–æ•°æ®çš„æ—¶å€™ä¼šå…ˆåŠ é”ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹ã€‚&#x3D;&#x3D;synchronizedå…³é”®å­—å’ŒLockçš„å®ç°ç±»éƒ½æ˜¯æ‚²è§‚é”ã€‚é€‚åˆå†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œå…ˆåŠ é”å¯ä»¥ä¿è¯å†™æ“ä½œæ—¶æ•°æ®æ­£ç¡®ã€‚æ˜¾å¼çš„é”å®šä¹‹åå†æ“ä½œåŒæ­¥èµ„æºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//=============æ‚²è§‚é”çš„è°ƒç”¨æ–¹å¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">m1</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//åŠ é”åçš„ä¸šåŠ¡é€»è¾‘......</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªlockå¯¹è±¡çš„å‰æä¸‹</span></span><br><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">m2</span><span class="params">()</span> &#123;</span><br><span class="line">lock.lock();...</span><br></pre></td></tr></table></figure><p>ä¹è§‚é”:&#x3D;&#x3D;ä¹è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®æ—¶ä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šæ·»åŠ é”ï¼Œåªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¹‹å‰æœ‰æ²¡æœ‰åˆ«çš„çº¿ç¨‹æ›´æ–°äº†è¿™ä¸ªæ•°æ®ã€‚å¦‚æœè¿™ä¸ªæ•°æ®æ²¡æœ‰è¢«æ›´æ–°ï¼Œå½“å‰çº¿ç¨‹å°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®æˆåŠŸå†™å…¥&#x3D;&#x3D;ã€‚å¦‚æœæ•°æ®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼Œåˆ™æ ¹æ®ä¸åŒçš„å®ç°æ–¹å¼æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚ä¹è§‚é”åœ¨Javaä¸­æ˜¯é€šè¿‡ä½¿ç”¨æ— é”ç¼–ç¨‹æ¥å®ç°ï¼Œæœ€å¸¸é‡‡ç”¨çš„æ˜¯CASç®—æ³•ï¼ŒJavaåŸå­ç±»ä¸­çš„é€’å¢æ“ä½œå°±é€šè¿‡CASè‡ªæ—‹å®ç°çš„ã€‚é€‚åˆè¯»æ“ä½œå¤šçš„åœºæ™¯ï¼Œä¸åŠ é”çš„ç‰¹ç‚¹èƒ½å¤Ÿä½¿å…¶è¯»æ“ä½œçš„æ€§èƒ½å¤§å¹…æå‡ã€‚ä¹è§‚é”åˆ™ç›´æ¥å»æ“ä½œåŒæ­¥èµ„æºï¼Œæ˜¯ä¸€ç§æ— é”ç®—æ³•ï¼Œå¾—ä¹‹æˆ‘å¹¸ä¸å¾—æˆ‘å‘½ï¼Œå†æŠ¢ã€‚</p><p>ä¹è§‚é”ä¸€èˆ¬æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š1ã€é‡‡ç”¨ç‰ˆæœ¬å·æœºåˆ¶ã€‚2ã€CASï¼ˆCompare-and-Swapï¼Œå³æ¯”è¾ƒå¹¶æ›¿æ¢ï¼‰ç®—æ³•å®ç°ã€‚</p><h2 id="å…¬å¹³é”å’Œéå…¬å¹³é”"><a href="#å…¬å¹³é”å’Œéå…¬å¹³é”" class="headerlink" title="å…¬å¹³é”å’Œéå…¬å¹³é”"></a>å…¬å¹³é”å’Œéå…¬å¹³é”</h2><p>ä½•ä¸ºå…¬å¹³é”&#x2F;éå…¬å¹³é”?t</p><p>â½£æ´»ä¸­ï¼Œæ’é˜Ÿè®²æ±‚å…ˆæ¥ååˆ°è§†ä¸ºå…¬å¹³ã€‚ç¨‹åºä¸­çš„å…¬å¹³æ€§ä¹Ÿæ˜¯ç¬¦åˆè¯·æ±‚é”çš„ç»å¯¹æ—¶é—´çš„ï¼Œå…¶å®å°±æ˜¯ FIFOï¼Œå¦åˆ™è§†ä¸ºä¸å…¬å¹³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ticket</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">true</span>); <span class="comment">//é»˜è®¤falseç”¨çš„æ˜¯éå…¬å¹³é”ï¼Œåˆ†é…çš„å¹³å‡ä¸€ç‚¹ï¼Œ=--ã€‹å…¬å¹³ä¸€ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (number &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t å–å‡ºç¬¬: &quot;</span> + (number--) + <span class="string">&quot;\t è¿˜å‰©ä¸‹: &quot;</span> + number);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*Object objectLock = new Object();</span></span><br><span class="line"><span class="comment">    public void sale()&#123;</span></span><br><span class="line"><span class="comment">        synchronized (objectLock) &#123;</span></span><br><span class="line"><span class="comment">            if(number &gt; 0) &#123;</span></span><br><span class="line"><span class="comment">                System.out.println(Thread.currentThread().getName()+&quot;\t å–å‡ºç¬¬: &quot;+(number--)+&quot;\t è¿˜å‰©ä¸‹: &quot;+number);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaleTicketDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Ticket</span> <span class="variable">ticket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ticket</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">55</span>; i++) ticket.sale();</span><br><span class="line">        &#125;, <span class="string">&quot;a&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">55</span>; i++) ticket.sale();</span><br><span class="line">        &#125;, <span class="string">&quot;b&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">55</span>; i++) ticket.sale();</span><br><span class="line">        &#125;, <span class="string">&quot;c&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">55</span>; i++) ticket.sale();</span><br><span class="line">        &#125;, <span class="string">&quot;d&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">55</span>; i++) ticket.sale();</span><br><span class="line">        &#125;, <span class="string">&quot;e&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆä¼šæœ‰å…¬å¹³é”&#x2F;éå…¬å¹³é”çš„è®¾è®¡ä¸ºä»€ä¹ˆé»˜è®¤éå…¬å¹³ï¼Ÿ</strong></p><p>1ã€æ¢å¤æŒ‚èµ·çš„çº¿ç¨‹åˆ°çœŸæ­£é”çš„è·å–è¿˜æ˜¯æœ‰æ—¶é—´å·®çš„ï¼Œä»å¼€å‘äººå‘˜æ¥çœ‹è¿™ä¸ªæ—¶é—´å¾®ä¹å…¶å¾®ï¼Œä½†æ˜¯ä»CPUçš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸ªæ—¶é—´å·®å­˜åœ¨çš„è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚æ‰€ä»¥éå…¬å¹³é”èƒ½æ›´å……åˆ†çš„åˆ©ç”¨CPU çš„æ—¶é—´ç‰‡ï¼Œå°½é‡å‡å°‘ CPU ç©ºé—²çŠ¶æ€æ—¶é—´ã€‚</p><p>2ã€ä½¿ç”¨å¤šçº¿ç¨‹å¾ˆé‡è¦çš„è€ƒé‡ç‚¹æ˜¯çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œå½“é‡‡ç”¨éå…¬å¹³é”æ—¶ï¼Œå½“1ä¸ªçº¿ç¨‹è¯·æ±‚é”è·å–åŒæ­¥çŠ¶æ€ï¼Œç„¶åé‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå› ä¸ºä¸éœ€è¦è€ƒè™‘æ˜¯å¦è¿˜æœ‰å‰é©±èŠ‚ç‚¹ï¼Œæ‰€ä»¥åˆšé‡Šæ”¾é”çš„çº¿ç¨‹åœ¨æ­¤åˆ»å†æ¬¡è·å–åŒæ­¥çŠ¶æ€çš„æ¦‚ç‡å°±å˜å¾—éå¸¸å¤§ï¼Œæ‰€ä»¥å°±å‡å°‘äº†çº¿ç¨‹çš„å¼€é”€ã€‚</p><p><strong>ä½¿â½¤å…¬å¹³é”ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p><p>å…¬å¹³é”ä¿è¯äº†æ’é˜Ÿçš„å…¬å¹³æ€§ï¼Œéå…¬å¹³é”éœ¸æ°”çš„å¿½è§†è¿™ä¸ªè§„åˆ™ï¼Œæ‰€ä»¥å°±æœ‰å¯èƒ½å¯¼è‡´æ’é˜Ÿçš„é•¿æ—¶é—´åœ¨æ’é˜Ÿï¼Œä¹Ÿæ²¡æœ‰æœºä¼šè·å–åˆ°é”ï¼Œè¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ â€œé”é¥¥é¥¿â€ã€‚</p><p><strong>ä»€ä¹ˆæ—¶å€™ç”¨å…¬å¹³ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨éå…¬å¹³ï¼Ÿ</strong></p><p>å¦‚æœä¸ºäº†æ›´é«˜çš„ååé‡ï¼Œå¾ˆæ˜¾ç„¶éå…¬å¹³é”æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œå› ä¸ºèŠ‚çœå¾ˆå¤šçº¿ç¨‹åˆ‡æ¢æ—¶é—´ï¼Œååé‡è‡ªç„¶å°±ä¸Šå»äº†ï¼›å¦åˆ™é‚£å°±ç”¨å…¬å¹³é”ï¼Œå¤§å®¶å…¬å¹³ä½¿ç”¨ã€‚</p><h2 id="å¯é‡å…¥é”-åˆåé€’å½’é”"><a href="#å¯é‡å…¥é”-åˆåé€’å½’é”" class="headerlink" title="å¯é‡å…¥é”(åˆåé€’å½’é”)"></a>å¯é‡å…¥é”(åˆåé€’å½’é”)</h2><p>â€‹å¯é‡å…¥é”åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”(å‰æï¼Œé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡)ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚</p><p>â€‹å¦‚æœæ˜¯1ä¸ªæœ‰ synchronized ä¿®é¥°çš„é€’å½’è°ƒç”¨æ–¹æ³•ï¼Œç¨‹åºç¬¬2æ¬¡è¿›å…¥è¢«è‡ªå·±é˜»å¡äº†å²‚ä¸æ˜¯å¤©å¤§çš„ç¬‘è¯ï¼Œå‡ºç°äº†ä½œèŒ§è‡ªç¼šã€‚æ‰€ä»¥Javaä¸­ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡å…¥é”ï¼Œå¯é‡å…¥é”çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚</p><h3 id="å¯é‡å…¥é”ç§ç±»"><a href="#å¯é‡å…¥é”ç§ç±»" class="headerlink" title="å¯é‡å…¥é”ç§ç±»"></a>å¯é‡å…¥é”ç§ç±»</h3><h4 id="éšå¼é”"><a href="#éšå¼é”" class="headerlink" title="éšå¼é”"></a>éšå¼é”</h4><p>éšå¼é”ï¼ˆå³synchronizedå…³é”®å­—ä½¿ç”¨çš„é”ï¼‰é»˜è®¤æ˜¯å¯é‡å…¥é”ã€‚</p><p>éšå¼é”æŒ‡çš„æ˜¯å¯é‡å¤å¯é€’å½’è°ƒç”¨çš„é”ï¼Œåœ¨å¤–å±‚ä½¿ç”¨é”ä¹‹åï¼Œåœ¨å†…å±‚ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸å‘ç”Ÿæ­»é”ï¼Œè¿™æ ·çš„é”å°±å«åšå¯é‡å…¥é”ã€‚<br>ç®€å•çš„æ¥è¯´å°±æ˜¯ï¼šåœ¨ä¸€ä¸ªsynchronizedä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—çš„å†…éƒ¨è°ƒç”¨æœ¬ç±»çš„å…¶ä»–synchronizedä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—æ—¶ï¼Œæ˜¯æ°¸è¿œå¯ä»¥å¾—åˆ°é”çš„ã€‚ä¸å¯é‡å…¥é”ç›¸åï¼Œä¸å¯é‡å…¥é”ä¸å¯é€’å½’è°ƒç”¨ï¼Œé€’å½’è°ƒç”¨å°±å‘ç”Ÿæ­»é”ã€‚</p><h5 id="åŒæ­¥å¿«"><a href="#åŒæ­¥å¿«" class="headerlink" title="åŒæ­¥å¿«"></a>åŒæ­¥å¿«</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">Object</span> <span class="variable">objectLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();   </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">syncBlock</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (objectLock) &#123;<span class="comment">// lock</span></span><br><span class="line">            System.out.println(<span class="string">&quot;-----å¤–å±‚&quot;</span>);</span><br><span class="line">            <span class="keyword">synchronized</span> (objectLock) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;-----ä¸­å±‚&quot;</span>);</span><br><span class="line">                <span class="keyword">synchronized</span> (objectLock) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;-----å†…å±‚&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="comment">//unlock</span></span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åŒæ­¥æ–¹æ³•"><a href="#åŒæ­¥æ–¹æ³•" class="headerlink" title="åŒæ­¥æ–¹æ³•"></a>åŒæ­¥æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* * æŒ‡çš„æ˜¯å¯é‡å¤å¯é€’å½’è°ƒç”¨çš„é”ï¼Œåœ¨å¤–å±‚ä½¿ç”¨é”ä¹‹åï¼Œåœ¨å†…å±‚ä»ç„¶å¯ä»¥ä½¿ç”¨å¹¶ä¸”ä¸å‘ç”Ÿæ­»é”ï¼Œè¿™æ ·çš„é”å°±å«åšå¯é‡å…¥é”ã€‚</span></span><br><span class="line"><span class="comment"> * ç®€å•çš„æ¥è¯´å°±æ˜¯ï¼š</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * åœ¨ä¸€ä¸ªsynchronizedä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—çš„å†…éƒ¨è°ƒç”¨æœ¬ç±»çš„å…¶ä»–synchronizedä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—æ—¶ï¼Œæ˜¯æ°¸è¿œå¯ä»¥å¾—åˆ°é”çš„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReEntryLockDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">m1</span><span class="params">()</span> &#123;</span><br><span class="line">        m1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Synchronizedçš„é‡å…¥çš„å®ç°æœºç†"><a href="#Synchronizedçš„é‡å…¥çš„å®ç°æœºç†" class="headerlink" title="Synchronizedçš„é‡å…¥çš„å®ç°æœºç†"></a>Synchronizedçš„é‡å…¥çš„å®ç°æœºç†</h4><p>æ¯ä¸ªé”å¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªé”è®¡æ•°å™¨å’Œä¸€ä¸ªæŒ‡å‘æŒæœ‰è¯¥é”çš„çº¿ç¨‹çš„æŒ‡é’ˆã€‚</p><p>å½“æ‰§è¡Œmonitorenteræ—¶ï¼Œå¦‚æœç›®æ ‡é”å¯¹è±¡çš„è®¡æ•°å™¨ä¸ºé›¶ï¼Œé‚£ä¹ˆè¯´æ˜å®ƒæ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æ‰€æŒæœ‰ï¼ŒJavaè™šæ‹Ÿæœºä¼šå°†è¯¥é”å¯¹è±¡çš„æŒæœ‰çº¿ç¨‹è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…¶è®¡æ•°å™¨åŠ 1ã€‚</p><p>åœ¨ç›®æ ‡é”å¯¹è±¡çš„è®¡æ•°å™¨ä¸ä¸ºé›¶çš„æƒ…å†µä¸‹ï¼Œå¦‚æœé”å¯¹è±¡çš„æŒæœ‰çº¿ç¨‹æ˜¯å½“å‰çº¿ç¨‹ï¼Œé‚£ä¹ˆ Java è™šæ‹Ÿæœºå¯ä»¥å°†å…¶è®¡æ•°å™¨åŠ 1ï¼Œå¦åˆ™éœ€è¦ç­‰å¾…ï¼Œç›´è‡³æŒæœ‰çº¿ç¨‹é‡Šæ”¾è¯¥é”ã€‚</p><p>å½“æ‰§è¡Œmonitorexitæ—¶ï¼ŒJavaè™šæ‹Ÿæœºåˆ™éœ€å°†é”å¯¹è±¡çš„è®¡æ•°å™¨å‡1ã€‚è®¡æ•°å™¨ä¸ºé›¶ä»£è¡¨é”å·²è¢«é‡Šæ”¾ã€‚</p><p>ä¸ºä»€ä¹ˆä»»ä½•ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥æˆä¸ºä¸€ä¸ªé”ï¼Ÿ</p><p>åœ¨Javaä¸­ï¼Œä»»ä½•ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥æˆä¸ºä¸€ä¸ªé”æ˜¯å› ä¸ºJavaçš„å†…ç½®åŒæ­¥æœºåˆ¶æ˜¯åŸºäºæ¯ä¸ªå¯¹è±¡çš„ç›‘è§†å™¨ï¼ˆmonitorï¼‰å®ç°çš„ã€‚ç›‘è§†å™¨æ˜¯ä¸€ç§åŒæ­¥å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åè°ƒå¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p><h4 id="æ˜¾å¼é”ï¼ˆå³Lockï¼‰"><a href="#æ˜¾å¼é”ï¼ˆå³Lockï¼‰" class="headerlink" title="æ˜¾å¼é”ï¼ˆå³Lockï¼‰"></a>æ˜¾å¼é”ï¼ˆå³Lockï¼‰</h4><p>æ˜¾å¼é”ï¼ˆå³Lockï¼‰ä¹Ÿæœ‰ReentrantLockè¿™æ ·çš„å¯é‡å…¥é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;-----å¤–å±‚&quot;</span>);</span><br><span class="line">                lock.lock();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;-----å†…å±‚&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    lock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;------22222&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="æ­»é”åŠæ’æŸ¥"><a href="#æ­»é”åŠæ’æŸ¥" class="headerlink" title="æ­»é”åŠæ’æŸ¥"></a>æ­»é”åŠæ’æŸ¥</h2><p>â€‹æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­,å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡,è‹¥æ— å¤–åŠ›å¹²æ¶‰é‚£å®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ï¼Œå¦‚æœç³»ç»Ÿèµ„æºå……è¶³ï¼Œè¿›ç¨‹çš„èµ„æºè¯·æ±‚éƒ½èƒ½å¤Ÿå¾—åˆ°æ»¡è¶³ï¼Œæ­»é”å‡ºç°çš„å¯èƒ½æ€§å°±å¾ˆä½ï¼Œå¦åˆ™å°±ä¼šå› äº‰å¤ºæœ‰é™çš„èµ„æºè€Œé™·å…¥æ­»é”ã€‚</p><p>äº§ç”Ÿæ­»é”ä¸»è¦åŸå› :</p><ol><li>ç³»ç»Ÿèµ„æºä¸è¶³</li><li>è¿›ç¨‹è¿è¡Œæ¨è¿›çš„é¡ºåºä¸åˆé€‚</li><li>èµ„æºåˆ†é…ä¸å½“</li></ol><p>æ­»é”æ¡ˆä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadLockDemo</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot; è‡ªå·±æŒæœ‰Aé”ï¼ŒæœŸå¾…è·å¾—Bé”&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è·å¾—Bé”æˆåŠŸ&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        a.start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot; è‡ªå·±æŒæœ‰Bé”ï¼ŒæœŸå¾…è·å¾—Aé”&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è·å¾—Aé”æˆåŠŸ&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;b&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä½•æ’æŸ¥æ­»é”</p><p>çº¯å‘½ä»¤: 1ã€jps -l ï¼›2ã€jstack è¿›ç¨‹ç¼–å·ï¼›</p><p>å›¾å½¢åŒ–ï¼šjconsole</p><h1 id="JUCå¹¶å‘ç¼–ç¨‹"><a href="#JUCå¹¶å‘ç¼–ç¨‹" class="headerlink" title="JUCå¹¶å‘ç¼–ç¨‹"></a>JUCå¹¶å‘ç¼–ç¨‹</h1><h2 id="çº¿ç¨‹åŸºç¡€çŸ¥è¯†"><a href="#çº¿ç¨‹åŸºç¡€çŸ¥è¯†" class="headerlink" title="çº¿ç¨‹åŸºç¡€çŸ¥è¯†"></a>çº¿ç¨‹åŸºç¡€çŸ¥è¯†</h2><p>1ã€è¿›ç¨‹ï¼šæ˜¯ç¨‹åºçš„â¼€æ¬¡æ‰§â¾ï¼Œæ˜¯&#x3D;&#x3D;ç³»ç»Ÿè¿›â¾èµ„æºåˆ†é…å’Œè°ƒåº¦çš„ç‹¬â½´å•ä½&#x3D;&#x3D;ï¼Œæ¯â¼€ä¸ªè¿›ç¨‹éƒ½æœ‰å®ƒâ¾ƒâ¼°çš„å†…å­˜ç©ºé—´å’Œç³»ç»Ÿèµ„æºã€‚</p><p>2ã€çº¿ç¨‹ï¼šåœ¨åŒâ¼€ä¸ªè¿›ç¨‹å†…â¼œå¯ä»¥æ‰§â¾å¤šä¸ªä»»åŠ¡ï¼Œâ½½è¿™æ¯â¼€ä¸ªä»»åŠ¡æˆ‘ä»¬å°±å¯ä»¥çœ‹åšæ˜¯â¼€ä¸ªçº¿ç¨‹ï¼Œâ¼€ä¸ªè¿›ç¨‹ä¼šæœ‰1ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚</p><p>3ã€ç®¡ç¨‹ï¼šå³Monitor(ç›‘è§†å™¨)ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³æ—¶æ‰€è¯´çš„é”ã€‚</p><p>Monitorå…¶å®æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œä»–çš„ä¹‰åŠ¡æ˜¯ä¿è¯ï¼ˆåŒä¸€æ—¶é—´ï¼‰åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è¢«ä¿æŠ¤çš„æ•°æ®å’Œä»£ç ã€‚</p><p>JVMä¸­åŒæ­¥æ˜¯åŸºäºè¿›å…¥å’Œé€€å‡ºç›‘è§†å™¨å¯¹è±¡(Monitor,ç®¡ç¨‹å¯¹è±¡)æ¥å®ç°çš„ï¼Œæ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½ä¼šæœ‰ä¸€ä¸ªMonitorå¯¹è±¡ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;    </span><br><span class="line">  <span class="keyword">synchronized</span> (o)    &#123;   </span><br><span class="line">  &#125;</span><br><span class="line">&#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>Monitorå¯¹è±¡ä¼šå’ŒJavaå¯¹è±¡ä¸€åŒåˆ›å»ºå¹¶é”€æ¯ï¼Œå®ƒåº•å±‚æ˜¯ç”±C++è¯­è¨€æ¥å®ç°çš„ã€‚</p><p>4ã€ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹</p><p>Javaçº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ï¼Œçº¿ç¨‹çš„daemonå±æ€§ä¸ºtrueè¡¨ç¤ºæ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œfalseè¡¨ç¤ºæ˜¯ç”¨æˆ·çº¿ç¨‹ã€‚</p><p>å®ˆæŠ¤çº¿ç¨‹ï¼šæ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹ï¼Œåœ¨åå°é»˜é»˜åœ°å®Œæˆä¸€äº›ç³»ç»Ÿæ€§çš„æœåŠ¡ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹ã€‚</p><p>ç”¨æˆ·çº¿ç¨‹ï¼šæ˜¯ç³»ç»Ÿçš„å·¥ä½œçº¿ç¨‹ï¼Œå®ƒä¼šå®Œæˆè¿™ä¸ªç¨‹åºéœ€è¦å®Œæˆçš„ä¸šåŠ¡æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span>Â com.atguigu.itdachang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>Â <span class="keyword">class</span>Â <span class="title class_">DaemonDemo</span>&#123;</span><br><span class="line">  <span class="keyword">public</span>Â <span class="keyword">static</span>Â <span class="keyword">void</span>Â <span class="title function_">main</span><span class="params">(String[]Â args)</span>&#123;Â Â Â Â </span><br><span class="line">    <span class="type">Thread</span>Â <span class="variable">t1</span>Â <span class="operator">=</span>Â <span class="keyword">new</span>Â <span class="title class_">Thread</span>(()Â -&gt;Â &#123;Â Â Â Â Â Â Â Â </span><br><span class="line">      System.out.println(Thread.currentThread().getName()+<span class="string">&quot;\tÂ å¼€å§‹è¿è¡Œï¼Œ&quot;</span>+(Thread.currentThread().isDaemon()Â ?Â <span class="string">&quot;å®ˆæŠ¤çº¿ç¨‹&quot;</span>:<span class="string">&quot;ç”¨æˆ·çº¿ç¨‹&quot;</span>));Â Â Â Â Â Â Â Â </span><br><span class="line">      <span class="keyword">while</span>Â (<span class="literal">true</span>)Â &#123;</span><br><span class="line">      &#125;Â Â Â Â </span><br><span class="line">    &#125;,Â <span class="string">&quot;t1&quot;</span>);Â Â Â Â </span><br><span class="line">    <span class="comment">//çº¿ç¨‹çš„daemonå±æ€§ä¸ºtrueè¡¨ç¤ºæ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œfalseè¡¨ç¤ºæ˜¯ç”¨æˆ·çº¿ç¨‹Â Â Â Â </span></span><br><span class="line">    t1.setDaemon(<span class="literal">true</span>);Â Â Â Â </span><br><span class="line">    t1.start();Â Â Â Â </span><br><span class="line">    <span class="comment">//3ç§’é’Ÿåä¸»çº¿ç¨‹å†è¿è¡ŒÂ Â Â Â </span></span><br><span class="line">    <span class="keyword">try</span>Â &#123;Â </span><br><span class="line">      TimeUnit.SECONDS.sleep(<span class="number">3</span>);Â </span><br><span class="line">    &#125;Â <span class="keyword">catch</span>Â (InterruptedExceptionÂ e)Â &#123;Â </span><br><span class="line">      e.printStackTrace();Â </span><br><span class="line">    &#125;Â Â Â Â </span><br><span class="line">    System.out.println(<span class="string">&quot;----------mainçº¿ç¨‹è¿è¡Œå®Œæ¯•&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå½“ç¨‹åºä¸­æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¸ç®¡å®ˆæŠ¤çº¿ç¨‹æ˜¯å¦ç»“æŸï¼Œç³»ç»Ÿéƒ½ä¼šè‡ªåŠ¨é€€å‡ºã€‚å¦‚æœç”¨æˆ·çº¿ç¨‹å…¨éƒ¨ç»“æŸäº†ï¼Œæ„å‘³ç€ç¨‹åºéœ€è¦å®Œæˆçš„ä¸šåŠ¡æ“ä½œå·²ç»ç»“æŸäº†ï¼Œç³»ç»Ÿå¯ä»¥é€€å‡ºäº†ã€‚æ‰€ä»¥&#x3D;&#x3D;å½“ç³»ç»Ÿåªå‰©ä¸‹å®ˆæŠ¤è¿›ç¨‹çš„æ—¶å€™ï¼Œjavaè™šæ‹Ÿæœºä¼šè‡ªåŠ¨é€€å‡º&#x3D;&#x3D;ã€‚è®¾ç½®å®ˆæŠ¤çº¿ç¨‹ï¼Œéœ€è¦åœ¨start()æ–¹æ³•ä¹‹å‰è¿›è¡Œã€‚</p><h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><h3 id="çº¿ç¨‹çš„åˆ›å»º"><a href="#çº¿ç¨‹çš„åˆ›å»º" class="headerlink" title="çº¿ç¨‹çš„åˆ›å»º"></a>çº¿ç¨‹çš„åˆ›å»º</h3><p>æ–¹å¼ä¸€ï¼š<strong>ä½¿ç”¨ Threadç±»æˆ–ç»§æ‰¿Threadç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼š<strong>å®ç° Runnable æ¥å£é…åˆThread</strong></p><p>æŠŠã€çº¿ç¨‹ã€‘å’Œã€ä»»åŠ¡ã€‘ï¼ˆè¦æ‰§è¡Œçš„ä»£ç ï¼‰åˆ†å¼€</p><ul><li>Thread ä»£è¡¨çº¿ç¨‹</li><li>Runnable å¯è¿è¡Œçš„ä»»åŠ¡ï¼ˆçº¿ç¨‹è¦æ‰§è¡Œçš„ä»£ç ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>( runnable );</span><br><span class="line"><span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">t.start(); </span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼3ï¼šä½¿ç”¨æœ‰è¿”å›å€¼çš„ Callable</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span>Â <span class="title class_">CallableTask</span>Â <span class="keyword">implements</span>Â <span class="title class_">Callable</span>&lt;Integer&gt;Â &#123;</span><br><span class="line">Â Â Â Â <span class="meta">@Override</span></span><br><span class="line">Â Â Â Â <span class="keyword">public</span>Â IntegerÂ <span class="title function_">call</span><span class="params">()</span>Â <span class="keyword">throws</span>Â ExceptionÂ &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â <span class="keyword">return</span>Â <span class="keyword">new</span>Â <span class="title class_">Random</span>().nextInt();</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line"><span class="type">ExecutorService</span>Â <span class="variable">service</span>Â <span class="operator">=</span>Â Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//æäº¤ä»»åŠ¡ï¼Œå¹¶ç”¨Â Futureæäº¤è¿”å›ç»“æœ</span></span><br><span class="line">Future&lt;Integer&gt; future = service.submit(<span class="keyword">new</span> <span class="title class_">CallableTask</span>()); </span><br></pre></td></tr></table></figure><p>æ–¹å¼4:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span>Â <span class="title class_">Thread</span>(</span><br><span class="line">  ()Â -&gt;Â System.out.println(Thread.currentThread().getName())</span><br><span class="line">).start();</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬è´¨ä¸ŠJavaä¸­å®ç°çº¿ç¨‹åªæœ‰ä¸€ç§æ–¹å¼ï¼Œéƒ½æ˜¯é€šè¿‡new Thread()åˆ›å»ºçº¿ç¨‹ï¼Œè°ƒç”¨Thread#startå¯åŠ¨çº¿ç¨‹æœ€ç»ˆéƒ½ä¼šè°ƒç”¨Thread#runæ–¹æ³•.</p></blockquote><h3 id="çº¿ç¨‹å¯åŠ¨å’Œåœæ­¢"><a href="#çº¿ç¨‹å¯åŠ¨å’Œåœæ­¢" class="headerlink" title="çº¿ç¨‹å¯åŠ¨å’Œåœæ­¢"></a>çº¿ç¨‹å¯åŠ¨å’Œåœæ­¢</h3><p>çº¿ç¨‹å¯åŠ¨ï¼šè°ƒç”¨startæ–¹æ³•</p><p>çº¿ç¨‹åœæ­¢ï¼šè°ƒç”¨stopæ–¹æ³•</p><p>æ³¨æ„ï¼šçº¿ç¨‹è‡ªå¸¦çš„stopæ–¹æ³•ï¼Œä¸€æ–¹é¢å·²ç»è¿‡æ—¶ï¼Œå¦ä¸€æ–¹é¢ï¼Œ&#x3D;&#x3D;ä¸ä¼šå¯¹åœæ­¢çš„çº¿ç¨‹åšçŠ¶æ€ä¿å­˜ï¼Œä½¿å¾—çº¿ç¨‹ä¸­æ¶‰åŠçš„å¯¹è±¡å¤„äºæœªçŸ¥çŠ¶æ€&#x3D;&#x3D;ï¼Œå¦‚æœè¿™äº›çŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šä½¿ç”¨ï¼Œå°†ä¼šä½¿å¾—å…¶ä»–çº¿ç¨‹å‡ºç°æ— æ³•é¢„æ–™çš„å¼‚å¸¸ï¼Œæ‰€ä»¥ï¼Œåœæ­¢ç¨‹åºçš„åŠŸèƒ½ï¼Œéœ€è¦è‡ªå·±å®ç°ã€‚</p><h3 id="çº¿ç¨‹æš‚åœå’Œä¸­æ–­"><a href="#çº¿ç¨‹æš‚åœå’Œä¸­æ–­" class="headerlink" title="çº¿ç¨‹æš‚åœå’Œä¸­æ–­"></a>çº¿ç¨‹æš‚åœå’Œä¸­æ–­</h3><p>æš‚åœ:Javaä¸­çº¿ç¨‹çš„æš‚åœæ˜¯è°ƒç”¨ java.lang.Thread ç±»çš„ sleep æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šä½¿å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœ,æŒ‡å®šçš„ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœçº¿ç¨‹æŒæœ‰é”ï¼Œ&#x3D;&#x3D;sleep æ–¹æ³•ç»“æŸå‰å¹¶ä¸ä¼šé‡Šæ”¾è¯¥é”&#x3D;&#x3D;ã€‚</p><p>ä¸­æ–­: interrupt æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç›´æ¥å¯¹çº¿ç¨‹è°ƒç”¨ã€‚&#x3D;&#x3D;å½“è¢«interruptçš„çº¿ç¨‹æ­£åœ¨sleepæˆ–waitæ—¶ï¼Œä¼šæŠ›å‡º InterruptedException å¼‚å¸¸&#x3D;&#x3D;ã€‚interrupt æ–¹æ³•åªæ˜¯æ”¹å˜ç›®æ ‡çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼ˆinterrupt statusï¼‰ï¼Œè€Œé‚£äº›ä¼šæŠ›å‡ºInterruptedException å¼‚å¸¸çš„æ–¹æ³•ï¼Œå¦‚waitã€sleepã€joinç­‰ï¼Œéƒ½æ˜¯åœ¨æ–¹æ³•å†…éƒ¨ä¸æ–­åœ°æ£€æŸ¥ä¸­æ–­çŠ¶æ€çš„å€¼ã€‚</p><ul><li><p>interruptæ–¹æ³•</p><p>Threadå®ä¾‹æ–¹æ³•ï¼šå¿…é¡»ç”±å…¶å®ƒçº¿ç¨‹è·å–è¢«è°ƒç”¨çº¿ç¨‹çš„å®ä¾‹åï¼Œè¿›è¡Œè°ƒç”¨ã€‚å®é™…ä¸Šï¼Œåªæ˜¯æ”¹å˜äº†è¢«è°ƒç”¨çº¿ç¨‹çš„å†…éƒ¨ä¸­æ–­çŠ¶æ€ï¼›</p></li><li><p>Thread.interruptedæ–¹æ³•</p><p>Threadç±»æ–¹æ³•ï¼šå¿…é¡»åœ¨å½“å‰æ‰§è¡Œçº¿ç¨‹å†…è°ƒç”¨ï¼Œè¯¥æ–¹æ³•è¿”å›å½“å‰çº¿ç¨‹çš„å†…éƒ¨ä¸­æ–­çŠ¶æ€ï¼Œç„¶åæ¸…é™¤ä¸­æ–­çŠ¶æ€ï¼ˆç½®ä¸ºfalseï¼‰ ï¼›</p></li><li><p>isInterruptedæ–¹æ³•</p><p>Threadå®ä¾‹æ–¹æ³•ï¼šç”¨æ¥æ£€æŸ¥æŒ‡å®šçº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚å½“çº¿ç¨‹ä¸ºä¸­æ–­çŠ¶æ€æ—¶ï¼Œä¼šè¿”å›trueï¼›å¦åˆ™è¿”å›falseã€‚</p></li></ul><p>interrupt() ï¼š</p><ul><li>interrupt ä¸­æ–­æ“ä½œæ—¶ï¼Œéè‡ªèº«æ‰“æ–­éœ€è¦å…ˆæ£€æµ‹æ˜¯å¦æœ‰ä¸­æ–­æƒé™ï¼Œè¿™ç”±jvmçš„å®‰å…¨æœºåˆ¶é…ç½®ï¼›</li><li>å¦‚æœçº¿ç¨‹å¤„äºsleep, wait, join ç­‰çŠ¶æ€ï¼Œé‚£ä¹ˆçº¿ç¨‹å°†ç«‹å³é€€å‡ºè¢«é˜»å¡çŠ¶æ€ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ï¼›</li><li>å¦‚æœçº¿ç¨‹å¤„äºI&#x2F;Oé˜»å¡çŠ¶æ€ï¼Œå°†ä¼šæŠ›å‡ºClosedByInterruptExceptionï¼ˆIOExceptionçš„å­ç±»ï¼‰å¼‚å¸¸ï¼›</li><li>å¦‚æœçº¿ç¨‹åœ¨Selectorä¸Šè¢«é˜»å¡ï¼Œselectæ–¹æ³•å°†ç«‹å³è¿”å›ï¼›</li><li>å¦‚æœéä»¥ä¸Šæƒ…å†µï¼Œå°†ç›´æ¥æ ‡è®° interrupt çŠ¶æ€ï¼›</li></ul><p>æ³¨æ„ï¼šinterrupt æ“ä½œä¸ä¼šæ‰“æ–­æ‰€æœ‰é˜»å¡ï¼Œåªæœ‰ä¸Šè¿°é˜»å¡æƒ…å†µæ‰åœ¨jvmçš„æ‰“æ–­èŒƒå›´å†…ï¼Œå¦‚å¤„äºé”é˜»å¡çš„çº¿ç¨‹ï¼Œä¸ä¼šå— interrupt ä¸­æ–­ï¼›</p><p>é˜»å¡æƒ…å†µä¸‹ä¸­æ–­ï¼ŒæŠ›å‡ºå¼‚å¸¸åçº¿ç¨‹æ¢å¤éä¸­æ–­çŠ¶æ€ï¼Œå³ interrupted &#x3D; false</p><h3 id="çº¿ç¨‹çš„çŠ¶æ€"><a href="#çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çš„çŠ¶æ€"></a>çº¿ç¨‹çš„çŠ¶æ€</h3><p>Javaçº¿ç¨‹å¯èƒ½çš„çŠ¶æ€ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81.png" alt="image-20240527003435340"></p><p>çº¿ç¨‹çš„çŠ¶æ€å˜è¿</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81%E5%8F%98%E8%BF%81.png" alt="image-20240526212126155"></p><h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><p>çº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œè´Ÿè´£å½“å‰è¿›ç¨‹ä¸­ç¨‹åºçš„æ‰§è¡Œï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­æ˜¯å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹çš„ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºå¤šçº¿ç¨‹ç¨‹åºã€‚</p><h3 id="å¹¶å‘å’Œå¹¶è¡Œ"><a href="#å¹¶å‘å’Œå¹¶è¡Œ" class="headerlink" title="å¹¶å‘å’Œå¹¶è¡Œ"></a>å¹¶å‘å’Œå¹¶è¡Œ</h3><ul><li>å¹¶è¡Œæ˜¯æŒ‡ä¸¤ä¸ªæˆ–è€…å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿï¼›è€Œå¹¶å‘æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨åŒä¸€æ—¶é—´é—´éš”å‘ç”Ÿã€‚</li><li>å¹¶è¡Œæ˜¯åœ¨ä¸åŒå®ä½“ä¸Šçš„å¤šä¸ªäº‹ä»¶ï¼Œå¹¶å‘æ˜¯åœ¨åŒä¸€å®ä½“ä¸Šçš„å¤šä¸ªäº‹ä»¶ã€‚</li><li>åœ¨ä¸€å°å¤„ç†å™¨ä¸Šâ€œåŒæ—¶â€å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œåœ¨å¤šå°å¤„ç†å™¨ä¸ŠåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ã€‚å¦‚hadoopåˆ†å¸ƒå¼é›†ç¾¤ã€‚</li></ul><h3 id="å¤šçº¿ç¨‹çš„å¥½å¤„"><a href="#å¤šçº¿ç¨‹çš„å¥½å¤„" class="headerlink" title="å¤šçº¿ç¨‹çš„å¥½å¤„"></a>å¤šçº¿ç¨‹çš„å¥½å¤„</h3><p>æé«˜cpuçš„åˆ©ç”¨ç‡ï¼šåœ¨ç­‰å¾…ç£ç›˜IOï¼Œç½‘ç»œIOæˆ–è€…ç­‰å¾…ç”¨æˆ·è¾“å…¥æ—¶ï¼ŒCPUå¯ä»¥åŒæ—¶å»å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚</p><p>æ›´é«˜æ•ˆçš„å“åº”ï¼šå¤šçº¿ç¨‹ä½¿ç¨‹åºçš„å“åº”é€Ÿåº¦æ›´å¿« ,å› ä¸ºç”¨æˆ·ç•Œé¢å¯ä»¥åœ¨è¿›è¡Œå…¶å®ƒå·¥ä½œçš„åŒæ—¶ä¸€ç›´å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œä¸ä¼šé€ æˆæ— æ³•å“åº”çš„ç°è±¡ã€‚</p><p>å…¬å¹³ä½¿ç”¨CPUèµ„æºï¼šå½“å‰æ²¡æœ‰è¿›è¡Œå¤„ç†çš„ä»»åŠ¡ï¼Œå¯ä»¥å°†å¤„ç†å™¨æ—¶é—´è®©ç»™å…¶å®ƒä»»åŠ¡;å ç”¨å¤§é‡å¤„ç†æ—¶é—´çš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å®šæœŸå°†å¤„ç†å™¨æ—¶é—´è®©ç»™å…¶å®ƒä»»åŠ¡;é€šè¿‡å¯¹CPUæ—¶é—´çš„åˆ’åˆ†ï¼Œä½¿å¾—CPUæ—¶é—´ç‰‡å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œé¿å…éœ€è¦é•¿æ—¶é—´å¤„ç†çš„çº¿ç¨‹ç‹¬å CPUï¼Œå¯¼è‡´å…¶å®ƒçº¿ç¨‹é•¿æ—¶é—´ç­‰å¾…ã€‚</p><h3 id="å¤šçº¿ç¨‹çš„ä»£ä»·"><a href="#å¤šçº¿ç¨‹çš„ä»£ä»·" class="headerlink" title="å¤šçº¿ç¨‹çš„ä»£ä»·"></a>å¤šçº¿ç¨‹çš„ä»£ä»·</h3><p>æ›´å¤æ‚çš„è®¾è®¡</p><p>â€‹å…±äº«æ•°æ®çš„è¯»å–ï¼Œæ•°æ®çš„å®‰å…¨æ€§ï¼Œçº¿ç¨‹ä¹‹é—´çš„äº¤äº’ï¼Œçº¿ç¨‹çš„åŒæ­¥ç­‰ï¼›</p><p>ä¸Šä¸‹æ–‡ç¯å¢ƒåˆ‡æ¢</p><p>â€‹çº¿ç¨‹åˆ‡æ¢ï¼Œcpuéœ€è¦ä¿å­˜æœ¬åœ°æ•°æ®ã€ç¨‹åºæŒ‡é’ˆç­‰å†…å®¹ï¼›</p><p>æ›´å¤šçš„èµ„æºæ¶ˆè€—</p><p>â€‹æ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦å†…å­˜ç»´æŠ¤è‡ªå·±çš„æœ¬åœ°æ ˆä¿¡æ¯ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿéœ€è¦èµ„æºå¯¹çº¿ç¨‹è¿›è¡Œç®¡ç†ç»´æŠ¤ï¼›</p><h2 id="å¹¶å‘ç¼–ç¨‹åŸºç¡€"><a href="#å¹¶å‘ç¼–ç¨‹åŸºç¡€" class="headerlink" title="å¹¶å‘ç¼–ç¨‹åŸºç¡€"></a>å¹¶å‘ç¼–ç¨‹åŸºç¡€</h2><h3 id="ä¸´ç•Œèµ„æº"><a href="#ä¸´ç•Œèµ„æº" class="headerlink" title="ä¸´ç•Œèµ„æº"></a>ä¸´ç•Œèµ„æº</h3><p>â€‹&#x3D;&#x3D;ä¸´ç•Œèµ„æºæ˜¯ä¸€æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨çš„å…±äº«èµ„æºã€‚&#x3D;&#x3D;<strong>å„è¿›ç¨‹é‡‡å–äº’æ–¥çš„æ–¹å¼ï¼Œå®ç°å…±äº«çš„èµ„æºç§°ä½œä¸´ç•Œèµ„æºã€‚</strong>å±äºä¸´ç•Œèµ„æºçš„ç¡¬ä»¶æœ‰ï¼Œæ‰“å°æœºï¼Œç£å¸¦æœºç­‰ï¼›è½¯ä»¶æœ‰æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå˜é‡ï¼Œæ•°ç»„ï¼Œç¼“å†²åŒºç­‰ã€‚è¯¸è¿›ç¨‹é—´é‡‡å–äº’æ–¥æ–¹å¼ï¼Œå®ç°å¯¹è¿™ç§èµ„æºçš„å…±äº«ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">  <span class="comment">// ä¸´ç•Œèµ„æº</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// ä¸´ç•ŒåŒº  ï¼ˆåœ¨ä¸´ç•ŒåŒºä¸­ä½¿ç”¨é€‚å½“çš„åŒæ­¥å°±å¯ä»¥é¿å…ç«æ€æ¡ä»¶ï¼Œå¦‚ä½¿ç”¨synchronizedæˆ–è€…åŠ é”æœºåˆ¶ã€‚ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">long</span> value)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.count = <span class="built_in">this</span>.count + value;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h3><h4 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><p><strong>ä½•è°“ç«æ€æ¡ä»¶</strong></p><p>â€‹å½“ä¸¤ä¸ªçº¿ç¨‹ç«äº‰åŒä¸€èµ„æºæ—¶ï¼Œå¦‚æœå¯¹èµ„æºçš„è®¿é—®é¡ºåºæ•æ„Ÿï¼Œå°±ç§°å­˜åœ¨ç«æ€æ¡ä»¶ã€‚</p><p>â€‹å¯¼è‡´ç«æ€æ¡ä»¶å‘ç”Ÿçš„ä»£ç åŒºç§°ä½œä¸´ç•ŒåŒºã€‚</p><p>â€‹åœ¨ä¸´ç•ŒåŒºä¸­ä½¿ç”¨é€‚å½“çš„åŒæ­¥å°±å¯ä»¥é¿å…ç«æ€æ¡ä»¶ï¼Œå¦‚ä½¿ç”¨synchronizedæˆ–è€…åŠ é”æœºåˆ¶ã€‚</p><p><strong>ä½•è°“çº¿ç¨‹å®‰å…¨</strong></p><p>â€‹å…è®¸è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œçš„ä»£ç ç§°ä½œçº¿ç¨‹å®‰å…¨çš„ä»£ç ã€‚çº¿ç¨‹å®‰å…¨çš„ä»£ç ä¸åŒ…å«ç«æ€æ¡ä»¶ã€‚</p><h3 id="å¯¹è±¡çš„å®‰å…¨"><a href="#å¯¹è±¡çš„å®‰å…¨" class="headerlink" title="å¯¹è±¡çš„å®‰å…¨"></a>å¯¹è±¡çš„å®‰å…¨</h3><h4 id="å±€éƒ¨åŸºæœ¬ç±»å‹å˜é‡"><a href="#å±€éƒ¨åŸºæœ¬ç±»å‹å˜é‡" class="headerlink" title="å±€éƒ¨åŸºæœ¬ç±»å‹å˜é‡"></a>å±€éƒ¨åŸºæœ¬ç±»å‹å˜é‡</h4><p>&#x3D;&#x3D;å±€éƒ¨å˜é‡å­˜å‚¨åœ¨çº¿ç¨‹è‡ªå·±çš„æ ˆä¸­ã€‚&#x3D;&#x3D;ä¹Ÿå°±æ˜¯è¯´ï¼Œå±€éƒ¨å˜é‡æ°¸è¿œä¹Ÿä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼ˆåªæ˜¯æ›´æ–°å½“å‰çº¿ç¨‹æ ˆçš„å€¼ï¼Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸å…±äº«æ•°æ®ï¼‰ã€‚æ‰€ä»¥ï¼ŒåŸºç¡€ç±»å‹çš„å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><h4 id="å±€éƒ¨çš„å¯¹è±¡å¼•ç”¨"><a href="#å±€éƒ¨çš„å¯¹è±¡å¼•ç”¨" class="headerlink" title="å±€éƒ¨çš„å¯¹è±¡å¼•ç”¨"></a>å±€éƒ¨çš„å¯¹è±¡å¼•ç”¨</h4><p>å¯¹è±¡çš„å±€éƒ¨å¼•ç”¨å’ŒåŸºç¡€ç±»å‹çš„å±€éƒ¨å˜é‡ä¸å¤ªä¸€æ ·ï¼Œå°½ç®¡å¼•ç”¨æœ¬èº«æ²¡æœ‰è¢«å…±äº«ï¼Œä½†å¼•ç”¨æ‰€æŒ‡çš„å¯¹è±¡å¹¶æ²¡æœ‰å­˜å‚¨åœ¨çº¿ç¨‹çš„æ ˆå†…ã€‚æ‰€æœ‰çš„å¯¹è±¡éƒ½å­˜åœ¨å…±äº«å †ä¸­ã€‚</p><p>å¦‚æœåœ¨æŸä¸ªæ–¹æ³•ä¸­åˆ›å»ºçš„å¯¹è±¡ä¸ä¼šé€ƒé€¸å‡ºï¼ˆå³è¯¥å¯¹è±¡ä¸ä¼šè¢«å…¶å®ƒæ–¹æ³•è·å¾—ï¼Œä¹Ÿä¸ä¼šè¢«éå±€éƒ¨å˜é‡å¼•ç”¨åˆ°ï¼‰è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><p>å®é™…ä¸Šï¼Œå“ªæ€•å°†è¿™ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ ç»™å…¶å®ƒæ–¹æ³•ï¼Œåªè¦åˆ«çš„çº¿ç¨‹è·å–ä¸åˆ°è¿™ä¸ªå¯¹è±¡ï¼Œé‚£å®ƒä»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">// è¯¥å¯¹è±¡ä¸ä¼šé€ƒé€¸å‡º</span></span><br><span class="line"><span class="type">LocalObject</span> <span class="variable">localObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LocalObject</span>();</span><br><span class="line">localObject.callMethod();</span><br><span class="line">method2(localObject);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">(LocalObject localObject)</span>&#123;</span><br><span class="line">localObject.setValue(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯¹è±¡æˆå‘˜-æˆå‘˜å˜é‡"><a href="#å¯¹è±¡æˆå‘˜-æˆå‘˜å˜é‡" class="headerlink" title="å¯¹è±¡æˆå‘˜(æˆå‘˜å˜é‡)"></a>å¯¹è±¡æˆå‘˜(æˆå‘˜å˜é‡)</h3><p>å¯¹è±¡æˆå‘˜å­˜å‚¨åœ¨å †ä¸Šã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°åŒä¸€ä¸ªå¯¹è±¡çš„åŒä¸€ä¸ªæˆå‘˜ï¼Œé‚£è¿™ä¸ªä»£ç å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">NotThreadSafe</span> <span class="variable">sharedInstance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NotThreadSafe</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyRunnable</span>(sharedInstance)).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyRunnable</span>(sharedInstance)).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="type">NotThreadSafe</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyRunnable</span><span class="params">(NotThreadSafe instance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.instance = instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.instance.add(<span class="string">&quot; &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.instance.builder.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotThreadSafe</span> &#123;</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.builder.append(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨åŒä¸€ä¸ªNotThreadSafeå®ä¾‹ä¸Šçš„add()æ–¹æ³•ï¼Œå°±ä¼šæœ‰ç«æ€æ¡ä»¶é—®é¢˜ã€‚</p><h3 id="ä¸å¯å˜æ€§"><a href="#ä¸å¯å˜æ€§" class="headerlink" title="ä¸å¯å˜æ€§"></a>ä¸å¯å˜æ€§</h3><p>é€šè¿‡åˆ›å»ºä¸å¯å˜çš„å…±äº«å¯¹è±¡æ¥ä¿è¯å¯¹è±¡åœ¨çº¿ç¨‹é—´å…±äº«æ—¶ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä»è€Œå®ç°çº¿ç¨‹å®‰å…¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImmutableValue</span>&#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºçš„è¯¥å±æ€§ä¸å¯å˜ï¼ˆæ²¡æœ‰setæ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ImmutableValue</span><span class="params">(<span class="type">int</span> value)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.value = value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.value;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ImmutableValueç±»çš„æˆå‘˜å˜é‡ value æ˜¯é€šè¿‡æ„é€ å‡½æ•°èµ‹å€¼çš„ï¼Œå¹¶ä¸”åœ¨ç±»ä¸­æ²¡æœ‰setæ–¹æ³•ã€‚è¿™æ„å‘³ç€ä¸€æ—¦ImmutableValueå®ä¾‹è¢«åˆ›å»ºï¼Œ value å˜é‡å°±ä¸èƒ½å†è¢«ä¿®æ”¹ï¼Œè¿™å°±æ˜¯ä¸å¯å˜æ€§ã€‚ä½†ä½ å¯ä»¥é€šè¿‡getValue()æ–¹æ³•è¯»å–è¿™ä¸ªå˜é‡çš„å€¼ã€‚</p><h2 id="Javaå†…å­˜æ¨¡å‹"><a href="#Javaå†…å­˜æ¨¡å‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹"></a>Javaå†…å­˜æ¨¡å‹</h2><p>Javaå†…å­˜æ¨¡å‹(ç®€ç§°JMM)ï¼ŒJMMå†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚</p><p>ä»æŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼ŒJMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆmain memoryï¼‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼ˆlocal memoryï¼‰ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯»&#x2F;å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯JMMçš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/JMM.png" alt="image-20240527015028358"></p><p>çº¿ç¨‹Aä¸çº¿ç¨‹Bä¹‹é—´å¦‚è¦é€šä¿¡çš„è¯ï¼Œå¿…é¡»è¦ç»å†ä¸‹é¢2ä¸ªæ­¥éª¤ï¼š</p><ol><li>é¦–å…ˆï¼Œçº¿ç¨‹AæŠŠæœ¬åœ°å†…å­˜Aä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­å»ã€‚</li><li>ç„¶åï¼Œçº¿ç¨‹Båˆ°ä¸»å†…å­˜ä¸­å»è¯»å–çº¿ç¨‹Aä¹‹å‰å·²æ›´æ–°è¿‡çš„å…±äº«å˜é‡ã€‚</li></ol><h2 id="CASä¹è§‚é”"><a href="#CASä¹è§‚é”" class="headerlink" title="CASä¹è§‚é”"></a>CASä¹è§‚é”</h2><p>ä¹è§‚é”ï¼šä¸åŠ é”ï¼Œå‡è®¾æ²¡æœ‰å†²çªå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚å…¶å®ç°æ–¹å¼æœ‰ä¸€ç§æ¯”è¾ƒå…¸å‹çš„å°±æ˜¯Compare and Swap( CAS )ã€‚</p><p>CASæœºåˆ¶å½“ä¸­ä½¿ç”¨äº†3ä¸ªåŸºæœ¬æ“ä½œæ•°ï¼šå†…å­˜åœ°å€Vï¼Œæ—§çš„é¢„æœŸå€¼Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼Bã€‚</p><p>æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåªæœ‰å½“å˜é‡çš„é¢„æœŸå€¼Aå’Œå†…å­˜åœ°å€Vå½“ä¸­çš„å®é™…å€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜åœ°å€Vå¯¹åº”çš„å€¼ä¿®æ”¹ä¸ºBã€‚</p><p>1.åœ¨å†…å­˜åœ°å€Vå½“ä¸­ï¼Œå­˜å‚¨ç€å€¼ä¸º10çš„å˜é‡ã€‚</p><p>2.æ­¤æ—¶çº¿ç¨‹1æƒ³è¦æŠŠå˜é‡çš„å€¼å¢åŠ 1ã€‚å¯¹çº¿ç¨‹1æ¥è¯´ï¼Œæ—§çš„é¢„æœŸå€¼A&#x3D;10ï¼Œè¦ä¿®æ”¹çš„æ–°å€¼B&#x3D;11ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405270159880.png" alt="image-20240527015919145"></p><p>3.åœ¨çº¿ç¨‹1è¦æäº¤æ›´æ–°ä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹2æŠ¢å…ˆä¸€æ­¥ï¼ŒæŠŠå†…å­˜åœ°å€Vä¸­çš„å˜é‡å€¼ç‡å…ˆæ›´æ–°æˆäº†11ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405270159406.png" alt="image-20240527015941075"></p><p>4.çº¿ç¨‹1å¼€å§‹æäº¤æ›´æ–°ï¼Œé¦–å…ˆè¿›è¡ŒAå’Œåœ°å€Vçš„å®é™…å€¼æ¯”è¾ƒï¼ˆCompareï¼‰ï¼Œå‘ç°Aä¸ç­‰äºVçš„å®é™…å€¼ï¼Œæäº¤å¤±è´¥ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405270201086.png" alt="image-20240527020130548"></p><p>5.çº¿ç¨‹1é‡æ–°è·å–å†…å­˜åœ°å€Vçš„å½“å‰å€¼ï¼Œå¹¶é‡æ–°è®¡ç®—æƒ³è¦ä¿®æ”¹çš„æ–°å€¼ã€‚æ­¤æ—¶å¯¹çº¿ç¨‹1æ¥è¯´ï¼ŒA&#x3D;11ï¼ŒB&#x3D;12ã€‚è¿™ä¸ªé‡æ–°å°è¯•çš„è¿‡ç¨‹è¢«ç§°ä¸ºè‡ªæ—‹ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405270203433.png" alt="image-20240527020313272"></p><p>6.è¿™ä¸€æ¬¡æ¯”è¾ƒå¹¸è¿ï¼Œæ²¡æœ‰å…¶ä»–çº¿ç¨‹æ”¹å˜åœ°å€Vçš„å€¼ã€‚çº¿ç¨‹1è¿›è¡ŒCompareï¼Œå‘ç°Aå’Œåœ°å€Vçš„å®é™…å€¼æ˜¯ç›¸ç­‰çš„ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405270205946.png" alt="image-20240527020529111"></p><p>7.çº¿ç¨‹1è¿›è¡ŒSWAPï¼ŒæŠŠåœ°å€Vçš„å€¼æ›¿æ¢ä¸ºBï¼Œä¹Ÿå°±æ˜¯12ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405270206835.png" alt="image-20240527020630202"></p><p>Synchronizedå±äºæ‚²è§‚é”ï¼Œæ‚²è§‚åœ°è®¤ä¸ºç¨‹åºä¸­çš„å¹¶å‘æƒ…å†µä¸¥é‡ï¼Œæ‰€ä»¥ä¸¥é˜²æ­»å®ˆã€‚CASå±äºä¹è§‚é”ï¼Œä¹è§‚åœ°è®¤ä¸ºç¨‹åºä¸­çš„å¹¶å‘æƒ…å†µä¸é‚£ä¹ˆä¸¥é‡ï¼Œæ‰€ä»¥è®©çº¿ç¨‹ä¸æ–­å»å°è¯•æ›´æ–°ã€‚</p><p>CASçš„ç¼ºç‚¹ï¼š</p><p>1.CPUå¼€é”€è¾ƒå¤§</p><p>â€‹åœ¨å¹¶å‘é‡æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè®¸å¤šçº¿ç¨‹åå¤å°è¯•æ›´æ–°æŸä¸€ä¸ªå˜é‡ï¼Œå´åˆä¸€ç›´æ›´æ–°ä¸æˆåŠŸï¼Œå¾ªç¯å¾€å¤ï¼Œä¼šç»™CPUå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚</p><p>2.ä¸èƒ½ä¿è¯ä»£ç å—çš„åŸå­æ€§</p><p>â€‹CASæœºåˆ¶æ‰€ä¿è¯çš„åªæ˜¯ä¸€ä¸ªå˜é‡çš„åŸå­æ€§æ“ä½œï¼Œè€Œä¸èƒ½ä¿è¯æ•´ä¸ªä»£ç å—çš„åŸå­æ€§ã€‚æ¯”å¦‚éœ€è¦ä¿è¯3ä¸ªå˜é‡å…±åŒè¿›è¡ŒåŸå­æ€§çš„æ›´æ–°ï¼Œå°±ä¸å¾—ä¸ä½¿ç”¨Synchronizedäº†ã€‚</p><h2 id="Synchronizedå—"><a href="#Synchronizedå—" class="headerlink" title="Synchronizedå—"></a>Synchronizedå—</h2><p>Javaä¸­çš„åŒæ­¥å—ç”¨&#x3D;&#x3D;synchronizedæ ‡è®°&#x3D;&#x3D;ã€‚åŒæ­¥å—åœ¨Javaä¸­æ˜¯åŒæ­¥åœ¨æŸä¸ªå¯¹è±¡ä¸Šã€‚æ‰€æœ‰åŒæ­¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šçš„åŒæ­¥å—åœ¨åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è¿›å…¥å¹¶æ‰§è¡Œæ“ä½œã€‚æ‰€æœ‰å…¶ä»–ç­‰å¾…è¿›å…¥è¯¥åŒæ­¥å—çš„çº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°æ‰§è¡Œè¯¥åŒæ­¥å—ä¸­çš„çº¿ç¨‹é€€å‡ºã€‚</p><h3 id="åŒæ­¥å—çš„åˆ†ç±»ï¼š"><a href="#åŒæ­¥å—çš„åˆ†ç±»ï¼š" class="headerlink" title="åŒæ­¥å—çš„åˆ†ç±»ï¼š"></a>åŒæ­¥å—çš„åˆ†ç±»ï¼š</h3><ol><li><p>å®ä¾‹æ–¹æ³•çš„åŒæ­¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨æ–¹æ³•å£°æ˜ä¸­åŒæ­¥ï¼ˆsynchronized ï¼‰å…³é”®å­—ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> value)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.count += value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Javaå®ä¾‹æ–¹æ³•åŒæ­¥æ˜¯&#x3D;&#x3D;åŒæ­¥åœ¨æ‹¥æœ‰è¯¥æ–¹æ³•çš„å¯¹è±¡ä¸Š&#x3D;&#x3D;ã€‚è¿™æ ·ï¼Œæ¯ä¸ªå®ä¾‹å…¶æ–¹æ³•åŒæ­¥éƒ½åŒæ­¥åœ¨ä¸åŒçš„å¯¹è±¡ä¸Šï¼Œå³è¯¥æ–¹æ³•æ‰€å±çš„å®ä¾‹ã€‚åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿåœ¨å®ä¾‹æ–¹æ³•åŒæ­¥å—ä¸­è¿è¡Œã€‚å¦‚æœæœ‰å¤šä¸ªå®ä¾‹å­˜åœ¨ï¼Œé‚£ä¹ˆä¸€ä¸ªçº¿ç¨‹ä¸€æ¬¡å¯ä»¥åœ¨ä¸€ä¸ªå®ä¾‹åŒæ­¥å—ä¸­æ‰§è¡Œæ“ä½œã€‚</p></li><li><p>é™æ€æ–¹æ³•çš„åŒæ­¥</p><p>é™æ€æ–¹æ³•åŒæ­¥å’Œå®ä¾‹æ–¹æ³•åŒæ­¥æ–¹æ³•ä¸€æ ·ï¼Œä¹Ÿä½¿ç”¨synchronized å…³é”®å­—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> value)</span>&#123;</span><br><span class="line">count += value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™æ€æ–¹æ³•çš„åŒæ­¥æ˜¯æŒ‡&#x3D;&#x3D;åŒæ­¥åœ¨è¯¥æ–¹æ³•æ‰€åœ¨çš„ç±»å¯¹è±¡ä¸Š&#x3D;&#x3D;ã€‚å› ä¸ºåœ¨Javaè™šæ‹Ÿæœºä¸­<strong>ä¸€ä¸ªç±»åªèƒ½å¯¹åº”ä¸€ä¸ªç±»å¯¹è±¡</strong>ï¼Œæ‰€ä»¥åŒæ—¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒä¸€ä¸ªç±»ä¸­çš„é™æ€åŒæ­¥æ–¹æ³•ã€‚</p><p>å¯¹äºä¸åŒç±»ä¸­çš„é™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œæ¯ä¸ªç±»ä¸­çš„é™æ€åŒæ­¥æ–¹æ³•è€Œæ— éœ€ç­‰å¾…ã€‚ä¸ç®¡ç±»ä¸­çš„é‚£ä¸ªé™æ€åŒæ­¥æ–¹æ³•è¢«è°ƒç”¨ï¼Œä¸€ä¸ªç±»åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚</p></li><li><p>å®ä¾‹æ–¹æ³•ä¸­çš„åŒæ­¥å—</p><p>æœ‰æ—¶ä½ ä¸éœ€è¦åŒæ­¥æ•´ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯åŒæ­¥æ–¹æ³•ä¸­çš„ä¸€éƒ¨åˆ†ã€‚Javaå¯ä»¥å¯¹æ–¹æ³•çš„ä¸€éƒ¨åˆ†è¿›è¡ŒåŒæ­¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨JavaåŒæ­¥å—æ„é€ å™¨æ¥æ ‡è®°ä¸€å—ä»£ç æ˜¯åŒæ­¥çš„ã€‚è¯¥ä»£ç åœ¨æ‰§è¡Œæ—¶å’ŒåŒæ­¥æ–¹æ³•ä¸€æ ·ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> value)</span>&#123;</span><br><span class="line"><span class="keyword">synchronized</span>(<span class="built_in">this</span>)&#123;</span><br><span class="line"><span class="built_in">this</span>.count += value;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„:JavaåŒæ­¥å—æ„é€ å™¨ç”¨æ‹¬å·å°†å¯¹è±¡æ‹¬èµ·æ¥ã€‚åœ¨ä¸Šä¾‹ä¸­ï¼Œä½¿ç”¨äº†â€œthisâ€ï¼Œå³ä¸º&#x3D;&#x3D;addæ–¹æ³•çš„å®ä¾‹æœ¬èº«&#x3D;&#x3D;ã€‚åœ¨åŒæ­¥æ„é€ å™¨ä¸­ç”¨æ‹¬å·æ‹¬èµ·æ¥çš„å¯¹è±¡å«åšç›‘è§†å™¨å¯¹è±¡ã€‚ä¸Šè¿°ä»£ç ä½¿ç”¨ç›‘è§†å™¨å¯¹è±¡åŒæ­¥ï¼ŒåŒæ­¥å®ä¾‹æ–¹æ³•ä½¿ç”¨è°ƒç”¨æ–¹æ³•æœ¬èº«çš„å®ä¾‹ä½œä¸ºç›‘è§†å™¨å¯¹è±¡ã€‚</p><p>ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿåœ¨åŒæ­¥äºåŒä¸€ä¸ªç›‘è§†å™¨å¯¹è±¡çš„Javaæ–¹æ³•å†…æ‰§è¡Œã€‚</p><p>ä¸‹é¢ä¸¤ä¸ªä¾‹å­éƒ½åŒæ­¥ä»–ä»¬æ‰€è°ƒç”¨çš„å®ä¾‹å¯¹è±¡ä¸Šï¼Œå› æ­¤ä»–ä»¬åœ¨åŒæ­¥çš„æ‰§è¡Œæ•ˆæœä¸Šæ˜¯ç­‰æ•ˆçš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">log1</span><span class="params">(String msg1, String msg2)</span>&#123;</span><br><span class="line">log.writeln(msg1);</span><br><span class="line">log.writeln(msg2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log2</span><span class="params">(String msg1, String msg2)</span>&#123;</span><br><span class="line"><span class="keyword">synchronized</span>(<span class="built_in">this</span>)&#123;</span><br><span class="line">log.writeln(msg1);</span><br><span class="line">log.writeln(msg2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šä¾‹ä¸­ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿåœ¨ä¸¤ä¸ªåŒæ­¥å—ä¸­ä»»æ„ä¸€ä¸ªæ–¹æ³•å†…æ‰§è¡Œã€‚</p><p>&#x3D;&#x3D;å¦‚æœç¬¬äºŒä¸ªåŒæ­¥å—ä¸æ˜¯åŒæ­¥åœ¨thiså®ä¾‹å¯¹è±¡ä¸Šï¼Œé‚£ä¹ˆä¸¤ä¸ªæ–¹æ³•å¯ä»¥è¢«çº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚&#x3D;&#x3D;åœ¨ Java ä¸­ï¼Œ<code>synchronized(this)</code> ç¡®å®é”ä½äº†è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ã€‚é”å®šå¯¹è±¡æ—¶ï¼Œå…¶ä»–ä»»ä½•è¯•å›¾è¿›å…¥è¢«åŒä¸€å¯¹è±¡é”å®šçš„ <code>synchronized</code> æ–¹æ³•æˆ– <code>synchronized</code> å—çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚è€Œè¯•å›¾è¿›å…¥è¯¥å¯¹è±¡çš„é <code>synchronized</code> æ–¹æ³•æˆ–é <code>synchronized</code> ä»£ç å—çš„çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡ï¼Œå®ƒä»¬å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</p></li><li><p>é™æ€æ–¹æ³•ä¸­çš„åŒæ­¥å—</p></li></ol><p>åŒæ­¥åœ¨è¯¥æ–¹æ³•æ‰€å±çš„ç±»å¯¹è±¡ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">log1</span><span class="params">(String msg1, String msg2)</span>&#123;</span><br><span class="line">log.writeln(msg1);</span><br><span class="line">log.writeln(msg2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">log2</span><span class="params">(String msg1, String msg2)</span>&#123;</span><br><span class="line"><span class="keyword">synchronized</span>(MyClass.class)&#123;</span><br><span class="line">log.writeln(msg1);</span><br><span class="line">log.writeln(msg2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ–¹æ³•ä¸å…è®¸åŒæ—¶è¢«çº¿ç¨‹è®¿é—®ã€‚</p><p>å¦‚æœç¬¬äºŒä¸ªåŒæ­¥å—ä¸æ˜¯åŒæ­¥åœ¨MyClass.classè¿™ä¸ªå¯¹è±¡ä¸Šã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥åŒæ—¶è¢«çº¿ç¨‹è®¿é—®ã€‚</p><h3 id="Synchronizedé”çš„å­˜å‚¨"><a href="#Synchronizedé”çš„å­˜å‚¨" class="headerlink" title="Synchronizedé”çš„å­˜å‚¨"></a>Synchronizedé”çš„å­˜å‚¨</h3><p>â€‹synchronizedç”¨çš„&#x3D;&#x3D;é”å­˜å‚¨åœ¨Javaå¯¹è±¡å¤´&#x3D;&#x3D;ï¼Œå¦‚æœå¯¹è±¡æ˜¯æ•°ç»„ç±»å‹ï¼Œåˆ™è™šæ‹Ÿæœºç”¨3ä¸ªå­—å®½å­˜å‚¨å¯¹è±¡å¤´ï¼Œå¦‚æœå¯¹è±¡æ˜¯éæ•°ç»„ç±»å‹ï¼Œåˆ™ç”¨2å­—å®½å­˜å‚¨å¯¹è±¡å¤´ï¼Œ32ä½è™šæ‹Ÿæœºï¼Œ1å­—å®½ç­‰äº4å­—èŠ‚ï¼Œå³32ä½ã€‚</p><h4 id="å¯¹è±¡çš„å†…å­˜å¸ƒå±€"><a href="#å¯¹è±¡çš„å†…å­˜å¸ƒå±€" class="headerlink" title="å¯¹è±¡çš„å†…å­˜å¸ƒå±€"></a><strong>å¯¹è±¡çš„å†…å­˜å¸ƒå±€</strong></h4><p>Hotspotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸ºä¸‰å—åŒºåŸŸï¼šå¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰ã€‚</p><ul><li><p>å¯¹è±¡å¤´ï¼šæ¯”å¦‚ hashç ï¼Œå¯¹è±¡æ‰€å±çš„å¹´ä»£ï¼Œå¯¹è±¡é”ï¼Œé”çŠ¶æ€æ ‡å¿—ï¼Œåå‘é”ï¼ˆçº¿ç¨‹ï¼‰IDï¼Œåå‘æ—¶é—´ï¼Œæ•°ç»„é•¿åº¦ï¼ˆæ•°ç»„å¯¹è±¡æ‰æœ‰ï¼‰ç­‰ã€‚</p></li><li><p>å®ä¾‹æ•°æ®ï¼šå­˜æ”¾ç±»çš„å±æ€§æ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„å±æ€§ä¿¡æ¯ï¼›</p></li><li><p>å¯¹é½å¡«å……ï¼šç”±äºè™šæ‹Ÿæœºè¦æ±‚ <strong>å¯¹è±¡èµ·å§‹åœ°å€å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€</strong>ã€‚å¡«å……æ•°æ®ä¸æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œä»…ä»…æ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282137739.png" alt="img"></p></li></ul><h5 id="å¯¹è±¡å¤´è¯¦è§£"><a href="#å¯¹è±¡å¤´è¯¦è§£" class="headerlink" title="å¯¹è±¡å¤´è¯¦è§£"></a><strong>å¯¹è±¡å¤´è¯¦è§£</strong></h5><p>HotSpotè™šæ‹Ÿæœºçš„å¯¹è±¡å¤´åŒ…æ‹¬ï¼š</p><ul><li>Mark Word</li></ul><p>ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ï¼ˆ4ä½ï¼ˆä¸åˆ†ä»£å¹´é¾„æœ‰å…³ï¼‰ï¼‰ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼Œè¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦åœ¨32ä½å’Œ64ä½çš„è™šæ‹Ÿæœºä¸­åˆ†åˆ«ä¸º32bitå’Œ64bitï¼Œå®˜æ–¹ç§°å®ƒä¸ºâ€œMark Wordâ€ã€‚</p><ul><li>Klass Pointer</li></ul><p>å¯¹è±¡å¤´çš„å¦å¤–ä¸€éƒ¨åˆ†æ˜¯klassç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚ 32ä½4å­—èŠ‚ï¼Œ64ä½å¼€å¯æŒ‡é’ˆå‹ç¼©æˆ–æœ€å¤§å †å†…å­˜&lt;32gæ—¶4å­—èŠ‚ï¼Œå¦åˆ™8å­—èŠ‚ã€‚jdk1.8é»˜è®¤å¼€å¯æŒ‡é’ˆå‹ç¼©åä¸º4å­—èŠ‚ï¼Œå½“åœ¨JVMå‚æ•°ä¸­å…³é—­æŒ‡é’ˆå‹ç¼©ï¼ˆ-XX:-UseCompressedOopsï¼‰åï¼Œé•¿åº¦ä¸º8å­—èŠ‚ã€‚</p><ul><li>æ•°ç»„é•¿åº¦ï¼ˆåªæœ‰æ•°ç»„å¯¹è±¡æœ‰ï¼‰</li></ul><p>å¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªæ•°ç»„, é‚£åœ¨å¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—æ•°æ®ç”¨äºè®°å½•æ•°ç»„é•¿åº¦ã€‚ 4å­—èŠ‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405270252460.png" alt="image-20240527025211529"></p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282136832.png" alt="image.png"></p><h5 id="Mark-Wordçš„ç»“æ„"><a href="#Mark-Wordçš„ç»“æ„" class="headerlink" title="Mark Wordçš„ç»“æ„"></a><strong>Mark Wordçš„ç»“æ„</strong></h5><p><strong>32ä½JVMä¸‹çš„å¯¹è±¡ç»“æ„æè¿°</strong></p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282147663.png" alt="image.png"></p><p><strong>64ä½JVMä¸‹çš„å¯¹è±¡ç»“æ„æè¿°</strong></p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282147130.png" alt="image.png"></p><h4 id="æ— é”"><a href="#æ— é”" class="headerlink" title="æ— é”"></a>æ— é”</h4><p>â€‹ç¨‹åºä¸ä¼šæœ‰é”çš„ç«äº‰</p><h4 id="åå‘é”"><a href="#åå‘é”" class="headerlink" title="åå‘é”"></a>åå‘é”</h4><h5 id="åå‘é”çš„è·å–æµç¨‹ï¼š"><a href="#åå‘é”çš„è·å–æµç¨‹ï¼š" class="headerlink" title="åå‘é”çš„è·å–æµç¨‹ï¼š"></a>åå‘é”çš„è·å–æµç¨‹ï¼š</h5><p> ï¼ˆ1ï¼‰æŸ¥çœ‹Mark Wordä¸­åå‘é”çš„æ ‡è¯†ä»¥åŠé”æ ‡å¿—ä½ï¼Œè‹¥æ˜¯å¦åå‘é”ä¸º1ä¸”é”æ ‡å¿—ä½ä¸º01ï¼Œåˆ™è¯¥é”ä¸ºå¯åå‘çŠ¶æ€ã€‚</p><p> ï¼ˆ2ï¼‰è‹¥ä¸ºå¯åå‘çŠ¶æ€ï¼Œåˆ™æµ‹è¯•Mark Wordä¸­çš„çº¿ç¨‹IDæ˜¯å¦ä¸å½“å‰çº¿ç¨‹ç›¸åŒï¼Œè‹¥ç›¸åŒï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å¾—äº†é”ï¼Œå¦‚æœä¸åŒï¼Œåˆ™è¿›å…¥ï¼ˆ3ï¼‰</p><p> ï¼ˆ3ï¼‰æµ‹è¯•Mark Wordçš„åå‘é”çš„æ ‡è¯†æ˜¯å¦è®¾ç½®ä¸º1ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä½¿ç”¨&#x3D;&#x3D;CASæ“ä½œç«äº‰é”&#x3D;&#x3D;ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œåˆ™å°è¯•ä½¿ç”¨CASå°è¯•å°†Mark Wordä¸­çº¿ç¨‹IDè®¾ç½®ä¸ºå½“å‰çº¿ç¨‹IDï¼Œå¦‚æœå°è¯•å¤±è´¥ï¼Œåˆ™æ‰§è¡Œï¼ˆ4ï¼‰</p><p> ï¼ˆ4ï¼‰å½“å‰çº¿ç¨‹é€šè¿‡CASç«äº‰é”å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œè¯´æ˜æœ‰ç«äº‰ã€‚å½“åˆ°è¾¾&#x3D;&#x3D;å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»£ç ï¼‰&#x3D;&#x3D;æ—¶ä¹‹å‰è·å¾—åå‘é”çš„çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œ&#x3D;&#x3D;åå‘é”å‡çº§ä¸ºè½»é‡çº§é”&#x3D;&#x3D;ï¼Œç„¶åè¢«é˜»å¡åœ¨å®‰å…¨ç‚¹çš„çº¿ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŒæ­¥ä»£ç ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282207782.png" alt="image-20240528220750790"></p><h5 id="åå‘é”JVMå‘½ä»¤"><a href="#åå‘é”JVMå‘½ä»¤" class="headerlink" title="åå‘é”JVMå‘½ä»¤"></a>åå‘é”JVMå‘½ä»¤</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+PrintFlagsInitial |grep BiasedLock*</span><br><span class="line">-XX:+UseBiasedLockingï¼šå¯ç”¨åå‘é”å®šï¼Œè¿™æ˜¯ JVM çš„é»˜è®¤è®¾ç½®ã€‚</span><br><span class="line">-XX:-UseBiasedLockingï¼šç¦ç”¨åå‘é”å®šï¼Œæ‰€æœ‰é”å°†ç›´æ¥ä½¿ç”¨è½»é‡çº§æˆ–é‡é‡çº§é”ã€‚</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼šjava -XX:-UseBiasedLocking -jar YourApplication.jar</span><br></pre></td></tr></table></figure><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282213888.png" alt="image-20240528221322470"></p><h5 id="åå‘é”çš„æ’¤é”€"><a href="#åå‘é”çš„æ’¤é”€" class="headerlink" title="åå‘é”çš„æ’¤é”€"></a>åå‘é”çš„æ’¤é”€</h5><p>å½“æœ‰å¦å¤–çº¿ç¨‹é€æ­¥æ¥ç«äº‰é”çš„æ—¶å€™ï¼Œå°±ä¸èƒ½å†ä½¿ç”¨åå‘é”äº†ï¼Œè¦å‡çº§ä¸ºè½»é‡çº§é”</p><p>ç«äº‰çº¿ç¨‹å°è¯•CASæ›´æ–°å¯¹è±¡å¤´å¤±è´¥ï¼Œä¼šç­‰å¾…åˆ°å…¨å±€å®‰å…¨ç‚¹ï¼ˆæ­¤æ—¶ä¸ä¼šæ‰§è¡Œä»»ä½•ä»£ç ï¼‰æ’¤é”€åå‘é”ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282226235.png" alt="po_diagram (1)"></p><h4 id="è½»é‡çº§é”"><a href="#è½»é‡çº§é”" class="headerlink" title="è½»é‡çº§é”"></a>è½»é‡çº§é”</h4><p>â€‹è½»é‡çº§é”ä¸æ˜¯ç”¨æ¥æ›¿ä»£ä¼ ç»Ÿçš„é‡é‡çº§é”çš„ï¼Œè€Œæ˜¯åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨è½»é‡çº§é”èƒ½å¤Ÿå‡å°‘æ€§èƒ½æ¶ˆè€—ï¼Œä½†æ˜¯å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ç«äº‰é”æ—¶ï¼Œè½»é‡çº§é”ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p><p>è½»é‡çº§é”çš„åŠ é”è¿‡ç¨‹ï¼š</p><p>ï¼ˆ1ï¼‰<strong>å½“çº¿ç¨‹æ‰§è¡Œä»£ç è¿›å…¥åŒæ­¥å—æ—¶ï¼Œè‹¥Mark Wordä¸ºæ— é”çŠ¶æ€ï¼Œè™šæ‹Ÿæœºå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºLock Recordçš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨å½“å‰å¯¹è±¡çš„Mark Wordçš„æ‹·è´</strong>ï¼Œå®˜æ–¹ç§°ä¹‹ä¸ºâ€œDispalced Mark Wordâ€ï¼Œæ­¤æ—¶çŠ¶æ€å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405270255844.png" alt="image-20240527025457987"></p><p>ï¼ˆ2ï¼‰å¤åˆ¶å¯¹è±¡å¤´ä¸­çš„Mark Wordåˆ°é”è®°å½•ä¸­ã€‚</p><p>ï¼ˆ3ï¼‰å¤åˆ¶æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ç”¨CASæ“ä½œå°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæ‰§è¡ŒLock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™æ‰§è¡Œ4ï¼Œå¦åˆ™æ‰§è¡Œ5ã€‚</p><p>ï¼ˆ4ï¼‰å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹æ‹¥æœ‰äº†è¿™ä¸ªé”ï¼Œå¹¶å°†é”æ ‡å¿—è®¾ä¸º00ï¼Œè¡¨ç¤ºå¤„äºè½»é‡çº§é”çŠ¶æ€ï¼Œæ­¤æ—¶çŠ¶æ€å›¾ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405270255717.png" alt="image-20240527025543187"></p><p>ï¼ˆ5ï¼‰å¦‚æœæ›´æ–°å¤±è´¥ï¼Œåˆ™è¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹ä¾¿é€šè¿‡è‡ªæ—‹æ¥è·å–é”ã€‚è½»é‡çº§é”å°±ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ï¼ŒMark Wordä¸­å­˜å‚¨é‡é‡çº§é”ï¼ˆäº’æ–¥é”ï¼‰çš„æŒ‡é’ˆï¼Œåé¢ç­‰å¾…é”çš„çº¿ç¨‹ä¹Ÿè¦è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><h5 id="è‡ªæ—‹é”ï¼ˆSpin-Lockï¼‰"><a href="#è‡ªæ—‹é”ï¼ˆSpin-Lockï¼‰" class="headerlink" title="è‡ªæ—‹é”ï¼ˆSpin Lockï¼‰"></a>è‡ªæ—‹é”ï¼ˆSpin Lockï¼‰</h5><p>java6ä¹‹å‰ï¼šé»˜è®¤å¯ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹è‡ªæ—‹çš„æ¬¡æ•°æ˜¯ 10 æ¬¡ï¼ˆ-XX:PreBlockSpin&#x3D;10æ¥ä¿®æ”¹ï¼‰æˆ–è€…è‡ªæ—‹çº¿ç¨‹æ•°è¶…è¿‡cpuæ ¸æ•°ä¸€åŠã€‚</p><p>Java6ä¹‹åï¼šè‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ¬¡æ•°ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œè€Œæ˜¯æ ¹æ®ï¼š1.åŒä¸€ä¸ªé”ä¸Šä¸€æ¬¡è‡ªæ—‹çš„æ—¶é—´ã€‚2.æ‹¥æœ‰é”çº¿ç¨‹çš„çŠ¶æ€æ¥å†³å®šã€‚</p><h5 id="è½»é‡é”ä¸åå‘é”çš„åŒºåˆ«å’Œä¸åŒ"><a href="#è½»é‡é”ä¸åå‘é”çš„åŒºåˆ«å’Œä¸åŒ" class="headerlink" title="è½»é‡é”ä¸åå‘é”çš„åŒºåˆ«å’Œä¸åŒ"></a>è½»é‡é”ä¸åå‘é”çš„åŒºåˆ«å’Œä¸åŒ</h5><ul><li>äº‰å¤ºè½»é‡çº§é”å¤±è´¥æ—¶ï¼Œè‡ªæ—‹å°è¯•æŠ¢å é”</li><li>è½»é‡çº§é”æ¯æ¬¡é€€å‡ºåŒæ­¥å—éƒ½éœ€è¦é‡Šæ”¾é”ï¼Œè€Œåå‘é”æ˜¯åœ¨ç«äº‰å‘ç”Ÿæ—¶æ‰é‡Šæ”¾é”</li></ul><h4 id="é‡é‡çº§é”"><a href="#é‡é‡çº§é”" class="headerlink" title="é‡é‡çº§é”"></a>é‡é‡çº§é”</h4><p>å³å½“æœ‰å…¶ä»–çº¿ç¨‹å ç”¨é”æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚ï¼ˆæœ‰å¤§é‡çš„çº¿ç¨‹å‚ä¸é”çš„ç«äº‰ï¼Œå†²çªæ€§å¾ˆé«˜ï¼‰</p><h4 id="æ€»ç»“ï¼šé”å¯¹è±¡çŠ¶æ€è½¬æ¢"><a href="#æ€»ç»“ï¼šé”å¯¹è±¡çŠ¶æ€è½¬æ¢" class="headerlink" title="æ€»ç»“ï¼šé”å¯¹è±¡çŠ¶æ€è½¬æ¢"></a><strong>æ€»ç»“ï¼šé”å¯¹è±¡çŠ¶æ€è½¬æ¢</strong></h4><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282244810.png" alt="image-20240528224415233"></p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282224953.png" alt="po_diagram"></p><h2 id="å…³é”®å­—Volatile"><a href="#å…³é”®å­—Volatile" class="headerlink" title="å…³é”®å­—Volatile"></a>å…³é”®å­—Volatile</h2><h3 id="è¢«volatileä¿®æ”¹çš„å˜é‡æœ‰2å¤§ç‰¹ç‚¹"><a href="#è¢«volatileä¿®æ”¹çš„å˜é‡æœ‰2å¤§ç‰¹ç‚¹" class="headerlink" title="è¢«volatileä¿®æ”¹çš„å˜é‡æœ‰2å¤§ç‰¹ç‚¹"></a>è¢«volatileä¿®æ”¹çš„å˜é‡æœ‰2å¤§ç‰¹ç‚¹</h3><p>ç‰¹ç‚¹:  å¯è§æ€§ , æœ‰åºæ€§</p><ul><li>å¯è§æ€§ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ªvolatileå˜é‡æœ€åçš„å†™å…¥ã€‚</li><li><del>åŸå­æ€§ï¼šå¯¹ä»»æ„å•ä¸ªvolatileå˜é‡çš„è¯»&#x2F;å†™å…·æœ‰åŸå­æ€§ï¼Œä½†ç±»ä¼¼äºvolatile++è¿™ç§å¤åˆæ“ä½œä¸å…·æœ‰åŸå­æ€§</del></li><li>æœ‰åºæ€§ï¼šå¯¹volatileä¿®é¥°çš„å˜é‡çš„è¯»å†™æ“ä½œå‰ååŠ ä¸Šå„ç§ç‰¹å®šçš„å†…å­˜å±éšœæ¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºæ¥ä¿éšœæœ‰åºæ€§ã€‚</li></ul><h3 id="volatileçš„å†…å­˜è¯­ä¹‰"><a href="#volatileçš„å†…å­˜è¯­ä¹‰" class="headerlink" title="volatileçš„å†…å­˜è¯­ä¹‰"></a>volatileçš„å†…å­˜è¯­ä¹‰</h3><p>å½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼&#x3D;&#x3D;ç«‹å³åˆ·æ–°å›ä¸»å†…å­˜ä¸­&#x3D;&#x3D;ã€‚</p><p>å½“è¯»ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜è®¾ç½®ä¸ºæ— æ•ˆï¼Œ&#x3D;&#x3D;ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡&#x3D;&#x3D;</p><p><strong>æ‰€ä»¥volatileçš„å†™å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œè¯»çš„å†…å­˜è¯­ä¹‰æ˜¯ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–ã€‚</strong></p><h3 id="å†…å­˜å±éšœ-é¢è¯•é‡ç‚¹å¿…é¡»æ‹¿ä¸‹"><a href="#å†…å­˜å±éšœ-é¢è¯•é‡ç‚¹å¿…é¡»æ‹¿ä¸‹" class="headerlink" title="å†…å­˜å±éšœ(é¢è¯•é‡ç‚¹å¿…é¡»æ‹¿ä¸‹)"></a>å†…å­˜å±éšœ(é¢è¯•é‡ç‚¹å¿…é¡»æ‹¿ä¸‹)</h3><blockquote><p>å†…å­˜å±éšœï¼ˆä¹Ÿç§°å†…å­˜æ …æ ï¼Œå†…å­˜æ …éšœï¼Œå±éšœæŒ‡ä»¤ç­‰ï¼Œæ˜¯ä¸€ç±»åŒæ­¥å±éšœæŒ‡ä»¤ï¼Œæ˜¯CPUæˆ–ç¼–è¯‘å™¨åœ¨å¯¹å†…å­˜éšæœºè®¿é—®çš„æ“ä½œä¸­çš„ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œä½¿å¾—æ­¤ç‚¹ä¹‹å‰çš„æ‰€æœ‰è¯»å†™æ“ä½œéƒ½æ‰§è¡Œåæ‰å¯ä»¥å¼€å§‹æ‰§è¡Œæ­¤ç‚¹ä¹‹åçš„æ“ä½œï¼‰ï¼Œé¿å…ä»£ç é‡æ’åºã€‚å†…å­˜å±éšœå…¶å®å°±æ˜¯ä¸€ç§JVMæŒ‡ä»¤ï¼ŒJavaå†…å­˜æ¨¡å‹çš„é‡æ’è§„åˆ™ä¼šè¦æ±‚Javaç¼–è¯‘å™¨åœ¨ç”ŸæˆJVMæŒ‡ä»¤æ—¶æ’å…¥ç‰¹å®šçš„å†…å­˜å±éšœæŒ‡ä»¤ï¼Œé€šè¿‡è¿™äº›å†…å­˜å±éšœæŒ‡ä»¤ï¼Œvolatileå®ç°äº†Javaå†…å­˜æ¨¡å‹ä¸­çš„å¯è§æ€§å’Œæœ‰åºæ€§ï¼Œä½†volatileæ— æ³•ä¿è¯åŸå­æ€§ã€‚</p><p>å†…å­˜å±éšœä¹‹å‰çš„æ‰€æœ‰å†™æ“ä½œéƒ½è¦å›å†™åˆ°ä¸»å†…å­˜ï¼Œå†…å­˜å±éšœä¹‹åçš„æ‰€æœ‰è¯»æ“ä½œéƒ½èƒ½è·å¾—å†…å­˜å±éšœä¹‹å‰çš„æ‰€æœ‰å†™æ“ä½œçš„æœ€æ–°ç»“æœ(å®ç°äº†å¯è§æ€§)ã€‚</p><p>å› æ­¤é‡æ’åºæ—¶ï¼Œä¸å…è®¸æŠŠå†…å­˜å±éšœä¹‹åçš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰ã€‚<br>ä¸€å¥è¯ï¼šå¯¹ä¸€ä¸ª volatile åŸŸçš„å†™, happens-before äºä»»æ„åç»­å¯¹è¿™ä¸ª volatile åŸŸçš„è¯»ï¼Œä¹Ÿå«å†™åè¯»ã€‚</p></blockquote><h4 id="ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§"><a href="#ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§" class="headerlink" title="ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§"></a>ä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§</h4><ol><li><strong>å¯è§æ€§</strong>ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº† <code>volatile</code> å˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹äºå…¶ä»–æ‰€æœ‰çº¿ç¨‹ç«‹å³å¯è§ã€‚</li><li><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</strong>ï¼šå¯¹ <code>volatile</code> å˜é‡çš„è¯»å†™æ“ä½œä¸ä¼šè¢«æŒ‡ä»¤é‡æ’åºï¼Œå› æ­¤ <code>volatile</code> å˜é‡çš„æ“ä½œåœ¨å†…å­˜ä¸­æ˜¯æœ‰åºçš„ã€‚</li></ol><p><strong>volatileé‡æ’åºè§„åˆ™</strong>:</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202406011435088.png" alt="image-20240601143456443"></p><h4 id="volatile-ä¸èƒ½ä¿è¯åŸå­æ€§çš„åŸå› "><a href="#volatile-ä¸èƒ½ä¿è¯åŸå­æ€§çš„åŸå› " class="headerlink" title="volatile ä¸èƒ½ä¿è¯åŸå­æ€§çš„åŸå› "></a><code>volatile</code> ä¸èƒ½ä¿è¯åŸå­æ€§çš„åŸå› </h4><p>å°½ç®¡ <code>volatile</code> èƒ½ç¡®ä¿å˜é‡çš„å¯è§æ€§å’Œæœ‰åºæ€§ï¼Œä½†å®ƒä¸èƒ½ä¿è¯å¯¹å˜é‡çš„å¤åˆæ“ä½œï¼ˆä¾‹å¦‚è¯»å–-ä¿®æ”¹-å†™å…¥ï¼‰æ˜¯åŸå­çš„ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// åœ¨å¤šä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ</span></span><br><span class="line">count++;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œ<code>count++</code> æ“ä½œå®é™…ä¸Šåˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol><li>è¯»å– <code>count</code> çš„å½“å‰å€¼ã€‚</li><li>å°†å€¼åŠ  1ã€‚</li><li>å°†æ–°å€¼å†™å› <code>count</code>ã€‚</li></ol><p>å³ä½¿ <code>count</code> æ˜¯ <code>volatile</code> çš„ï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½ä¼šåœ¨æ­¥éª¤ 1 å’Œæ­¥éª¤ 3 ä¹‹é—´ä¿®æ”¹ <code>count</code> çš„å€¼ï¼Œä»è€Œå¯¼è‡´ç«äº‰æ¡ä»¶å’Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚å› æ­¤ï¼Œ<code>count++</code> ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œã€‚</p><h4 id="ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼Ÿ</h4><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282343216.png" alt="po_diagram"></p><p>å½“ç¬¬ä¸€ä¸ªæ“ä½œä¸ºvolatileè¯»æ—¶ï¼Œä¸è®ºç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªæ“ä½œä¿è¯äº†volatileè¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«é‡æ’åˆ°volatileè¯»ä¹‹å‰ã€‚<br>å½“ç¬¬äºŒä¸ªæ“ä½œä¸ºvolatileå†™æ—¶ï¼Œä¸è®ºç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªæ“ä½œä¿è¯äº†volatileå†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«é‡æ’åˆ°volatileå†™ä¹‹åã€‚<br>å½“ç¬¬ä¸€ä¸ªæ“ä½œä¸ºvolatileå†™æ—¶ï¼Œç¬¬äºŒä¸ªæ“ä½œä¸ºvolatileè¯»æ—¶ï¼Œä¸èƒ½é‡æ’ã€‚</p><h4 id="JMM-å°±å°†å†…å­˜å±éšœæ’â¼Šç­–ç•¥åˆ†ä¸º-4-ç§"><a href="#JMM-å°±å°†å†…å­˜å±éšœæ’â¼Šç­–ç•¥åˆ†ä¸º-4-ç§" class="headerlink" title="JMM å°±å°†å†…å­˜å±éšœæ’â¼Šç­–ç•¥åˆ†ä¸º 4 ç§"></a>JMM å°±å°†å†…å­˜å±éšœæ’â¼Šç­–ç•¥åˆ†ä¸º 4 ç§</h4><ol><li><p>åœ¨æ¯ä¸ª volatile <strong>å†™</strong>æ“ä½œçš„å‰â¾¯æ’â¼Šâ¼€ä¸ª StoreStore å±éšœ</p></li><li><p>åœ¨æ¯ä¸ª volatile <strong>å†™</strong>æ“ä½œçš„åâ¾¯æ’â¼Šâ¼€ä¸ª StoreLoad å±éšœ</p></li><li><p>åœ¨æ¯ä¸ª volatile <strong>è¯»</strong>æ“ä½œçš„åâ¾¯æ’â¼Šâ¼€ä¸ª LoadLoad å±éšœ</p></li><li><p>åœ¨æ¯ä¸ª volatile <strong>è¯»</strong>æ“ä½œçš„åâ¾¯æ’â¼Šâ¼€ä¸ª LoadStore å±éšœ</p></li></ol><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282345615.png" alt="po_diagram (1)"></p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202406011436972.png" alt="image-20240601143620894"></p><h3 id="volatileç‰¹æ€§"><a href="#volatileç‰¹æ€§" class="headerlink" title="volatileç‰¹æ€§"></a>volatileç‰¹æ€§</h3><h4 id="ä¿è¯å¯è§æ€§"><a href="#ä¿è¯å¯è§æ€§" class="headerlink" title="ä¿è¯å¯è§æ€§"></a>ä¿è¯å¯è§æ€§</h4><p>è¯´æ˜ï¼šä¿è¯ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³å˜é‡ä¸€æ—¦æ”¹å˜æ‰€æœ‰çº¿ç¨‹ç«‹å³å¯è§ã€‚</p><h4 id="volatileå˜é‡çš„è¯»å†™è¿‡ç¨‹"><a href="#volatileå˜é‡çš„è¯»å†™è¿‡ç¨‹" class="headerlink" title="volatileå˜é‡çš„è¯»å†™è¿‡ç¨‹"></a>volatileå˜é‡çš„è¯»å†™è¿‡ç¨‹</h4><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282349584.png" alt="po_diagram (2)"></p><ol><li>read: ä½œç”¨äºä¸»å†…å­˜ï¼Œå°†å˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°å·¥ä½œå†…å­˜ï¼Œä¸»å†…å­˜åˆ°å·¥ä½œå†…å­˜</li><li>load: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†readä»ä¸»å†…å­˜ä¼ è¾“çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜å˜é‡å‰¯æœ¬ä¸­ï¼Œå³æ•°æ®åŠ è½½</li><li>use: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†å·¥ä½œå†…å­˜å˜é‡å‰¯æœ¬çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“JVMé‡åˆ°éœ€è¦è¯¥å˜é‡çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶ä¼šæ‰§è¡Œè¯¥æ“ä½œ</li><li>assign: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†ä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜å˜é‡ï¼Œæ¯å½“JVMé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼å­—èŠ‚ç æŒ‡ä»¤æ—¶ä¼šæ‰§è¡Œè¯¥æ“ä½œ</li><li>store: ä½œç”¨äºå·¥ä½œå†…å­˜ï¼Œå°†èµ‹å€¼å®Œæ¯•çš„å·¥ä½œå˜é‡çš„å€¼å†™å›ç»™ä¸»å†…å­˜</li><li>write: ä½œç”¨äºä¸»å†…å­˜ï¼Œå°†storeä¼ è¾“è¿‡æ¥çš„å˜é‡å€¼èµ‹å€¼ç»™ä¸»å†…å­˜ä¸­çš„å˜é‡</li><li>ç”±äºä¸Šè¿°åªèƒ½ä¿è¯å•æ¡æŒ‡ä»¤çš„åŸå­æ€§ï¼Œé’ˆå¯¹å¤šæ¡æŒ‡ä»¤çš„ç»„åˆæ€§åŸå­ä¿è¯ï¼Œæ²¡æœ‰å¤§é¢ç§¯åŠ é” ï¼Œæ‰€ä»¥ï¼ŒJVMæä¾›äº†å¦å¤–ä¸¤ä¸ªåŸå­æŒ‡ä»¤ï¼š</li><li>lock: ä½œç”¨äºä¸»å†…å­˜ï¼Œå°†ä¸€ä¸ªå˜é‡æ ‡è®°ä¸ºä¸€ä¸ªçº¿ç¨‹ç‹¬å çš„çŠ¶æ€ï¼Œåªæ˜¯å†™æ—¶å€™åŠ é”ï¼Œå°±åªæ˜¯é”äº†å†™å˜é‡çš„è¿‡ç¨‹ã€‚</li><li>unlock: ä½œç”¨äºä¸»å†…å­˜ï¼ŒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾ï¼Œç„¶åæ‰èƒ½è¢«å…¶ä»–çº¿ç¨‹å ç”¨</li></ol><h4 id="æ²¡æœ‰åŸå­æ€§"><a href="#æ²¡æœ‰åŸå­æ€§" class="headerlink" title="æ²¡æœ‰åŸå­æ€§"></a><span style="color: red;">æ²¡æœ‰åŸå­æ€§</span></h4><blockquote><p>volatileå˜é‡çš„å¤åˆæ“ä½œ(å¦‚i++)ä¸å…·æœ‰åŸå­æ€§</p></blockquote><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405282352674.png" alt="po_diagram"></p><p>âš ï¸ï¼šæ•°æ®åŠ è½½ã€æ•°æ®è®¡ç®—ã€æ•°æ®èµ‹å€¼ä¸æ˜¯åŸå­æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyNumber</span> &#123;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPlusPlus</span><span class="params">()</span> &#123;</span><br><span class="line">        number++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileNoAtomicDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">MyNumber</span> <span class="variable">myNumber</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyNumber</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                    myNumber.addPlusPlus();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + myNumber.number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»i++çš„å­—èŠ‚ç è§’åº¦è¯´æ˜ï¼š</p><p>åŸå­æ€§æŒ‡çš„æ˜¯ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œå³ä½¿æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªæ“ä½œä¸€æ—¦å¼€å§‹å°±ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å½±å“ã€‚<br>public void add(){<br>        i++; &#x2F;&#x2F;ä¸å…·å¤‡åŸå­æ€§ï¼Œè¯¥æ“ä½œæ˜¯å…ˆè¯»å–å€¼ï¼Œç„¶åå†™å›ä¸€ä¸ªæ–°å€¼ï¼Œç›¸å½“äºåŸæ¥çš„å€¼åŠ ä¸Š1ï¼Œåˆ†3æ­¥å®Œæˆ<br> }<br>å¦‚æœç¬¬äºŒä¸ªçº¿ç¨‹åœ¨ç¬¬ä¸€ä¸ªçº¿ç¨‹è¯»å–æ—§å€¼å’Œå†™å›æ–°å€¼æœŸé—´è¯»å–içš„åŸŸå€¼ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªçº¿ç¨‹å°±ä¼šä¸ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¸€èµ·çœ‹åˆ°åŒä¸€ä¸ªå€¼ï¼Œå¹¶æ‰§è¡Œç›¸åŒå€¼çš„åŠ 1æ“ä½œï¼Œè¿™ä¹Ÿå°±é€ æˆäº†çº¿ç¨‹å®‰å…¨å¤±è´¥ï¼Œå› æ­¤å¯¹äºaddæ–¹æ³•å¿…é¡»ä½¿ç”¨synchronizedä¿®é¥°ï¼Œä»¥ä¾¿ä¿è¯çº¿ç¨‹å®‰å…¨.</p><p>ä¸ä¿è¯åŸå­æ€§ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œâ€æ•°æ®è®¡ç®—â€å’Œâ€æ•°æ®èµ‹å€¼â€æ“ä½œå¯èƒ½å¤šæ¬¡å‡ºç°ï¼Œå³æ“ä½œéåŸå­ã€‚è‹¥æ•°æ®åœ¨åŠ è½½ä¹‹åï¼Œè‹¥ä¸»å†…å­˜countå˜é‡å‘ç”Ÿä¿®æ”¹ä¹‹åï¼Œç”±äºçº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„å€¼åœ¨æ­¤å‰å·²ç»åŠ è½½ï¼Œä»è€Œä¸ä¼šå¯¹å˜æ›´æ“ä½œåšå‡ºç›¸åº”å˜åŒ–ï¼Œå³ç§æœ‰å†…å­˜å’Œå…¬å…±å†…å­˜ä¸­å˜é‡ä¸åŒæ­¥ï¼Œè¿›è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ ï¼›å¯¹äºvolatileå˜é‡ï¼ŒJVMåªæ˜¯ä¿è¯ä»ä¸»å†…å­˜åŠ è½½åˆ°çº¿ç¨‹å·¥ä½œå†…å­˜çš„å€¼æ˜¯æœ€æ–°çš„ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åŠ è½½æ—¶æ˜¯æœ€æ–°çš„ã€‚<br>ç”±æ­¤å¯è§volatileè§£å†³çš„æ˜¯å˜é‡è¯»æ—¶çš„å¯è§æ€§é—®é¢˜ï¼Œä½†æ— æ³•ä¿è¯åŸå­æ€§ï¼Œå¯¹äºå¤šçº¿ç¨‹ä¿®æ”¹å…±äº«å˜é‡çš„åœºæ™¯å¿…é¡»ä½¿ç”¨åŠ é”åŒæ­¥</p><p>è¯»å–èµ‹å€¼ä¸€ä¸ªæ™®é€šå˜é‡çš„æƒ…å†µï¼š</p><p>å½“çº¿ç¨‹1å¯¹ä¸»å†…å­˜å¯¹è±¡å‘èµ·readæ“ä½œåˆ°writeæ“ä½œç¬¬ä¸€å¥—æµç¨‹çš„æ—¶é—´é‡Œï¼Œçº¿ç¨‹2éšæ—¶éƒ½æœ‰å¯èƒ½å¯¹è¿™ä¸ªä¸»å†…å­˜å¯¹è±¡å‘èµ·ç¬¬äºŒå¥—æ“ä½œã€‚</p><p>æ—¢ç„¶ä¸€ä¿®æ”¹å°±æ˜¯å¯è§ï¼Œä¸ºä»€ä¹ˆè¿˜ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Ÿ</p><p>volatileä¸»è¦æ˜¯å¯¹å…¶ä¸­éƒ¨åˆ†æŒ‡ä»¤åšäº†å¤„ç†</p><p>è¦use(ä½¿ç”¨)ä¸€ä¸ªå˜é‡çš„æ—¶å€™å¿…éœ€load(è½½å…¥ï¼‰ï¼Œè¦è½½å…¥çš„æ—¶å€™å¿…éœ€ä»ä¸»å†…å­˜read(è¯»å–ï¼‰è¿™æ ·å°±è§£å†³äº†è¯»çš„å¯è§æ€§ã€‚ </p><p>å†™æ“ä½œæ˜¯æŠŠassignå’Œstoreåšäº†å…³è”(åœ¨assign(èµ‹å€¼)åå¿…éœ€store(å­˜å‚¨))ã€‚store(å­˜å‚¨)åwrite(å†™å…¥)ã€‚ä¹Ÿå°±æ˜¯åšåˆ°äº†ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼çš„æ—¶å€™ä¸€ä¸²å…³è”æŒ‡ä»¤ç›´æ¥æŠŠå˜é‡å€¼å†™åˆ°ä¸»å†…å­˜ã€‚å°±è¿™æ ·é€šè¿‡ç”¨çš„æ—¶å€™ç›´æ¥ä»ä¸»å†…å­˜å–ï¼Œåœ¨èµ‹å€¼åˆ°ç›´æ¥å†™å›ä¸»å†…å­˜åšåˆ°äº†å†…å­˜å¯è§æ€§ã€‚o(â•¥ï¹â•¥)o</p><p> <strong>read-load-use</strong> å’Œ <strong>assign-store-write</strong> æˆä¸ºäº†ä¸¤ä¸ªä¸å¯åˆ†å‰²çš„åŸå­æ“ä½œï¼Œä½†æ˜¯åœ¨useå’Œassignä¹‹é—´ä¾ç„¶æœ‰æå°çš„ä¸€æ®µçœŸç©ºæœŸï¼Œæœ‰å¯èƒ½å˜é‡ä¼šè¢«å…¶ä»–çº¿ç¨‹è¯»å–ï¼Œå¯¼è‡´å†™ä¸¢å¤±ä¸€æ¬¡â€¦o(â•¥ï¹â•¥)o<br>ä½†æ˜¯æ— è®ºåœ¨å“ªä¸€ä¸ªæ—¶é—´ç‚¹ä¸»å†…å­˜çš„å˜é‡å’Œä»»ä¸€å·¥ä½œå†…å­˜çš„å˜é‡çš„å€¼éƒ½æ˜¯ç›¸ç­‰çš„ã€‚è¿™ä¸ªç‰¹æ€§å°±å¯¼è‡´äº†volatileå˜é‡ä¸é€‚åˆå‚ä¸åˆ°ä¾èµ–å½“å‰å€¼çš„è¿ç®—ï¼Œå¦‚i &#x3D; i + 1; i++;ä¹‹ç±»çš„ï¼Œé‚£ä¹ˆä¾é å¯è§æ€§çš„ç‰¹ç‚¹volatileå¯ä»¥ç”¨åœ¨å“ªäº›åœ°æ–¹å‘¢ï¼Ÿ é€šå¸¸volatileç”¨åšä¿å­˜æŸä¸ªçŠ¶æ€çš„booleanå€¼or intå€¼ã€‚ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹æåˆ°ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405290032234.png" alt="po_diagram (1)"></p><p>JVMçš„å­—èŠ‚ç ï¼Œi++åˆ†æˆä¸‰æ­¥ï¼Œé—´éš™æœŸä¸åŒæ­¥éåŸå­æ“ä½œ(i++)</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405290036054.png" alt="po_diagram (2)"></p><h3 id="æŒ‡ä»¤ç¦é‡æ’"><a href="#æŒ‡ä»¤ç¦é‡æ’" class="headerlink" title="æŒ‡ä»¤ç¦é‡æ’"></a>æŒ‡ä»¤ç¦é‡æ’</h3><h4 id="é‡æ’åº"><a href="#é‡æ’åº" class="headerlink" title="é‡æ’åº"></a>é‡æ’åº</h4><p>â€‹&#x3D;&#x3D;é‡æ’åºæ˜¯æŒ‡ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œå¯¹æŒ‡ä»¤åºåˆ—è¿›è¡Œé‡æ–°æ’åºçš„ä¸€ç§æ‰‹æ®µ&#x3D;&#x3D;ï¼Œæœ‰æ—¶å€™ä¼šæ”¹å˜ç¨‹åºè¯­å¥çš„å…ˆåé¡ºåº<br>ä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œå¯ä»¥é‡æ’åºï¼›å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¦æ­¢é‡æ’åº<br>æ³¨æ„âš ï¸ï¼šé‡æ’åçš„æŒ‡ä»¤ç»å¯¹ä¸èƒ½æ”¹å˜åŸæœ‰çš„ä¸²è¡Œè¯­ä¹‰ï¼è¿™ç‚¹åœ¨å¹¶å‘è®¾è®¡ä¸­å¿…é¡»è¦é‡ç‚¹è€ƒè™‘ï¼</p><p>é‡æ’åºçš„åˆ†ç±»å’Œæ‰§è¡Œæµç¨‹</p><ol><li>ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºï¼š ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ä¸²è¡Œè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°è°ƒæ•´æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº</li><li>æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åºï¼š å¤„ç†å™¨ä½¿ç”¨æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯æ¥è®²å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œï¼Œè‹¥ä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº</li><li>å†…å­˜ç³»ç»Ÿçš„é‡æ’åºï¼š ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»&#x2F;å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯ä¹±åºæ‰§è¡Œ</li><li>æ•°æ®ä¾èµ–æ€§ï¼šè‹¥ä¸¤ä¸ªæ“ä½œè®¿é—®åŒä¸€å˜é‡ï¼Œä¸”è¿™ä¸¤ä¸ªæ“ä½œä¸­æœ‰ä¸€ä¸ªä¸ºå†™æ“ä½œï¼Œæ­¤æ—¶ä¸¤æ“ä½œé—´å°±å­˜åœ¨æ•°æ®ä¾èµ–æ€§ã€‚</li></ol><p>æ¡ˆä¾‹ ï¼š<br><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405290042815.png" alt="image-20240529004156263"></p><p>å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¦æ­¢é‡æ’åº&#x3D;&#x3D;&#x3D;&gt; é‡æ’åºå‘ç”Ÿï¼Œä¼šå¯¼è‡´ç¨‹åºè¿è¡Œç»“æœä¸åŒã€‚<br> ç¼–è¯‘å™¨å’Œå¤„ç†å™¨åœ¨é‡æ’åºæ—¶ï¼Œä¼šéµå®ˆæ•°æ®ä¾èµ–æ€§ï¼Œä¸ä¼šæ”¹å˜å­˜åœ¨ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œ,ä½†ä¸åŒå¤„ç†å™¨å’Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ•°æ®æ€§ä¸ä¼šè¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨è€ƒè™‘ï¼Œå…¶åªä¼šä½œç”¨äºå•å¤„ç†å™¨å’Œå•çº¿ç¨‹ç¯å¢ƒï¼Œä¸‹é¢ä¸‰ç§æƒ…å†µï¼Œåªè¦é‡æ’åºä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œç¨‹åºçš„æ‰§è¡Œç»“æœå°±ä¼šè¢«æ”¹å˜ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405290050933.png" alt="image-20240529005028521"></p><h3 id="volatileçš„åº•å±‚å®ç°æ˜¯é€šè¿‡å†…å­˜å±éšœ"><a href="#volatileçš„åº•å±‚å®ç°æ˜¯é€šè¿‡å†…å­˜å±éšœ" class="headerlink" title="volatileçš„åº•å±‚å®ç°æ˜¯é€šè¿‡å†…å­˜å±éšœ"></a>volatileçš„åº•å±‚å®ç°æ˜¯é€šè¿‡å†…å­˜å±éšœ</h3><h4 id="volatileæœ‰å…³çš„ç¦æ­¢æŒ‡ä»¤é‡æ’çš„è¡Œä¸º"><a href="#volatileæœ‰å…³çš„ç¦æ­¢æŒ‡ä»¤é‡æ’çš„è¡Œä¸º" class="headerlink" title="volatileæœ‰å…³çš„ç¦æ­¢æŒ‡ä»¤é‡æ’çš„è¡Œä¸º"></a>volatileæœ‰å…³çš„ç¦æ­¢æŒ‡ä»¤é‡æ’çš„è¡Œä¸º</h4><ol><li>å½“ç¬¬ä¸€ä¸ªæ“ä½œä¸ºvolatileè¯»æ—¶ï¼Œä¸è®ºç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªæ“ä½œä¿è¯äº†volatileè¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«é‡æ’åˆ°volatileè¯»ä¹‹å‰ã€‚</li><li>å½“ç¬¬äºŒä¸ªæ“ä½œä¸ºvolatileå†™æ—¶ï¼Œä¸è®ºç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªæ“ä½œä¿è¯äº†volatileå†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«é‡æ’åˆ°volatileå†™ä¹‹åã€‚</li><li>å½“ç¬¬ä¸€ä¸ªæ“ä½œä¸ºvolatileå†™æ—¶ï¼Œç¬¬äºŒä¸ªæ“ä½œä¸ºvolatileè¯»æ—¶ï¼Œä¸èƒ½é‡æ’ã€‚</li></ol><h4 id="å››å¤§å±éšœçš„æ’å…¥æƒ…å†µ"><a href="#å››å¤§å±éšœçš„æ’å…¥æƒ…å†µ" class="headerlink" title="å››å¤§å±éšœçš„æ’å…¥æƒ…å†µ"></a>å››å¤§å±éšœçš„æ’å…¥æƒ…å†µ</h4><ol><li>åœ¨æ¯ä¸€ä¸ªvolatileå†™æ“ä½œå‰é¢æ’å…¥ä¸€ä¸ªStoreStoreå±éšœï¼ŒStoreStoreå±éšœå¯ä»¥ä¿è¯åœ¨volatileå†™ä¹‹å‰ï¼Œå…¶å‰é¢çš„æ‰€æœ‰æ™®é€šå†™æ“ä½œéƒ½å·²ç»åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚</li><li>åœ¨æ¯ä¸€ä¸ªvolatileå†™æ“ä½œåé¢æ’å…¥ä¸€ä¸ªStoreLoadå±éšœï¼ŒStoreLoadå±éšœçš„ä½œç”¨æ˜¯é¿å…volatileå†™ä¸åé¢å¯èƒ½æœ‰çš„volatileè¯»&#x2F;å†™æ“ä½œé‡æ’åºã€‚</li><li>åœ¨æ¯ä¸€ä¸ªvolatileè¯»æ“ä½œå‰é¢æ’å…¥ä¸€ä¸ªLoadLoadå±éšœï¼ŒLoadLoadå±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„volatileè¯»ä¸ä¸‹é¢çš„æ™®é€šè¯»é‡æ’åºã€‚</li><li>åœ¨æ¯ä¸€ä¸ªvolatileè¯»æ“ä½œåé¢æ’å…¥ä¸€ä¸ªLoadStoreå±éšœï¼ŒLoadStoreå±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„volatileè¯»ä¸ä¸‹é¢çš„æ™®é€šå†™é‡æ’åºã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileTest</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        i = <span class="number">2</span>;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;---i  =  &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405290058587.png" alt="image-20240529005803058"></p><h3 id="å¦‚ä½•æ­£ç¡®ä½¿ç”¨volatile"><a href="#å¦‚ä½•æ­£ç¡®ä½¿ç”¨volatile" class="headerlink" title="å¦‚ä½•æ­£ç¡®ä½¿ç”¨volatile"></a>å¦‚ä½•æ­£ç¡®ä½¿ç”¨volatile</h3><p>å•ä¸€èµ‹å€¼å¯ä»¥ï¼Œbutå«å¤åˆè¿ç®—èµ‹å€¼ä¸å¯ä»¥(i++ä¹‹ç±»)</p><p>volatile int a &#x3D; 10;  volatile boolean flag &#x3D; false;</p><p>1ã€çŠ¶æ€æ ‡å¿—ï¼Œåˆ¤æ–­ä¸šåŠ¡æ˜¯å¦ç»“æŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ï¼šä½œä¸ºä¸€ä¸ªå¸ƒå°”çŠ¶æ€æ ‡å¿—ï¼Œç”¨äºæŒ‡ç¤ºå‘ç”Ÿäº†ä¸€ä¸ªé‡è¦çš„ä¸€æ¬¡æ€§äº‹ä»¶ï¼Œä¾‹å¦‚å®Œæˆåˆå§‹åŒ–æˆ–ä»»åŠ¡ç»“æŸ </span></span><br><span class="line"><span class="comment"> * ç†ç”±ï¼šçŠ¶æ€æ ‡å¿—å¹¶ä¸ä¾èµ–äºç¨‹åºå†…ä»»ä½•å…¶ä»–çŠ¶æ€ï¼Œä¸”é€šå¸¸åªæœ‰ä¸€ç§çŠ¶æ€è½¬æ¢ </span></span><br><span class="line"><span class="comment"> * ä¾‹å­ï¼šåˆ¤æ–­ä¸šåŠ¡æ˜¯å¦ç»“æŸ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UseVolatileDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">                <span class="comment">//do something......</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="comment">//æš‚åœå‡ ç§’é’Ÿçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2L</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€å¼€é”€è¾ƒä½çš„è¯»ï¼Œå†™é”ç­–ç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UseVolatileDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ï¼šå½“è¯»è¿œå¤šäºå†™ï¼Œç»“åˆä½¿ç”¨å†…éƒ¨é”å’Œ volatile å˜é‡æ¥å‡å°‘åŒæ­¥çš„å¼€é”€</span></span><br><span class="line"><span class="comment">     * ç†ç”±ï¼šåˆ©ç”¨volatileä¿è¯è¯»å–æ“ä½œçš„å¯è§æ€§ï¼›åˆ©ç”¨synchronizedä¿è¯å¤åˆæ“ä½œçš„åŸå­æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> value;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value;   <span class="comment">//åˆ©ç”¨volatileä¿è¯è¯»å–æ“ä½œçš„å¯è§æ€§</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value++; <span class="comment">//åˆ©ç”¨synchronizedä¿è¯å¤åˆæ“ä½œçš„åŸå­æ€§</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DCLåŒç«¯é”çš„å‘å¸ƒ"><a href="#DCLåŒç«¯é”çš„å‘å¸ƒ" class="headerlink" title="DCLåŒç«¯é”çš„å‘å¸ƒ"></a>DCLåŒç«¯é”çš„å‘å¸ƒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeDoubleCheckSingleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">SafeDoubleCheckSingleton</span> <span class="variable">singleton</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//ç§æœ‰åŒ–æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SafeDoubleCheckSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åŒé‡é”è®¾è®¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SafeDoubleCheckSingleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//1.å¤šçº¿ç¨‹å¹¶å‘åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šé€šè¿‡åŠ é”ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">            <span class="keyword">synchronized</span> (SafeDoubleCheckSingleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (singleton == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//éšæ‚£ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç”±äºé‡æ’åºï¼Œè¯¥å¯¹è±¡å¯èƒ½è¿˜æœªå®Œæˆåˆå§‹åŒ–å°±è¢«å…¶ä»–çº¿ç¨‹è¯»å–</span></span><br><span class="line">                    singleton = <span class="keyword">new</span> <span class="title class_">SafeDoubleCheckSingleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.å¯¹è±¡åˆ›å»ºå®Œæ¯•ï¼Œæ‰§è¡ŒgetInstance()å°†ä¸éœ€è¦è·å–é”ï¼Œç›´æ¥è¿”å›åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> singleton;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SafeDoubleCheckSingleton</span> <span class="variable">instance</span> <span class="operator">=</span> SafeDoubleCheckSingleton.getInstance();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å•çº¿ç¨‹ç¯å¢ƒä¸‹(æˆ–è€…è¯´æ­£å¸¸æƒ…å†µä¸‹)ï¼Œåœ¨â€é—®é¢˜ä»£ç å¤„â€ï¼Œä¼šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼Œä¿è¯èƒ½è·å–åˆ°å·²å®Œæˆåˆå§‹åŒ–çš„å®ä¾‹</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405290127295.png" alt="image-20240529012737397"></p><p>è§£å†³01:åŠ volatileä¿®é¥°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡volatileå£°æ˜ï¼Œå®ç°çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> SafeDoubleCheckSingleton singleton;</span><br></pre></td></tr></table></figure><p>è§£å†³02:é‡‡ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç°åœ¨æ¯”è¾ƒå¥½çš„åšæ³•å°±æ˜¯é‡‡ç”¨é™æ€å†…éƒ¨å†…çš„æ–¹å¼å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonDemo</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonDemoHandler</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">SingletonDemo</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingletonDemo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonDemo <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonDemoHandler.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h1><h2 id="ThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ThreadLocalæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>â€‹ThreadLocalæä¾›çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚è¿™äº›å˜é‡ä¸æ­£å¸¸çš„å˜é‡ä¸åŒï¼Œå› ä¸º&#x3D;&#x3D;æ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ThreadLocalå®ä¾‹çš„æ—¶å€™ï¼ˆé€šè¿‡å…¶getæˆ–setæ–¹æ³•ï¼‰éƒ½æœ‰è‡ªå·±çš„ã€ç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰¯æœ¬ã€‚&#x3D;&#x3D;ThreadLocalå®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„ç§æœ‰é™æ€å­—æ®µï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯å¸Œæœ›å°†çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·IDæˆ–äº‹åŠ¡IDï¼‰ä¸çº¿ç¨‹å…³è”èµ·æ¥ã€‚</p><pre><code> å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸“å±çš„æœ¬åœ°å˜é‡å‰¯æœ¬ï¼Œä¸»è¦è§£å†³äº†è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œé€šè¿‡ä½¿ç”¨get()å’Œset()æ–¹æ³•ï¼Œè·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</code></pre><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405302243032.png" alt="image-20240530224314824"></p><h2 id="apiä»‹ç»"><a href="#apiä»‹ç»" class="headerlink" title="apiä»‹ç»"></a>apiä»‹ç»</h2><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>1ã€new ä¹‹åå¤å†™initiaValue()</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405302305249.png" alt="image-20240530230508608"></p><p>è¯´æ˜ï¼šå¦‚æœæ˜¯ JDK8 çš„åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ Instant ä»£æ›¿ Dateï¼ŒLocalDateTime ä»£æ›¿ Calendarï¼ŒDateTimeFormatter ä»£æ›¿ SimpleDateFormatï¼Œå®˜æ–¹ç»™å‡ºçš„è§£é‡Šï¼šsimple beautiful strong immutable thread-safeã€‚</p><p>2ã€ThreadLocal.withInitial(() - 0);</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405302245537.png" alt="image-20240530224540542"></p><h3 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h3><p>â€‹è¿”å›æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å½“å‰çº¿ç¨‹å‰¯æœ¬ä¸­çš„å€¼ã€‚å¦‚æœå˜é‡å¯¹å½“å‰çº¿ç¨‹æ²¡æœ‰å€¼ï¼Œåˆ™é¦–å…ˆå°†å…¶åˆå§‹åŒ–ä¸ºinitialValueæ–¹æ³•è°ƒç”¨è¿”å›çš„å€¼ã€‚è¿”å›å€¼:çº¿ç¨‹æœ¬åœ°å½“å‰çº¿ç¨‹çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h3><p>è®¾ç½®å€¼ã€‚<code>threadLocal.set(value);</code></p><p>å°†æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å½“å‰çº¿ç¨‹å‰¯æœ¬è®¾ç½®ä¸ºæŒ‡å®šå€¼ã€‚å¤§å¤šæ•°å­ç±»ä¸éœ€è¦é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåªä¾èµ–äº{@link initialValue}æ–¹æ³•æ¥è®¾ç½®çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ã€‚</p><p>@param valueè¦å­˜å‚¨åœ¨å½“å‰çº¿ç¨‹çš„è¿™ä¸ªçº¿ç¨‹æœ¬åœ°å‰¯æœ¬ä¸­çš„å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        createMap(t, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="remove"><a href="#remove" class="headerlink" title="remove()"></a>remove()</h3><p>ç§»é™¤æ­¤çº¿ç¨‹å±€éƒ¨å˜é‡çš„å½“å‰çº¿ç¨‹å€¼ã€‚å¦‚æœè¿™ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡éšåè¢«å½“å‰çº¿ç¨‹{@linkplain get read}ï¼Œå®ƒçš„å€¼å°†é€šè¿‡è°ƒç”¨å®ƒçš„{@link initialValue}æ–¹æ³•é‡æ–°åˆå§‹åŒ–ï¼Œé™¤éå½“å‰çº¿ç¨‹åœ¨æ­¤æœŸé—´å°†å®ƒçš„å€¼è®¾ç½®ä¸º{@linkplain set set}ã€‚è¿™å¯èƒ½å¯¼è‡´åœ¨å½“å‰çº¿ç¨‹ä¸­å¤šæ¬¡è°ƒç”¨{@code initialValue}æ–¹æ³•ã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405302309010.png" alt="image-20240530230912717"></p><h3 id="æ¡ˆä¾‹ï¼š"><a href="#æ¡ˆä¾‹ï¼š" class="headerlink" title="æ¡ˆä¾‹ï¼š"></a>æ¡ˆä¾‹ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalDateUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1ã€æ¯æ¬¡ä½¿ç”¨æ—¥å†æ§ä»¶éƒ½éœ€è¦è®¾ç½®ä¸€æ¬¡æ—¥æœŸæ ¼å¼ï¼Œåˆšå…¥è¡Œçš„æ—¶å€™ï¼Œç»éªŒä¸ä¸°å¯Œã€‚ä¸ºäº†æ–¹ä¾¿æŠŠsdfå®šä¹‰ä¸ºä¸€ä¸ªé™æ€å˜é‡ï¼Œå¹¶ä¸”æŠŠå®ƒåˆ†è£…æˆäº†ä¸€ä¸ªæ–¹æ³•ã€‚åæ¥å…¶ä»–åŒäº‹ç›¸ç»§è°ƒç”¨ï¼Œå„ç§é¢‘ç¹è°ƒé”™ã€‚è¢«æµ‹è¯•ç—›æ‰¹ã€‚</span></span><br><span class="line">    <span class="comment">//  æºç ï¼šsdfä¸­çš„æ—¥æœŸæ ¼å¼æ˜¯ä¸åŒæ­¥çš„ï¼Œæ¨èä½æ¯ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºç‹¬ç«‹çš„æ ¼å¼å®ä¾‹ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªæ ¼å¼ã€‚åˆ™å®ƒå¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ã€‚</span></span><br><span class="line">    <span class="comment">//  åŸå› ï¼šSimpleDateFormatç±»å†…éƒ¨æœ‰ä¸€ä¸ªCalendarå¯¹è±¡å¼•ç”¨,å®ƒç”¨æ¥å‚¨å­˜å’Œè¿™ä¸ªSimpleDateFormatç›¸å…³çš„æ—¥æœŸä¿¡æ¯,ä¾‹å¦‚sdf.parse(dateStr),sdf.format(date) è¯¸å¦‚æ­¤ç±»çš„æ–¹æ³•å‚æ•°ä¼ å…¥çš„æ—¥æœŸç›¸å…³String,Dateç­‰ç­‰, éƒ½æ˜¯äº¤ç”±Calendarå¼•ç”¨æ¥å‚¨å­˜çš„.è¿™æ ·å°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜å¦‚æœä½ çš„SimpleDateFormatæ˜¯ä¸ªstaticçš„, é‚£ä¹ˆå¤šä¸ªthread ä¹‹é—´å°±ä¼šå…±äº«è¿™ä¸ªSimpleDateFormat, åŒæ—¶ä¹Ÿæ˜¯å…±äº«è¿™ä¸ªCalendarå¼•ç”¨ã€‚</span></span><br><span class="line">    <span class="comment">//  clearæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">parse</span><span class="params">(String stringDate)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="keyword">return</span> sdf.parse(stringDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è§£å†³æ–¹æ¡ˆ1:å°†SimpleDateFormatå®šä¹‰æˆå±€éƒ¨å˜é‡ã€‚</span></span><br><span class="line">    <span class="comment">// ç¼ºç‚¹ï¼šæ¯è°ƒç”¨ä¸€æ¬¡æ–¹æ³•å°±ä¼šåˆ›å»ºä¸€ä¸ªSimpleDateFormatå¯¹è±¡ï¼Œæ–¹æ³•ç»“æŸåˆè¦ä½œä¸ºåƒåœ¾å›æ”¶ã€‚</span></span><br><span class="line">    <span class="comment">// çº¿ç¨‹å°‘çš„æ—¶å€™å¯ä»¥è€ƒè™‘ï¼Œå¦‚æœçº¿ç¨‹å¤šçš„è¯å°±ä¸åˆé€‚äº†</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è§£å†³æ–¹æ¡ˆ2   ThreadLocalå¯ä»¥ç¡®ä¿æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥å¾—åˆ°å„è‡ªå•ç‹¬çš„ä¸€ä¸ªSimpleDateFormatçš„å¯¹è±¡ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±ä¸å­˜åœ¨ç«äº‰é—®é¢˜äº†ã€‚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;SimpleDateFormat&gt; sdfThreadLocal = ThreadLocal.withInitial(() -&gt; <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Date <span class="title function_">parseByThreadLocal</span><span class="params">(String stringDate)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="keyword">return</span> sdfThreadLocal.get().parse(stringDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è§£å†³æ–¹æ¡ˆ3 DateTimeFormatter ä»£æ›¿ SimpleDateFormat</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*è¯´æ˜ï¼šå¦‚æœæ˜¯ JDK8 çš„åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ Instant ä»£æ›¿ Dateï¼ŒLocalDateTime ä»£æ›¿ Calendarï¼Œ</span></span><br><span class="line"><span class="comment">    DateTimeFormatter ä»£æ›¿ SimpleDateFormatï¼Œå®˜æ–¹ç»™å‡ºçš„è§£é‡Šï¼šsimple beautiful strong immutable</span></span><br><span class="line"><span class="comment">    thread-safeã€‚*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">DateTimeFormatter</span> <span class="variable">DATE_TIME_FORMAT</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">format</span><span class="params">(LocalDateTime localDateTime)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DATE_TIME_FORMAT.format(localDateTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LocalDateTime <span class="title function_">parseByDateTimeFormatter</span><span class="params">(String dateString)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.parse(dateString, DATE_TIME_FORMAT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//System.out.println(ThreadLocalDateUtils.parse(&quot;2011-11-11 11:11:11&quot;));</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">/*SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span></span><br><span class="line"><span class="comment">                    System.out.println(sdf.parse(&quot;2011-11-11 11:11:11&quot;));</span></span><br><span class="line"><span class="comment">                    sdf = null;*/</span></span><br><span class="line"></span><br><span class="line">                    System.out.println(ThreadLocalDateUtils.parse(<span class="string">&quot;2011-11-11 11:11:11&quot;</span>));</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">//remove();</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ThreadLocalæºç åˆ†æ"><a href="#ThreadLocalæºç åˆ†æ" class="headerlink" title="ThreadLocalæºç åˆ†æ"></a>ThreadLocalæºç åˆ†æ</h2><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405302347505.png" alt="image-20240530234737568"></p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405302352618.png" alt="Snipaste_2024-05-30_23-49-06"></p><h3 id="Threadã€ThreadLocalã€ThreadLocalMap-å…³ç³»"><a href="#Threadã€ThreadLocalã€ThreadLocalMap-å…³ç³»" class="headerlink" title="Threadã€ThreadLocalã€ThreadLocalMap å…³ç³»"></a>Threadã€ThreadLocalã€ThreadLocalMap å…³ç³»</h3><p>ThreadLocalæºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Construct a new map initially containing (firstKey, firstValue).</span></span><br><span class="line"><span class="comment"> * ThreadLocalMaps are constructed lazily, so we only create</span></span><br><span class="line"><span class="comment"> * one when we have at least one entry to put in it.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;</span><br><span class="line">    table = <span class="keyword">new</span> <span class="title class_">Entry</span>[INITIAL_CAPACITY];</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="number">1</span>);</span><br><span class="line">    table[i] = <span class="keyword">new</span> <span class="title class_">Entry</span>(firstKey, firstValue);</span><br><span class="line">    size = <span class="number">1</span>;</span><br><span class="line">    setThreshold(INITIAL_CAPACITY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Threadæºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ThreadLocal values pertaining to this thread. This map is maintained</span></span><br><span class="line"><span class="comment"> * by the ThreadLocal class. */</span></span><br><span class="line">ThreadLocal.<span class="type">ThreadLocalMap</span> <span class="variable">threadLocals</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šThreadé‡Œé¢æœ‰ä¸€ä¸ªThreadLocal</p><p>ThreadLocalå’ŒThreadLocalMapï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405310006877.png" alt="image-20240531000603742"></p><p>è¯´æ˜ï¼šThreadLocalé‡Œé¢æœ‰ä¸€ä¸ªThreadLocalMap</p><p>ThreadLocalMapå®é™…ä¸Šæ˜¯ä¸€ä¸ªä»¥ThreadLocalå®ä¾‹ä¸ºkeyï¼Œä»»æ„å¯¹è±¡ä¸ºValueçš„Entryæ•°ç»„ã€‚å½“ç»™ä½ æˆ‘ä»¬ä¸ºThread Localå˜é‡èµ‹å€¼çš„æ—¶å€™ï¼Œå®é™…ä¸Šå°±æ˜¯ä»¥å½“å‰çš„ThreadLocalä¸ºkey,å€¼ä¸ºvalueçš„Entryå¾€è¿™ä¸ªThreadLocalMapä¸­å­˜æ”¾ã€‚</p><p>ThreadLocalMapæºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalMap</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * The entries in this hash map extend WeakReference, using</span></span><br><span class="line"><span class="comment">         * its main ref field as the key (which is always a</span></span><br><span class="line"><span class="comment">         * ThreadLocal object).  Note that null keys (i.e. entry.get()</span></span><br><span class="line"><span class="comment">         * == null) mean that the key is no longer referenced, so the</span></span><br><span class="line"><span class="comment">         * entry can be expunged from table.  Such entries are referred to</span></span><br><span class="line"><span class="comment">         * as &quot;stale entries&quot; in the code that follows.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class="line">            <span class="comment">/** The value associated with this ThreadLocal. */</span></span><br><span class="line">            Object value;</span><br><span class="line"></span><br><span class="line">            Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">                <span class="built_in">super</span>(k);</span><br><span class="line">                value = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šThreadLocalMapä¸­å®é™…ä¸­çš„å­˜å‚¨æ˜¯ç”¨Entryï¼Œæ˜¯å¼±å¼•ç”¨</p><h2 id="ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜"><a href="#ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜" class="headerlink" title="ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜"></a>ThreadLocalå†…å­˜æ³„éœ²é—®é¢˜</h2><h3 id="ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼"><a href="#ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼" class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼"></a>ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼</h3><p>ä¸å†ä¼šè¢«ä½¿ç”¨çš„å¯¹è±¡æˆ–è€…å˜é‡å ç”¨çš„å†…å­˜ä¸èƒ½è¢«å›æ”¶ï¼Œå°±æ˜¯å†…å­˜æ³„éœ²ã€‚</p><h3 id="è°æƒ¹çš„ç¥¸ï¼Ÿ"><a href="#è°æƒ¹çš„ç¥¸ï¼Ÿ" class="headerlink" title="è°æƒ¹çš„ç¥¸ï¼Ÿ"></a>è°æƒ¹çš„ç¥¸ï¼Ÿ</h3><h4 id="å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>ThreadLocalMapä¸WeakReference ï¼ŒThreadLocalMapä»å­—é¢ä¸Šå°±å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªä¿å­˜ThreadLocalå¯¹è±¡çš„map(å…¶å®æ˜¯ä»¥å®ƒä¸ºKey)ï¼Œä¸è¿‡æ˜¯ç»è¿‡äº†ä¸¤å±‚åŒ…è£…çš„ThreadLocalå¯¹è±¡ï¼š<br>ï¼ˆ1ï¼‰ç¬¬ä¸€å±‚åŒ…è£…æ˜¯ä½¿ç”¨ WeakReference&lt;&lt;ThreadLocal&lt;<?>> å°†ThreadLocalå¯¹è±¡å˜æˆä¸€ä¸ªå¼±å¼•ç”¨çš„å¯¹è±¡ï¼›ï¼ˆ2ï¼‰ç¬¬äºŒå±‚åŒ…è£…æ˜¯å®šä¹‰äº†ä¸€ä¸ªä¸“é—¨çš„ç±» Entry æ¥æ‰©å±• WeakReference<<ThreadLocal<<?>&gt;ï¼š</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405310018509.png" alt="image-20240531001810543"></p><h5 id="å¼ºå¼•ç”¨-é»˜è®¤æ”¯æŒæ¨¡å¼"><a href="#å¼ºå¼•ç”¨-é»˜è®¤æ”¯æŒæ¨¡å¼" class="headerlink" title="å¼ºå¼•ç”¨(é»˜è®¤æ”¯æŒæ¨¡å¼)"></a>å¼ºå¼•ç”¨(é»˜è®¤æ”¯æŒæ¨¡å¼)</h5><p>â€‹&#x3D;&#x3D;å½“å†…å­˜ä¸è¶³ï¼ŒJVMå¼€å§‹åƒåœ¾å›æ”¶ï¼Œå¯¹äºå¼ºå¼•ç”¨çš„å¯¹è±¡ï¼Œå°±ç®—æ˜¯å‡ºç°äº†OOMä¹Ÿä¸ä¼šå¯¹è¯¥å¯¹è±¡è¿›è¡Œå›æ”¶&#x3D;&#x3D;ï¼Œæ­»éƒ½ä¸æ”¶ã€‚</p><p>â€‹å¼ºå¼•ç”¨æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ™®é€šå¯¹è±¡å¼•ç”¨ï¼Œåªè¦è¿˜æœ‰å¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œå°±èƒ½è¡¨æ˜å¯¹è±¡è¿˜â€œæ´»ç€â€ï¼Œåƒåœ¾æ”¶é›†å™¨ä¸ä¼šç¢°è¿™ç§å¯¹è±¡ã€‚åœ¨ Java ä¸­æœ€å¸¸è§çš„å°±æ˜¯å¼ºå¼•ç”¨ï¼ŒæŠŠä¸€ä¸ªå¯¹è±¡èµ‹ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸ªå¼•ç”¨å˜é‡å°±æ˜¯ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«å¼ºå¼•ç”¨å˜é‡å¼•ç”¨æ—¶ï¼Œå®ƒå¤„äºå¯è¾¾çŠ¶æ€ï¼Œå®ƒæ˜¯ä¸å¯èƒ½è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶çš„ï¼Œå³ä½¿è¯¥å¯¹è±¡ä»¥åæ°¸è¿œéƒ½ä¸ä¼šè¢«ç”¨åˆ°JVMä¹Ÿä¸ä¼šå›æ”¶ã€‚å› æ­¤å¼ºå¼•ç”¨æ˜¯é€ æˆJavaå†…å­˜æ³„æ¼çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚</p><p>â€‹å¯¹äºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çš„å¼•ç”¨å…³ç³»ï¼Œåªè¦è¶…è¿‡äº†å¼•ç”¨çš„ä½œç”¨åŸŸæˆ–è€…æ˜¾å¼åœ°å°†ç›¸åº”ï¼ˆå¼ºï¼‰å¼•ç”¨èµ‹å€¼ä¸º nullï¼Œä¸€èˆ¬è®¤ä¸ºå°±æ˜¯å¯ä»¥è¢«åƒåœ¾æ”¶é›†çš„äº†(å½“ç„¶å…·ä½“å›æ”¶æ—¶æœºè¿˜æ˜¯è¦çœ‹åƒåœ¾æ”¶é›†ç­–ç•¥)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">strongReference</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MyObject</span> <span class="variable">myObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObject</span>();<span class="comment">//é»˜è®¤ï¼Œå¼ºå¼•ç”¨,æ­»äº†éƒ½ä¸æ”¾æ‰‹</span></span><br><span class="line">    System.out.println(<span class="string">&quot;gc before: &quot;</span> + myObject);</span><br><span class="line">    myObject = <span class="literal">null</span>;</span><br><span class="line">    System.gc();<span class="comment">//æ‰‹åŠ¨æŒ¡çš„æ–¹å¼å¼€å¯Gcå›æ”¶ã€‚</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;gc after: &quot;</span> + myObject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h5><p>è½¯å¼•ç”¨æ˜¯ä¸€ç§ç›¸å¯¹å¼ºå¼•ç”¨å¼±åŒ–äº†ä¸€äº›çš„å¼•ç”¨ï¼Œéœ€è¦ç”¨java.lang.ref.SoftReferenceç±»æ¥å®ç°ï¼Œå¯ä»¥è®©å¯¹è±¡è±å…ä¸€äº›åƒåœ¾æ”¶é›†ã€‚</p><p>å¯¹äºåªæœ‰è½¯å¼•ç”¨çš„å¯¹è±¡æ¥è¯´ï¼Œ</p><pre><code> å½“ç³»ç»Ÿå†…å­˜å……è¶³æ—¶å®ƒ         ä¸ä¼š     è¢«å›æ”¶ï¼Œ å½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶å®ƒ         ä¼š       è¢«å›æ”¶ã€‚</code></pre><p>è½¯å¼•ç”¨é€šå¸¸ç”¨åœ¨å¯¹å†…å­˜æ•æ„Ÿçš„ç¨‹åºä¸­ï¼Œæ¯”å¦‚é«˜é€Ÿç¼“å­˜å°±æœ‰ç”¨åˆ°è½¯å¼•ç”¨ï¼Œå†…å­˜å¤Ÿç”¨çš„æ—¶å€™å°±ä¿ç•™ï¼Œä¸å¤Ÿç”¨å°±å›æ”¶ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">softReference</span><span class="params">()</span> &#123;</span><br><span class="line">    SoftReference&lt;MyObject&gt; softReference = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MyObject</span>());<span class="comment">//è½¯å¼•ç”¨</span></span><br><span class="line"><span class="comment">// 1ã€å†…å­˜å¤Ÿç”¨ï¼Œä¸ä¼šå›æ”¶</span></span><br><span class="line">    <span class="comment">/*å†…å­˜å¤Ÿç”¨</span></span><br><span class="line"><span class="comment">    System.out.println(&quot;gc beforeå†…å­˜å¤Ÿç”¨: &quot;+softReference);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    System.gc();//æ‰‹åŠ¨æŒ¡çš„æ–¹å¼å¼€å¯Gcå›æ”¶ã€‚</span></span><br><span class="line"><span class="comment">    try &#123; TimeUnit.SECONDS.sleep(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    System.out.println(&quot;gc afterå†…å­˜å¤Ÿç”¨: &quot;+softReference);*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ã€å†…å­˜ä¸å¤Ÿç”¨ï¼Œå›æ”¶</span></span><br><span class="line">    <span class="comment">//è®¾ç½®å‚æ•°-Xms10m -Xmx10m</span></span><br><span class="line">    System.out.println(<span class="string">&quot;gc before: &quot;</span> + softReference);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">9</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-----gc afterå†…å­˜ä¸å¤Ÿ: &quot;</span> + softReference.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h5><p>å¼±å¼•ç”¨éœ€è¦ç”¨java.lang.ref.WeakReferenceç±»æ¥å®ç°ï¼Œå®ƒæ¯”è½¯å¼•ç”¨çš„ç”Ÿå­˜æœŸæ›´çŸ­ï¼Œå¯¹äºåªæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ¥è¯´ï¼Œåªè¦åƒåœ¾å›æ”¶æœºåˆ¶ä¸€è¿è¡Œï¼Œä¸ç®¡JVMçš„å†…å­˜ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶è¯¥å¯¹è±¡å ç”¨çš„å†…å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">weakReference</span><span class="params">()</span> &#123;</span><br><span class="line">    WeakReference&lt;MyObject&gt; weakReference = <span class="keyword">new</span> <span class="title class_">WeakReference</span>(<span class="keyword">new</span> <span class="title class_">MyObject</span>());</span><br><span class="line">    System.out.println(<span class="string">&quot;gc before: &quot;</span> + weakReference.get());</span><br><span class="line"></span><br><span class="line">    System.gc();<span class="comment">//æ‰‹åŠ¨æŒ¡çš„æ–¹å¼å¼€å¯Gcå›æ”¶ã€‚</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;gc after: &quot;</span> + weakReference.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡å¦‚æœ‰ä¸€ä¸ªåº”ç”¨éœ€è¦è¯»å–å¤§é‡çš„æœ¬åœ°å›¾ç‰‡:</p><ul><li>å¦‚æœæ¯æ¬¡è¯»å–å›¾ç‰‡éƒ½ä»ç¡¬ç›˜è¯»å–åˆ™ä¼šä¸¥é‡å½±å“æ€§èƒ½,</li><li>å¦‚æœä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­åˆå¯èƒ½é€ æˆå†…å­˜æº¢å‡ºã€‚æ­¤æ—¶ä½¿ç”¨è½¯å¼•ç”¨å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li></ul><p>è®¾è®¡æ€è·¯æ˜¯ï¼šç”¨ä¸€ä¸ªHashMapæ¥ä¿å­˜å›¾ç‰‡çš„è·¯å¾„å’Œç›¸åº”å›¾ç‰‡å¯¹è±¡å…³è”çš„è½¯å¼•ç”¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å›æ”¶è¿™äº›ç¼“å­˜å›¾ç‰‡å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´ï¼Œä»è€Œæœ‰æ•ˆåœ°é¿å…äº†OOMçš„é—®é¢˜ã€‚</p><p>Map&lt;String, SoftReference<Bitmap>&gt; imageCache &#x3D; new HashMap&lt;String, SoftReference<Bitmap>&gt;();</p><h5 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a>è™šå¼•ç”¨</h5><p> è™šå¼•ç”¨éœ€è¦java.lang.ref.PhantomReferenceç±»æ¥å®ç°ã€‚</p><p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯&#x3D;&#x3D;å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚&#x3D;&#x3D;<br>å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œ<br>å®ƒä¸èƒ½å•ç‹¬ä½¿ç”¨ä¹Ÿä¸èƒ½é€šè¿‡å®ƒè®¿é—®å¯¹è±¡ï¼Œè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ— (ReferenceQueue)è”åˆä½¿ç”¨ã€‚</p><p>è™šå¼•ç”¨çš„ä¸»è¦ä½œç”¨æ˜¯è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€ã€‚ ä»…ä»…æ˜¯æä¾›äº†ä¸€ç§ç¡®ä¿å¯¹è±¡è¢« finalizeä»¥åï¼ŒåšæŸäº›äº‹æƒ…çš„æœºåˆ¶ã€‚ PhantomReferenceçš„getæ–¹æ³•æ€»æ˜¯è¿”å›nullï¼Œå› æ­¤æ— æ³•è®¿é—®å¯¹åº”çš„å¼•ç”¨å¯¹è±¡ã€‚</p><p>å…¶æ„ä¹‰åœ¨äºï¼šè¯´æ˜ä¸€ä¸ªå¯¹è±¡å·²ç»è¿›å…¥finalizationé˜¶æ®µï¼Œå¯ä»¥è¢«gcå›æ”¶ï¼Œç”¨æ¥å®ç°æ¯”finalizationæœºåˆ¶æ›´çµæ´»çš„å›æ”¶æ“ä½œ ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œè®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶çš„æ—¶å€™æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥æˆ–è€…åç»­æ·»åŠ è¿›ä¸€æ­¥çš„å¤„ç†ã€‚</p><h5 id="GCRootså’Œå››å¤§å¼•ç”¨å°æ€»ç»“"><a href="#GCRootså’Œå››å¤§å¼•ç”¨å°æ€»ç»“" class="headerlink" title="GCRootså’Œå››å¤§å¼•ç”¨å°æ€»ç»“"></a>GCRootså’Œå››å¤§å¼•ç”¨å°æ€»ç»“</h5><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405310047366.png" alt="image-20240531004657979"></p><h5 id="å…³ç³»ï¼š"><a href="#å…³ç³»ï¼š" class="headerlink" title="å…³ç³»ï¼š"></a>å…³ç³»ï¼š</h5><p>æ¯ä¸ªThreadå¯¹è±¡ç»´æŠ¤ç€ä¸€ä¸ªThreadLocalMapçš„å¼•ç”¨<br>ThreadLocalMapæ˜¯ThreadLocalçš„å†…éƒ¨ç±»ï¼Œç”¨Entryæ¥è¿›è¡Œå­˜å‚¨<br>è°ƒç”¨ThreadLocalçš„set()æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯å¾€ThreadLocalMapè®¾ç½®å€¼ï¼Œkeyæ˜¯ThreadLocalå¯¹è±¡ï¼Œå€¼Valueæ˜¯ä¼ é€’è¿›æ¥çš„å¯¹è±¡<br>è°ƒç”¨ThreadLocalçš„get()æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯å¾€ThreadLocalMapè·å–å€¼ï¼Œkeyæ˜¯ThreadLocalå¯¹è±¡<br>ThreadLocalæœ¬èº«å¹¶ä¸å­˜å‚¨å€¼ï¼Œå®ƒåªæ˜¯è‡ªå·±ä½œä¸ºä¸€ä¸ªkeyæ¥è®©çº¿ç¨‹ä»ThreadLocalMapè·å–valueï¼Œæ­£å› ä¸ºè¿™ä¸ªåŸç†ï¼Œæ‰€ä»¥ThreadLocalèƒ½å¤Ÿå®ç°â€œæ•°æ®éš”ç¦»â€ï¼Œè·å–å½“å‰çº¿ç¨‹çš„å±€éƒ¨å˜é‡å€¼ï¼Œä¸å—å…¶ä»–çº¿ç¨‹å½±å“ï½</p><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨å¼±å¼•ç”¨-ä¸ç”¨å¦‚ä½•ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨å¼±å¼•ç”¨-ä¸ç”¨å¦‚ä½•ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨å¼±å¼•ç”¨?ä¸ç”¨å¦‚ä½•ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ç”¨å¼±å¼•ç”¨?ä¸ç”¨å¦‚ä½•ï¼Ÿ</h3><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405310053775.png" alt="image-20240531005313750"></p><h4 id="ä¸ºä»€ä¹ˆæºä»£ç ç”¨å¼±å¼•ç”¨ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæºä»£ç ç”¨å¼±å¼•ç”¨ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæºä»£ç ç”¨å¼±å¼•ç”¨ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæºä»£ç ç”¨å¼±å¼•ç”¨ï¼Ÿ</h4><p>ä¸ºä»€ä¹ˆæºä»£ç ç”¨å¼±å¼•ç”¨?<br>å½“function01æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œæ ˆå¸§é”€æ¯å¼ºå¼•ç”¨ tl ä¹Ÿå°±æ²¡æœ‰äº†ã€‚ä½†æ­¤æ—¶çº¿ç¨‹çš„ThreadLocalMapé‡ŒæŸä¸ªentryçš„keyå¼•ç”¨è¿˜æŒ‡å‘è¿™ä¸ªå¯¹è±¡<br>è‹¥è¿™ä¸ª<strong>key</strong>å¼•ç”¨æ˜¯<strong>å¼ºå¼•ç”¨</strong>ï¼Œå°±ä¼šå¯¼è‡´<strong>key</strong>æŒ‡å‘çš„<strong>ThreadLocal</strong>å¯¹è±¡åŠvæŒ‡å‘çš„å¯¹è±¡ä¸èƒ½è¢«<strong>gc</strong>å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ï¼›<br>è‹¥è¿™ä¸ª<strong>key</strong>å¼•ç”¨æ˜¯<strong>å¼±å¼•ç”¨</strong>å°±<strong>å¤§æ¦‚ç‡</strong>ä¼šå‡å°‘å†…å­˜æ³„æ¼çš„é—®é¢˜(<strong>è¿˜æœ‰ä¸€ä¸ªkeyä¸ºnullçš„é›·</strong>)ã€‚ä½¿ç”¨å¼±å¼•ç”¨ï¼Œå°±å¯ä»¥ä½¿<strong>ThreadLocal</strong>å¯¹è±¡åœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åé¡ºåˆ©è¢«å›æ”¶ä¸”<strong>Entry</strong>çš„<strong>keyå¼•ç”¨æŒ‡å‘ä¸ºnullã€‚</strong></p><p>â€“ä¸‹é¢è¿™å¥è¯ï¼Œæˆ‘ä»¬åç»­èŠï¼Œæœ¬èŠ‚å…ˆå¿½ç•¥<br>æ­¤åæˆ‘ä»¬è°ƒç”¨get,setæˆ–removeæ–¹æ³•æ—¶ï¼Œå°±ä¼šå°è¯•åˆ é™¤keyä¸ºnullçš„entryï¼Œå¯ä»¥é‡Šæ”¾valueå¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚</p><p>1 å½“æˆ‘ä»¬ä¸ºthreadLocalå˜é‡èµ‹å€¼ï¼Œå®é™…ä¸Šå°±æ˜¯å½“å‰çš„Entry(threadLocalå®ä¾‹ä¸ºkeyï¼Œå€¼ä¸ºvalue)å¾€è¿™ä¸ªthreadLocalMapä¸­å­˜æ”¾ã€‚Entryä¸­çš„keyæ˜¯å¼±å¼•ç”¨ï¼Œå½“threadLocalå¤–éƒ¨å¼ºå¼•ç”¨è¢«ç½®ä¸ºnull(tl&#x3D;null),é‚£ä¹ˆç³»ç»Ÿ GC çš„æ—¶å€™ï¼Œæ ¹æ®å¯è¾¾æ€§åˆ†æï¼Œè¿™ä¸ªthreadLocalå®ä¾‹å°±æ²¡æœ‰ä»»ä½•ä¸€æ¡é“¾è·¯èƒ½å¤Ÿå¼•ç”¨åˆ°å®ƒï¼Œè¿™ä¸ªThreadLocalåŠ¿å¿…ä¼šè¢«å›æ”¶ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒThreadLocalMapä¸­å°±ä¼šå‡ºç°keyä¸ºnullçš„Entryï¼Œå°±æ²¡æœ‰åŠæ³•è®¿é—®è¿™äº›keyä¸ºnullçš„Entryçš„valueï¼Œå¦‚æœå½“å‰çº¿ç¨‹å†è¿Ÿè¿Ÿä¸ç»“æŸçš„è¯ï¼Œè¿™äº›keyä¸ºnullçš„Entryçš„valueå°±ä¼šä¸€ç›´å­˜åœ¨ä¸€æ¡å¼ºå¼•ç”¨é“¾ï¼šThread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; valueæ°¸è¿œæ— æ³•å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚â€¦</p><h5 id="keyä¸ºnullçš„entryï¼ŒåŸç†è§£æ"><a href="#keyä¸ºnullçš„entryï¼ŒåŸç†è§£æ" class="headerlink" title="keyä¸ºnullçš„entryï¼ŒåŸç†è§£æ"></a>keyä¸ºnullçš„entryï¼ŒåŸç†è§£æ</h5><p>ThreadLocalMapä½¿ç”¨ThreadLocalçš„å¼±å¼•ç”¨ä½œä¸ºkeyï¼Œå¦‚æœä¸€ä¸ªThreadLocalæ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨å¼•ç”¨ä»–ï¼Œé‚£ä¹ˆç³»ç»Ÿgcçš„æ—¶å€™ï¼Œè¿™ä¸ªThreadLocalåŠ¿å¿…ä¼šè¢«å›æ”¶ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒThreadLocalMapä¸­å°±ä¼šå‡ºç°keyä¸ºnullçš„Entryï¼Œå°±æ²¡æœ‰åŠæ³•è®¿é—®è¿™äº›keyä¸ºnullçš„Entryçš„valueï¼Œå¦‚æœå½“å‰çº¿ç¨‹å†è¿Ÿè¿Ÿä¸ç»“æŸçš„è¯(æ¯”å¦‚æ­£å¥½ç”¨åœ¨çº¿ç¨‹æ± )ï¼Œè¿™äº›keyä¸ºnullçš„Entryçš„valueå°±ä¼šä¸€ç›´å­˜åœ¨ä¸€æ¡å¼ºå¼•ç”¨é“¾ã€‚</p><p>è™½ç„¶å¼±å¼•ç”¨ï¼Œä¿è¯äº†keyæŒ‡å‘çš„ThreadLocalå¯¹è±¡èƒ½è¢«åŠæ—¶å›æ”¶ï¼Œä½†æ˜¯væŒ‡å‘çš„valueå¯¹è±¡æ˜¯éœ€è¦ThreadLocalMapè°ƒç”¨getã€setæ—¶å‘ç°keyä¸ºnullæ—¶æ‰ä¼šå»å›æ”¶æ•´ä¸ªentryã€valueï¼Œå› æ­¤å¼±å¼•ç”¨ä¸èƒ½100%ä¿è¯å†…å­˜ä¸æ³„éœ²ã€‚æˆ‘ä»¬è¦åœ¨ä¸ä½¿ç”¨æŸä¸ªThreadLocalå¯¹è±¡åï¼Œæ‰‹åŠ¨è°ƒç”¨remoevæ–¹æ³•æ¥åˆ é™¤å®ƒï¼Œå°¤å…¶æ˜¯åœ¨çº¿ç¨‹æ± ä¸­ï¼Œä¸ä»…ä»…æ˜¯å†…å­˜æ³„éœ²çš„é—®é¢˜ï¼Œå› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯é‡å¤ä½¿ç”¨çš„ï¼Œæ„å‘³ç€è¿™ä¸ªçº¿ç¨‹çš„ThreadLocalMapå¯¹è±¡ä¹Ÿæ˜¯é‡å¤ä½¿ç”¨çš„ï¼Œå¦‚æœæˆ‘ä»¬ä¸æ‰‹åŠ¨è°ƒç”¨removeæ–¹æ³•ï¼Œé‚£ä¹ˆåé¢çš„çº¿ç¨‹å°±æœ‰å¯èƒ½è·å–åˆ°ä¸Šä¸ªçº¿ç¨‹é—ç•™ä¸‹æ¥çš„valueå€¼ï¼Œé€ æˆbugã€‚</p><p><img src="https://qijian-1301807797.cos.ap-guangzhou.myqcloud.com/markdown/202405310058199.png" alt="image-20240531005758402"></p><p>setã€getæ–¹æ³•ä¼šå»æ£€æŸ¥æ‰€æœ‰é”®ä¸ºnullçš„Entryå¯¹è±¡</p><h4 id="ç»“è®ºï¼š"><a href="#ç»“è®ºï¼š" class="headerlink" title="ç»“è®ºï¼š"></a>ç»“è®ºï¼š</h4><p>â€‹ä»å‰é¢çš„set,getEntry,removeæ–¹æ³•çœ‹å‡ºï¼Œåœ¨threadLocalçš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼Œé’ˆå¯¹threadLocalå­˜åœ¨çš„å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œéƒ½ä¼šé€šè¿‡expungeStaleEntryï¼ŒcleanSomeSlots,replaceStaleEntryè¿™ä¸‰ä¸ªæ–¹æ³•æ¸…ç†æ‰keyä¸ºnullçš„è„entryã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>ThreadLocal å¹¶ä¸è§£å†³çº¿ç¨‹é—´å…±äº«æ•°æ®çš„é—®é¢˜</li><li>ThreadLocal é€‚ç”¨äºå˜é‡åœ¨çº¿ç¨‹é—´éš”ç¦»ä¸”åœ¨æ–¹æ³•é—´å…±äº«çš„åœºæ™¯</li><li>ThreadLocal é€šè¿‡éšå¼çš„åœ¨ä¸åŒçº¿ç¨‹å†…åˆ›å»ºç‹¬ç«‹å®ä¾‹å‰¯æœ¬é¿å…äº†å®ä¾‹çº¿ç¨‹å®‰å…¨çš„é—®é¢˜</li><li>æ¯ä¸ªçº¿ç¨‹æŒæœ‰ä¸€ä¸ªåªå±äºè‡ªå·±çš„ä¸“å±Mapå¹¶ç»´æŠ¤äº†ThreadLocalå¯¹è±¡ä¸å…·ä½“å®ä¾‹çš„æ˜ å°„ï¼Œè¯¥Mapç”±äºåªè¢«æŒæœ‰å®ƒçš„çº¿ç¨‹è®¿é—®ï¼Œæ•…ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨ä»¥åŠé”çš„é—®é¢˜</li><li>ThreadLocalMapçš„Entryå¯¹ThreadLocalçš„å¼•ç”¨ä¸ºå¼±å¼•ç”¨ï¼Œé¿å…äº†ThreadLocalå¯¹è±¡æ— æ³•è¢«å›æ”¶çš„é—®é¢˜</li><li>éƒ½ä¼šé€šè¿‡expungeStaleEntryï¼ŒcleanSomeSlots,replaceStaleEntryè¿™ä¸‰ä¸ªæ–¹æ³•å›æ”¶é”®ä¸º null çš„ Entry å¯¹è±¡çš„å€¼ï¼ˆå³ä¸ºå…·ä½“å®ä¾‹ï¼‰ä»¥åŠ Entry å¯¹è±¡æœ¬èº«ä»è€Œé˜²æ­¢å†…å­˜æ³„æ¼ï¼Œå±äºå®‰å…¨åŠ å›ºçš„æ–¹æ³•</li></ol><h2 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h2><h3 id="Futureå’ŒCallableæ¥å£"><a href="#Futureå’ŒCallableæ¥å£" class="headerlink" title="Futureå’ŒCallableæ¥å£"></a>Futureå’ŒCallableæ¥å£</h3><p>Futureæ¥å£å®šä¹‰äº†æ“ä½œå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œä¸€äº›æ–¹æ³•ï¼Œå¦‚è·å–å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€å–æ¶ˆä»»åŠ¡çš„æ‰§è¡Œã€åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆã€åˆ¤æ–­ä»»åŠ¡æ‰§è¡Œæ˜¯å¦å®Œæ¯•ç­‰ã€‚</p><p>Callableæ¥å£ä¸­å®šä¹‰äº†éœ€è¦æœ‰è¿”å›çš„ä»»åŠ¡éœ€è¦å®ç°çš„æ–¹æ³•ã€‚æ¯”å¦‚ä¸»çº¿ç¨‹è®©ä¸€ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå­çº¿ç¨‹å¯èƒ½æ¯”è¾ƒè€—æ—¶ï¼Œå¯åŠ¨å­çº¿ç¨‹å¼€å§‹æ‰§è¡Œä»»åŠ¡åï¼Œä¸»çº¿ç¨‹å°±å»åšå…¶ä»–äº‹æƒ…äº†ï¼Œè¿‡äº†ä¸€ä¼šæ‰å»è·å–å­ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span>Â com.zzyy.study.test;<span class="keyword">import</span>Â java.util.concurrent.*;</span><br><span class="line"><span class="keyword">public</span>Â <span class="keyword">class</span>Â <span class="title class_">CompletableFutureDemo</span>&#123;Â </span><br><span class="line">  <span class="keyword">public</span>Â <span class="keyword">static</span>Â <span class="keyword">void</span>Â <span class="title function_">main</span><span class="params">(String[]Â args)</span>Â <span class="keyword">throws</span>Â ExecutionException,Â InterruptedException,Â TimeoutExceptionÂ &#123;Â Â Â Â </span><br><span class="line">    FutureTask&lt;String&gt;Â futureTaskÂ =Â <span class="keyword">new</span>Â <span class="title class_">FutureTask</span>&lt;&gt;(()Â -&gt;Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">      System.out.println(<span class="string">&quot;-----comeÂ inÂ FutureTask&quot;</span>);Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">      <span class="keyword">try</span>Â &#123;Â </span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);Â </span><br><span class="line">      &#125;Â <span class="keyword">catch</span>Â (InterruptedExceptionÂ e)Â &#123;Â </span><br><span class="line">        e.printStackTrace();Â </span><br><span class="line">      &#125;Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">      <span class="keyword">return</span>Â <span class="string">&quot;&quot;</span>+ThreadLocalRandom.current().nextInt(<span class="number">100</span>);Â Â Â Â Â Â Â Â </span><br><span class="line">      &#125;</span><br><span class="line">                                                    );Â Â Â Â Â Â Â </span><br><span class="line">    <span class="type">Thread</span>Â <span class="variable">t1</span>Â <span class="operator">=</span>Â <span class="keyword">new</span>Â <span class="title class_">Thread</span>(futureTask,<span class="string">&quot;t1&quot;</span>);Â Â Â Â Â Â Â Â </span><br><span class="line">    t1.start();Â Â Â Â Â Â Â Â </span><br><span class="line">    <span class="comment">//3ç§’é’Ÿåæ‰å‡ºæ¥ç»“æœï¼Œè¿˜æ²¡æœ‰è®¡ç®—ä½ æå‰æ¥æ‹¿(åªè¦ä¸€è°ƒç”¨getæ–¹æ³•ï¼Œå¯¹äºç»“æœå°±æ˜¯ä¸è§ä¸æ•£ï¼Œä¼šå¯¼è‡´é˜»å¡)Â Â Â Â Â Â Â Â       //System.out.println(Thread.currentThread().getName()+&quot;\t&quot;+futureTask.get());Â Â Â Â Â Â Â Â </span></span><br><span class="line">    <span class="comment">//3ç§’é’Ÿåæ‰å‡ºæ¥ç»“æœï¼Œæˆ‘åªæƒ³ç­‰å¾…1ç§’é’Ÿï¼Œè¿‡æ—¶ä¸å€™Â Â Â Â Â Â Â Â System.out.println(Thread.currentThread().getName()+&quot;\t&quot;+futureTask.get(1L,TimeUnit.SECONDS));Â Â Â Â Â Â Â Â System.out.println(Thread.currentThread().getName()+&quot;\t&quot;+&quot;Â run...Â here&quot;);Â Â Â Â </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h3><p>Futureå®é™…é‡‡ç”¨FutureTaskå®ç°ï¼Œè¯¥å¯¹è±¡ç›¸å½“äºæ˜¯æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„æ¡¥æ¢ï¼Œæ¶ˆè´¹è€…é€šè¿‡ FutureTask å­˜å‚¨ä»»åŠ¡çš„å¤„ç†ç»“æœï¼Œæ›´æ–°ä»»åŠ¡çš„çŠ¶æ€ï¼šæœªå¼€å§‹ã€æ­£åœ¨å¤„ç†ã€å·²å®Œæˆç­‰ã€‚</p><p>1ã€get()é˜»å¡ï¼šä¸€æ—¦è°ƒç”¨get()æ–¹æ³•ï¼Œä¸ç®¡æ˜¯å¦è®¡ç®—å®Œæˆéƒ½ä¼šå¯¼è‡´é˜»å¡ï¼Œo(â•¥ï¹â•¥)o</p><p>2ã€get(long timeout, TimeUnit unit)ï¼šåªç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè¿‡æ—¶ä¸ä¾¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FutureTaskDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Task</span>();</span><br><span class="line">        <span class="comment">//æ„å»ºfutureTask</span></span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(task);</span><br><span class="line">        <span class="comment">//ä½œä¸ºRunnableå…¥å‚</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask).start();</span><br><span class="line">        System.out.println(<span class="string">&quot;taskè¿è¡Œç»“æœï¼š&quot;</span> + futureTask.get());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å­çº¿ç¨‹æ­£åœ¨è®¡ç®—&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">                sum += i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€isDone()è½®è¯¢ï¼šè½®è¯¢çš„æ–¹å¼ä¼šè€—è´¹æ— è°“çš„CPUèµ„æºï¼Œè€Œä¸”ä¹Ÿä¸è§å¾—èƒ½åŠæ—¶åœ°å¾—åˆ°è®¡ç®—ç»“æœï¼›å¦‚æœæƒ³è¦å¼‚æ­¥è·å–ç»“æœ,é€šå¸¸éƒ½ä¼šä»¥è½®è¯¢çš„æ–¹å¼å»è·å–ç»“æœå°½é‡ä¸è¦é˜»å¡ï¼›æ‰§è¡Œç»“æŸï¼ˆå®Œæˆ&#x2F;å–æ¶ˆ&#x2F;å¼‚å¸¸ï¼‰è¿”å›true</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CompletableFutureDemo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;-----come in FutureTask&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span> + ThreadLocalRandom.current().nextInt(<span class="number">100</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;çº¿ç¨‹å®Œæˆä»»åŠ¡&quot;</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç”¨äºé˜»å¡å¼è·å–ç»“æœ,å¦‚æœæƒ³è¦å¼‚æ­¥è·å–ç»“æœ,é€šå¸¸éƒ½ä¼šä»¥è½®è¯¢çš„æ–¹å¼å»è·å–ç»“æœ</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">             <span class="comment">// å¦‚æœçº¿ç¨‹ç»“æŸäº†ï¼Œåˆ™è·å–ç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span> (futureTask.isDone()) &#123;</span><br><span class="line">                System.out.println(futureTask.get());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java åŸºç¡€ </category>
          
          <category> java åŸºç¡€ é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java çŸ¥è¯†æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç•™è¨€ç‰ˆ</title>
      <link href="/2024/11/14/comment/"/>
      <url>/2024/11/14/comment/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/11/13/index/"/>
      <url>/2024/11/13/index/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è”åˆç´¢å¼•çš„åŸºç¡€</title>
      <link href="/2024/11/13/%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E7%9A%84%E5%9F%BA%E7%A1%80/"/>
      <url>/2024/11/13/%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E7%9A%84%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p><strong>&#x3D;&#x3D;è”åˆç´¢å¼•å¤±æ•ˆçš„åœºæ™¯ï¼Ÿa,b,c è”åˆç´¢å¼• b&#x3D;null, a&#x3D;xx and b&#x3D;xx or c&#x3D;xx ä¼šç”Ÿæ•ˆå—ï¼Ÿ&#x3D;&#x3D;</strong></p><p>è”åˆç´¢å¼•åœ¨ MySQL ä¸­çš„ä½¿ç”¨å¯èƒ½ä¼šå—åˆ°æŸ¥è¯¢æ¡ä»¶çš„å½±å“ï¼Œä»è€Œå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚äº†è§£è”åˆç´¢å¼•å¤±æ•ˆçš„åœºæ™¯æœ‰åŠ©äºä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½ã€‚</p><h3 id="è”åˆç´¢å¼•çš„åŸºç¡€"><a href="#è”åˆç´¢å¼•çš„åŸºç¡€" class="headerlink" title="è”åˆç´¢å¼•çš„åŸºç¡€"></a>è”åˆç´¢å¼•çš„åŸºç¡€</h3><p>å‡è®¾æœ‰ä¸€ä¸ªè¡¨ <code>my_table</code>ï¼Œä¸Šé¢æœ‰ä¸€ä¸ªè”åˆç´¢å¼• <code>idx_abc</code>ï¼Œå®ƒåŒ…å«åˆ— <code>a, b, c</code>ã€‚è¯¥ç´¢å¼•æŒ‰ç…§ <code>(a, b, c)</code> çš„é¡ºåºå­˜å‚¨ã€‚</p><h3 id="è”åˆç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯"><a href="#è”åˆç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯" class="headerlink" title="è”åˆç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯"></a>è”åˆç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯</h3><ol><li><p><strong>åˆ—é¡ºåºå’ŒæŸ¥è¯¢æ¡ä»¶</strong>ï¼š</p><ul><li>è”åˆç´¢å¼•åœ¨ä½¿ç”¨æ—¶éœ€è¦éµå¾ªç´¢å¼•åˆ—çš„é¡ºåºã€‚å¦‚æœæŸ¥è¯¢ä¸­è·³è¿‡äº†ç´¢å¼•ä¸­çš„æŸä¸€åˆ—ï¼Œåé¢çš„åˆ—ä¸ä¼šä½¿ç”¨ç´¢å¼•ã€‚</li><li>ä¾‹å¦‚ï¼Œå¦‚æœåªæœ‰ <code>a</code> å’Œ <code>b</code> åˆ›å»ºäº†ç´¢å¼•ï¼Œè€ŒæŸ¥è¯¢ä¸­åªä½¿ç”¨äº† <code>b</code> åˆ—æ¡ä»¶ï¼Œç´¢å¼•å°†ä¸ä¼šç”Ÿæ•ˆã€‚</li></ul></li><li><p><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼š</p><ul><li>åœ¨è”åˆç´¢å¼•ä¸­ï¼Œä¸€æ—¦æœ‰ä¸€åˆ—ä½¿ç”¨äº†èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ <code>&lt;</code>, <code>&gt;</code>, <code>BETWEEN</code>ï¼Œ<code>LIKE</code> ç­‰ï¼‰ï¼Œåé¢çš„åˆ—å°†ä¸å†ä½¿ç”¨ç´¢å¼•ã€‚</li></ul></li><li><p><strong>NULL åˆ¤æ–­</strong>ï¼š</p><ul><li>å¯¹äº <code>IS NULL</code> å’Œ <code>IS NOT NULL</code> æ¡ä»¶ï¼Œç´¢å¼•çš„ä½¿ç”¨å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå…·ä½“å–å†³äºç´¢å¼•ç±»å‹å’ŒæŸ¥è¯¢ä¼˜åŒ–å™¨çš„é€‰æ‹©ã€‚</li></ul></li></ol><h3 id="å…·ä½“é—®é¢˜åˆ†æ"><a href="#å…·ä½“é—®é¢˜åˆ†æ" class="headerlink" title="å…·ä½“é—®é¢˜åˆ†æ"></a>å…·ä½“é—®é¢˜åˆ†æ</h3><p>å¯¹äºæŸ¥è¯¢ <code>b IS NULL</code> å’Œ <code>a = xx AND b = xx OR c = xx</code>ï¼Œæˆ‘ä»¬æ¥åˆ†ææ˜¯å¦ä¼šä½¿ç”¨è”åˆç´¢å¼• <code>(a, b, c)</code>ã€‚</p><ol><li><p>**<code>b IS NULL</code>**ï¼š</p><ul><li>å¯¹äº <code>b IS NULL</code>ï¼Œå¦‚æœç´¢å¼•æ˜¯ <code>(a, b, c)</code>ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹ <code>a</code> æä¾›æ¡ä»¶ï¼Œé‚£ä¹ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæŸ¥è¯¢ä¸ä¼šä½¿ç”¨åˆ°è”åˆç´¢å¼•ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¼ ç»Ÿçš„ B-Tree ç´¢å¼•ä¸­ã€‚</li></ul></li><li><p>**<code>a = xx AND b = xx OR c = xx</code>**ï¼š</p><ul><li>å¯¹äº <code>a = xx AND b = xx OR c = xx</code>ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå°†å…¶åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†æ¥å¤„ç†ï¼š<ul><li><code>a = xx AND b = xx</code></li><li><code>c = xx</code></li></ul></li><li>è¿™é‡Œæœ‰ä¸€ä¸ª <code>OR</code> æ¡ä»¶ï¼ŒMySQL çš„æŸ¥è¯¢ä¼˜åŒ–å™¨åœ¨é‡åˆ° <code>OR</code> æ—¶ï¼Œå¾€å¾€ä¼šæ”¾å¼ƒä½¿ç”¨è”åˆç´¢å¼•è€Œæ”¹ä¸ºå…¨è¡¨æ‰«æï¼Œç‰¹åˆ«æ˜¯å½“ <code>OR</code> çš„æ¡ä»¶ä¸èƒ½éƒ½ä½¿ç”¨åˆ°åŒä¸€ä¸ªç´¢å¼•æ—¶ã€‚</li><li>å¦‚æœ <code>a = xx AND b = xx</code> éƒ¨åˆ†å¯ä»¥æœ‰æ•ˆä½¿ç”¨åˆ° <code>(a, b, c)</code> ç´¢å¼•ï¼Œä½†æ˜¯ <code>c = xx</code> ä¸èƒ½å•ç‹¬ä½¿ç”¨è¿™ä¸ªç´¢å¼•ï¼Œå› æ­¤æ•´ä½“ä¸Šå¯èƒ½ä¼šé€‰æ‹©å…¨è¡¨æ‰«æã€‚</li></ul></li></ol><h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><ol><li><p>**<code>b IS NULL</code>**ï¼š</p><ul><li>è¿™ä¸ªæŸ¥è¯¢å¾ˆå¯èƒ½ä¸ä¼šä½¿ç”¨è”åˆç´¢å¼• <code>(a, b, c)</code>ï¼Œå› ä¸ºæ²¡æœ‰å¯¹ç´¢å¼•çš„å‰å¯¼åˆ— <code>a</code> æä¾›æ¡ä»¶ã€‚</li></ul></li><li><p>**<code>a = xx AND b = xx OR c = xx</code>**ï¼š</p><ul><li>ç”±äºå­˜åœ¨ <code>OR</code> æ¡ä»¶ï¼Œå¹¶ä¸” <code>c = xx</code> ä¸èƒ½åˆ©ç”¨ <code>(a, b, c)</code> ç´¢å¼•çš„å‰å¯¼åˆ—ï¼Œå› æ­¤æŸ¥è¯¢ä¼˜åŒ–å™¨å¯èƒ½ä¸ä¼šä½¿ç”¨è”åˆç´¢å¼•ï¼Œè€Œæ˜¯é€‰æ‹©å…¨è¡¨æ‰«æã€‚</li></ul></li></ol><h3 id="ä¼˜åŒ–å»ºè®®"><a href="#ä¼˜åŒ–å»ºè®®" class="headerlink" title="ä¼˜åŒ–å»ºè®®"></a>ä¼˜åŒ–å»ºè®®</h3><ol><li><p><strong>é¿å…ä½¿ç”¨ <code>OR</code> æ¡ä»¶</strong>ï¼š</p><ul><li><p>å°½é‡é¿å…åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ <code>OR</code> æ¡ä»¶ï¼Œå¯ä»¥é€šè¿‡ <code>UNION</code> åˆ†å¼€ä¸¤ä¸ªæŸ¥è¯¢æ¥ä¼˜åŒ–ï¼Œå¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> my_table <span class="keyword">WHERE</span> a <span class="operator">=</span> xx <span class="keyword">AND</span> b <span class="operator">=</span> xx)</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line">(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> my_table <span class="keyword">WHERE</span> c <span class="operator">=</span> xx);</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ç´¢å¼•è¦†ç›–</strong>ï¼š</p><ul><li>è®¾è®¡è”åˆç´¢å¼•æ—¶ï¼Œè€ƒè™‘æŸ¥è¯¢çš„å…·ä½“ä½¿ç”¨æƒ…å†µï¼Œç¡®ä¿æœ€å·¦å‰ç¼€åŸåˆ™ã€‚</li></ul></li><li><p><strong>EXPLAIN åˆ†æ</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>EXPLAIN</code> å‘½ä»¤æ¥åˆ†ææŸ¥è¯¢è®¡åˆ’ï¼Œç¡®ä¿ç´¢å¼•çš„ä½¿ç”¨æƒ…å†µã€‚</li></ul></li></ol><p>é€šè¿‡äº†è§£è¿™äº›åŸåˆ™ï¼Œå¯ä»¥æ›´å¥½åœ°è®¾è®¡å’Œä¼˜åŒ– MySQL æ•°æ®åº“ä¸­çš„è”åˆç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> mysql çŸ¥è¯†æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
